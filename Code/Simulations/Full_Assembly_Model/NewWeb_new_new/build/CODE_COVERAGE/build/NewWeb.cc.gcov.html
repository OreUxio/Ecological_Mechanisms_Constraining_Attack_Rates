<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - NewWeb.info - build/NewWeb.cc</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">build</a> - NewWeb.cc<span style="font-size: 80%;"> (source / <a href="NewWeb.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">NewWeb.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">339</td>
            <td class="headerCovTableEntry">4679</td>
            <td class="headerCovTableEntryLo">7.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-05-14 13:23:03</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">42</td>
            <td class="headerCovTableEntry">154</td>
            <td class="headerCovTableEntryLo">27.3 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // $Id: NewWeb.cc 2503 2017-02-27 17:37:46Z axel $</a>
<span class="lineNum">       2 </span>            : #include &lt;string.h&gt;
<span class="lineNum">       3 </span>            : #include &lt;stdlib.h&gt;
<span class="lineNum">       4 </span>            : #include &lt;unistd.h&gt;  // for getpid, sysconf and number of CPUs
<span class="lineNum">       5 </span>            : #include &lt;sys/types.h&gt; // for number of CPUs on MAC
<span class="lineNum">       6 </span>            : #include &lt;sys/sysctl.h&gt; // for number of CPUs on MAC
<span class="lineNum">       7 </span>            : #include &lt;math.h&gt; // this should include NAN
<span class="lineNum">       8 </span>            : #ifndef NAN
<span class="lineNum">       9 </span>            : //#warning &quot;defining my own NAN&quot;
<span class="lineNum">      10 </span>            : static const double my_nan=sqrt(-1.0);
<span class="lineNum">      11 </span>            : #define NAN my_nan
<span class="lineNum">      12 </span>            : #endif
<span class="lineNum">      13 </span>            : 
<span class="lineNum">      14 </span>            : #include &lt;fstream&gt;
<span class="lineNum">      15 </span>            : #include &lt;iostream&gt;
<span class="lineNum">      16 </span>            : 
<span class="lineNum">      17 </span>            : #include &quot;NewWeb.h&quot;
<span class="lineNum">      18 </span>            : #include &quot;random.h&quot;
<span class="lineNum">      19 </span>            : //#include &quot;TOP.h&quot;
<span class="lineNum">      20 </span>            : #include &quot;evaluate.h&quot;
<span class="lineNum">      21 </span>            : #include &quot;random_pick_field.h&quot;
<span class="lineNum">      22 </span>            : #include &quot;matrix_transformers.h&quot;
<span class="lineNum">      23 </span>            : //#include &quot;linpack_eigen.h&quot;
<span class="lineNum">      24 </span>            : #include &quot;xy_graph.h&quot;
<span class="lineNum">      25 </span>            : #include &quot;link_strength_matrix.h&quot;
<span class="lineNum">      26 </span>            : #include &quot;CompMatrix.h&quot;
<span class="lineNum">      27 </span>            : #include &quot;packed_simulation.h&quot;
<span class="lineNum">      28 </span>            : //#include &lt;values.h&gt;
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : using namespace std;
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span><span class="lineCov">         45 : static my_evaluator_t eval_here;</span>
<span class="lineNum">      34 </span>            : static double animal_invasion_pressure_kappa_a=1.4;
<span class="lineNum">      35 </span>            : static double plant_invasion_pressure_kappa_p=1.4;
<span class="lineNum">      36 </span>            : static int number_of_plant_species=0; // UNUSED!! 
<span class="lineNum">      37 </span>            : double any_invasion_pressure_q=0;
<span class="lineNum">      38 </span>            : double unified_invasion_pressure_kappa=0; //extern
<span class="lineNum">      39 </span>            : static int mean_field_threshold=0; // At what abundance to use mean
<span class="lineNum">      40 </span>            :                                    // field invasions. 0=NEVER
<span class="lineNum">      41 </span>            : static double speciation_rate=1;  // UNUSED!!
<span class="lineNum">      42 </span>            : static double invasion_rate=1;    // UNUSED!!
<span class="lineNum">      43 </span>            : static double n_neutral=1;
<span class="lineNum">      44 </span>            : static double conservation_tolerance=10000;///&lt; prevents inserted species from being delete right away
<span class="lineNum">      45 </span>            : int max_steady_state_size=0; ///&lt; 0 mean don't use
<span class="lineNum">      46 </span><span class="lineCov">         45 : static double fishall_intercept=0*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">      47 </span><span class="lineCov">         45 : static double fishall_slope=0*eval_here(&quot;1/kilogram/year&quot;);</span>
<span class="lineNum">      48 </span><span class="lineCov">         45 : static double fishall_residual_se=0*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">      49 </span>            : static double fishMrangemax=10000000000.0;
<span class="lineNum">      50 </span>            : static double fishTLrangemax=10000000000.0;
<span class="lineNum">      51 </span>            : static double const_fishing_mortality_rate=0.1;
<span class="lineNum">      52 </span><span class="lineCov">         45 : static double Fmax=1*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">      53 </span>            : static double fishMrangeCSFfactor=1.0;
<span class="lineNum">      54 </span>            : static int addrandF=0;
<span class="lineNum">      55 </span><span class="lineCov">         45 : static double randFstd=0.1*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">      56 </span>            : static double log_small_value_tolerance=log(1.001);
<span class="lineNum">      57 </span>            : static int dumb_preconditioner=true;
<span class="lineNum">      58 </span><span class="lineCov">         45 : static double fishMlowerthreshold=eval_here(&quot;1*gram&quot;);</span>
<span class="lineNum">      59 </span><span class="lineCov">         45 : static double fishMupperthreshold=eval_here(&quot;345000*gram&quot;);</span>
<span class="lineNum">      60 </span>            : int use_packed_simulation=0; ///&lt; Use experimental, optimized code.
<span class="lineNum">      61 </span>            : #ifdef SET_CPU_AFFINITY
<span class="lineNum">      62 </span><span class="lineCov">         90 : CPU_set_list_t CPU_set_list=CPU_set_list_t(0);</span>
<span class="lineNum">      63 </span>            : #endif
<span class="lineNum">      64 </span>            : int log_steady_state_stats=0;
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : 
<span class="lineNum">      67 </span>            : // Manage adjustable parameters:
<span class="lineNum">      68 </span>            : #include &quot;cfgList.h&quot;
<span class="lineNum">      69 </span>            : static cfgStruct cfg[] = 
<span class="lineNum">      70 </span>            :   {
<span class="lineNum">      71 </span>            :     CFGDOUBLE(speciation_rate),
<span class="lineNum">      72 </span>            :     CFGDOUBLE(invasion_rate),
<span class="lineNum">      73 </span>            :     CFGDOUBLE(animal_invasion_pressure_kappa_a),
<span class="lineNum">      74 </span>            :     CFGDOUBLE(plant_invasion_pressure_kappa_p),
<span class="lineNum">      75 </span>            :     CFGDOUBLE(unified_invasion_pressure_kappa),
<span class="lineNum">      76 </span>            :     CFGDOUBLE(any_invasion_pressure_q),
<span class="lineNum">      77 </span>            :     CFGDOUBLE(n_neutral),
<span class="lineNum">      78 </span>            :     CFGINT(number_of_plant_species),
<span class="lineNum">      79 </span>            :     CFGINT(mean_field_threshold),
<span class="lineNum">      80 </span>            :     CFGINT(max_steady_state_size),
<span class="lineNum">      81 </span>            :     CFGDOUBLE(fishall_intercept),
<span class="lineNum">      82 </span>            :     CFGDOUBLE(fishall_slope),
<span class="lineNum">      83 </span>            :     CFGDOUBLE(fishall_residual_se),
<span class="lineNum">      84 </span>            :     CFGDOUBLE(fishMrangemax),
<span class="lineNum">      85 </span>            :     CFGDOUBLE(fishTLrangemax),
<span class="lineNum">      86 </span>            :     CFGDOUBLE(const_fishing_mortality_rate),
<span class="lineNum">      87 </span>            :     CFGDOUBLE(Fmax),
<span class="lineNum">      88 </span>            :     CFGDOUBLE(log_small_value_tolerance),
<span class="lineNum">      89 </span>            :     CFGINT(addrandF),
<span class="lineNum">      90 </span>            :     CFGDOUBLE(randFstd),
<span class="lineNum">      91 </span>            :     CFGDOUBLE(fishMrangeCSFfactor),
<span class="lineNum">      92 </span>            :     CFGINT(dumb_preconditioner),
<span class="lineNum">      93 </span>            :     CFGINT(log_steady_state_stats),
<span class="lineNum">      94 </span>            :     {0, CFG_END, 0}
<span class="lineNum">      95 </span>            :   };
<span class="lineNum">      96 </span><span class="lineCov">         45 : static cfg_add dummy(cfg);</span>
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : const double log_DBL_MAX=5*log(DBL_MAX)/7.0; // we added some safety margin
<a name="100"><span class="lineNum">     100 </span>            : const double log_DBL_MIN=5*log(DBL_MIN)/7.0; // we added some safety margin</a>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span><span class="lineCov">         90 : NewWeb::NewWeb():</span>
<span class="lineNum">     103 </span>            :   invasion_counter(0),
<span class="lineNum">     104 </span>            :   speciation_counter(0),
<span class="lineNum">     105 </span>            :   max_ever_plant_richness(0),
<span class="lineNum">     106 </span>            :   dynamics_accelerator(0),
<span class="lineNum">     107 </span><span class="lineCov">       1080 :   compute_diagnostics(false)</span>
<span class="lineNum">     108 </span>            : {
<span class="lineNum">     109 </span>            :   // nothing to do
<a name="110"><span class="lineNum">     110 </span><span class="lineCov">         90 : }</span></a>
<span class="lineNum">     111 </span>            : 
<span class="lineNum">     112 </span><span class="lineCov">        990 : NewWeb::~NewWeb(){</span>
<span class="lineNum">     113 </span><span class="lineCov">      62140 :   while(precomputed.begin()!=precomputed.end()){</span>
<span class="lineNum">     114 </span><span class="lineCov">      52800 :     delete precomputed.detach(precomputed.end()-1);</span>
<span class="lineNum">     115 </span>            :   }
<span class="lineNum">     116 </span><span class="lineCov">         90 : };</span>
<span class="lineNum">     117 </span>            : 
<a name="118"><span class="lineNum">     118 </span>            : // This copy constructure is not essential, but save us from copying </a>
<span class="lineNum">     119 </span>            : // some parts which are not essential.
<span class="lineNum">     120 </span><span class="lineNoCov">          0 : NewWeb::NewWeb(const NewWeb&amp; other):</span>
<span class="lineNum">     121 </span>            :   biomass_B(other.biomass_B),
<span class="lineNum">     122 </span>            :   common_factor(other.common_factor),
<span class="lineNum">     123 </span>            :   dynamics_accelerator(0),
<span class="lineNum">     124 </span>            :   fx(other.fx),
<span class="lineNum">     125 </span>            :   compute_diagnostics(false),
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :   speciation_counter(other.speciation_counter),</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :   invasion_counter(other.invasion_counter),</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :   max_ever_plant_richness(other.max_ever_plant_richness),</span>
<span class="lineNum">     129 </span>            :   s(other.s),
<span class="lineNum">     130 </span>            :   species_at(other.species_at),
<span class="lineNum">     131 </span>            :   assigned_column(other.assigned_column),
<span class="lineNum">     132 </span><span class="lineNoCov">          0 :   otherwebs(other.otherwebs) {</span>
<a name="133"><span class="lineNum">     133 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     134 </span>            :         
<span class="lineNum">     135 </span><span class="lineNoCov">          0 : NewWeb&amp; NewWeb::operator=(const NewWeb&amp; other){</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :   if(this==&amp;other) return *this;</span>
<span class="lineNum">     137 </span>            : 
<span class="lineNum">     138 </span><span class="lineNoCov">          0 :   if(dynamics_accelerator) {// Perhaps not necessary but safer.</span>
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     delete dynamics_accelerator;</span>
<span class="lineNum">     140 </span><span class="lineNoCov">          0 :     dynamics_accelerator = 0;</span>
<span class="lineNum">     141 </span>            :   }
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :   while(precomputed.begin()!=precomputed.end()){</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :     delete precomputed.detach(precomputed.end()-1);</span>
<span class="lineNum">     144 </span>            :   }
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :   biomass_B=other.biomass_B;</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :   common_factor=other.common_factor;</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :   fx=other.fx;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :   compute_diagnostics=false;</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :   current_time=other.current_time;</span>
<span class="lineNum">     151 </span><span class="lineNoCov">          0 :   speciation_counter=other.speciation_counter;</span>
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :   invasion_counter=other.invasion_counter;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :   max_ever_plant_richness=other.max_ever_plant_richness;</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :   s=other.s;</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :   species_at=other.species_at;</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :   assigned_column=other.assigned_column;</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :   otherwebs=other.otherwebs;</span>
<span class="lineNum">     158 </span><span class="lineNoCov">          0 :   return *this;</span>
<span class="lineNum">     159 </span>            : }
<a name="160"><span class="lineNum">     160 </span>            :   </a>
<span class="lineNum">     161 </span>            : 
<span class="lineNum">     162 </span><span class="lineCov">         45 : void NewWeb::data_mapping(){</span>
<span class="lineNum">     163 </span><span class="lineCov">         45 :   PERMANENT(current_time); //from ODE_dynamical_object</span>
<span class="lineNum">     164 </span><span class="lineCov">         45 :   PERMANENT(invasion_counter);</span>
<span class="lineNum">     165 </span><span class="lineCov">         45 :   PERMANENT(speciation_counter);</span>
<span class="lineNum">     166 </span><span class="lineCov">         45 :   PERMANENT(max_ever_plant_richness);</span>
<span class="lineNum">     167 </span><span class="lineCov">         45 :   if(the_remember-&gt;read_or_write()==rememberWrite){</span>
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :     int new_foraging_vectors=1;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :     PERMANENT(new_foraging_vectors);</span>
<span class="lineNum">     170 </span>            :     int used_species=0;
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :     for(unsigned int i=0;i&lt;s.size();i++){</span>
<span class="lineNum">     172 </span><span class="lineNoCov">          0 :       NewSpecies &amp; Species = s[i];</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :       PERMANENTP(Species);</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :       used_species++;</span>
<span class="lineNum">     175 </span>            :     }
<span class="lineNum">     176 </span>            :     std::cout &lt;&lt; 
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :       &quot;**** WRITING &quot; &lt;&lt; used_species &lt;&lt; &quot; SPECIES ****&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     assigned_column.resize(s.size());</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :     for(Ancestry::iterator i=ancestors.begin();</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :         i!=ancestors.end();</span>
<span class="lineNum">     181 </span>            :         ++i){
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :       if(i-&gt;second.column==parent_not_extant){</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :         NewSpecies &amp; Ancestor=i-&gt;second.extinct_ancestor;</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :         PERMANENTP(Ancestor);</span>
<span class="lineNum">     185 </span>            :       }
<span class="lineNum">     186 </span>            :     }
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :     PERMANENT(assigned_column);</span>
<span class="lineNum">     188 </span><span class="lineCov">         45 :   }else if(the_remember-&gt;read_or_write()==rememberRead){</span>
<span class="lineNum">     189 </span><span class="lineCov">         45 :     int new_foraging_vectors=0;</span>
<span class="lineNum">     190 </span><span class="lineCov">         45 :     PERMANENT(new_foraging_vectors);</span>
<span class="lineNum">     191 </span><span class="lineCov">         90 :     NewSpecies Species;</span>
<span class="lineNum">     192 </span><span class="lineCov">         45 :     if(PERMANENT(assigned_column)!=0){</span>
<span class="lineNum">     193 </span>            :       // there were no assigned columns, so we do it by hand:
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;)</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :         assigned_column[i]=i;</span>
<span class="lineNum">     196 </span>            :     }
<span class="lineNum">     197 </span>            :     // species will be reordered, so we should remember
<span class="lineNum">     198 </span>            :     // assigned_column elsewhere
<span class="lineNum">     199 </span><span class="lineCov">        135 :     sequence&lt;int&gt; assigned_column_hold(assigned_column);</span>
<span class="lineNum">     200 </span><span class="lineCov">         45 :     assigned_column.resize(0);</span>
<span class="lineNum">     201 </span>            :     int i_before_saving=0;
<span class="lineNum">     202 </span><span class="lineCov">      17645 :     while(PERMANENTP(Species)==0){</span>
<span class="lineNum">     203 </span>            :       // This is a bit time consuming right now, because we have to
<span class="lineNum">     204 </span>            :       // reallocate memory with each species inserted:
<span class="lineNum">     205 </span>            :       int i_now;
<span class="lineNum">     206 </span><span class="lineCov">      35200 :       s[i_now=get_unused_index_and_allocate_memory(Species.is_a_plant())]=</span>
<span class="lineNum">     207 </span><span class="lineCov">      17600 :         Species;</span>
<span class="lineNum">     208 </span><span class="lineCov">      17600 :       assigned_column[i_now]=assigned_column_hold(i_before_saving);</span>
<span class="lineNum">     209 </span><span class="lineCov">      17600 :       species_at[assigned_column_hold(i_before_saving)];//resize species_at</span>
<span class="lineNum">     210 </span><span class="lineCov">       8800 :       i_before_saving++;</span>
<span class="lineNum">     211 </span>            :     }
<span class="lineNum">     212 </span><span class="lineCov">         90 :     NewSpecies Ancestor;</span>
<span class="lineNum">     213 </span><span class="lineCov">         45 :     while(PERMANENTP(Ancestor)==0){</span>
<span class="lineNum">     214 </span><span class="lineNoCov">          0 :       ancestors[Ancestor.unique_id()]=ancestral_record(Ancestor);</span>
<span class="lineNum">     215 </span>            :     }    
<span class="lineNum">     216 </span>            :     // the species_at array is messed up, we have to recompute it:
<span class="lineNum">     217 </span><span class="lineCov">         45 :     species_at.resize(0);</span>
<span class="lineNum">     218 </span><span class="lineCov">       8890 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     219 </span><span class="lineCov">      17600 :       species_at[assigned_column(i)]=i+1;</span>
<span class="lineNum">     220 </span>            :     }
<span class="lineNum">     221 </span>            :     ASSERT(column_unused==-1);
<span class="lineNum">     222 </span><span class="lineCov">         90 :     species_at-=1;</span>
<span class="lineNum">     223 </span>            :     // fix foraging vectors if they are old
<span class="lineNum">     224 </span><span class="lineCov">         45 :     if(!new_foraging_vectors){</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     226 </span><span class="lineNoCov">          0 :         s[i].fix_foraging_vector();</span>
<span class="lineNum">     227 </span>            :       }
<span class="lineNum">     228 </span>            :     }
<span class="lineNum">     229 </span>            :   }
<a name="230"><span class="lineNum">     230 </span><span class="lineCov">         45 : };</span></a>
<span class="lineNum">     231 </span>            : 
<span class="lineNum">     232 </span><span class="lineCov">        926 : void NewWeb::write_state_to(ODE_vector &amp; state) const{</span>
<span class="lineNum">     233 </span><span class="lineCov">       1852 :   int S=s.size();</span>
<span class="lineNum">     234 </span><span class="lineCov">     182368 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">     235 </span><span class="lineCov">     544326 :     state[i]=log(s(i).biomass_abundance_B());</span>
<span class="lineNum">     236 </span>            :   }
<a name="237"><span class="lineNum">     237 </span><span class="lineCov">        926 : }</span></a>
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span><span class="lineCov">        521 : void NewWeb::read_state_from(const ODE_vector &amp; state){</span>
<span class="lineNum">     240 </span><span class="lineCov">       1042 :   int S=s.size();</span>
<span class="lineNum">     241 </span><span class="lineCov">        521 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">     242 </span><span class="lineCov">     306138 :     s(i).set_biomass_abundance_B(exp(state[i]));</span>
<span class="lineNum">     243 </span>            :   }
<span class="lineNum">     244 </span><span class="lineCov">        521 : }</span>
<a name="245"><span class="lineNum">     245 </span>            : </a>
<span class="lineNum">     246 </span>            : 
<span class="lineNum">     247 </span><span class="lineCov">       1942 : int NewWeb::</span>
<span class="lineNum">     248 </span>            : number_of_variables() const{
<span class="lineNum">     249 </span><span class="lineCov">       3884 :   return s.size();</span>
<span class="lineNum">     250 </span>            : }
<span class="lineNum">     251 </span>            : 
<span class="lineNum">     252 </span>            : const int NewWeb::column_unused=-1;
<a name="253"><span class="lineNum">     253 </span>            : const int NewWeb::parent_not_extant=-1;</a>
<span class="lineNum">     254 </span>            : 
<span class="lineNum">     255 </span><span class="lineCov">       8890 : int NewWeb::column_allocate(){</span>
<span class="lineNum">     256 </span><span class="lineCov">       8890 :   int i=0;</span>
<span class="lineNum">     257 </span><span class="lineCov">    2387972 :   while(true){</span>
<span class="lineNum">     258 </span><span class="lineCov">    4793724 :     if(i==species_at.size()){</span>
<span class="lineNum">     259 </span><span class="lineCov">       8800 :       species_at.resize(i+1);</span>
<span class="lineNum">     260 </span><span class="lineCov">       8800 :       return i;</span>
<span class="lineNum">     261 </span>            :     }
<span class="lineNum">     262 </span><span class="lineCov">    4776124 :     if(species_at(i)!=column_unused)</span>
<span class="lineNum">     263 </span><span class="lineCov">    2387972 :       i++;</span>
<span class="lineNum">     264 </span>            :     else
<span class="lineNum">     265 </span>            :       return i;
<span class="lineNum">     266 </span>            :   }
<a name="267"><span class="lineNum">     267 </span>            : }</a>
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 : void NewWeb::column_free(int i){</span>
<span class="lineNum">     270 </span><span class="lineCov">         90 :   species_at[i]=column_unused;</span>
<a name="271"><span class="lineNum">     271 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     272 </span>            : 
<span class="lineNum">     273 </span><span class="lineCov">       8890 : int NewWeb::get_unused_index_and_allocate_memory(int plant){</span>
<span class="lineNum">     274 </span><span class="lineCov">      17780 :   int si=s.size();</span>
<span class="lineNum">     275 </span>            :   int i;
<span class="lineNum">     276 </span>            :   // enlarge arrays (for a simple_vector this is a cheap operation if
<span class="lineNum">     277 </span>            :   // going back and forth):
<span class="lineNum">     278 </span><span class="lineCov">       8890 :   precomputed.resize(si+1,s);</span>
<span class="lineNum">     279 </span><span class="lineCov">       8890 :   fx.resize(si+1);</span>
<span class="lineNum">     280 </span>            :   TRACE(fx.size(),FLOWS);
<span class="lineNum">     281 </span><span class="lineCov">      17780 :   biomass_B.resize(si+1);</span>
<span class="lineNum">     282 </span><span class="lineCov">       8890 :   s.resize(si+1);</span>
<span class="lineNum">     283 </span><span class="lineCov">       8890 :   assigned_column.resize(si+1);</span>
<span class="lineNum">     284 </span><span class="lineCov">       8890 :   if(plant){</span>
<span class="lineNum">     285 </span>            :     i=si;
<span class="lineNum">     286 </span>            :   }else{//animal
<span class="lineNum">     287 </span><span class="lineCov">       3235 :     move_species(s.n_animals,si);</span>
<span class="lineNum">     288 </span><span class="lineCov">       3235 :     i=s.n_animals;</span>
<span class="lineNum">     289 </span><span class="lineCov">       3235 :     s.n_animals++;</span>
<span class="lineNum">     290 </span>            :   }
<span class="lineNum">     291 </span><span class="lineCov">      17780 :   species_at[assigned_column(i)=column_allocate()]=i;</span>
<span class="lineNum">     292 </span><span class="lineCov">       8890 :   return i;</span>
<a name="293"><span class="lineNum">     293 </span>            : }</a>
<span class="lineNum">     294 </span>            : 
<span class="lineNum">     295 </span><span class="lineCov">       3379 : void NewWeb::move_species(int old_i,int new_i){</span>
<span class="lineNum">     296 </span><span class="lineCov">       3379 :   if(old_i==new_i)</span>
<span class="lineNum">     297 </span>            :     return;
<span class="lineNum">     298 </span>            : 
<span class="lineNum">     299 </span><span class="lineCov">        776 :   species_at(assigned_column(new_i)=assigned_column(old_i))=new_i;</span>
<span class="lineNum">     300 </span>            :   // Note that this also moved c(old_i,old_i) to c(new_i,new_i)!
<span class="lineNum">     301 </span><span class="lineCov">        582 :   s(new_i)=s(old_i);</span>
<span class="lineNum">     302 </span><span class="lineCov">        194 :   precomputed.move(old_i,new_i,s);</span>
<a name="303"><span class="lineNum">     303 </span>            : }</a>
<span class="lineNum">     304 </span>            :   
<span class="lineNum">     305 </span><span class="lineNoCov">          0 : int NewWeb::delete_species_and_report(int i){</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :         ofstream list_of_inserted_deleted_species;</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :         list_of_inserted_deleted_species.open(&quot;list_of_inserted_deleted_species.dat&quot;,ios_base::app);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :         list_of_inserted_deleted_species &lt;&lt; s(i).unique_id() &lt;&lt; &quot; &quot; &lt;&lt; s(i).parent_unique_id() &lt;&lt; &quot; &quot; &lt;&lt; 0 &lt;&lt; &quot; &quot; &lt;&lt; s(i).aggressivity_g()  &lt;&lt; &quot; &quot; &lt;&lt; 0 &lt;&lt; endl;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         return delete_species(i);</span>
<a name="310"><span class="lineNum">     310 </span>            : }</a>
<span class="lineNum">     311 </span>            : 
<span class="lineNum">     312 </span><span class="lineCov">         90 : int NewWeb::delete_species(int i){</span>
<span class="lineNum">     313 </span>            :   ASSERT(0&lt;=i);
<span class="lineNum">     314 </span>            :   ASSERT(i&lt;s.size());
<span class="lineNum">     315 </span>            :   TRACE(s[i].unique_id(),SPECIES);
<span class="lineNum">     316 </span>            :   TRACE(s[i].clade_id(),SPECIES);
<span class="lineNum">     317 </span><span class="lineCov">        180 :   int end=s.size()-1;</span>
<span class="lineNum">     318 </span>            : 
<span class="lineNum">     319 </span><span class="lineCov">         90 :   if(log_steady_state_stats &amp;&amp; !is_plant(i)){</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;note &quot; &lt;&lt; s(i).aggressivity_g();</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot; &quot; &lt;&lt; s(i).niche_width_wt();</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot; &quot; &lt;&lt; s(i).bodymass();</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot; &quot; &lt;&lt; s(i).number_of_invading_offspring();</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot; &quot; &lt;&lt; s(i).age();</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :     sequence&lt; double &gt; diet(s.size());</span>
<span class="lineNum">     326 </span><span class="lineNoCov">          0 :     get_diet(i,diet);</span>
<span class="lineNum">     327 </span>            :     int main_prey_of_predator=
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :       max_element(diet.begin(),diet.end())-diet.begin();</span>
<span class="lineNum">     329 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot; &quot; &lt;&lt; is_plant(main_prey_of_predator);</span>
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :     cout &lt;&lt; endl;</span>
<span class="lineNum">     331 </span>            :   }
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineCov">        270 :   column_free(assigned_column(i));</span>
<span class="lineNum">     334 </span>            : 
<span class="lineNum">     335 </span><span class="lineCov">         90 :   if(is_plant(i)){</span>
<span class="lineNum">     336 </span><span class="lineCov">         36 :     move_species(end,i);</span>
<span class="lineNum">     337 </span>            :   }else{
<span class="lineNum">     338 </span><span class="lineCov">         54 :     move_species(--s.n_animals,i);</span>
<span class="lineNum">     339 </span><span class="lineCov">         54 :     move_species(end,s.n_animals);</span>
<span class="lineNum">     340 </span>            :   }
<span class="lineNum">     341 </span><span class="lineCov">         90 :   s.resize(end);</span>
<span class="lineNum">     342 </span><span class="lineCov">         90 :   fx.resize(end);</span>
<span class="lineNum">     343 </span><span class="lineCov">         90 :   precomputed.resize(end,s);</span>
<span class="lineNum">     344 </span><span class="lineCov">         90 :   steady_state.clear();</span>
<span class="lineNum">     345 </span>            : 
<span class="lineNum">     346 </span><span class="lineCov">         90 :   return i &lt; end;</span>
<a name="347"><span class="lineNum">     347 </span>            : }</a>
<span class="lineNum">     348 </span>            : 
<span class="lineNum">     349 </span><span class="lineNoCov">          0 : void NewWeb::delete_forbidden_species(){</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){ // Loop must go backwards!</span>
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :     if(s(i).outside_allowed_trait_space()){</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">     353 </span>            :     }
<span class="lineNum">     354 </span>            :   }
<span class="lineNum">     355 </span><span class="lineNoCov">          0 : }</span>
<a name="356"><span class="lineNum">     356 </span>            : </a>
<span class="lineNum">     357 </span>            : // Note that insert() deletes the object the argument points to!
<span class="lineNum">     358 </span><span class="lineCov">         90 : int NewWeb::insert(const NewSpecies * sp){</span>
<span class="lineNum">     359 </span><span class="lineCov">        180 :   int i=get_unused_index_and_allocate_memory(sp-&gt;is_a_plant());</span>
<span class="lineNum">     360 </span><span class="lineCov">        180 :   s[i]=*sp;</span>
<span class="lineNum">     361 </span><span class="lineCov">         90 :   delete sp;</span>
<span class="lineNum">     362 </span><span class="lineCov">        180 :   s[i].set_sequential_id();</span>
<span class="lineNum">     363 </span><span class="lineCov">         90 :   precomputed.update(i,s);</span>
<span class="lineNum">     364 </span><span class="lineCov">         90 :   steady_state.clear();</span>
<span class="lineNum">     365 </span>            :   max_ever_plant_richness=
<span class="lineNum">     366 </span><span class="lineCov">        180 :     max(max_ever_plant_richness,number_of_plants());</span>
<span class="lineNum">     367 </span>            : 
<span class="lineNum">     368 </span><span class="lineCov">         90 :   int parent_i=find_extant_parent(* sp);</span>
<span class="lineNum">     369 </span><span class="lineCov">         90 :   if(parent_i != parent_not_extant){</span>
<span class="lineNum">     370 </span><span class="lineCov">        130 :     s(parent_i).notify_speciation(* sp);</span>
<span class="lineNum">     371 </span>            :   }
<span class="lineNum">     372 </span><span class="lineCov">         90 :   return i;</span>
<span class="lineNum">     373 </span>            : }
<a name="374"><span class="lineNum">     374 </span>            : </a>
<span class="lineNum">     375 </span>            : // Helper to find a parent species:
<span class="lineNum">     376 </span><span class="lineCov">         90 : int NewWeb::find_extant_parent(const NewSpecies &amp; sp){</span>
<span class="lineNum">     377 </span><span class="lineCov">         90 :   int puid=sp.parent_unique_id();</span>
<span class="lineNum">     378 </span><span class="lineCov">        180 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     379 </span><span class="lineCov">      31032 :     if(s[i].unique_id()==puid){</span>
<span class="lineNum">     380 </span>            :       return i;
<span class="lineNum">     381 </span>            :     }
<span class="lineNum">     382 </span>            :   }
<span class="lineNum">     383 </span>            :   return parent_not_extant;
<a name="384"><span class="lineNum">     384 </span>            : }</a>
<span class="lineNum">     385 </span>            : 
<span class="lineNum">     386 </span><span class="lineNoCov">          0 : void NewWeb::Ancestry::note_speciation(const NewSpecies &amp; offspring,</span>
<span class="lineNum">     387 </span>            :                                        const NewWeb &amp; web){
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :   int puid=offspring.parent_unique_id();</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :   Ancestry::iterator parent_p=find(puid);</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :   if(parent_p==this-&gt;end()){</span>
<span class="lineNum">     391 </span>            :     // Parent not recorded in ancestry, yet
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :     for(int i=web.s.size();i--&gt;0;){</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :       if(web.s[i].unique_id()==puid){</span>
<span class="lineNum">     394 </span>            :         // Found the parent
<span class="lineNum">     395 </span>            :         parent_p=
<span class="lineNum">     396 </span>            :           Ancestry::
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :           insert(pair&lt; int, ancestral_record &gt;</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :                  (puid,ancestral_record(web.assigned_column[i])) ).first;</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :         break;</span>
<span class="lineNum">     400 </span>            :       }else{
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :         WARNING(&quot;Speciating species has no parent!&quot;);</span>
<span class="lineNum">     402 </span>            :         return;
<span class="lineNum">     403 </span>            :       }
<span class="lineNum">     404 </span>            :     }
<span class="lineNum">     405 </span>            :   }
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :   parent_p-&gt;second.number_of_known_offspring++;</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :   return;</span>
<a name="408"><span class="lineNum">     408 </span>            : }</a>
<span class="lineNum">     409 </span>            : 
<span class="lineNum">     410 </span><span class="lineNoCov">          0 : void NewWeb::Ancestry::</span>
<span class="lineNum">     411 </span>            : note_impending_extinction(const NewSpecies &amp; going_extinct){
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :   int uid=going_extinct.unique_id();</span>
<span class="lineNum">     413 </span>            :   
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :   Ancestry::iterator record_p=find(uid);</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :   if(record_p-&gt;second.number_of_known_offspring == 0){</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :     int puid=going_extinct.parent_unique_id();</span>
<span class="lineNum">     417 </span>            :     // Remove entire branch from tree:
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :     record_p=Ancestry::find(puid);</span>
<span class="lineNum">     419 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;REMOVAL OF ANCESTRAL BRANCHES NOT IMPLEMENTED YET&quot;);</span>
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :     if(record_p != Ancestry::end()){</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :       record_p-&gt;second.number_of_known_offspring--;</span>
<span class="lineNum">     422 </span>            :       //... stuff missing here, probaby need some recursive function or so.
<span class="lineNum">     423 </span>            :     }
<span class="lineNum">     424 </span>            :     return;
<span class="lineNum">     425 </span>            :   }else{
<span class="lineNum">     426 </span>            :     // explicitly record among ancestors, overwriting implicit record:
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;number_of_known_offspring WOULD GET LOST IN NEXT LINE!&quot;);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :     record_p-&gt;second=ancestral_record(going_extinct);</span>
<span class="lineNum">     429 </span>            :   }
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :   return;</span>
<a name="431"><span class="lineNum">     431 </span>            : }</a>
<span class="lineNum">     432 </span>            : 
<span class="lineNum">     433 </span><span class="lineNoCov">          0 : void NewWeb::clear(){</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :     delete_species(i);</span>
<span class="lineNum">     436 </span>            :   }
<a name="437"><span class="lineNum">     437 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     438 </span>            : 
<span class="lineNum">     439 </span><span class="lineCov">      21199 : void NewWeb::record_for_steady_state(){</span>
<span class="lineNum">     440 </span><span class="lineCov">      21199 :   if(not dynamics_accelerator){</span>
<span class="lineNum">     441 </span>            :     steady_state.
<span class="lineNum">     442 </span><span class="lineCov">      21199 :       push_back(new saved_state(current_time,biomass_B,common_factor));</span>
<span class="lineNum">     443 </span>            :   }else{
<span class="lineNum">     444 </span>            :     steady_state.
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :       push_back(new saved_state</span>
<span class="lineNum">     446 </span>            :                 (current_time,
<span class="lineNum">     447 </span>            :                  vector_with_max(dynamics_accelerator-&gt;biomass_B.begin(),
<span class="lineNum">     448 </span>            :                                  dynamics_accelerator-&gt;biomass_B.end() ),
<span class="lineNum">     449 </span>            :                  vector_with_max(dynamics_accelerator-&gt;common_factor.begin(),
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :                                  dynamics_accelerator-&gt;common_factor.end() )</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :                  ));</span>
<span class="lineNum">     452 </span>            :   }    
<span class="lineNum">     453 </span><span class="lineCov">      42398 :   if(max_steady_state_size &amp;&amp; </span>
<span class="lineNum">     454 </span><span class="lineCov">      42398 :      steady_state.size()==2*max_steady_state_size){</span>
<span class="lineNum">     455 </span>            :     steady_state_t::iterator start=
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :       steady_state.begin();</span>
<span class="lineNum">     457 </span>            :     steady_state_t::iterator rest=
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :       steady_state.begin()+max_steady_state_size;</span>
<span class="lineNum">     459 </span><span class="lineNoCov">          0 :     for(;rest!=steady_state.end();++start,++rest){</span>
<span class="lineNum">     460 </span><span class="lineNoCov">          0 :       ptr_swap(start,rest);</span>
<span class="lineNum">     461 </span>            :     }
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :     while(steady_state.size()&gt;max_steady_state_size){</span>
<span class="lineNum">     463 </span><span class="lineNoCov">          0 :       delete steady_state.detach(steady_state.end()-1);</span>
<span class="lineNum">     464 </span>            :     }
<span class="lineNum">     465 </span>            :   }
<a name="466"><span class="lineNum">     466 </span><span class="lineCov">      21199 : }</span></a>
<span class="lineNum">     467 </span>            : 
<span class="lineNum">     468 </span><span class="lineNoCov">          0 : void NewWeb::delete_weeds(){</span>
<span class="lineNum">     469 </span><span class="lineNoCov">          0 :   double max_animal_size=0;</span>
<span class="lineNum">     470 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">     471 </span>            :     max_animal_size=
<span class="lineNum">     472 </span><span class="lineNoCov">          0 :       max&lt;double&gt;(max_animal_size,s(i).mean_bodymass_M());</span>
<span class="lineNum">     473 </span>            :   }
<span class="lineNum">     474 </span>            :   const double weed_threshold_mass=
<span class="lineNum">     475 </span><span class="lineNoCov">          0 :     max_animal_size/</span>
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :     pow(10,get_cfg_parameter(&quot;log10_bodymass_ratio_window_center&quot;));</span>
<span class="lineNum">     477 </span>            : 
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">     479 </span><span class="lineNoCov">          0 :     if(s(i).mean_bodymass_M()&gt;weed_threshold_mass){</span>
<span class="lineNum">     480 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">     481 </span>            :     }
<span class="lineNum">     482 </span>            :   }
<span class="lineNum">     483 </span><span class="lineNoCov">          0 : }</span>
<a name="484"><span class="lineNum">     484 </span>            : </a>
<span class="lineNum">     485 </span>            :         
<span class="lineNum">     486 </span><span class="lineCov">         39 : void NewWeb::steady_state_is_fixed_point(){</span>
<span class="lineNum">     487 </span><span class="lineCov">        195 :   WARNING(&quot;deleting steady_state up to final point&quot;);</span>
<span class="lineNum">     488 </span><span class="lineCov">         39 :   steady_state.clear();</span>
<span class="lineNum">     489 </span><span class="lineCov">         78 :   steady_state.push_back(new saved_state(current_time,biomass_B,common_factor));</span>
<a name="490"><span class="lineNum">     490 </span><span class="lineCov">         39 : }</span></a>
<span class="lineNum">     491 </span>            :         
<span class="lineNum">     492 </span><span class="lineNoCov">          0 : double NewWeb::biomass_larger(double threshold) const{</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :   double sum=0;</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :     if(s[i].bodymass()&gt;threshold)</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :       sum+=s[i].biomass_abundance_B();</span>
<span class="lineNum">     497 </span>            :   }
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :   return sum;</span>
<a name="499"><span class="lineNum">     499 </span>            : }</a>
<span class="lineNum">     500 </span>            : 
<span class="lineNum">     501 </span><span class="lineNoCov">          0 : double NewWeb::biomass_yield(){</span>
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :   double Y=0;</span>
<span class="lineNum">     503 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     504 </span><span class="lineNoCov">          0 :     Y+=s(i).fishing_yield();</span>
<span class="lineNum">     505 </span>            :   }
<span class="lineNum">     506 </span><span class="lineNoCov">          0 :   return Y;</span>
<span class="lineNum">     507 </span>            : }
<a name="508"><span class="lineNum">     508 </span>            : </a>
<span class="lineNum">     509 </span>            : 
<span class="lineNum">     510 </span><span class="lineNoCov">          0 : double NewWeb::plant_biomass() const{</span>
<span class="lineNum">     511 </span><span class="lineNoCov">          0 :   double sum=0;</span>
<span class="lineNum">     512 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">     513 </span><span class="lineNoCov">          0 :     sum+=s[i].biomass_abundance_B();</span>
<span class="lineNum">     514 </span>            :   }
<span class="lineNum">     515 </span><span class="lineNoCov">          0 :   return sum;</span>
<a name="516"><span class="lineNum">     516 </span>            : }</a>
<span class="lineNum">     517 </span>            : 
<span class="lineNum">     518 </span><span class="lineNoCov">          0 : double NewWeb::animal_biomass() const{</span>
<span class="lineNum">     519 </span><span class="lineNoCov">          0 :   double sum=0;</span>
<span class="lineNum">     520 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">     521 </span><span class="lineNoCov">          0 :     sum+=s[i].biomass_abundance_B();</span>
<span class="lineNum">     522 </span>            :   }
<span class="lineNum">     523 </span><span class="lineNoCov">          0 :   return sum;</span>
<a name="524"><span class="lineNum">     524 </span>            : }</a>
<span class="lineNum">     525 </span>            : 
<span class="lineNum">     526 </span><span class="lineNoCov">          0 : void NewWeb::check_internal_consistency(int check_data_consistency){</span>
<span class="lineNum">     527 </span><span class="lineNoCov">          0 :   if(check_data_consistency&gt;1){</span>
<span class="lineNum">     528 </span><span class="lineNoCov">          0 :     REPORT(s.n_animals);</span>
<span class="lineNum">     529 </span><span class="lineNoCov">          0 :     REPORT(assigned_column);</span>
<span class="lineNum">     530 </span><span class="lineNoCov">          0 :     REPORT(species_at);</span>
<span class="lineNum">     531 </span>            :   }
<span class="lineNum">     532 </span><span class="lineNoCov">          0 :   for(int i=species_at.size();i--&gt;0;){</span>
<span class="lineNum">     533 </span><span class="lineNoCov">          0 :     if(species_at(i)!=column_unused){</span>
<span class="lineNum">     534 </span><span class="lineNoCov">          0 :       ALWAYS_ASSERT(assigned_column(species_at(i))==i);</span>
<span class="lineNum">     535 </span>            :     }
<span class="lineNum">     536 </span>            :   }
<span class="lineNum">     537 </span><span class="lineNoCov">          0 :   ALWAYS_ASSERT(s.n_animals&lt;=s.size());</span>
<span class="lineNum">     538 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     539 </span><span class="lineNoCov">          0 :     ALWAYS_ASSERT(s(i).is_a_plant()==is_plant(i));</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     ALWAYS_ASSERT(is_plant(i)==(i&gt;=s.n_animals));</span>
<span class="lineNum">     541 </span>            :   }
<span class="lineNum">     542 </span>            :   
<span class="lineNum">     543 </span>            :   
<span class="lineNum">     544 </span><span class="lineNoCov">          0 :   precomputed_t pre2=precomputed;</span>
<span class="lineNum">     545 </span><span class="lineNoCov">          0 :   initialize_precomputed();</span>
<span class="lineNum">     546 </span>            :   
<span class="lineNum">     547 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;s.size();i++){</span>
<span class="lineNum">     548 </span><span class="lineNoCov">          0 :     pre2.update(i,s);</span>
<span class="lineNum">     549 </span>            :   }
<span class="lineNum">     550 </span><span class="lineNoCov">          0 :   if(do_switching){</span>
<span class="lineNum">     551 </span><span class="lineNoCov">          0 :     for(int i=0;i&lt;s.size();i++){</span>
<span class="lineNum">     552 </span><span class="lineNoCov">          0 :       if(check_data_consistency&gt;1){</span>
<span class="lineNum">     553 </span><span class="lineNoCov">          0 :         REPORT(i);</span>
<span class="lineNum">     554 </span><span class="lineNoCov">          0 :         REPORT(pre2[i].csc_eating);</span>
<span class="lineNum">     555 </span><span class="lineNoCov">          0 :         REPORT(precomputed[i].csc_eating);</span>
<span class="lineNum">     556 </span>            :       }
<span class="lineNum">     557 </span><span class="lineNoCov">          0 :       ALWAYS_ASSERT(pre2[i].csc_eating==precomputed[i].csc_eating);</span>
<span class="lineNum">     558 </span><span class="lineNoCov">          0 :       if(check_data_consistency&gt;1){</span>
<span class="lineNum">     559 </span><span class="lineNoCov">          0 :         REPORT(pre2[i].csc_being_eaten);</span>
<span class="lineNum">     560 </span><span class="lineNoCov">          0 :         REPORT(precomputed[i].csc_being_eaten);</span>
<span class="lineNum">     561 </span>            :       }
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :       ALWAYS_ASSERT(pre2[i].csc_being_eaten==precomputed[i].csc_being_eaten);</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :       if(check_data_consistency&gt;1){</span>
<span class="lineNum">     564 </span><span class="lineNoCov">          0 :         REPORT(pre2[i].c);</span>
<span class="lineNum">     565 </span><span class="lineNoCov">          0 :         REPORT(precomputed[i].c);</span>
<span class="lineNum">     566 </span>            :       }
<span class="lineNum">     567 </span><span class="lineNoCov">          0 :       ALWAYS_ASSERT(pre2[i].c==precomputed[i].c);</span>
<span class="lineNum">     568 </span>            :     }
<span class="lineNum">     569 </span>            :   }else{// not switching:
<span class="lineNum">     570 </span>            :     // .. not implemented ..
<span class="lineNum">     571 </span>            :   }
<a name="572"><span class="lineNum">     572 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     573 </span>            : 
<span class="lineNum">     574 </span><span class="lineCov">        698 : NewSpecies * NewWeb::speciate_selected(double parent){</span>
<span class="lineNum">     575 </span><span class="lineCov">        698 :   speciation_counter++;</span>
<span class="lineNum">     576 </span><span class="lineCov">       1396 :   return s[parent].speciate();</span>
<span class="lineNum">     577 </span>            : }  
<a name="578"><span class="lineNum">     578 </span>            : </a>
<span class="lineNum">     579 </span>            : // Find a random species and speciate from it:
<span class="lineNum">     580 </span><span class="lineCov">        698 : NewSpecies * NewWeb::speciate(double plant_fraction){</span>
<span class="lineNum">     581 </span>            :   bool speciate_plant;
<span class="lineNum">     582 </span>            :   int parent;
<span class="lineNum">     583 </span><span class="lineCov">        698 :   if(unified_invasion_pressure_kappa){</span>
<span class="lineNum">     584 </span><span class="lineNoCov">          0 :     parent=random_integer(s.size());</span>
<span class="lineNum">     585 </span><span class="lineNoCov">          0 :     speciate_plant=s[parent].is_a_plant();</span>
<span class="lineNum">     586 </span>            :   }else{
<span class="lineNum">     587 </span><span class="lineCov">       1396 :     if(plant_fraction &lt;=0 &amp;&amp; number_of_animals()==0){</span>
<span class="lineNum">     588 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;No animals to speciate&quot;);</span>
<span class="lineNum">     589 </span><span class="lineNoCov">          0 :       return 0;</span>
<span class="lineNum">     590 </span>            :     }
<span class="lineNum">     591 </span><span class="lineCov">        698 :     if(plant_fraction &gt;=1 &amp;&amp; number_of_plants()==0){</span>
<span class="lineNum">     592 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;No plants to speciate&quot;);</span>
<span class="lineNum">     593 </span><span class="lineNoCov">          0 :       return 0;</span>
<span class="lineNum">     594 </span>            :     }
<span class="lineNum">     595 </span><span class="lineCov">        698 :     if(number_of_animals()==0){</span>
<span class="lineNum">     596 </span><span class="lineNoCov">          0 :       if(number_of_plants()&gt;0)</span>
<span class="lineNum">     597 </span>            :         speciate_plant=1;
<span class="lineNum">     598 </span>            :       else{
<span class="lineNum">     599 </span><span class="lineNoCov">          0 :         FATAL_ERROR(&quot;No species to speciate&quot;);</span>
<span class="lineNum">     600 </span><span class="lineNoCov">          0 :         return 0;</span>
<span class="lineNum">     601 </span>            :       }
<span class="lineNum">     602 </span>            :     }
<span class="lineNum">     603 </span><span class="lineCov">        698 :     else if(number_of_plants()==0)</span>
<span class="lineNum">     604 </span>            :       speciate_plant=0;
<span class="lineNum">     605 </span><span class="lineCov">        698 :     else speciate_plant=unirand()&lt;plant_fraction;</span>
<span class="lineNum">     606 </span><span class="lineCov">       1962 :     do{</span>
<span class="lineNum">     607 </span><span class="lineCov">       3924 :       parent=random_integer(s.size());</span>
<span class="lineNum">     608 </span><span class="lineCov">       3924 :     }while(s[parent].is_a_plant()!=speciate_plant);</span>
<span class="lineNum">     609 </span>            :   }
<span class="lineNum">     610 </span><span class="lineCov">        698 :   return speciate_selected(parent);</span>
<span class="lineNum">     611 </span>            : }
<a name="612"><span class="lineNum">     612 </span>            :   </a>
<span class="lineNum">     613 </span>            : 
<span class="lineNum">     614 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::speciate_by_biomass(int get_a_plant){</span>
<span class="lineNum">     615 </span>            :   int parent;
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :   if(number_of_species()==0){</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;no species to speciate&quot;);</span>
<span class="lineNum">     618 </span>            :   }
<span class="lineNum">     619 </span>            :   TRACE(get_a_plant,SPECIES);
<span class="lineNum">     620 </span><span class="lineNoCov">          0 :   double biomass_sum=(get_a_plant?plant_biomass():animal_biomass());</span>
<span class="lineNum">     621 </span>            :   TRACE(biomass_sum,SPECIES);
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :   double specindex=biomass_sum*unirand();</span>
<span class="lineNum">     623 </span><span class="lineNoCov">          0 :   double cumulative_mass_sum=0;</span>
<span class="lineNum">     624 </span><span class="lineNoCov">          0 :   parent=0;</span>
<span class="lineNum">     625 </span><span class="lineNoCov">          0 :   if(get_a_plant){</span>
<span class="lineNum">     626 </span><span class="lineNoCov">          0 :     for(int j=s.size();j--&gt;s.n_animals;){</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :       cumulative_mass_sum+=s[j].biomass_abundance_B();</span>
<span class="lineNum">     628 </span><span class="lineNoCov">          0 :       if(cumulative_mass_sum&gt;specindex){</span>
<span class="lineNum">     629 </span>            :         parent=j;
<span class="lineNum">     630 </span>            :         break;
<span class="lineNum">     631 </span>            :       }
<span class="lineNum">     632 </span>            :     }
<span class="lineNum">     633 </span>            :   }else{// get an animal
<span class="lineNum">     634 </span><span class="lineNoCov">          0 :     for(int j=s.n_animals;j--&gt;0;){</span>
<span class="lineNum">     635 </span><span class="lineNoCov">          0 :       cumulative_mass_sum+=s[j].biomass_abundance_B();</span>
<span class="lineNum">     636 </span><span class="lineNoCov">          0 :       if(cumulative_mass_sum&gt;specindex){</span>
<span class="lineNum">     637 </span>            :         parent=j;
<span class="lineNum">     638 </span>            :         break;
<span class="lineNum">     639 </span>            :       }
<span class="lineNum">     640 </span>            :     }
<span class="lineNum">     641 </span>            :   }
<span class="lineNum">     642 </span>            :   TRACE(parent,SPECIES);
<span class="lineNum">     643 </span>            :   TRACE(s[parent].unique_id(),SPECIES);
<span class="lineNum">     644 </span><span class="lineNoCov">          0 :   return speciate_selected(parent);</span>
<span class="lineNum">     645 </span>            : }
<a name="646"><span class="lineNum">     646 </span>            :   </a>
<span class="lineNum">     647 </span>            : 
<span class="lineNum">     648 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::invade(double plant_fraction){</span>
<span class="lineNum">     649 </span><span class="lineNoCov">          0 :   bool get_a_plant=(unirand()&lt;plant_fraction);</span>
<span class="lineNum">     650 </span>            :   NewSpecies * species_p;
<span class="lineNum">     651 </span><span class="lineNoCov">          0 :   if(mean_field_threshold){</span>
<span class="lineNum">     652 </span><span class="lineNoCov">          0 :       int sample_size=(get_a_plant ? s.size()-s.n_animals : s.n_animals)-1;</span>
<span class="lineNum">     653 </span>            :       // (subtract 1 because the last is the empty slot 1)
<span class="lineNum">     654 </span><span class="lineNoCov">          0 :       if(sample_size &lt; mean_field_threshold){</span>
<span class="lineNum">     655 </span><span class="lineNoCov">          0 :         species_p=new NewSpecies(get_a_plant);</span>
<span class="lineNum">     656 </span>            :       }else{
<span class="lineNum">     657 </span><span class="lineNoCov">          0 :         int offset=(get_a_plant ? s.n_animals : 0);</span>
<span class="lineNum">     658 </span><span class="lineNoCov">          0 :         species_p=NewSpecies(s,offset,sample_size).speciate();</span>
<span class="lineNum">     659 </span>            :       }
<span class="lineNum">     660 </span>            :   }else{
<span class="lineNum">     661 </span>            :     // invade from other webs?
<span class="lineNum">     662 </span><span class="lineNoCov">          0 :     if(otherwebs.current_mode()==Otherwebs::newest)</span>
<span class="lineNum">     663 </span><span class="lineNoCov">          0 :       otherwebs.get_newest_webs();</span>
<span class="lineNum">     664 </span>            :     int n_elsewhere=
<span class="lineNum">     665 </span>            :       (get_a_plant?
<span class="lineNum">     666 </span><span class="lineNoCov">          0 :        otherwebs.total_number_of_plants():</span>
<span class="lineNum">     667 </span><span class="lineNoCov">          0 :        otherwebs.total_number_of_animals() );</span>
<span class="lineNum">     668 </span><span class="lineNoCov">          0 :     if(otherwebs.current_mode()!=Otherwebs::off &amp;&amp;  </span>
<span class="lineNum">     669 </span><span class="lineNoCov">          0 :        n_elsewhere&gt;0 &amp;&amp; unirand()&lt;n_elsewhere/double(n_neutral+n_elsewhere) ){</span>
<span class="lineNum">     670 </span>            :       species_p=
<span class="lineNum">     671 </span>            :         otherwebs.
<span class="lineNum">     672 </span>            :         get_random_species((get_a_plant ? 
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :                             NewSpecies::plant : NewSpecies::animal)).</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :         speciate_as_new();</span>
<span class="lineNum">     675 </span>            :     }else{
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :       species_p=new NewSpecies(get_a_plant);</span>
<span class="lineNum">     677 </span>            :     }
<span class="lineNum">     678 </span>            :   }
<span class="lineNum">     679 </span><span class="lineNoCov">          0 :   invasion_counter++;</span>
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :   return species_p;</span>
<a name="681"><span class="lineNum">     681 </span>            : }</a>
<span class="lineNum">     682 </span>            : 
<span class="lineNum">     683 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::invade_by_biomass(double plant_fraction){</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :   bool get_a_plant=(unirand()&lt;plant_fraction);</span>
<span class="lineNum">     685 </span>            :   NewSpecies * species_p;
<span class="lineNum">     686 </span>            :   // invade from other webs?
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :   if(otherwebs.current_mode()==Otherwebs::newest)</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :     otherwebs.get_newest_webs();</span>
<span class="lineNum">     689 </span><span class="lineNoCov">          0 :   if(get_a_plant ?</span>
<span class="lineNum">     690 </span><span class="lineNoCov">          0 :      otherwebs.total_number_of_plants()&gt;0 :</span>
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :      otherwebs.total_number_of_animals()&gt;0 ){</span>
<span class="lineNum">     692 </span>            :     species_p=
<span class="lineNum">     693 </span>            :       otherwebs.
<span class="lineNum">     694 </span>            :       get_random_species_by_biomass(get_a_plant ? 
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :                                     NewSpecies::plant : NewSpecies::animal).</span>
<span class="lineNum">     696 </span><span class="lineNoCov">          0 :       speciate_as_new();</span>
<span class="lineNum">     697 </span>            :   }else{
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :     species_p=new NewSpecies(get_a_plant);</span>
<span class="lineNum">     699 </span>            :   }
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :   invasion_counter++;</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :   return species_p;</span>
<a name="702"><span class="lineNum">     702 </span>            : }</a>
<span class="lineNum">     703 </span>            :   
<span class="lineNum">     704 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::invade_or_speciate(double plant_fraction){</span>
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :   if(plant_fraction!=0 &amp;&amp; plant_fraction!=1){</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :     plant_fraction=(unirand()&lt;plant_fraction);</span>
<span class="lineNum">     707 </span>            :   }
<span class="lineNum">     708 </span>            :   int number_of_relevant_species;
<span class="lineNum">     709 </span><span class="lineNoCov">          0 :   if(unified_invasion_pressure_kappa){</span>
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :     number_of_relevant_species=number_of_species();</span>
<span class="lineNum">     711 </span>            :   }else{
<span class="lineNum">     712 </span>            :     number_of_relevant_species=
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :       ( plant_fraction==0 ? number_of_animals() : number_of_plants() );</span>
<span class="lineNum">     714 </span>            :   }
<span class="lineNum">     715 </span>            :   double kappa;
<span class="lineNum">     716 </span><span class="lineNoCov">          0 :   if(unified_invasion_pressure_kappa){</span>
<span class="lineNum">     717 </span>            :     kappa=unified_invasion_pressure_kappa;
<span class="lineNum">     718 </span>            :   }else{
<span class="lineNum">     719 </span>            :     kappa=
<span class="lineNum">     720 </span><span class="lineNoCov">          0 :       ( plant_fraction==0 ? animal_invasion_pressure_kappa_a : plant_invasion_pressure_kappa_p );</span>
<span class="lineNum">     721 </span>            :   }
<span class="lineNum">     722 </span>            :   TRACE(kappa,SPECIES);
<span class="lineNum">     723 </span><span class="lineNoCov">          0 :   if(!number_of_relevant_species ||</span>
<span class="lineNum">     724 </span><span class="lineNoCov">          0 :      kappa/(kappa + number_of_relevant_species) &gt;= </span>
<span class="lineNum">     725 </span><span class="lineNoCov">          0 :      unirand() ){</span>
<span class="lineNum">     726 </span>            :     //    cout &lt;&lt; &quot;invading &quot; &lt;&lt; plant_fraction &lt;&lt; endl;
<span class="lineNum">     727 </span><span class="lineNoCov">          0 :     return invade(plant_fraction);</span>
<span class="lineNum">     728 </span>            :   }else{
<span class="lineNum">     729 </span>            :     //    cout &lt;&lt; &quot;speciating &quot; &lt;&lt; plant_fraction &lt;&lt; endl;
<span class="lineNum">     730 </span><span class="lineNoCov">          0 :     ALWAYS_ASSERT(number_of_relevant_species);</span>
<span class="lineNum">     731 </span><span class="lineNoCov">          0 :     return speciate(plant_fraction);</span>
<span class="lineNum">     732 </span>            :   }
<a name="733"><span class="lineNum">     733 </span>            : }</a>
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::invade_or_speciate_any(double get_a_plant){</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :   if(int(get_a_plant)!=get_a_plant){</span>
<span class="lineNum">     737 </span><span class="lineNoCov">          0 :     get_a_plant=(unirand()&lt;get_a_plant);</span>
<span class="lineNum">     738 </span>            :   }
<span class="lineNum">     739 </span><span class="lineNoCov">          0 :   if(!any_invasion_pressure_q){</span>
<span class="lineNum">     740 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;invade_or_speciate_any needs any_invasion_pressure_q&quot;);</span>
<span class="lineNum">     741 </span>            :   }
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :   int plants_to_invade=otherwebs.total_number_of_plants();</span>
<span class="lineNum">     743 </span><span class="lineNoCov">          0 :   int animals_to_invade=otherwebs.total_number_of_animals();</span>
<span class="lineNum">     744 </span><span class="lineNoCov">          0 :   int species_to_invade=(get_a_plant?plants_to_invade:animals_to_invade);</span>
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :   int species_here=(get_a_plant?number_of_plants():number_of_animals());</span>
<span class="lineNum">     746 </span>            :   int total_number_of_species=
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :     species_to_invade+species_here;</span>
<span class="lineNum">     748 </span>            : 
<span class="lineNum">     749 </span><span class="lineNoCov">          0 :   if(total_number_of_species==0){</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :     return new NewSpecies(get_a_plant);</span>
<span class="lineNum">     751 </span>            :   }
<span class="lineNum">     752 </span>            :     
<span class="lineNum">     753 </span>            :   
<span class="lineNum">     754 </span>            :   double probability_of_invasion=
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :     (any_invasion_pressure_q*species_to_invade)/total_number_of_species;</span>
<span class="lineNum">     756 </span>            : 
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :   if(unirand()&lt;probability_of_invasion || !species_here){</span>
<span class="lineNum">     758 </span>            :     // invade:
<span class="lineNum">     759 </span><span class="lineNoCov">          0 :     return invade(get_a_plant);</span>
<span class="lineNum">     760 </span>            :   }else{
<span class="lineNum">     761 </span>            :     // speciate:
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :     return speciate(get_a_plant);</span>
<span class="lineNum">     763 </span>            :   }
<a name="764"><span class="lineNum">     764 </span>            : }</a>
<span class="lineNum">     765 </span>            : 
<span class="lineNum">     766 </span><span class="lineNoCov">          0 : NewSpecies * NewWeb::invade_or_speciate_any_by_biomass(double get_a_plant){</span>
<span class="lineNum">     767 </span><span class="lineNoCov">          0 :   if(int(get_a_plant)!=get_a_plant){</span>
<span class="lineNum">     768 </span><span class="lineNoCov">          0 :     get_a_plant=(unirand()&lt;get_a_plant);</span>
<span class="lineNum">     769 </span>            :   }
<span class="lineNum">     770 </span><span class="lineNoCov">          0 :   if(!any_invasion_pressure_q){</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :     FATAL_ERROR</span>
<span class="lineNum">     772 </span><span class="lineNoCov">          0 :       (&quot;invade_or_speciate_any_by_biomass needs any_invasion_pressure_q&quot;);</span>
<span class="lineNum">     773 </span>            :   }
<span class="lineNum">     774 </span><span class="lineNoCov">          0 :   double plants_to_invade=otherwebs.total_plant_biomass();</span>
<span class="lineNum">     775 </span><span class="lineNoCov">          0 :   double animals_to_invade=otherwebs.total_animal_biomass();</span>
<span class="lineNum">     776 </span>            :   double species_to_invade=
<span class="lineNum">     777 </span>            :     (get_a_plant?
<span class="lineNum">     778 </span>            :      otherwebs.total_plant_biomass() :
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :      otherwebs.total_animal_biomass() );</span>
<span class="lineNum">     780 </span>            :   double species_here=
<span class="lineNum">     781 </span>            :     (get_a_plant?
<span class="lineNum">     782 </span>            :      plant_biomass() :
<span class="lineNum">     783 </span><span class="lineNoCov">          0 :      animal_biomass() );</span>
<span class="lineNum">     784 </span>            : 
<span class="lineNum">     785 </span>            :   int total_number_of_species=
<span class="lineNum">     786 </span><span class="lineNoCov">          0 :     species_to_invade+species_here;</span>
<span class="lineNum">     787 </span>            :   
<span class="lineNum">     788 </span><span class="lineNoCov">          0 :   if(total_number_of_species==0){</span>
<span class="lineNum">     789 </span><span class="lineNoCov">          0 :     return new NewSpecies(get_a_plant);</span>
<span class="lineNum">     790 </span>            :   }
<span class="lineNum">     791 </span>            :   
<span class="lineNum">     792 </span>            :   double probability_of_invasion=
<span class="lineNum">     793 </span><span class="lineNoCov">          0 :     (any_invasion_pressure_q*species_to_invade)/total_number_of_species;</span>
<span class="lineNum">     794 </span>            : 
<span class="lineNum">     795 </span><span class="lineNoCov">          0 :   if(unirand()&lt;probability_of_invasion || !species_here){</span>
<span class="lineNum">     796 </span>            :     // invade:
<span class="lineNum">     797 </span><span class="lineNoCov">          0 :     return invade_by_biomass(get_a_plant);</span>
<span class="lineNum">     798 </span>            :   }else{
<span class="lineNum">     799 </span>            :     // speciate:
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :     return speciate_by_biomass(get_a_plant);</span>
<span class="lineNum">     801 </span>            :   }
<span class="lineNum">     802 </span>            : }
<span class="lineNum">     803 </span>            : 
<span class="lineNum">     804 </span>            : // Some dead code (still here, because annealing was really cool!):
<span class="lineNum">     805 </span>            :  
<span class="lineNum">     806 </span>            : // #define ONLY_FIT_AFTER_ANNEALING_DEFINE(X)              \
<span class="lineNum">     807 </span>            : // int NewWeb::X##_only_fit_after_annealing(double plant_fraction){     \
<span class="lineNum">     808 </span>            : //   species_list_t save_s=s;                           \
<span class="lineNum">     809 </span>            : //   int new_species;                                   \
<span class="lineNum">     810 </span>            : //   int attempts_left=999;                             \
<span class="lineNum">     811 </span>            : //   do{                                                        \
<span class="lineNum">     812 </span>            : //     new_species=insert(X(plant_fraction));           \
<span class="lineNum">     813 </span>            : //     if(fitness_after_annealing(new_species)&gt;=0 || \
<span class="lineNum">     814 </span>            : //        attempts_left-- &lt;=0 ) break;                       \
<span class="lineNum">     815 </span>            : //     delete_species(new_species);                     \
<span class="lineNum">     816 </span>            : //     s=save_s;                                                \
<span class="lineNum">     817 </span>            : //   }while(true);                                              \
<span class="lineNum">     818 </span>            : //   if(attempts_left &lt;=0){                          \
<span class="lineNum">     819 </span>            : //     WARNING(#X &quot; unfit &quot; &lt;&lt; (plant_fraction?&quot;plant&quot;:(plant_fraction==0?&quot;animal&quot;:&quot;&quot;))); \
<span class="lineNum">     820 </span>            : //   }                                                  \
<span class="lineNum">     821 </span>            : //   return new_species;                                        \
<span class="lineNum">     822 </span>            : // }
<span class="lineNum">     823 </span>            : 
<span class="lineNum">     824 </span>            : // ONLY_FIT_AFTER_ANNEALING_DEFINE(invade);
<span class="lineNum">     825 </span>            : // ONLY_FIT_AFTER_ANNEALING_DEFINE(speciate);
<span class="lineNum">     826 </span>            : // ONLY_FIT_AFTER_ANNEALING_DEFINE(invade_or_speciate);
<span class="lineNum">     827 </span>            :  
<span class="lineNum">     828 </span>            : // int NewWeb::invade_only_fit_or_speciate_only_fit_after_annealing(double plant_fraction){
<span class="lineNum">     829 </span>            : //   if(plant_fraction!=0 &amp;&amp; plant_fraction!=1){
<span class="lineNum">     830 </span>            : //     plant_fraction=(unirand()&lt;plant_fraction);
<span class="lineNum">     831 </span>            : //   }
<span class="lineNum">     832 </span>            : //   int number_of_relevant_species;
<span class="lineNum">     833 </span>            : //   if(unified_invasion_pressure_kappa){
<span class="lineNum">     834 </span>            : //     number_of_relevant_species=number_of_species();
<span class="lineNum">     835 </span>            : //   }else{
<span class="lineNum">     836 </span>            : //     number_of_relevant_species=
<span class="lineNum">     837 </span>            : //       ( plant_fraction==0 ? number_of_animals() : number_of_plants() );
<span class="lineNum">     838 </span>            : //   }
<span class="lineNum">     839 </span>            : //   double kappa;
<span class="lineNum">     840 </span>            : //   if(unified_invasion_pressure_kappa){
<span class="lineNum">     841 </span>            : //     kappa=unified_invasion_pressure_kappa;
<span class="lineNum">     842 </span>            : //   }else{
<span class="lineNum">     843 </span>            : //     kappa=
<span class="lineNum">     844 </span>            : //       ( plant_fraction==0 ? animal_invasion_pressure_kappa_a : plant_invasion_pressure_kappa_p );
<span class="lineNum">     845 </span>            : //   }
<span class="lineNum">     846 </span>            : //   TRACE(kappa,SPECIES);
<span class="lineNum">     847 </span>            : //   REPORT(kappa);
<span class="lineNum">     848 </span>            : //   if(kappa/(kappa + number_of_relevant_species) &gt;= 
<span class="lineNum">     849 </span>            : //      unirand() ){
<span class="lineNum">     850 </span>            : //     cout &lt;&lt; &quot;invading &quot; &lt;&lt; plant_fraction &lt;&lt; endl;
<span class="lineNum">     851 </span>            : //     return invade_only_fit_after_annealing(plant_fraction);
<span class="lineNum">     852 </span>            : //   }else{
<span class="lineNum">     853 </span>            : //     cout &lt;&lt; &quot;speciating &quot; &lt;&lt; plant_fraction &lt;&lt; endl;
<span class="lineNum">     854 </span>            : //     return speciate_only_fit_after_annealing(plant_fraction);
<span class="lineNum">     855 </span>            : //   }
<span class="lineNum">     856 </span>            : // }
<span class="lineNum">     857 </span>            : 
<span class="lineNum">     858 </span>            : // int NewWeb::invade_fit_or_speciate_fit (double plant_fraction){
<span class="lineNum">     859 </span>            : //   // In this function FIRST the species to speciate is decided, and
<span class="lineNum">     860 </span>            : //   // THEN a fit descendant is sought.
<span class="lineNum">     861 </span>            : //  if(plant_fraction!=0 &amp;&amp; plant_fraction!=1){
<span class="lineNum">     862 </span>            : //     plant_fraction=(unirand()&lt;plant_fraction);
<span class="lineNum">     863 </span>            : //   }
<span class="lineNum">     864 </span>            : //   // this assumes unified_invasion_pressure_kappa to be set
<span class="lineNum">     865 </span>            : //   ALWAYS_ASSERT(unified_invasion_pressure_kappa);
<span class="lineNum">     866 </span>            : //   double kappa=unified_invasion_pressure_kappa;
<span class="lineNum">     867 </span>            : //   if(kappa/(kappa + s.size() )  &gt;=   unirand()){
<span class="lineNum">     868 </span>            : //     cout &lt;&lt; &quot;invading &quot; &lt;&lt; int(plant_fraction) &lt;&lt; endl;
<span class="lineNum">     869 </span>            : //     return invade_only_fit(plant_fraction);
<span class="lineNum">     870 </span>            : //   }else{
<span class="lineNum">     871 </span>            : //     int parent=random_integer(s.size());
<span class="lineNum">     872 </span>            : //     cout &lt;&lt; &quot;speciating &quot; &lt;&lt; is_plant(parent) &lt;&lt; endl;
<span class="lineNum">     873 </span>            : //     int child=get_unused_index_and_allocate_memory(is_plant(parent));
<span class="lineNum">     874 </span>            : //     int attempts_left = 999;
<span class="lineNum">     875 </span>            : //     do{
<span class="lineNum">     876 </span>            : //       TRACE(parent,SPECIES);
<span class="lineNum">     877 </span>            : //       TRACE(child,SPECIES);
<span class="lineNum">     878 </span>            : //       s[child]=s[parent].speciate();
<span class="lineNum">     879 </span>            : //       precomputed.update(child,s);
<span class="lineNum">     880 </span>            : //       speciation_counter++;
<span class="lineNum">     881 </span>            : //       if(fitness_after_annealing(child)&gt;=0) break;
<span class="lineNum">     882 </span>            : //     }while(attempts_left-- &gt; 0);
<span class="lineNum">     883 </span>            : //     if(!attempts_left)
<span class="lineNum">     884 </span>            : //       WARNING(&quot;speciating unfit &quot; &lt;&lt; (plant_fraction?&quot;plant&quot;:(plant_fraction==0?&quot;animal&quot;:&quot;&quot;))); 
<span class="lineNum">     885 </span>            : //     return child;
<span class="lineNum">     886 </span>            : //   }
<span class="lineNum">     887 </span>            : // }
<span class="lineNum">     888 </span>            : 
<span class="lineNum">     889 </span>            : // double NewWeb::fitness_after_annealing(int test){
<span class="lineNum">     890 </span>            : //   double best_fitness=fitness(test);
<span class="lineNum">     891 </span>            : //   NewSpecies best_species=s[test];
<span class="lineNum">     892 </span>            : //   const double annealing_slowdown=0.1;
<span class="lineNum">     893 </span>            : //   const int annealing_attempts=niche_space_dimensions_D*10;
<span class="lineNum">     894 </span>            : //   int attempts_left=annealing_attempts;
<span class="lineNum">     895 </span>            : //   int annealing_steps=0;
<span class="lineNum">     896 </span>            : //   do{
<span class="lineNum">     897 </span>            : //     s[test]=best_species.speciate(annealing_slowdown);
<span class="lineNum">     898 </span>            : //     precomputed.update(test,s);
<span class="lineNum">     899 </span>            : //     double new_fitness=fitness(test);
<span class="lineNum">     900 </span>            : //     if(new_fitness&gt;best_fitness){
<span class="lineNum">     901 </span>            : //       best_fitness=new_fitness;
<span class="lineNum">     902 </span>            : //       best_species=s[test];
<span class="lineNum">     903 </span>            : //       attempts_left=annealing_attempts;
<span class="lineNum">     904 </span>            : //       annealing_steps++;
<span class="lineNum">     905 </span>            : //     }
<span class="lineNum">     906 </span>            : //   }while(--attempts_left);
<span class="lineNum">     907 </span>            : //   REPORT(annealing_steps);
<span class="lineNum">     908 </span>            : //   s[test]=best_species;
<span class="lineNum">     909 </span>            : //   return best_fitness;
<span class="lineNum">     910 </span>            : // }
<span class="lineNum">     911 </span>            : 
<span class="lineNum">     912 </span>            : 
<span class="lineNum">     913 </span>            : // void NewWeb::update_link_strength(int i){
<span class="lineNum">     914 </span>            : //   // i on other:
<span class="lineNum">     915 </span>            : //   if(!s(i).is_plant){
<span class="lineNum">     916 </span>            : //     for(int j=s.size();j--&gt;0;){
<span class="lineNum">     917 </span>            : //       log_c(j,i)=s(i).log_foraging_strength_c_on(s(j));
<span class="lineNum">     918 </span>            : //       c(j,i)=(log_c(j,i)&lt;log_DBL_MIN ? 0 : exp(log_c(j,i)));
<span class="lineNum">     919 </span>            : //     }
<span class="lineNum">     920 </span>            : //     TRACE(i,LINKS);
<span class="lineNum">     921 </span>            : //     //    TRACE(log_c(i),LINKS);
<span class="lineNum">     922 </span>            : //   }else{
<span class="lineNum">     923 </span>            : //     for(int j=s.size();j--&gt;0;){
<span class="lineNum">     924 </span>            : //       if(s(j).is_plant)
<span class="lineNum">     925 </span>            : //      c(j,i)=s(i).plant_hampering_by(s(j));
<span class="lineNum">     926 </span>            : //       else 
<span class="lineNum">     927 </span>            : //      c(j,i)=0;
<span class="lineNum">     928 </span>            : //     }
<span class="lineNum">     929 </span>            : //     TRACE(i,LINKS);
<span class="lineNum">     930 </span>            : //     //    TRACE(c(i),LINKS);
<span class="lineNum">     931 </span>            : //   }
<span class="lineNum">     932 </span>            : //   // other on i
<span class="lineNum">     933 </span>            : //   for(int j=s.size();j--&gt;0;){
<span class="lineNum">     934 </span>            : //     if(!s(j).is_plant){
<span class="lineNum">     935 </span>            : //       log_c(i,j)=s(j).log_foraging_strength_c_on(s(i));
<span class="lineNum">     936 </span>            : //       c(i,j)=(log_c(i,j)&lt;log_DBL_MIN ? 0 : exp(log_c(i,j)));
<span class="lineNum">     937 </span>            : //     }
<span class="lineNum">     938 </span>            : //     else if(s(i).is_plant)
<span class="lineNum">     939 </span>            : //       c(i,j)=s(j).plant_hampering_by(s(i));
<span class="lineNum">     940 </span>            : //     else 
<span class="lineNum">     941 </span>            : //       c(i,j)=0;
<span class="lineNum">     942 </span>            : //   }
<a name="943"><span class="lineNum">     943 </span>            : // }</a>
<span class="lineNum">     944 </span>            : 
<span class="lineNum">     945 </span><span class="lineCov">        559 : void NewWeb::initialize_for_integration(){</span>
<span class="lineNum">     946 </span><span class="lineCov">        559 :   NewSpecies::initialize();</span>
<span class="lineNum">     947 </span><span class="lineCov">     110864 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     948 </span><span class="lineCov">     219492 :     s(i).adjust_trait_vector_dimensions();</span>
<span class="lineNum">     949 </span>            :   }
<span class="lineNum">     950 </span>            : 
<span class="lineNum">     951 </span><span class="lineCov">        559 :   initialize_precomputed();</span>
<a name="952"><span class="lineNum">     952 </span><span class="lineCov">        559 : }</span></a>
<span class="lineNum">     953 </span>            : 
<span class="lineNum">     954 </span><span class="lineCov">        881 : void NewWeb::prepare_for_integration(){</span>
<span class="lineNum">     955 </span><span class="lineCov">        881 :   if(dynamics_accelerator) {</span>
<span class="lineNum">     956 </span><span class="lineNoCov">          0 :     delete dynamics_accelerator;</span>
<span class="lineNum">     957 </span><span class="lineNoCov">          0 :     dynamics_accelerator = 0;</span>
<span class="lineNum">     958 </span>            :   }
<span class="lineNum">     959 </span><span class="lineCov">        881 :   if(use_packed_simulation and</span>
<span class="lineNum">     960 </span><span class="lineNoCov">          0 :      number_of_animals() &gt;= max_num_threads and</span>
<span class="lineNum">     961 </span><span class="lineCov">        881 :      number_of_plants()  &gt;= max_num_threads and</span>
<span class="lineNum">     962 </span>            :      do_switching
<span class="lineNum">     963 </span>            :      ){
<span class="lineNum">     964 </span><span class="lineNoCov">          0 :     dynamics_accelerator=new packed_simulation(*this);</span>
<a name="965"><span class="lineNum">     965 </span>            :   }</a>
<span class="lineNum">     966 </span><span class="lineCov">        881 : }</span>
<span class="lineNum">     967 </span><span class="lineCov">        521 : void NewWeb::cleanup_after_integration(){</span>
<span class="lineNum">     968 </span><span class="lineCov">        521 :   if(dynamics_accelerator) {</span>
<span class="lineNum">     969 </span><span class="lineNoCov">          0 :     delete dynamics_accelerator;</span>
<span class="lineNum">     970 </span><span class="lineNoCov">          0 :     dynamics_accelerator = 0;</span>
<span class="lineNum">     971 </span>            :   }
<a name="972"><span class="lineNum">     972 </span><span class="lineCov">        521 : }</span></a>
<span class="lineNum">     973 </span>            : 
<span class="lineNum">     974 </span><span class="lineCov">      67085 : void NewWeb::precondition(ODE_vector const &amp; state,</span>
<span class="lineNum">     975 </span>            :                   ODE_vector const &amp; in,
<span class="lineNum">     976 </span>            :                   ODE_vector &amp; out,
<span class="lineNum">     977 </span>            :                   realtype gamma,
<span class="lineNum">     978 </span>            :                   bool left_rather_than_right){
<span class="lineNum">     979 </span>            : //   The preconditioner computes
<span class="lineNum">     980 </span>            : //   out = P_i^(-1) in,
<span class="lineNum">     981 </span>            : //   where i=1,2 and P=P_1*P_2 is an approximation of the Newton Matrix N
<span class="lineNum">     982 </span>            : //   N = I - gamma J
<span class="lineNum">     983 </span>            : //   where J is the Jacobian of the dynamics f.
<span class="lineNum">     984 </span>            : 
<span class="lineNum">     985 </span>            : //   A dumb preconditioner does not do much harm,
<span class="lineNum">     986 </span>            : //   so we check that we are at least better than this:
<span class="lineNum">     987 </span>            :   
<span class="lineNum">     988 </span><span class="lineCov">      67085 :   if(dumb_preconditioner || !left_rather_than_right){</span>
<span class="lineNum">     989 </span><span class="lineNoCov">          0 :     memcpy(&amp;out[0],&amp;in[0],in.size()*sizeof(in[0]));</span>
<span class="lineNum">     990 </span>            :   }else{
<span class="lineNum">     991 </span><span class="lineCov">      67085 :     if(dynamics_accelerator) {</span>
<span class="lineNum">     992 </span><span class="lineNoCov">          0 :       dynamics_accelerator-&gt;precondition(state,in,out,gamma);</span>
<span class="lineNum">     993 </span>            :     }else{
<span class="lineNum">     994 </span><span class="lineCov">   13318680 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">     995 </span><span class="lineCov">   65922550 :         out[i]=in[i]/(1+gamma*s(i).turnover_rate_r());</span>
<span class="lineNum">     996 </span>            :       }
<span class="lineNum">     997 </span>            :     }
<span class="lineNum">     998 </span>            :   }
<a name="999"><span class="lineNum">     999 </span><span class="lineCov">      67085 : }</span></a>
<span class="lineNum">    1000 </span>            : 
<span class="lineNum">    1001 </span><span class="lineNoCov">          0 : void NewWeb::get_inherent_rates(ODE_vector &amp; rates){</span>
<span class="lineNum">    1002 </span><span class="lineNoCov">          0 :   for(int i=number_of_variables();i--&gt;0;){</span>
<span class="lineNum">    1003 </span><span class="lineNoCov">          0 :     rates[i]=s(i).turnover_rate_r();</span>
<span class="lineNum">    1004 </span>            :   }
<span class="lineNum">    1005 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1006 </span>            : 
<a name="1007"><span class="lineNum">    1007 </span>            : </a>
<span class="lineNum">    1008 </span>            : // the next is dead code??
<span class="lineNum">    1009 </span><span class="lineNoCov">          0 : link_strength_matrix select(const link_strength_matrix &amp; m,</span>
<span class="lineNum">    1010 </span>            :                             const sequence&lt;short int&gt; &amp; u){
<span class="lineNum">    1011 </span><span class="lineNoCov">          0 :   link_strength_matrix m0;</span>
<span class="lineNum">    1012 </span><span class="lineNoCov">          0 :   int i0=0;</span>
<span class="lineNum">    1013 </span><span class="lineNoCov">          0 :   for(unsigned int i=0;i&lt;m.size();i++){</span>
<span class="lineNum">    1014 </span><span class="lineNoCov">          0 :     if(u[i]){</span>
<span class="lineNum">    1015 </span>            :       int j0=0;
<span class="lineNum">    1016 </span><span class="lineNoCov">          0 :       for(unsigned int j=0;j&lt;m.size();j++){</span>
<span class="lineNum">    1017 </span><span class="lineNoCov">          0 :         if(u[j]){</span>
<span class="lineNum">    1018 </span><span class="lineNoCov">          0 :           m0(j0,i0)=m(j,i);</span>
<span class="lineNum">    1019 </span><span class="lineNoCov">          0 :           j0++;</span>
<span class="lineNum">    1020 </span>            :         }
<span class="lineNum">    1021 </span>            :       }
<span class="lineNum">    1022 </span><span class="lineNoCov">          0 :       i0++;</span>
<span class="lineNum">    1023 </span>            :     }
<span class="lineNum">    1024 </span>            :   }
<span class="lineNum">    1025 </span><span class="lineNoCov">          0 :   return m0;</span>
<a name="1026"><span class="lineNum">    1026 </span>            : }</a>
<span class="lineNum">    1027 </span>            : 
<span class="lineNum">    1028 </span><span class="lineNoCov">          0 : link_strength_matrix NewWeb::matching_matrix(){</span>
<span class="lineNum">    1029 </span><span class="lineNoCov">          0 :   prepare_for_integration();</span>
<span class="lineNum">    1030 </span><span class="lineNoCov">          0 :   link_strength_matrix m;</span>
<span class="lineNum">    1031 </span><span class="lineNoCov">          0 :   m.resize(s.size());</span>
<span class="lineNum">    1032 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1033 </span><span class="lineNoCov">          0 :     if(s[i].is_a_plant())</span>
<span class="lineNum">    1034 </span><span class="lineNoCov">          0 :       for(int j=s.size();j--&gt;0;){</span>
<span class="lineNum">    1035 </span><span class="lineNoCov">          0 :         m(j,i)=0;</span>
<span class="lineNum">    1036 </span>            :       }
<span class="lineNum">    1037 </span>            :     else // j is the forager:
<span class="lineNum">    1038 </span><span class="lineNoCov">          0 :       for(int j=s.size();j--&gt;0;){</span>
<span class="lineNum">    1039 </span><span class="lineNoCov">          0 :         m(j,i)=precomputed[j].c[i];</span>
<span class="lineNum">    1040 </span>            :       }
<span class="lineNum">    1041 </span>            :   }
<span class="lineNum">    1042 </span><span class="lineNoCov">          0 :   return m;</span>
<a name="1043"><span class="lineNum">    1043 </span>            : }</a>
<span class="lineNum">    1044 </span>            :                    
<span class="lineNum">    1045 </span><span class="lineNoCov">          0 : const link_strength_matrix &amp; NewWeb::get_intake_matrix(){</span>
<span class="lineNum">    1046 </span><span class="lineNoCov">          0 :   return fx;</span>
<a name="1047"><span class="lineNum">    1047 </span>            : }</a>
<span class="lineNum">    1048 </span>            : 
<span class="lineNum">    1049 </span><span class="lineCov">        360 : link_strength_matrix NewWeb::intake_matrix(bool initialize){</span>
<span class="lineNum">    1050 </span><span class="lineCov">        360 :   prepare_for_integration();</span>
<span class="lineNum">    1051 </span><span class="lineCov">        720 :   ODE_vector state(number_of_variables());</span>
<span class="lineNum">    1052 </span><span class="lineCov">        360 :   NewWeb::write_state_to(state);</span>
<span class="lineNum">    1053 </span><span class="lineCov">        360 :   compute_flows(state,initialize); // sets fx as a side effect</span>
<span class="lineNum">    1054 </span><span class="lineCov">       1080 :   return fx;</span>
<a name="1055"><span class="lineNum">    1055 </span>            : }</a>
<span class="lineNum">    1056 </span>            :                    
<span class="lineNum">    1057 </span><span class="lineCov">        135 : link_strength_matrix NewWeb::scaled_intake_matrix(bool initialize){</span>
<span class="lineNum">    1058 </span>            :   link_strength_matrix f=
<span class="lineNum">    1059 </span><span class="lineCov">        135 :     intake_matrix(initialize);</span>
<span class="lineNum">    1060 </span><span class="lineCov">        270 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1061 </span><span class="lineCov">    5309536 :     for(int j=s.size();j--&gt;0;){</span>
<span class="lineNum">    1062 </span><span class="lineCov">   21026192 :       f(i,j)/=s[i].turnover_rate_r();</span>
<span class="lineNum">    1063 </span>            :     }
<span class="lineNum">    1064 </span>            :   }
<span class="lineNum">    1065 </span><span class="lineCov">        135 :   return f;</span>
<span class="lineNum">    1066 </span>            : }
<a name="1067"><span class="lineNum">    1067 </span>            :         </a>
<span class="lineNum">    1068 </span>            : #if 1
<span class="lineNum">    1069 </span><span class="lineCov">        270 : void NewWeb::get_top_down_strength(){</span>
<span class="lineNum">    1070 </span><span class="lineCov">        540 :   ODE_vector ddt(number_of_variables());</span>
<span class="lineNum">    1071 </span><span class="lineCov">        540 :   ODE_state ode_state(this); </span>
<span class="lineNum">    1072 </span><span class="lineCov">        270 :   dynamics(ode_state,ddt);</span>
<span class="lineNum">    1073 </span><span class="lineCov">        270 :   return;</span>
<span class="lineNum">    1074 </span>            : }
<span class="lineNum">    1075 </span>            : #else
<span class="lineNum">    1076 </span>            : void NewWeb::get_top_down_strength(){
<span class="lineNum">    1077 </span>            :   int hold=get_cfg_parameter(&quot;record_relaxation_dynamics&quot;);
<span class="lineNum">    1078 </span>            :   set_cfg_parameter(&quot;record_relaxation_dynamics&quot;,&quot;0&quot;);
<span class="lineNum">    1079 </span>            :   relax(0);
<span class="lineNum">    1080 </span>            :   set_cfg_parameter(&quot;record_relaxation_dynamics&quot;,
<span class="lineNum">    1081 </span>            :                     (hold==0?&quot;0&quot;:&quot;1&quot;) );
<span class="lineNum">    1082 </span>            :   return;
<span class="lineNum">    1083 </span>            : }
<a name="1084"><span class="lineNum">    1084 </span>            : #endif</a>
<span class="lineNum">    1085 </span>            :                    
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 : void NewWeb::enforce_equilibrium(){</span>
<span class="lineNum">    1087 </span>            :   // ... and delete species for which it cannot be enforced
<span class="lineNum">    1088 </span>            :   int bad_species;
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :   do{</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :     bad_species=-1; // -1 means no species is bad</span>
<span class="lineNum">    1091 </span>            :     {
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :       ODE_vector state(number_of_variables()),</span>
<span class="lineNum">    1093 </span><span class="lineNoCov">          0 :         time_derivative(number_of_variables());</span>
<span class="lineNum">    1094 </span><span class="lineNoCov">          0 :       NewWeb::write_state_to(state);</span>
<span class="lineNum">    1095 </span><span class="lineNoCov">          0 :       NewWeb::dynamics(state,time_derivative);</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1097 </span><span class="lineNoCov">          0 :         if(!s[i].increase_loss_rate_by(time_derivative[i])){</span>
<span class="lineNum">    1098 </span>            :           bad_species=i;
<span class="lineNum">    1099 </span>            :           break;
<span class="lineNum">    1100 </span>            :         }
<span class="lineNum">    1101 </span>            :       }
<span class="lineNum">    1102 </span>            :     }
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :     if(bad_species&gt;=0){</span>
<span class="lineNum">    1104 </span><span class="lineNoCov">          0 :       WARNING(&quot;deleting species &quot; &lt;&lt; assigned_column[bad_species]);</span>
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :       delete_species(bad_species);</span>
<span class="lineNum">    1106 </span>            :     }else{
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :       return;</span>
<span class="lineNum">    1108 </span>            :     }
<span class="lineNum">    1109 </span>            :   }while(true);
<a name="1110"><span class="lineNum">    1110 </span>            : }</a>
<span class="lineNum">    1111 </span>            : 
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 : double NewWeb::fitness(int test){</span>
<span class="lineNum">    1113 </span><span class="lineNoCov">          0 :   ODE_vector state(number_of_variables()),</span>
<span class="lineNum">    1114 </span><span class="lineNoCov">          0 :     time_derivative(number_of_variables());</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :   NewWeb::write_state_to(state);</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :   NewWeb::dynamics(state,time_derivative);</span>
<span class="lineNum">    1117 </span><span class="lineNoCov">          0 :   return time_derivative[test];</span>
<a name="1118"><span class="lineNum">    1118 </span>            : }</a>
<span class="lineNum">    1119 </span>            : 
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 : double NewWeb::fitness(NewSpecies &amp; test_species){</span>
<span class="lineNum">    1121 </span>            :   // species should have number of individuals set!
<span class="lineNum">    1122 </span><span class="lineNoCov">          0 :   int test=get_unused_index_and_allocate_memory(test_species.is_a_plant());</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :   s[test]=test_species;</span>
<span class="lineNum">    1124 </span><span class="lineNoCov">          0 :   precomputed.update(test,s);</span>
<span class="lineNum">    1125 </span><span class="lineNoCov">          0 :   double f=fitness(test);</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :   delete_species(test);</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :   return f;</span>
<a name="1128"><span class="lineNum">    1128 </span>            : }</a>
<span class="lineNum">    1129 </span>            : 
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 : void NewWeb::delete_random_animal_species(){</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :   delete_species(unirand()*number_of_animals());</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 : }</span>
<a name="1133"><span class="lineNum">    1133 </span>            : </a>
<span class="lineNum">    1134 </span>            : // delete x randomly chosen fish species
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_at_random(double x){</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">          0 :   double dummyindex=0;</span>
<span class="lineNum">    1138 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1139 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1140 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1142 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1147 </span>            :       }
<span class="lineNum">    1148 </span>            :     }
<span class="lineNum">    1149 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1150 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1152 </span>            :     }else{
<span class="lineNum">    1153 </span>            :       // Choose a random number representing the fish species to be deleted
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :       dummyindex = nooffishspecies*unirand();</span>
<span class="lineNum">    1155 </span>            :       // int() always rounds down to nearest integer, regardless of size of fraction
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :       deletedfishspeciesindex = int(dummyindex);</span>
<span class="lineNum">    1157 </span>            :       //cout &lt;&lt; &quot;dummyindex = &quot; &lt;&lt; dummyindex &lt;&lt; endl;
<span class="lineNum">    1158 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1160 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1161 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1162 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1163 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1164 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1166 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1168 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1171 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1172 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1173 </span>            :           }else{
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1175 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1176 </span>            :           }
<span class="lineNum">    1177 </span>            :         }
<span class="lineNum">    1178 </span>            :       }
<span class="lineNum">    1179 </span>            :     }
<span class="lineNum">    1180 </span>            :   }
<span class="lineNum">    1181 </span><span class="lineNoCov">          0 : }</span>
<a name="1182"><span class="lineNum">    1182 </span>            : </a>
<span class="lineNum">    1183 </span>            : // delete x randomly chosen fish species
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_size(double x){</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1186 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1189 </span><span class="lineNoCov">          0 :   double largestM=0;</span>
<span class="lineNum">    1190 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1191 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1192 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1194 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1196 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1197 </span>            :       }
<span class="lineNum">    1198 </span>            :     }
<span class="lineNum">    1199 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1201 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1202 </span>            :     }else{
<span class="lineNum">    1203 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1204 </span><span class="lineNoCov">          0 :       largestM=0;</span>
<span class="lineNum">    1205 </span>            :       // Choose the largest existing fish species and delete it
<span class="lineNum">    1206 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the largest existing fish species
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1208 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :           if(s[i].bodymass()&gt;largestM){</span>
<span class="lineNum">    1210 </span><span class="lineNoCov">          0 :             largestM=s[i].bodymass();</span>
<span class="lineNum">    1211 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1212 </span>            :           }
<span class="lineNum">    1213 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1214 </span>            :         }
<span class="lineNum">    1215 </span>            :       }
<span class="lineNum">    1216 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1219 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1220 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1221 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1222 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1223 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1224 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1226 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1228 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1230 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1231 </span>            :           }else{
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1233 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1234 </span>            :           }
<span class="lineNum">    1235 </span>            :         }
<span class="lineNum">    1236 </span>            :       }
<span class="lineNum">    1237 </span>            :     }
<span class="lineNum">    1238 </span>            :   }
<span class="lineNum">    1239 </span><span class="lineNoCov">          0 : }</span>
<a name="1240"><span class="lineNum">    1240 </span>            : </a>
<span class="lineNum">    1241 </span>            : // delete x randomly chosen fish species
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_size_reverse(double x){</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1244 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1246 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :   double smallestM=0;</span>
<span class="lineNum">    1248 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1249 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1250 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1251 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1255 </span>            :       }
<span class="lineNum">    1256 </span>            :     }
<span class="lineNum">    1257 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1259 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1260 </span>            :     }else{
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1262 </span><span class="lineNoCov">          0 :       smallestM=fishMupperthreshold;</span>
<span class="lineNum">    1263 </span>            :       // Choose the smallest existing fish species and delete it
<span class="lineNum">    1264 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the smallest existing fish species
<span class="lineNum">    1265 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :           if(s[i].bodymass()&lt;smallestM){</span>
<span class="lineNum">    1268 </span><span class="lineNoCov">          0 :             smallestM=s[i].bodymass();</span>
<span class="lineNum">    1269 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1270 </span>            :           }
<span class="lineNum">    1271 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1272 </span>            :         }
<span class="lineNum">    1273 </span>            :       }
<span class="lineNum">    1274 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1275 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1276 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1277 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1278 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1279 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1280 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1281 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1282 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1283 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1288 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1289 </span>            :           }else{
<span class="lineNum">    1290 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1291 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1292 </span>            :           }
<span class="lineNum">    1293 </span>            :         }
<span class="lineNum">    1294 </span>            :       }
<span class="lineNum">    1295 </span>            :     }
<span class="lineNum">    1296 </span>            :   }
<span class="lineNum">    1297 </span><span class="lineNoCov">          0 : }</span>
<a name="1298"><span class="lineNum">    1298 </span>            : </a>
<span class="lineNum">    1299 </span>            : // delete x fish species chosen in order of decreasing biomass
<span class="lineNum">    1300 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_biomass(double x){</span>
<span class="lineNum">    1301 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1302 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1304 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1305 </span><span class="lineNoCov">          0 :   double largestB=0;</span>
<span class="lineNum">    1306 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1307 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1308 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1309 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1310 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1311 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1312 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1313 </span>            :       }
<span class="lineNum">    1314 </span>            :     }
<span class="lineNum">    1315 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1318 </span>            :     }else{
<span class="lineNum">    1319 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :       largestB=0;</span>
<span class="lineNum">    1321 </span>            :       // Choose the existing fish species with largest biomass and delete it
<span class="lineNum">    1322 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1323 </span>            :       // with largest biomass
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :           if(s(i).biomass_abundance_B()&gt;largestB){</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :             largestB=s(i).biomass_abundance_B();</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1329 </span>            :           }
<span class="lineNum">    1330 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1331 </span>            :         }
<span class="lineNum">    1332 </span>            :       }
<span class="lineNum">    1333 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1334 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1335 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1336 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1337 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1338 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1339 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1340 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1341 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1342 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1343 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1344 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1345 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1346 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1347 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1348 </span>            :           }else{
<span class="lineNum">    1349 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1350 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1351 </span>            :           }
<span class="lineNum">    1352 </span>            :         }
<span class="lineNum">    1353 </span>            :       }
<span class="lineNum">    1354 </span>            :     }
<span class="lineNum">    1355 </span>            :   }
<span class="lineNum">    1356 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1357 </span>            : 
<a name="1358"><span class="lineNum">    1358 </span>            : </a>
<span class="lineNum">    1359 </span>            : // delete x fish species chosen in order of increasing biomass
<span class="lineNum">    1360 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_biomass_reverse(double x){</span>
<span class="lineNum">    1361 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1362 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1363 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1364 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1365 </span><span class="lineNoCov">          0 :   double smallestB=0;</span>
<span class="lineNum">    1366 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1367 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1368 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1369 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1370 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1371 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1372 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1373 </span>            :       }
<span class="lineNum">    1374 </span>            :     }
<span class="lineNum">    1375 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1376 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1377 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1378 </span>            :     }else{
<span class="lineNum">    1379 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1380 </span><span class="lineNoCov">          0 :       smallestB=0;</span>
<span class="lineNum">    1381 </span>            :       // Choose the existing fish species with smallest biomass and delete it
<span class="lineNum">    1382 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1383 </span>            :       // with smallest biomass
<span class="lineNum">    1384 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1385 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1386 </span><span class="lineNoCov">          0 :           if(dummyindex==0){</span>
<span class="lineNum">    1387 </span><span class="lineNoCov">          0 :             smallestB=s(i).biomass_abundance_B();</span>
<span class="lineNum">    1388 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1389 </span>            :           }
<span class="lineNum">    1390 </span><span class="lineNoCov">          0 :           if(dummyindex&gt;0){</span>
<span class="lineNum">    1391 </span><span class="lineNoCov">          0 :             if(s(i).biomass_abundance_B()&lt;smallestB){</span>
<span class="lineNum">    1392 </span><span class="lineNoCov">          0 :               smallestB=s(i).biomass_abundance_B();</span>
<span class="lineNum">    1393 </span><span class="lineNoCov">          0 :               deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1394 </span>            :             }
<span class="lineNum">    1395 </span>            :           }
<span class="lineNum">    1396 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1397 </span>            :         }
<span class="lineNum">    1398 </span>            :       }
<span class="lineNum">    1399 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1400 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1401 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1402 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1403 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1404 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1405 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1406 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1407 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1408 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1409 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1410 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1411 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1412 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1413 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1414 </span>            :           }else{
<span class="lineNum">    1415 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1416 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1417 </span>            :           }
<span class="lineNum">    1418 </span>            :         }
<span class="lineNum">    1419 </span>            :       }
<span class="lineNum">    1420 </span>            :     }
<span class="lineNum">    1421 </span>            :   }
<span class="lineNum">    1422 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1423 </span>            : 
<a name="1424"><span class="lineNum">    1424 </span>            : </a>
<span class="lineNum">    1425 </span>            : // delete x fish species chosen in order of decreasing TL
<span class="lineNum">    1426 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_TL(double x){</span>
<span class="lineNum">    1427 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1428 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1429 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1430 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1431 </span><span class="lineNoCov">          0 :   double largestTL=0;</span>
<span class="lineNum">    1432 </span>            :   // Work out TLs
<span class="lineNum">    1433 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    1434 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    1435 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    1436 </span><span class="lineNoCov">          0 :   NewVector level;</span>
<span class="lineNum">    1437 </span><span class="lineNoCov">          0 :   NewMatrix dietF;</span>
<span class="lineNum">    1438 </span><span class="lineNoCov">          0 :   dietF=ifrac;</span>
<span class="lineNum">    1439 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    1440 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1441 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    1442 </span>            :   }
<span class="lineNum">    1443 </span><span class="lineNoCov">          0 :   level=ones;</span>
<span class="lineNum">    1444 </span><span class="lineNoCov">          0 :   NewVector level2;</span>
<span class="lineNum">    1445 </span><span class="lineNoCov">          0 :   NewVector leveldiff;</span>
<span class="lineNum">    1446 </span><span class="lineNoCov">          0 :   double dummycounter = 0;</span>
<span class="lineNum">    1447 </span><span class="lineNoCov">          0 :   double dummydiff = 0;</span>
<span class="lineNum">    1448 </span>            :   do{
<span class="lineNum">    1449 </span><span class="lineNoCov">          0 :     level2=level;</span>
<span class="lineNum">    1450 </span><span class="lineNoCov">          0 :     level=dietF*level+ones;</span>
<span class="lineNum">    1451 </span><span class="lineNoCov">          0 :     leveldiff=level-level2;</span>
<span class="lineNum">    1452 </span><span class="lineNoCov">          0 :     dummydiff=NewVectorAbs(leveldiff);</span>
<span class="lineNum">    1453 </span><span class="lineNoCov">          0 :     dummycounter=dummycounter+1;</span>
<span class="lineNum">    1454 </span>            :     //cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;
<span class="lineNum">    1455 </span>            :     //cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;
<span class="lineNum">    1456 </span><span class="lineNoCov">          0 :   }while(dummydiff&gt;=0.0001);</span>
<span class="lineNum">    1457 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;</span>
<span class="lineNum">    1458 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;</span>
<span class="lineNum">    1459 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1460 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1461 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1462 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1463 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1464 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1465 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1466 </span>            :       }
<span class="lineNum">    1467 </span>            :     }
<span class="lineNum">    1468 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1469 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1470 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1471 </span>            :     }else{
<span class="lineNum">    1472 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1473 </span><span class="lineNoCov">          0 :       largestTL=0;</span>
<span class="lineNum">    1474 </span>            :       // Choose the existing fish species with largest TL and delete it
<span class="lineNum">    1475 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1476 </span>            :       // with largest TL
<span class="lineNum">    1477 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1478 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1479 </span><span class="lineNoCov">          0 :           if(level[i]&gt;largestTL){</span>
<span class="lineNum">    1480 </span><span class="lineNoCov">          0 :             largestTL=level[i];</span>
<span class="lineNum">    1481 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1482 </span>            :           }
<span class="lineNum">    1483 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1484 </span>            :         }
<span class="lineNum">    1485 </span>            :       }
<span class="lineNum">    1486 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1487 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1488 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1489 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1490 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1491 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1492 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1493 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1494 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1495 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1496 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1497 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1498 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1499 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1500 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1501 </span>            :           }else{
<span class="lineNum">    1502 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1503 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1504 </span>            :           }
<span class="lineNum">    1505 </span>            :         }
<span class="lineNum">    1506 </span>            :       }
<span class="lineNum">    1507 </span>            :     }
<span class="lineNum">    1508 </span>            :   }
<span class="lineNum">    1509 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1510 </span>            : 
<a name="1511"><span class="lineNum">    1511 </span>            : </a>
<span class="lineNum">    1512 </span>            : // delete x fish species chosen in order of increasing TL
<span class="lineNum">    1513 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_TL_reverse(double x){</span>
<span class="lineNum">    1514 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1515 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1516 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1517 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1518 </span><span class="lineNoCov">          0 :   double smallestTL=0;</span>
<span class="lineNum">    1519 </span>            :   // Work out TLs
<span class="lineNum">    1520 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    1521 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    1522 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    1523 </span><span class="lineNoCov">          0 :   NewVector level;</span>
<span class="lineNum">    1524 </span><span class="lineNoCov">          0 :   NewMatrix dietF;</span>
<span class="lineNum">    1525 </span><span class="lineNoCov">          0 :   dietF=ifrac;</span>
<span class="lineNum">    1526 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    1527 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1528 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    1529 </span>            :   }
<span class="lineNum">    1530 </span><span class="lineNoCov">          0 :   level=ones;</span>
<span class="lineNum">    1531 </span><span class="lineNoCov">          0 :   NewVector level2;</span>
<span class="lineNum">    1532 </span><span class="lineNoCov">          0 :   NewVector leveldiff;</span>
<span class="lineNum">    1533 </span><span class="lineNoCov">          0 :   double dummycounter = 0;</span>
<span class="lineNum">    1534 </span><span class="lineNoCov">          0 :   double dummydiff = 0;</span>
<span class="lineNum">    1535 </span>            :   do{
<span class="lineNum">    1536 </span><span class="lineNoCov">          0 :     level2=level;</span>
<span class="lineNum">    1537 </span><span class="lineNoCov">          0 :     level=dietF*level+ones;</span>
<span class="lineNum">    1538 </span><span class="lineNoCov">          0 :     leveldiff=level-level2;</span>
<span class="lineNum">    1539 </span><span class="lineNoCov">          0 :     dummydiff=NewVectorAbs(leveldiff);</span>
<span class="lineNum">    1540 </span><span class="lineNoCov">          0 :     dummycounter=dummycounter+1;</span>
<span class="lineNum">    1541 </span>            :     //cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;
<span class="lineNum">    1542 </span>            :     //cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;
<span class="lineNum">    1543 </span><span class="lineNoCov">          0 :   }while(dummydiff&gt;=0.0001);</span>
<span class="lineNum">    1544 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;</span>
<span class="lineNum">    1545 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;</span>
<span class="lineNum">    1546 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1547 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1548 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1549 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1550 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1551 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1552 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1553 </span>            :       }
<span class="lineNum">    1554 </span>            :     }
<span class="lineNum">    1555 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1556 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1557 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1558 </span>            :     }else{
<span class="lineNum">    1559 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1560 </span><span class="lineNoCov">          0 :       smallestTL=0;</span>
<span class="lineNum">    1561 </span>            :       // Choose the existing fish species with smallest TL and delete it
<span class="lineNum">    1562 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1563 </span>            :       // with smallest TL
<span class="lineNum">    1564 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1565 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1566 </span><span class="lineNoCov">          0 :           if(dummyindex==0){</span>
<span class="lineNum">    1567 </span><span class="lineNoCov">          0 :             smallestTL=level[i];</span>
<span class="lineNum">    1568 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1569 </span>            :           }
<span class="lineNum">    1570 </span><span class="lineNoCov">          0 :           if(dummyindex&gt;0){</span>
<span class="lineNum">    1571 </span><span class="lineNoCov">          0 :             if(level[i]&lt;smallestTL){</span>
<span class="lineNum">    1572 </span><span class="lineNoCov">          0 :               smallestTL=level[i];</span>
<span class="lineNum">    1573 </span><span class="lineNoCov">          0 :               deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1574 </span>            :             }
<span class="lineNum">    1575 </span>            :           }
<span class="lineNum">    1576 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1577 </span>            :         }
<span class="lineNum">    1578 </span>            :       }
<span class="lineNum">    1579 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1580 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1581 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1582 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1583 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1584 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1585 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1586 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1587 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1588 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1589 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1590 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1591 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1592 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1593 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1594 </span>            :           }else{
<span class="lineNum">    1595 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1596 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1597 </span>            :           }
<span class="lineNum">    1598 </span>            :         }
<span class="lineNum">    1599 </span>            :       }
<span class="lineNum">    1600 </span>            :     }
<span class="lineNum">    1601 </span>            :   }
<span class="lineNum">    1602 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1603 </span>            : 
<a name="1604"><span class="lineNum">    1604 </span>            : </a>
<span class="lineNum">    1605 </span>            : // delete x fish species chosen in order of decreasing Conn
<span class="lineNum">    1606 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_Conn(double x){</span>
<span class="lineNum">    1607 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1608 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1609 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1610 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1611 </span><span class="lineNoCov">          0 :   double largestConn=0;</span>
<span class="lineNum">    1612 </span>            :   // Work out Conns
<span class="lineNum">    1613 </span><span class="lineNoCov">          0 :   const double gram=eval_here(&quot;1*gram&quot;); //get a dimensionless gram</span>
<span class="lineNum">    1614 </span><span class="lineNoCov">          0 :   const double unit_mass=eval_here(&quot;1*kilogram&quot;); //for output files</span>
<span class="lineNum">    1615 </span><span class="lineNoCov">          0 :   const double meter2=eval_here(&quot;1*meter^2&quot;);</span>
<span class="lineNum">    1616 </span><span class="lineNoCov">          0 :   const double unit_area=eval_here(&quot;1*meter^2&quot;); //for output files</span>
<span class="lineNum">    1617 </span><span class="lineNoCov">          0 :   const double year=eval_here(&quot;1*year&quot;);</span>
<span class="lineNum">    1618 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    1619 </span>            :   //cout &lt;&lt; &quot;area_per_compartment = &quot; &lt;&lt; area_per_compartment &lt;&lt; endl;
<span class="lineNum">    1620 </span>            :   //cout &lt;&lt; &quot;meter2 = &quot; &lt;&lt; meter2 &lt;&lt; endl;
<span class="lineNum">    1621 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    1622 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    1623 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    1624 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotI;</span>
<span class="lineNum">    1625 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjI;</span>
<span class="lineNum">    1626 </span><span class="lineNoCov">          0 :   double b_dotdotI = 0.0;</span>
<span class="lineNum">    1627 </span><span class="lineNoCov">          0 :   double dummy3 = 0.0;</span>
<span class="lineNum">    1628 </span><span class="lineNoCov">          0 :   double dummy4 = 0.0;</span>
<span class="lineNum">    1629 </span><span class="lineNoCov">          0 :   double resolog10M = 0.0;</span>
<span class="lineNum">    1630 </span><span class="lineNoCov">          0 :   double conslog10M = 0.0;</span>
<span class="lineNum">    1631 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Gen_I;</span>
<span class="lineNum">    1632 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Vul_I;</span>
<span class="lineNum">    1633 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Conn_I;</span>
<span class="lineNum">    1634 </span><span class="lineNoCov">          0 :   double dietfractionthreshold = 0.01; </span>
<span class="lineNum">    1635 </span>            :   // First populate b_idotI, b_dotjI.
<span class="lineNum">    1636 </span>            :   // Also calcuate b_dotdotI.
<span class="lineNum">    1637 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1638 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    1639 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    1640 </span><span class="lineNoCov">          0 :     dummy3 = 0;</span>
<span class="lineNum">    1641 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    1642 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    1643 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];</span>
<span class="lineNum">    1644 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    1645 </span><span class="lineNoCov">          0 :       dummy3 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1646 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1647 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1648 </span>            :       // End loop for j.
<span class="lineNum">    1649 </span>            :     }
<span class="lineNum">    1650 </span><span class="lineNoCov">          0 :     b_idotI[i] = dummy3;</span>
<span class="lineNum">    1651 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    1652 </span>            :     // End loop for i.
<span class="lineNum">    1653 </span>            :   }
<span class="lineNum">    1654 </span>            :   // Now populate Gen_I, Vul_I and 
<span class="lineNum">    1655 </span>            :   // Conn_I (= Gen + Vul)
<span class="lineNum">    1656 </span>            :   // for each species.
<span class="lineNum">    1657 </span>            :   double dummy100 = 0.0;
<span class="lineNum">    1658 </span>            :   double dummy101 = 0.0;
<span class="lineNum">    1659 </span>            :   double sumGen = 0.0;
<span class="lineNum">    1660 </span>            :   double sumVul = 0.0;
<span class="lineNum">    1661 </span>            :   double sumConn = 0.0;
<span class="lineNum">    1662 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1663 </span>            :     sumGen = 0;
<span class="lineNum">    1664 </span>            :     sumVul = 0;
<span class="lineNum">    1665 </span>            :     sumConn = 0;
<span class="lineNum">    1666 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    1667 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1668 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1669 </span>            :       // Work out Gen, Vul and Conn.
<span class="lineNum">    1670 </span><span class="lineNoCov">          0 :       if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    1671 </span><span class="lineNoCov">          0 :         if((dummy101/b_dotjI[i])&gt;dietfractionthreshold){</span>
<span class="lineNum">    1672 </span><span class="lineNoCov">          0 :           sumGen = sumGen + 1;</span>
<span class="lineNum">    1673 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    1674 </span>            :         }
<span class="lineNum">    1675 </span>            :       }
<span class="lineNum">    1676 </span><span class="lineNoCov">          0 :       if(b_dotjI[j]&gt;0){</span>
<span class="lineNum">    1677 </span><span class="lineNoCov">          0 :         if((dummy100/b_dotjI[j])&gt;dietfractionthreshold){</span>
<span class="lineNum">    1678 </span><span class="lineNoCov">          0 :           sumVul = sumVul + 1;</span>
<span class="lineNum">    1679 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    1680 </span>            :         }
<span class="lineNum">    1681 </span>            :       }
<span class="lineNum">    1682 </span>            :       // End loop for j.
<span class="lineNum">    1683 </span>            :     }
<span class="lineNum">    1684 </span><span class="lineNoCov">          0 :     Gen_I[i] = sumGen;</span>
<span class="lineNum">    1685 </span><span class="lineNoCov">          0 :     Vul_I[i] = sumVul;</span>
<span class="lineNum">    1686 </span><span class="lineNoCov">          0 :     Conn_I[i] = sumConn;</span>
<span class="lineNum">    1687 </span>            :     // End loop for i.
<span class="lineNum">    1688 </span>            :   }
<span class="lineNum">    1689 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1690 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1691 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1692 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1693 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1694 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1695 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1696 </span>            :       }
<span class="lineNum">    1697 </span>            :     }
<span class="lineNum">    1698 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1699 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1700 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1701 </span>            :     }else{
<span class="lineNum">    1702 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1703 </span><span class="lineNoCov">          0 :       largestConn=0;</span>
<span class="lineNum">    1704 </span>            :       // Choose the existing fish species with largest Conn and delete it
<span class="lineNum">    1705 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1706 </span>            :       // with largest Conn
<span class="lineNum">    1707 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1708 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1709 </span><span class="lineNoCov">          0 :           if(Conn_I[i]&gt;largestConn){</span>
<span class="lineNum">    1710 </span><span class="lineNoCov">          0 :             largestConn=Conn_I[i];</span>
<span class="lineNum">    1711 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1712 </span>            :           }
<span class="lineNum">    1713 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1714 </span>            :         }
<span class="lineNum">    1715 </span>            :       }
<span class="lineNum">    1716 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1717 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1718 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1719 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1720 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1721 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1722 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1723 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1724 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1725 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1726 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1727 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1728 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1729 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1730 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1731 </span>            :           }else{
<span class="lineNum">    1732 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1733 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1734 </span>            :           }
<span class="lineNum">    1735 </span>            :         }
<span class="lineNum">    1736 </span>            :       }
<span class="lineNum">    1737 </span>            :     }
<span class="lineNum">    1738 </span>            :   }
<span class="lineNum">    1739 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1740 </span>            : 
<a name="1741"><span class="lineNum">    1741 </span>            : </a>
<span class="lineNum">    1742 </span>            : // delete x fish species chosen in order of increasing Conn
<span class="lineNum">    1743 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_by_Conn_reverse(double x){</span>
<span class="lineNum">    1744 </span><span class="lineNoCov">          0 :   int dummyindex=0;</span>
<span class="lineNum">    1745 </span><span class="lineNoCov">          0 :   int nooffishspecies=0;</span>
<span class="lineNum">    1746 </span><span class="lineNoCov">          0 :   int deletedfishspeciesindex=0;</span>
<span class="lineNum">    1747 </span><span class="lineNoCov">          0 :   int indextracker=0;</span>
<span class="lineNum">    1748 </span><span class="lineNoCov">          0 :   double smallestConn=0;</span>
<span class="lineNum">    1749 </span>            :   // Work out Conns
<span class="lineNum">    1750 </span><span class="lineNoCov">          0 :   const double gram=eval_here(&quot;1*gram&quot;); //get a dimensionless gram</span>
<span class="lineNum">    1751 </span><span class="lineNoCov">          0 :   const double unit_mass=eval_here(&quot;1*kilogram&quot;); //for output files</span>
<span class="lineNum">    1752 </span><span class="lineNoCov">          0 :   const double meter2=eval_here(&quot;1*meter^2&quot;);</span>
<span class="lineNum">    1753 </span><span class="lineNoCov">          0 :   const double unit_area=eval_here(&quot;1*meter^2&quot;); //for output files</span>
<span class="lineNum">    1754 </span><span class="lineNoCov">          0 :   const double year=eval_here(&quot;1*year&quot;);</span>
<span class="lineNum">    1755 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    1756 </span>            :   //cout &lt;&lt; &quot;area_per_compartment = &quot; &lt;&lt; area_per_compartment &lt;&lt; endl;
<span class="lineNum">    1757 </span>            :   //cout &lt;&lt; &quot;meter2 = &quot; &lt;&lt; meter2 &lt;&lt; endl;
<span class="lineNum">    1758 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    1759 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    1760 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    1761 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotI;</span>
<span class="lineNum">    1762 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjI;</span>
<span class="lineNum">    1763 </span><span class="lineNoCov">          0 :   double b_dotdotI = 0.0;</span>
<span class="lineNum">    1764 </span><span class="lineNoCov">          0 :   double dummy3 = 0.0;</span>
<span class="lineNum">    1765 </span><span class="lineNoCov">          0 :   double dummy4 = 0.0;</span>
<span class="lineNum">    1766 </span><span class="lineNoCov">          0 :   double resolog10M = 0.0;</span>
<span class="lineNum">    1767 </span><span class="lineNoCov">          0 :   double conslog10M = 0.0;</span>
<span class="lineNum">    1768 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Gen_I;</span>
<span class="lineNum">    1769 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Vul_I;</span>
<span class="lineNum">    1770 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Conn_I;</span>
<span class="lineNum">    1771 </span><span class="lineNoCov">          0 :   double dietfractionthreshold = 0.01; </span>
<span class="lineNum">    1772 </span>            :   // First populate b_idotI, b_dotjI.
<span class="lineNum">    1773 </span>            :   // Also calcuate b_dotdotI.
<span class="lineNum">    1774 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1775 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    1776 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    1777 </span><span class="lineNoCov">          0 :     dummy3 = 0;</span>
<span class="lineNum">    1778 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    1779 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    1780 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];</span>
<span class="lineNum">    1781 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    1782 </span><span class="lineNoCov">          0 :       dummy3 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1783 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1784 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1785 </span>            :       // End loop for j.
<span class="lineNum">    1786 </span>            :     }
<span class="lineNum">    1787 </span><span class="lineNoCov">          0 :     b_idotI[i] = dummy3;</span>
<span class="lineNum">    1788 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    1789 </span>            :     // End loop for i.
<span class="lineNum">    1790 </span>            :   }
<span class="lineNum">    1791 </span>            :   // Now populate Gen_I, Vul_I and 
<span class="lineNum">    1792 </span>            :   // Conn_I (= Gen + Vul)
<span class="lineNum">    1793 </span>            :   // for each species.
<span class="lineNum">    1794 </span>            :   double dummy100 = 0.0;
<span class="lineNum">    1795 </span>            :   double dummy101 = 0.0;
<span class="lineNum">    1796 </span>            :   double sumGen = 0.0;
<span class="lineNum">    1797 </span>            :   double sumVul = 0.0;
<span class="lineNum">    1798 </span>            :   double sumConn = 0.0;
<span class="lineNum">    1799 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    1800 </span>            :     sumGen = 0;
<span class="lineNum">    1801 </span>            :     sumVul = 0;
<span class="lineNum">    1802 </span>            :     sumConn = 0;
<span class="lineNum">    1803 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    1804 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1805 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    1806 </span>            :       // Work out Gen, Vul and Conn.
<span class="lineNum">    1807 </span><span class="lineNoCov">          0 :       if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    1808 </span><span class="lineNoCov">          0 :         if((dummy101/b_dotjI[i])&gt;dietfractionthreshold){</span>
<span class="lineNum">    1809 </span><span class="lineNoCov">          0 :           sumGen = sumGen + 1;</span>
<span class="lineNum">    1810 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    1811 </span>            :         }
<span class="lineNum">    1812 </span>            :       }
<span class="lineNum">    1813 </span><span class="lineNoCov">          0 :       if(b_dotjI[j]&gt;0){</span>
<span class="lineNum">    1814 </span><span class="lineNoCov">          0 :         if((dummy100/b_dotjI[j])&gt;dietfractionthreshold){</span>
<span class="lineNum">    1815 </span><span class="lineNoCov">          0 :           sumVul = sumVul + 1;</span>
<span class="lineNum">    1816 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    1817 </span>            :         }
<span class="lineNum">    1818 </span>            :       }
<span class="lineNum">    1819 </span>            :       // End loop for j.
<span class="lineNum">    1820 </span>            :     }
<span class="lineNum">    1821 </span><span class="lineNoCov">          0 :     Gen_I[i] = sumGen;</span>
<span class="lineNum">    1822 </span><span class="lineNoCov">          0 :     Vul_I[i] = sumVul;</span>
<span class="lineNum">    1823 </span><span class="lineNoCov">          0 :     Conn_I[i] = sumConn;</span>
<span class="lineNum">    1824 </span>            :     // End loop for i.
<span class="lineNum">    1825 </span>            :   }
<span class="lineNum">    1826 </span>            :   // Loop to delete fish species - one fish species deleted per iteration
<span class="lineNum">    1827 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;x;i++){</span>
<span class="lineNum">    1828 </span>            :     // First work out the total number of fish species. If this is zero, then a message is printed out
<span class="lineNum">    1829 </span><span class="lineNoCov">          0 :     nooffishspecies=0;</span>
<span class="lineNum">    1830 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1831 </span><span class="lineNoCov">          0 :       if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1832 </span><span class="lineNoCov">          0 :         nooffishspecies+=1;</span>
<span class="lineNum">    1833 </span>            :       }
<span class="lineNum">    1834 </span>            :     }
<span class="lineNum">    1835 </span>            :     //cout &lt;&lt; &quot;nooffishspecies = &quot; &lt;&lt; nooffishspecies &lt;&lt; endl;
<span class="lineNum">    1836 </span><span class="lineNoCov">          0 :     if(nooffishspecies==0){</span>
<span class="lineNum">    1837 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;No fish species left&quot; &lt;&lt; endl;</span>
<span class="lineNum">    1838 </span>            :     }else{
<span class="lineNum">    1839 </span><span class="lineNoCov">          0 :       dummyindex=0;</span>
<span class="lineNum">    1840 </span><span class="lineNoCov">          0 :       smallestConn=0;</span>
<span class="lineNum">    1841 </span>            :       // Choose the existing fish species with smallest Conn and delete it
<span class="lineNum">    1842 </span>            :       // First find the index (deletedfishspeciesindex) corresponding to the existing fish species
<span class="lineNum">    1843 </span>            :       // with smallest Conn
<span class="lineNum">    1844 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1845 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1846 </span><span class="lineNoCov">          0 :           if(dummyindex==0){</span>
<span class="lineNum">    1847 </span><span class="lineNoCov">          0 :             smallestConn=Conn_I[i];</span>
<span class="lineNum">    1848 </span><span class="lineNoCov">          0 :             deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1849 </span>            :           }
<span class="lineNum">    1850 </span><span class="lineNoCov">          0 :           if(dummyindex&gt;0){</span>
<span class="lineNum">    1851 </span><span class="lineNoCov">          0 :             if(Conn_I[i]&lt;smallestConn){</span>
<span class="lineNum">    1852 </span><span class="lineNoCov">          0 :               smallestConn=Conn_I[i];</span>
<span class="lineNum">    1853 </span><span class="lineNoCov">          0 :               deletedfishspeciesindex=dummyindex;</span>
<span class="lineNum">    1854 </span>            :             }
<span class="lineNum">    1855 </span>            :           }
<span class="lineNum">    1856 </span><span class="lineNoCov">          0 :           dummyindex+=1;</span>
<span class="lineNum">    1857 </span>            :         }
<span class="lineNum">    1858 </span>            :       }
<span class="lineNum">    1859 </span>            :       //cout &lt;&lt; &quot;deletedfishspeciesindex = &quot; &lt;&lt; deletedfishspeciesindex &lt;&lt; endl;
<span class="lineNum">    1860 </span><span class="lineNoCov">          0 :       indextracker=0;</span>
<span class="lineNum">    1861 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1862 </span><span class="lineNoCov">          0 :         if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1863 </span>            :           // If indextracker is equal to deletedfishspeciesindex, then current fish species 
<span class="lineNum">    1864 </span>            :           // is deleted and indextracker is incremented by 1; else, indextracker is 
<span class="lineNum">    1865 </span>            :           // incremented by 1 without species deletion
<span class="lineNum">    1866 </span><span class="lineNoCov">          0 :           if(indextracker==deletedfishspeciesindex){</span>
<span class="lineNum">    1867 </span>            :             //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    1868 </span><span class="lineNoCov">          0 :             cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1869 </span><span class="lineNoCov">          0 :                  &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1870 </span><span class="lineNoCov">          0 :                  &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1871 </span><span class="lineNoCov">          0 :             delete_species(i);</span>
<span class="lineNum">    1872 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1873 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1874 </span>            :           }else{
<span class="lineNum">    1875 </span><span class="lineNoCov">          0 :             indextracker+=1;</span>
<span class="lineNum">    1876 </span>            :             //cout &lt;&lt; &quot;indextracker = &quot; &lt;&lt; indextracker &lt;&lt; endl;
<span class="lineNum">    1877 </span>            :           }
<span class="lineNum">    1878 </span>            :         }
<span class="lineNum">    1879 </span>            :       }
<span class="lineNum">    1880 </span>            :     }
<span class="lineNum">    1881 </span>            :   }
<span class="lineNum">    1882 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1883 </span>            : 
<a name="1884"><span class="lineNum">    1884 </span>            : // delete last fish species making up some % of total fish biomass when arranged in descending </a>
<span class="lineNum">    1885 </span>            : // order of biomass
<span class="lineNum">    1886 </span><span class="lineNoCov">          0 : void NewWeb::delete_rare_fish_species(double percentage){</span>
<span class="lineNum">    1887 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; fishbiomasses;</span>
<span class="lineNum">    1888 </span><span class="lineNoCov">          0 :   double totalfishbiomass=0;</span>
<span class="lineNum">    1889 </span><span class="lineNoCov">          0 :   double fractionthreshold=(100-percentage)/100;</span>
<span class="lineNum">    1890 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1891 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1892 </span><span class="lineNoCov">          0 :       fishbiomasses.push_back(s(i).biomass_abundance_B());</span>
<span class="lineNum">    1893 </span><span class="lineNoCov">          0 :       totalfishbiomass+=s(i).biomass_abundance_B();</span>
<span class="lineNum">    1894 </span>            :     }    
<span class="lineNum">    1895 </span>            :   }
<span class="lineNum">    1896 </span>            :   //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;
<span class="lineNum">    1897 </span><span class="lineNoCov">          0 :   double totalfishbiomassthreshold=fractionthreshold*totalfishbiomass;</span>
<span class="lineNum">    1898 </span><span class="lineNoCov">          0 :   double fishbiomassthreshold=0;</span>
<span class="lineNum">    1899 </span><span class="lineNoCov">          0 :   int fishbiomassthresholdindex=0;</span>
<span class="lineNum">    1900 </span>            :   //cout &lt;&lt; &quot;totalfishbiomassthreshold = &quot; &lt;&lt; totalfishbiomassthreshold &lt;&lt; endl;
<span class="lineNum">    1901 </span>            :   // sort fish biomasses in descending order (because we are working backwards in i)
<span class="lineNum">    1902 </span><span class="lineNoCov">          0 :   sort(fishbiomasses.begin(),fishbiomasses.end());</span>
<span class="lineNum">    1903 </span><span class="lineNoCov">          0 :   totalfishbiomass=0;</span>
<span class="lineNum">    1904 </span><span class="lineNoCov">          0 :   for(int i=fishbiomasses.size();i--&gt;0;){</span>
<span class="lineNum">    1905 </span>            :     //cout &lt;&lt; &quot;fishbiomasses.at(&quot; &lt;&lt; i &lt;&lt; &quot;) = &quot; &lt;&lt; fishbiomasses.at(i) &lt;&lt; endl;   
<span class="lineNum">    1906 </span><span class="lineNoCov">          0 :     if((totalfishbiomass&gt;totalfishbiomassthreshold)&amp;&amp;(fishbiomassthresholdindex==0)){</span>
<span class="lineNum">    1907 </span><span class="lineNoCov">          0 :       fishbiomassthreshold=fishbiomasses.at(i);</span>
<span class="lineNum">    1908 </span><span class="lineNoCov">          0 :       fishbiomassthresholdindex=1;</span>
<span class="lineNum">    1909 </span>            :     }
<span class="lineNum">    1910 </span><span class="lineNoCov">          0 :     totalfishbiomass+=fishbiomasses.at(i);</span>
<span class="lineNum">    1911 </span>            :     //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;   
<span class="lineNum">    1912 </span>            :   }
<span class="lineNum">    1913 </span>            :   //cout &lt;&lt; &quot;fishbiomassthreshold = &quot; &lt;&lt; fishbiomassthreshold &lt;&lt; endl;
<span class="lineNum">    1914 </span>            :   //cout &lt;&lt; &quot;fishbiomassthresholdindex = &quot; &lt;&lt; fishbiomassthresholdindex &lt;&lt; endl;
<span class="lineNum">    1915 </span>            :   // now delete rare fish species
<span class="lineNum">    1916 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1917 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)&amp;&amp;(s(i).biomass_abundance_B()&lt;=fishbiomassthreshold)){</span>
<span class="lineNum">    1918 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1919 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1920 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1921 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    1922 </span>            :     }
<span class="lineNum">    1923 </span>            :   }
<span class="lineNum">    1924 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    1925 </span>            : 
<a name="1926"><span class="lineNum">    1926 </span>            : // delete last fish species making up 5% of total fish biomass when arranged in descending </a>
<span class="lineNum">    1927 </span>            : // order of biomass, but using a positive sloping cut-off rather than a horizontal cut-off
<span class="lineNum">    1928 </span><span class="lineNoCov">          0 : void NewWeb::delete_rare_fish_species_5per_2(double slope){</span>
<span class="lineNum">    1929 </span>            :   // Rotated fish biomasses are fish biomasses rotated clockwise through angle defined by slope 
<span class="lineNum">    1930 </span>            :   // We only care about the rotated biomass, not the rotated body mass,
<span class="lineNum">    1931 </span>            :   // but the rotated biomass depends on original body mass.
<span class="lineNum">    1932 </span>            :   // Since line that does cutting-off is in log10 kg and log10 kg m-2, 
<span class="lineNum">    1933 </span>            :   // need to work in these units.
<span class="lineNum">    1934 </span>            :   // Rotated fish biomasses vector also has original fish biomass attached to each value.
<span class="lineNum">    1935 </span>            :   // There is also a vector of rotated biomasses for all species, required at the end.
<span class="lineNum">    1936 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; fishbiomasses;</span>
<span class="lineNum">    1937 </span><span class="lineNoCov">          0 :   double totalfishbiomass=0;</span>
<span class="lineNum">    1938 </span><span class="lineNoCov">          0 :   double percentage = 5;</span>
<span class="lineNum">    1939 </span><span class="lineNoCov">          0 :   double fractionthreshold=(100-percentage)/100;</span>
<span class="lineNum">    1940 </span><span class="lineNoCov">          0 :   sequence&lt; pair&lt;double,double&gt; &gt; rotatedlog10fishbiomassesunitmassunitarea;</span>
<span class="lineNum">    1941 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; rotatedlog10biomassesunitmassunitarea;</span>
<span class="lineNum">    1942 </span><span class="lineNoCov">          0 :   double theta=atan(slope);</span>
<span class="lineNum">    1943 </span><span class="lineNoCov">          0 :   double massunit = 1000;</span>
<span class="lineNum">    1944 </span><span class="lineNoCov">          0 :   double areaunit = 1;</span>
<span class="lineNum">    1945 </span>            :   //cout &lt;&lt; &quot;theta = &quot; &lt;&lt; theta &lt;&lt; endl;
<span class="lineNum">    1946 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1947 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    1948 </span><span class="lineNoCov">          0 :       fishbiomasses.push_back(s(i).biomass_abundance_B());</span>
<span class="lineNum">    1949 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassesunitmassunitarea.push_back(make_pair(</span>
<span class="lineNum">    1950 </span><span class="lineNoCov">          0 :                                                                     -(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    1951 </span><span class="lineNoCov">          0 :                                                                     +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta)</span>
<span class="lineNum">    1952 </span><span class="lineNoCov">          0 :                                                                     ,s(i).biomass_abundance_B()));</span>
<span class="lineNum">    1953 </span><span class="lineNoCov">          0 :       totalfishbiomass+=s(i).biomass_abundance_B();</span>
<span class="lineNum">    1954 </span>            :     }
<span class="lineNum">    1955 </span><span class="lineNoCov">          0 :     rotatedlog10biomassesunitmassunitarea.push_back(</span>
<span class="lineNum">    1956 </span><span class="lineNoCov">          0 :                                                     -(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    1957 </span><span class="lineNoCov">          0 :                                                     +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta)</span>
<span class="lineNum">    1958 </span><span class="lineNoCov">          0 :                                                     );</span>
<span class="lineNum">    1959 </span>            :   }
<span class="lineNum">    1960 </span>            :   // Re-populate vector rotatedlog10biomassesunitmassunitarea to get elements in right order - this time, at(i) works because
<span class="lineNum">    1961 </span>            :   // there are existing elements
<span class="lineNum">    1962 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1963 </span><span class="lineNoCov">          0 :     rotatedlog10biomassesunitmassunitarea.at(i)=-(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    1964 </span><span class="lineNoCov">          0 :       +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta);</span>
<span class="lineNum">    1965 </span>            :   }
<span class="lineNum">    1966 </span>            :   // For rotated fish biomasses vector,
<span class="lineNum">    1967 </span>            :   // sort in descending order (because we are working backwards in i)
<span class="lineNum">    1968 </span>            :   // then work out cut-off point above which there is (100-percentage)% of fish biomass
<span class="lineNum">    1969 </span>            :   // this is done in a loop where we go from fish species with highest biomass
<span class="lineNum">    1970 </span>            :   // down to cut-off point (as opposed to other way round), so always get
<span class="lineNum">    1971 </span>            :   // at least (100-percentage)% of total fish biomass
<span class="lineNum">    1972 </span><span class="lineNoCov">          0 :   double totalfishbiomassthreshold=fractionthreshold*totalfishbiomass;</span>
<span class="lineNum">    1973 </span><span class="lineNoCov">          0 :   double rotatedlog10fishbiomassthresholdunitmassunitarea=0;</span>
<span class="lineNum">    1974 </span><span class="lineNoCov">          0 :   int rotatedlog10fishbiomassthresholdunitmassunitareaindex=0;</span>
<span class="lineNum">    1975 </span>            :   //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;
<span class="lineNum">    1976 </span>            :   //cout &lt;&lt; &quot;totalfishbiomassthreshold = &quot; &lt;&lt; totalfishbiomassthreshold &lt;&lt; endl;
<span class="lineNum">    1977 </span><span class="lineNoCov">          0 :   sort(rotatedlog10fishbiomassesunitmassunitarea.begin(),rotatedlog10fishbiomassesunitmassunitarea.end());</span>
<span class="lineNum">    1978 </span><span class="lineNoCov">          0 :   totalfishbiomass=0;</span>
<span class="lineNum">    1979 </span><span class="lineNoCov">          0 :   for(int i=rotatedlog10fishbiomassesunitmassunitarea.size();i--&gt;0;){</span>
<span class="lineNum">    1980 </span>            :     //cout &lt;&lt; &quot;rotatedlog10fishbiomassesunitmassunitarea.at(&quot; &lt;&lt; i &lt;&lt; &quot;) = &quot; &lt;&lt; rotatedlog10fishbiomassesunitmassunitarea.at(i).first &lt;&lt; endl;   
<span class="lineNum">    1981 </span><span class="lineNoCov">          0 :     if((totalfishbiomass&gt;totalfishbiomassthreshold)&amp;&amp;(rotatedlog10fishbiomassthresholdunitmassunitareaindex==0)){</span>
<span class="lineNum">    1982 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassthresholdunitmassunitarea=rotatedlog10fishbiomassesunitmassunitarea.at(i).first;</span>
<span class="lineNum">    1983 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassthresholdunitmassunitareaindex=1;</span>
<span class="lineNum">    1984 </span>            :     }
<span class="lineNum">    1985 </span><span class="lineNoCov">          0 :     totalfishbiomass+=rotatedlog10fishbiomassesunitmassunitarea.at(i).second;</span>
<span class="lineNum">    1986 </span>            :     //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;   
<span class="lineNum">    1987 </span>            :   }
<span class="lineNum">    1988 </span>            :   //cout &lt;&lt; &quot;rotatedlog10fishbiomassthresholdunitmassunitarea = &quot; &lt;&lt; rotatedlog10fishbiomassthresholdunitmassunitarea &lt;&lt; endl;
<span class="lineNum">    1989 </span>            :   //cout &lt;&lt; &quot;rotatedlog10fishbiomassthresholdunitmassunitareaindex = &quot; &lt;&lt; rotatedlog10fishbiomassthresholdunitmassunitareaindex &lt;&lt; endl;
<span class="lineNum">    1990 </span>            :   // now delete rare fish species
<span class="lineNum">    1991 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    1992 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)&amp;&amp;(rotatedlog10biomassesunitmassunitarea.at(i)&lt;=rotatedlog10fishbiomassthresholdunitmassunitarea)){</span>
<span class="lineNum">    1993 </span>            :       //cout &lt;&lt; &quot;rotatedlog10biomassesunitmassunitarea.at(&quot; &lt;&lt; i &lt;&lt; &quot;) = &quot; &lt;&lt; rotatedlog10biomassesunitmassunitarea.at(i) &lt;&lt; endl;
<span class="lineNum">    1994 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    1995 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    1996 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    1997 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    1998 </span>            :     }
<span class="lineNum">    1999 </span>            :   }
<span class="lineNum">    2000 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2001 </span>            : 
<a name="2002"><span class="lineNum">    2002 </span>            : // delete last fish species making up 10% of total fish biomass when arranged in descending </a>
<span class="lineNum">    2003 </span>            : // order of biomass, but using a positive sloping cut-off rather than a horizontal cut-off
<span class="lineNum">    2004 </span><span class="lineNoCov">          0 : void NewWeb::delete_rare_fish_species_10per_2(double slope){</span>
<span class="lineNum">    2005 </span>            :   // Rotated fish biomasses are fish biomasses rotated clockwise through angle defined by slope 
<span class="lineNum">    2006 </span>            :   // We only care about the rotated biomass, not the rotated body mass,
<span class="lineNum">    2007 </span>            :   // but the rotated biomass depends on original body mass.
<span class="lineNum">    2008 </span>            :   // Since line that does cutting-off is in log10 kg and log10 kg m-2, 
<span class="lineNum">    2009 </span>            :   // need to work in these units.
<span class="lineNum">    2010 </span>            :   // Rotated fish biomasses vector also has original fish biomass attached to each value.
<span class="lineNum">    2011 </span>            :   // There is also a vector of rotated biomasses for all species, required at the end.
<span class="lineNum">    2012 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; fishbiomasses;</span>
<span class="lineNum">    2013 </span><span class="lineNoCov">          0 :   double totalfishbiomass=0;</span>
<span class="lineNum">    2014 </span><span class="lineNoCov">          0 :   double percentage = 10;</span>
<span class="lineNum">    2015 </span><span class="lineNoCov">          0 :   double fractionthreshold=(100-percentage)/100;</span>
<span class="lineNum">    2016 </span><span class="lineNoCov">          0 :   sequence&lt; pair&lt;double,double&gt; &gt; rotatedlog10fishbiomassesunitmassunitarea;</span>
<span class="lineNum">    2017 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; rotatedlog10biomassesunitmassunitarea;</span>
<span class="lineNum">    2018 </span><span class="lineNoCov">          0 :   double theta=atan(slope);</span>
<span class="lineNum">    2019 </span><span class="lineNoCov">          0 :   double massunit = 1000;</span>
<span class="lineNum">    2020 </span><span class="lineNoCov">          0 :   double areaunit = 1;</span>
<span class="lineNum">    2021 </span>            :   //cout &lt;&lt; &quot;theta = &quot; &lt;&lt; theta &lt;&lt; endl;
<span class="lineNum">    2022 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2023 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    2024 </span><span class="lineNoCov">          0 :       fishbiomasses.push_back(s(i).biomass_abundance_B());</span>
<span class="lineNum">    2025 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassesunitmassunitarea.push_back(make_pair(</span>
<span class="lineNum">    2026 </span><span class="lineNoCov">          0 :                                                                     -(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    2027 </span><span class="lineNoCov">          0 :                                                                     +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta)</span>
<span class="lineNum">    2028 </span><span class="lineNoCov">          0 :                                                                     ,s(i).biomass_abundance_B()));</span>
<span class="lineNum">    2029 </span><span class="lineNoCov">          0 :       totalfishbiomass+=s(i).biomass_abundance_B();</span>
<span class="lineNum">    2030 </span>            :     }
<span class="lineNum">    2031 </span><span class="lineNoCov">          0 :     rotatedlog10biomassesunitmassunitarea.push_back(</span>
<span class="lineNum">    2032 </span><span class="lineNoCov">          0 :                                                     -(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    2033 </span><span class="lineNoCov">          0 :                                                     +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta)</span>
<span class="lineNum">    2034 </span><span class="lineNoCov">          0 :                                                     );</span>
<span class="lineNum">    2035 </span>            :   }
<span class="lineNum">    2036 </span>            :   // Re-populate vector rotatedlog10biomassesunitmassunitarea to get elements in right order - this time, at(i) works because
<span class="lineNum">    2037 </span>            :   // there are existing elements
<span class="lineNum">    2038 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2039 </span><span class="lineNoCov">          0 :     rotatedlog10biomassesunitmassunitarea.at(i)=-(log10((s(i).bodymass())/massunit))*sin(theta)</span>
<span class="lineNum">    2040 </span><span class="lineNoCov">          0 :       +(log10(((s(i).biomass_abundance_B())/massunit)/areaunit))*cos(theta);</span>
<span class="lineNum">    2041 </span>            :   }
<span class="lineNum">    2042 </span>            :   // For rotated fish biomasses vector,
<span class="lineNum">    2043 </span>            :   // sort in descending order (because we are working backwards in i)
<span class="lineNum">    2044 </span>            :   // then work out cut-off point above which there is (100-percentage)% of fish biomass
<span class="lineNum">    2045 </span>            :   // this is done in a loop where we go from fish species with highest biomass
<span class="lineNum">    2046 </span>            :   // down to cut-off point (as opposed to other way round), so always get
<span class="lineNum">    2047 </span>            :   // at least (100-percentage)% of total fish biomass
<span class="lineNum">    2048 </span><span class="lineNoCov">          0 :   double totalfishbiomassthreshold=fractionthreshold*totalfishbiomass;</span>
<span class="lineNum">    2049 </span><span class="lineNoCov">          0 :   double rotatedlog10fishbiomassthresholdunitmassunitarea=0;</span>
<span class="lineNum">    2050 </span><span class="lineNoCov">          0 :   int rotatedlog10fishbiomassthresholdunitmassunitareaindex=0;</span>
<span class="lineNum">    2051 </span>            :   //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;
<span class="lineNum">    2052 </span>            :   //cout &lt;&lt; &quot;totalfishbiomassthreshold = &quot; &lt;&lt; totalfishbiomassthreshold &lt;&lt; endl;
<span class="lineNum">    2053 </span><span class="lineNoCov">          0 :   sort(rotatedlog10fishbiomassesunitmassunitarea.begin(),rotatedlog10fishbiomassesunitmassunitarea.end());</span>
<span class="lineNum">    2054 </span><span class="lineNoCov">          0 :   totalfishbiomass=0;</span>
<span class="lineNum">    2055 </span><span class="lineNoCov">          0 :   for(int i=rotatedlog10fishbiomassesunitmassunitarea.size();i--&gt;0;){</span>
<span class="lineNum">    2056 </span>            :     //cout &lt;&lt; &quot;rotatedlog10fishbiomassesunitmassunitarea.at(&quot; &lt;&lt; i &lt;&lt; &quot;) = &quot; &lt;&lt; rotatedlog10fishbiomassesunitmassunitarea.at(i).first &lt;&lt; endl;   
<span class="lineNum">    2057 </span><span class="lineNoCov">          0 :     if((totalfishbiomass&gt;totalfishbiomassthreshold)&amp;&amp;(rotatedlog10fishbiomassthresholdunitmassunitareaindex==0)){</span>
<span class="lineNum">    2058 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassthresholdunitmassunitarea=rotatedlog10fishbiomassesunitmassunitarea.at(i).first;</span>
<span class="lineNum">    2059 </span><span class="lineNoCov">          0 :       rotatedlog10fishbiomassthresholdunitmassunitareaindex=1;</span>
<span class="lineNum">    2060 </span>            :     }
<span class="lineNum">    2061 </span><span class="lineNoCov">          0 :     totalfishbiomass+=rotatedlog10fishbiomassesunitmassunitarea.at(i).second;</span>
<span class="lineNum">    2062 </span>            :     //cout &lt;&lt; &quot;totalfishbiomass = &quot; &lt;&lt; totalfishbiomass &lt;&lt; endl;   
<span class="lineNum">    2063 </span>            :   }
<span class="lineNum">    2064 </span>            :   //cout &lt;&lt; &quot;rotatedlog10fishbiomassthresholdunitmassunitarea = &quot; &lt;&lt; rotatedlog10fishbiomassthresholdunitmassunitarea &lt;&lt; endl;
<span class="lineNum">    2065 </span>            :   //cout &lt;&lt; &quot;rotatedlog10fishbiomassthresholdunitmassunitareaindex = &quot; &lt;&lt; rotatedlog10fishbiomassthresholdunitmassunitareaindex &lt;&lt; endl;
<span class="lineNum">    2066 </span>            :   // now delete rare fish species
<span class="lineNum">    2067 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2068 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)&amp;&amp;(rotatedlog10biomassesunitmassunitarea.at(i)&lt;=rotatedlog10fishbiomassthresholdunitmassunitarea)){</span>
<span class="lineNum">    2069 </span>            :       //cout &lt;&lt; &quot;rotatedlog10biomassesunitmassunitarea.at(&quot; &lt;&lt; i &lt;&lt; &quot;) = &quot; &lt;&lt; rotatedlog10biomassesunitmassunitarea.at(i) &lt;&lt; endl;
<span class="lineNum">    2070 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2071 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2072 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    2073 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2074 </span>            :     }
<span class="lineNum">    2075 </span>            :   }
<a name="2076"><span class="lineNum">    2076 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2077 </span>            : 
<span class="lineNum">    2078 </span><span class="lineNoCov">          0 : void NewWeb::delete_all_species_with_biomass_less_than(double m){</span>
<span class="lineNum">    2079 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2080 </span><span class="lineNoCov">          0 :     if(!isnormal(s(i).biomass_abundance_B()) || s(i).biomass_abundance_B() &lt; m ){</span>
<span class="lineNum">    2081 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2082 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2083 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i]</span>
<span class="lineNum">    2084 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; with body mass &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;</span>
<span class="lineNum">    2085 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2086 </span>            :     }
<span class="lineNum">    2087 </span>            :   }
<span class="lineNum">    2088 </span><span class="lineNoCov">          0 : }</span>
<a name="2089"><span class="lineNum">    2089 </span>            : </a>
<span class="lineNum">    2090 </span>            : // delete all fish species except the one with assigned column number x
<span class="lineNum">    2091 </span><span class="lineNoCov">          0 : void NewWeb::delete_fish_species_except_1(double x){</span>
<span class="lineNum">    2092 </span>            :   //cout &lt;&lt; &quot;x = &quot; &lt;&lt; x &lt;&lt; endl;
<span class="lineNum">    2093 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2094 </span>            :     //cout &lt;&lt; &quot;i = &quot; &lt;&lt; i &lt;&lt; endl;
<span class="lineNum">    2095 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)&amp;&amp;(assigned_column[i]!=x)){</span>
<span class="lineNum">    2096 </span>            :       //cout &lt;&lt; &quot;deleted species s[i].bodymass() = &quot; &lt;&lt; s[i].bodymass() &lt;&lt; endl;
<span class="lineNum">    2097 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2098 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2099 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    2100 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2101 </span>            :     }
<span class="lineNum">    2102 </span>            :   }
<a name="2103"><span class="lineNum">    2103 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2104 </span>            : 
<span class="lineNum">    2105 </span><span class="lineNoCov">          0 : void NewWeb::</span>
<span class="lineNum">    2106 </span>            : delete_all_plants_with_negative_growth_rates(species_set_t&amp; inserted){
<span class="lineNum">    2107 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2108 </span><span class="lineNoCov">          0 :     if(s(i).plant_growth_rate_sigma()&lt;0){</span>
<span class="lineNum">    2109 </span><span class="lineNoCov">          0 :       inserted.erase(assigned_column[i]);</span>
<span class="lineNum">    2110 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2111 </span><span class="lineNoCov">          0 :       species_set_t corrected;</span>
<span class="lineNum">    2112 </span>            :     }
<span class="lineNum">    2113 </span>            :   }
<span class="lineNum">    2114 </span><span class="lineNoCov">          0 : }</span>
<a name="2115"><span class="lineNum">    2115 </span>            : </a>
<span class="lineNum">    2116 </span>            : NewWeb::species_set_t
<span class="lineNum">    2117 </span><span class="lineCov">         47 : NewWeb::delete_species_larger_than_exp(const sequence&lt;double&gt; &amp; si,</span>
<span class="lineNum">    2118 </span>            :                                        const species_set_t&amp;  conserved){
<span class="lineNum">    2119 </span><span class="lineCov">         47 :   species_set_t deleted;</span>
<span class="lineNum">    2120 </span><span class="lineCov">         94 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2121 </span>            :     // must be downwards loop to work!!
<span class="lineNum">    2122 </span><span class="lineCov">      36756 :     if(!isnormal(s(i).biomass_abundance_B()) || </span>
<span class="lineNum">    2123 </span><span class="lineCov">      36756 :        si(i)&lt;(log(s[i].get_threshold_biomass_B()/</span>
<span class="lineNum">    2124 </span><span class="lineCov">      18378 :                   (conserved.count(assigned_column[i])?conservation_tolerance:1) </span>
<span class="lineNum">    2125 </span>            :                   ))){
<span class="lineNum">    2126 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; s(i).taxon_name() &lt;&lt; &quot; &quot;</span>
<span class="lineNum">    2127 </span><span class="lineNoCov">          0 :                 &lt;&lt; assigned_column(i) &lt;&lt; &quot; went extinct (2)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    2128 </span><span class="lineNoCov">          0 :       deleted.insert(assigned_column[i]);</span>
<span class="lineNum">    2129 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2130 </span>            :     }
<span class="lineNum">    2131 </span>            :   }
<span class="lineNum">    2132 </span><span class="lineCov">         47 :   return deleted;</span>
<span class="lineNum">    2133 </span>            : }
<a name="2134"><span class="lineNum">    2134 </span>            :   </a>
<span class="lineNum">    2135 </span>            : 
<span class="lineNum">    2136 </span><span class="lineCov">        161 : relaxing_dynamical_object::species_set_t NewWeb::</span>
<span class="lineNum">    2137 </span>            : delete_all_species_with_less_than_one_individual(const species_set_t
<span class="lineNum">    2138 </span>            :                                                  &amp; conserved){
<span class="lineNum">    2139 </span><span class="lineCov">        161 :   const double tolerance = 1e-5;</span>
<span class="lineNum">    2140 </span><span class="lineCov">        161 :   bool OK=true;</span>
<span class="lineNum">    2141 </span>            : 
<span class="lineNum">    2142 </span>            :   // not OK, do cleanup
<span class="lineNum">    2143 </span><span class="lineCov">        161 :   species_set_t deleted;</span>
<span class="lineNum">    2144 </span><span class="lineCov">        322 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2145 </span><span class="lineCov">     126160 :     if(!isnormal(s(i).biomass_abundance_B()) </span>
<span class="lineNum">    2146 </span><span class="lineCov">      63080 :        || </span>
<span class="lineNum">    2147 </span><span class="lineCov">      94620 :        (1+tolerance)*s(i).biomass_abundance_B()*</span>
<span class="lineNum">    2148 </span><span class="lineCov">      63080 :        (conserved.count(assigned_column[i])?conservation_tolerance:1) &lt; </span>
<span class="lineNum">    2149 </span><span class="lineCov">      63080 :        s(i).get_threshold_biomass_B() ){</span>
<span class="lineNum">    2150 </span><span class="lineCov">        360 :       std::cout &lt;&lt; s(i).taxon_name() &lt;&lt; &quot; &quot;</span>
<span class="lineNum">    2151 </span><span class="lineCov">        450 :            &lt;&lt; assigned_column(i) &lt;&lt; &quot; went extinct (1)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    2152 </span><span class="lineCov">        180 :       deleted.insert(assigned_column[i]);</span>
<span class="lineNum">    2153 </span><span class="lineCov">         90 :       delete_species(i);</span>
<span class="lineNum">    2154 </span>            :     }
<span class="lineNum">    2155 </span>            :   }
<span class="lineNum">    2156 </span><span class="lineCov">        161 :   return deleted;</span>
<a name="2157"><span class="lineNum">    2157 </span>            : }</a>
<span class="lineNum">    2158 </span>            : 
<span class="lineNum">    2159 </span><span class="lineNoCov">          0 : void NewWeb::delete_all_animals(){</span>
<span class="lineNum">    2160 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2161 </span>            :     // must be downwards loop to work!!
<span class="lineNum">    2162 </span><span class="lineNoCov">          0 :     if(!is_plant(i)){</span>
<span class="lineNum">    2163 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2164 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2165 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    2166 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2167 </span>            :     }
<span class="lineNum">    2168 </span>            :   }
<a name="2169"><span class="lineNum">    2169 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2170 </span>            : 
<span class="lineNum">    2171 </span><span class="lineNoCov">          0 : void NewWeb::delete_all_species_with_level_higher_than(double h){</span>
<span class="lineNum">    2172 </span>            : 
<span class="lineNum">    2173 </span>            :   // compute the trophic level vector:
<span class="lineNum">    2174 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    2175 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    2176 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    2177 </span><span class="lineNoCov">          0 :   NewMatrix F=ifrac;</span>
<span class="lineNum">    2178 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    2179 </span>            :   int err;
<span class="lineNum">    2180 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;)</span>
<span class="lineNum">    2181 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    2182 </span><span class="lineNoCov">          0 :   NewMatrix D=NewIdentityMatrix(S,S)-F;</span>
<span class="lineNum">    2183 </span><span class="lineNoCov">          0 :   NewVector level=solve(D,ones);</span>
<span class="lineNum">    2184 </span><span class="lineNoCov">          0 :   if(err) FATAL_ERROR(&quot;could not compute trophic levels&quot;);</span>
<span class="lineNum">    2185 </span>            : 
<span class="lineNum">    2186 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2187 </span>            :     // must be downwards loop to work!!
<span class="lineNum">    2188 </span><span class="lineNoCov">          0 :     if(level[i]&gt;h){</span>
<span class="lineNum">    2189 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2190 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2191 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    2192 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2193 </span>            :     }
<span class="lineNum">    2194 </span>            :   }
<a name="2195"><span class="lineNum">    2195 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2196 </span>            : 
<span class="lineNum">    2197 </span><span class="lineNoCov">          0 : void NewWeb::scale_primary_productivity(double x){</span>
<span class="lineNum">    2198 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2199 </span><span class="lineNoCov">          0 :     s[i].set_plant_growth_rate_sigma(x*s[i].plant_growth_rate_sigma());</span>
<span class="lineNum">    2200 </span>            :   }
<span class="lineNum">    2201 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    2202 </span>            : 
<a name="2203"><span class="lineNum">    2203 </span>            : </a>
<span class="lineNum">    2204 </span>            : // See if there are plants larger than the largest animals::
<span class="lineNum">    2205 </span><span class="lineNoCov">          0 : bool NewWeb::</span>
<span class="lineNum">    2206 </span>            : large_plants(){
<span class="lineNum">    2207 </span><span class="lineNoCov">          0 :   if(number_of_animals()==0) return false;</span>
<span class="lineNum">    2208 </span>            : 
<span class="lineNum">    2209 </span><span class="lineNoCov">          0 :   double max_animal_body_mass=0;</span>
<span class="lineNum">    2210 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2211 </span>            :     max_animal_body_mass=
<span class="lineNum">    2212 </span><span class="lineNoCov">          0 :       max(s[i].bodymass(),max_animal_body_mass);</span>
<span class="lineNum">    2213 </span>            :   }
<span class="lineNum">    2214 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2215 </span><span class="lineNoCov">          0 :     if(s[i].bodymass()&gt;max_animal_body_mass)</span>
<span class="lineNum">    2216 </span>            :       return true;
<span class="lineNum">    2217 </span>            :   }
<span class="lineNum">    2218 </span>            :   return false;
<span class="lineNum">    2219 </span>            : }
<a name="2220"><span class="lineNum">    2220 </span>            : </a>
<span class="lineNum">    2221 </span>            : // quick and dirty implementation!!
<span class="lineNum">    2222 </span><span class="lineNoCov">          0 : void NewWeb::fish(double n){</span>
<span class="lineNum">    2223 </span>            :   // increase mortality of an abundand large fish species by n
<span class="lineNum">    2224 </span><span class="lineNoCov">          0 :   double max_fishing_value=0;</span>
<span class="lineNum">    2225 </span><span class="lineNoCov">          0 :   int max_species=0;</span>
<span class="lineNum">    2226 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2227 </span><span class="lineNoCov">          0 :     double fishing_value=s[i].biomass_abundance_B()*</span>
<span class="lineNum">    2228 </span><span class="lineNoCov">          0 :       s[i].bodymass();</span>
<span class="lineNum">    2229 </span><span class="lineNoCov">          0 :     if(fishing_value&gt;max_fishing_value){</span>
<span class="lineNum">    2230 </span><span class="lineNoCov">          0 :       max_fishing_value=fishing_value;</span>
<span class="lineNum">    2231 </span><span class="lineNoCov">          0 :       max_species=i;</span>
<span class="lineNum">    2232 </span>            :     }
<span class="lineNum">    2233 </span>            :   }
<span class="lineNum">    2234 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;fishing target is &quot; &lt;&lt; assigned_column[max_species] </span>
<span class="lineNum">    2235 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; (internal &quot; &lt;&lt; max_species &lt;&lt; &quot;)&quot;</span>
<span class="lineNum">    2236 </span><span class="lineNoCov">          0 :        &lt;&lt; endl;</span>
<span class="lineNum">    2237 </span>            :   //double m=s[max_species].turnover_rate_r()*(n);
<span class="lineNum">    2238 </span><span class="lineNoCov">          0 :   s[max_species].set_fishing_mortality(n);</span>
<a name="2239"><span class="lineNum">    2239 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2240 </span>            : 
<span class="lineNum">    2241 </span><span class="lineNoCov">          0 : void NewWeb::forbid_fishing(){</span>
<span class="lineNum">    2242 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2243 </span><span class="lineNoCov">          0 :     s(i).set_fishing_mortality(0);</span>
<span class="lineNum">    2244 </span>            :   }
<a name="2245"><span class="lineNum">    2245 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2246 </span>            : 
<span class="lineNum">    2247 </span><span class="lineNoCov">          0 : void NewWeb::copy_fishing_mortalities_from(const NewWeb &amp; other){</span>
<span class="lineNum">    2248 </span><span class="lineNoCov">          0 :   for(int i=other.s.size();i--&gt;0;){</span>
<span class="lineNum">    2249 </span><span class="lineNoCov">          0 :     const int c=other.assigned_column[i];</span>
<span class="lineNum">    2250 </span><span class="lineNoCov">          0 :     if(c &gt;= species_at.size() ||</span>
<span class="lineNum">    2251 </span><span class="lineNoCov">          0 :        species_at[c]==column_unused ){</span>
<span class="lineNum">    2252 </span><span class="lineNoCov">          0 :       WARNING(&quot;no correspondence for fished species &quot; &lt;&lt; c);</span>
<span class="lineNum">    2253 </span>            :     }else{
<span class="lineNum">    2254 </span><span class="lineNoCov">          0 :       s(species_at[c]).set_fishing_mortality(other.s(i).fishing_mortality());</span>
<span class="lineNum">    2255 </span>            :     }
<span class="lineNum">    2256 </span>            :   }
<span class="lineNum">    2257 </span><span class="lineNoCov">          0 : }</span>
<a name="2258"><span class="lineNum">    2258 </span>            : </a>
<span class="lineNum">    2259 </span>            : 
<span class="lineNum">    2260 </span><span class="lineNoCov">          0 : void NewWeb::fishF(double F){</span>
<span class="lineNum">    2261 </span>            :   // Fish all animals &gt; 1g with F
<span class="lineNum">    2262 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2263 </span><span class="lineNoCov">          0 :     if(s[i].bodymass() &gt;= eval_here(&quot;1*gram&quot;)){</span>
<span class="lineNum">    2264 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(F);</span>
<span class="lineNum">    2265 </span>            :     }
<span class="lineNum">    2266 </span>            :   } 
<a name="2267"><span class="lineNum">    2267 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2268 </span>            : 
<span class="lineNum">    2269 </span><span class="lineNoCov">          0 : void NewWeb::fishall(double n){</span>
<span class="lineNum">    2270 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2271 </span><span class="lineNoCov">          0 :   double fishing_value_intercept=0;</span>
<span class="lineNum">    2272 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2273 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2274 </span><span class="lineNoCov">          0 :     if(s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)){</span>
<span class="lineNum">    2275 </span><span class="lineNoCov">          0 :       fishing_value_intercept=fishall_intercept+gaussian(0,fishall_residual_se);</span>
<span class="lineNum">    2276 </span><span class="lineNoCov">          0 :       fishing_value=pow(10,fishing_value_intercept)*pow((s[i].bodymass())/eval_here(&quot;kilogram&quot;),fishall_slope);</span>
<span class="lineNum">    2277 </span>            :       //cout &lt;&lt; &quot;fishing_value is &quot; &lt;&lt; fishing_value &lt;&lt; endl;
<span class="lineNum">    2278 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2279 </span>            :      }
<span class="lineNum">    2280 </span>            :   } 
<a name="2281"><span class="lineNum">    2281 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2282 </span>            : 
<span class="lineNum">    2283 </span><span class="lineNoCov">          0 : void NewWeb::fishMrange(double n){</span>
<span class="lineNum">    2284 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2285 </span>            :   // and &lt;10^fishMrangemax kg
<span class="lineNum">    2286 </span><span class="lineNoCov">          0 :   double fishing_value_intercept=0;</span>
<span class="lineNum">    2287 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2288 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2289 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2290 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2291 </span><span class="lineNoCov">          0 :       fishing_value_intercept=fishall_intercept+gaussian(0,fishall_residual_se);</span>
<span class="lineNum">    2292 </span><span class="lineNoCov">          0 :       fishing_value=pow(10,fishing_value_intercept)*pow((s[i].bodymass())/eval_here(&quot;kilogram&quot;),fishall_slope);</span>
<span class="lineNum">    2293 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2294 </span>            :      }
<span class="lineNum">    2295 </span>            :   } 
<a name="2296"><span class="lineNum">    2296 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2297 </span>            : 
<span class="lineNum">    2298 </span><span class="lineNoCov">          0 : void NewWeb::custom_perturbation(double x){</span>
<span class="lineNum">    2299 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2300 </span><span class="lineNoCov">          0 :   double fishing_value_intercept=0;</span>
<span class="lineNum">    2301 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2302 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2303 </span><span class="lineNoCov">          0 :     if(s[i].bodymass() &gt; eval_here(&quot;10*gram&quot;)){</span>
<span class="lineNum">    2304 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(eval_here(&quot;0.5/year&quot;));</span>
<span class="lineNum">    2305 </span>            :      }
<span class="lineNum">    2306 </span>            :   } 
<span class="lineNum">    2307 </span><span class="lineNoCov">          0 : }</span>
<a name="2308"><span class="lineNum">    2308 </span>            : </a>
<span class="lineNum">    2309 </span>            : 
<span class="lineNum">    2310 </span><span class="lineNoCov">          0 : void NewWeb::fishTLrange(double n){</span>
<span class="lineNum">    2311 </span>            :   // increase mortality of all fish species with TL &gt;n and &lt; fishTLrangemax
<span class="lineNum">    2312 </span><span class="lineNoCov">          0 :   double fishing_value_intercept=0;</span>
<span class="lineNum">    2313 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2314 </span>            :   // compute the trophic level vector:
<span class="lineNum">    2315 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    2316 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    2317 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    2318 </span><span class="lineNoCov">          0 :   NewMatrix F=ifrac;</span>
<span class="lineNum">    2319 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    2320 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;)</span>
<span class="lineNum">    2321 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    2322 </span><span class="lineNoCov">          0 :   NewMatrix D=NewIdentityMatrix(S,S)-F;</span>
<span class="lineNum">    2323 </span><span class="lineNoCov">          0 :   NewVector level=solve(D,ones);</span>
<span class="lineNum">    2324 </span>            :   // apply fishing
<span class="lineNum">    2325 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2326 </span><span class="lineNoCov">          0 :     if((level[i]&gt;n)&amp;&amp;(level[i]&lt;fishTLrangemax)){</span>
<span class="lineNum">    2327 </span><span class="lineNoCov">          0 :       fishing_value_intercept=fishall_intercept+gaussian(0,fishall_residual_se);</span>
<span class="lineNum">    2328 </span><span class="lineNoCov">          0 :       fishing_value=pow(10,fishing_value_intercept)*pow((s[i].bodymass())/eval_here(&quot;kilogram&quot;),fishall_slope);</span>
<span class="lineNum">    2329 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2330 </span>            :      }
<span class="lineNum">    2331 </span>            :   } 
<a name="2332"><span class="lineNum">    2332 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2333 </span>            : 
<span class="lineNum">    2334 </span><span class="lineNoCov">          0 : void NewWeb::fishMrangeconst(double n){</span>
<span class="lineNum">    2335 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2336 </span>            :   // and &lt;fishMrangemax kg
<span class="lineNum">    2337 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2338 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2339 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2340 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2341 </span><span class="lineNoCov">          0 :       fishing_value=const_fishing_mortality_rate;</span>
<span class="lineNum">    2342 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2343 </span>            :      }
<span class="lineNum">    2344 </span>            :   } 
<span class="lineNum">    2345 </span><span class="lineNoCov">          0 : }</span>
<a name="2346"><span class="lineNum">    2346 </span>            : </a>
<span class="lineNum">    2347 </span>            : // fishMrangeconst2 same as fishMrangeconst except that F can be chosen
<span class="lineNum">    2348 </span><span class="lineNoCov">          0 : void NewWeb::fishMrangeconst2(double n, double p){</span>
<span class="lineNum">    2349 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2350 </span>            :   // and &lt;fishMrangemax kg
<span class="lineNum">    2351 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2352 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2353 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2354 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2355 </span><span class="lineNoCov">          0 :       fishing_value=p;</span>
<span class="lineNum">    2356 </span>            :       //cout &lt;&lt; &quot;fishing_value = &quot; &lt;&lt; p &lt;&lt; endl;
<span class="lineNum">    2357 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2358 </span>            :      }
<span class="lineNum">    2359 </span>            :   } 
<a name="2360"><span class="lineNum">    2360 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2361 </span>            : 
<span class="lineNum">    2362 </span><span class="lineNoCov">          0 : void NewWeb::fishTLrangeconst(double n){</span>
<span class="lineNum">    2363 </span>            :   // increase mortality of all fish species with TL &gt;n and &lt; fishTLrangemax
<span class="lineNum">    2364 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2365 </span>            :   // compute the trophic level vector:
<span class="lineNum">    2366 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    2367 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    2368 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    2369 </span><span class="lineNoCov">          0 :   NewMatrix F=ifrac;</span>
<span class="lineNum">    2370 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    2371 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;)</span>
<span class="lineNum">    2372 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    2373 </span><span class="lineNoCov">          0 :   NewMatrix D=NewIdentityMatrix(S,S)-F;</span>
<span class="lineNum">    2374 </span><span class="lineNoCov">          0 :   NewVector level=solve(D,ones);</span>
<span class="lineNum">    2375 </span>            :   // apply fishing
<span class="lineNum">    2376 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2377 </span><span class="lineNoCov">          0 :     if((level[i]&gt;n)&amp;&amp;(level[i]&lt;fishTLrangemax)){</span>
<span class="lineNum">    2378 </span><span class="lineNoCov">          0 :       fishing_value=const_fishing_mortality_rate;</span>
<span class="lineNum">    2379 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2380 </span>            :      }
<span class="lineNum">    2381 </span>            :   } 
<a name="2382"><span class="lineNum">    2382 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2383 </span>            : 
<span class="lineNum">    2384 </span><span class="lineNoCov">          0 : void NewWeb::fishMrangeline(double n){</span>
<span class="lineNum">    2385 </span>            :   // increase mortality of all fish species with bodymass &gt;n kg
<span class="lineNum">    2386 </span>            :   // and &lt;fishMrangemax kg
<span class="lineNum">    2387 </span>            :   // An upper limit Fmax is set to the fishing mortality
<span class="lineNum">    2388 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2389 </span><span class="lineNoCov">          0 :   double fishing_value2=0;</span>
<span class="lineNum">    2390 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2391 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2392 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2393 </span><span class="lineNoCov">          0 :       fishing_value=pow(10,fishall_intercept)*pow((s[i].bodymass())/eval_here(&quot;kilogram&quot;),fishall_slope);</span>
<span class="lineNum">    2394 </span><span class="lineNoCov">          0 :       fishing_value2=min(fishing_value,Fmax);</span>
<span class="lineNum">    2395 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value2);</span>
<span class="lineNum">    2396 </span>            :      }
<span class="lineNum">    2397 </span>            :   } 
<a name="2398"><span class="lineNum">    2398 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2399 </span>            : 
<span class="lineNum">    2400 </span><span class="lineNoCov">          0 : void NewWeb::fishTLrangeline(double n){</span>
<span class="lineNum">    2401 </span>            :   // increase mortality of all fish species with TL &gt;n and &lt; fishTLrangemax
<span class="lineNum">    2402 </span>            :   // An upper limit Fmax is set to the fishing mortality
<span class="lineNum">    2403 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2404 </span><span class="lineNoCov">          0 :   double fishing_value2=0;</span>
<span class="lineNum">    2405 </span>            :   // compute the trophic level vector:
<span class="lineNum">    2406 </span><span class="lineNoCov">          0 :   link_strength_matrix intake=intake_matrix();</span>
<span class="lineNum">    2407 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    2408 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    2409 </span><span class="lineNoCov">          0 :   NewMatrix F=ifrac;</span>
<span class="lineNum">    2410 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    2411 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;)</span>
<span class="lineNum">    2412 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    2413 </span><span class="lineNoCov">          0 :   NewMatrix D=NewIdentityMatrix(S,S)-F;</span>
<span class="lineNum">    2414 </span><span class="lineNoCov">          0 :   NewVector level=solve(D,ones);</span>
<span class="lineNum">    2415 </span>            :   // apply fishing
<span class="lineNum">    2416 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2417 </span><span class="lineNoCov">          0 :     if((level[i]&gt;n)&amp;&amp;(level[i]&lt;fishTLrangemax)){</span>
<span class="lineNum">    2418 </span><span class="lineNoCov">          0 :       fishing_value=pow(10,fishall_intercept)*pow((s[i].bodymass())/eval_here(&quot;kilogram&quot;),fishall_slope);</span>
<span class="lineNum">    2419 </span><span class="lineNoCov">          0 :       fishing_value2=min(fishing_value,Fmax);</span>
<span class="lineNum">    2420 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value2);</span>
<span class="lineNum">    2421 </span>            :      }
<span class="lineNum">    2422 </span>            :   } 
<span class="lineNum">    2423 </span><span class="lineNoCov">          0 : }</span>
<a name="2424"><span class="lineNum">    2424 </span>            : </a>
<span class="lineNum">    2425 </span>            : 
<span class="lineNum">    2426 </span><span class="lineNoCov">          0 : void NewWeb::fishMrangeCS(double n){</span>
<span class="lineNum">    2427 </span>            :   // species1Mdiff is the list of body mass differences between species 1 and all other fish species.
<span class="lineNum">    2428 </span>            :   // species1Mdiffsorted is species1Mdiff sorted in ascending order.
<span class="lineNum">    2429 </span>            :   // species1M is the body mass of species 1.
<span class="lineNum">    2430 </span>            :   // species1F is F for species 1.
<span class="lineNum">    2431 </span>            :   // indices is the list of indices for the fish species. 
<span class="lineNum">    2432 </span>            :   // newindices1 is the list of indices for species 1 once they have been sorted.
<span class="lineNum">    2433 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species1Mdiff;</span>
<span class="lineNum">    2434 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species2Mdiff;</span>
<span class="lineNum">    2435 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species3Mdiff;</span>
<span class="lineNum">    2436 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species4Mdiff;</span>
<span class="lineNum">    2437 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species5Mdiff;</span>
<span class="lineNum">    2438 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species6Mdiff;</span>
<span class="lineNum">    2439 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species1Mdiffsorted;</span>
<span class="lineNum">    2440 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species2Mdiffsorted;</span>
<span class="lineNum">    2441 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species3Mdiffsorted;</span>
<span class="lineNum">    2442 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species4Mdiffsorted;</span>
<span class="lineNum">    2443 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species5Mdiffsorted;</span>
<span class="lineNum">    2444 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; species6Mdiffsorted;</span>
<span class="lineNum">    2445 </span><span class="lineNoCov">          0 :   double species1M = 0.0691*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2446 </span><span class="lineNoCov">          0 :   double species2M = 0.144*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2447 </span><span class="lineNoCov">          0 :   double species3M = 0.535*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2448 </span><span class="lineNoCov">          0 :   double species4M = 0.626*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2449 </span><span class="lineNoCov">          0 :   double species5M = 1.01*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2450 </span><span class="lineNoCov">          0 :   double species6M = 2.10*eval_here(&quot;kilogram&quot;);</span>
<span class="lineNum">    2451 </span><span class="lineNoCov">          0 :   double species1F = fishMrangeCSFfactor*0.437*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2452 </span><span class="lineNoCov">          0 :   double species2F = fishMrangeCSFfactor*0.277*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2453 </span><span class="lineNoCov">          0 :   double species3F = fishMrangeCSFfactor*0.566*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2454 </span><span class="lineNoCov">          0 :   double species4F = fishMrangeCSFfactor*0.255*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2455 </span><span class="lineNoCov">          0 :   double species5F = fishMrangeCSFfactor*0.714*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2456 </span><span class="lineNoCov">          0 :   double species6F = fishMrangeCSFfactor*0.234*eval_here(&quot;1/year&quot;);</span>
<span class="lineNum">    2457 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; indices;</span>
<span class="lineNum">    2458 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices1;</span>
<span class="lineNum">    2459 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices2;</span>
<span class="lineNum">    2460 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices3;</span>
<span class="lineNum">    2461 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices4;</span>
<span class="lineNum">    2462 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices5;</span>
<span class="lineNum">    2463 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; newindices6;</span>
<span class="lineNum">    2464 </span><span class="lineNoCov">          0 :   int count1 = 0;</span>
<span class="lineNum">    2465 </span>            : 
<span class="lineNum">    2466 </span>            :   // For each model fish species, compute differences between body mass and body masses of 6 species
<span class="lineNum">    2467 </span>            :   // Note that the body mass of each species is in g. *eval_here(&quot;kilogram&quot;) above 
<span class="lineNum">    2468 </span>            :   // converts all the body masses into g automatically by multiplying by 1000. 
<span class="lineNum">    2469 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2470 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2471 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2472 </span><span class="lineNoCov">          0 :       species1Mdiff[count1]=fabs(s[i].bodymass()-species1M);</span>
<span class="lineNum">    2473 </span><span class="lineNoCov">          0 :       species2Mdiff[count1]=fabs(s[i].bodymass()-species2M);</span>
<span class="lineNum">    2474 </span><span class="lineNoCov">          0 :       species3Mdiff[count1]=fabs(s[i].bodymass()-species3M);</span>
<span class="lineNum">    2475 </span><span class="lineNoCov">          0 :       species4Mdiff[count1]=fabs(s[i].bodymass()-species4M);</span>
<span class="lineNum">    2476 </span><span class="lineNoCov">          0 :       species5Mdiff[count1]=fabs(s[i].bodymass()-species5M);</span>
<span class="lineNum">    2477 </span><span class="lineNoCov">          0 :       species6Mdiff[count1]=fabs(s[i].bodymass()-species6M);</span>
<span class="lineNum">    2478 </span><span class="lineNoCov">          0 :       species1Mdiffsorted[count1]=fabs(s[i].bodymass()-species1M);</span>
<span class="lineNum">    2479 </span><span class="lineNoCov">          0 :       species2Mdiffsorted[count1]=fabs(s[i].bodymass()-species2M);</span>
<span class="lineNum">    2480 </span><span class="lineNoCov">          0 :       species3Mdiffsorted[count1]=fabs(s[i].bodymass()-species3M);</span>
<span class="lineNum">    2481 </span><span class="lineNoCov">          0 :       species4Mdiffsorted[count1]=fabs(s[i].bodymass()-species4M);</span>
<span class="lineNum">    2482 </span><span class="lineNoCov">          0 :       species5Mdiffsorted[count1]=fabs(s[i].bodymass()-species5M);</span>
<span class="lineNum">    2483 </span><span class="lineNoCov">          0 :       species6Mdiffsorted[count1]=fabs(s[i].bodymass()-species6M);</span>
<span class="lineNum">    2484 </span><span class="lineNoCov">          0 :       indices[count1]=i;</span>
<span class="lineNum">    2485 </span><span class="lineNoCov">          0 :       count1++;      </span>
<span class="lineNum">    2486 </span>            :      }
<span class="lineNum">    2487 </span>            :   } 
<span class="lineNum">    2488 </span>            : 
<span class="lineNum">    2489 </span>            :   // Now sort each vector of body mass differences (ascending order). 
<span class="lineNum">    2490 </span><span class="lineNoCov">          0 :   sort(species1Mdiffsorted.begin(),species1Mdiffsorted.end());</span>
<span class="lineNum">    2491 </span><span class="lineNoCov">          0 :   sort(species2Mdiffsorted.begin(),species2Mdiffsorted.end());</span>
<span class="lineNum">    2492 </span><span class="lineNoCov">          0 :   sort(species3Mdiffsorted.begin(),species3Mdiffsorted.end());</span>
<span class="lineNum">    2493 </span><span class="lineNoCov">          0 :   sort(species4Mdiffsorted.begin(),species4Mdiffsorted.end());</span>
<span class="lineNum">    2494 </span><span class="lineNoCov">          0 :   sort(species5Mdiffsorted.begin(),species5Mdiffsorted.end());</span>
<span class="lineNum">    2495 </span><span class="lineNoCov">          0 :   sort(species6Mdiffsorted.begin(),species6Mdiffsorted.end());</span>
<span class="lineNum">    2496 </span>            : 
<span class="lineNum">    2497 </span>            :   // assign new indices by comparing sorted 
<span class="lineNum">    2498 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;count1;i++){</span>
<span class="lineNum">    2499 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;count1;j++){</span>
<span class="lineNum">    2500 </span><span class="lineNoCov">          0 :       if(species1Mdiff[i]==species1Mdiffsorted[j]) {</span>
<span class="lineNum">    2501 </span><span class="lineNoCov">          0 :         newindices1[j]=indices[i];</span>
<span class="lineNum">    2502 </span>            :       }
<span class="lineNum">    2503 </span><span class="lineNoCov">          0 :       if(species2Mdiff[i]==species2Mdiffsorted[j]) {</span>
<span class="lineNum">    2504 </span><span class="lineNoCov">          0 :         newindices2[j]=indices[i];</span>
<span class="lineNum">    2505 </span>            :       }
<span class="lineNum">    2506 </span><span class="lineNoCov">          0 :       if(species3Mdiff[i]==species3Mdiffsorted[j]) {</span>
<span class="lineNum">    2507 </span><span class="lineNoCov">          0 :         newindices3[j]=indices[i];</span>
<span class="lineNum">    2508 </span>            :       }
<span class="lineNum">    2509 </span><span class="lineNoCov">          0 :       if(species4Mdiff[i]==species4Mdiffsorted[j]) {</span>
<span class="lineNum">    2510 </span><span class="lineNoCov">          0 :         newindices4[j]=indices[i];</span>
<span class="lineNum">    2511 </span>            :       }
<span class="lineNum">    2512 </span><span class="lineNoCov">          0 :       if(species5Mdiff[i]==species5Mdiffsorted[j]) {</span>
<span class="lineNum">    2513 </span><span class="lineNoCov">          0 :         newindices5[j]=indices[i];</span>
<span class="lineNum">    2514 </span>            :       }
<span class="lineNum">    2515 </span><span class="lineNoCov">          0 :       if(species6Mdiff[i]==species6Mdiffsorted[j]) {</span>
<span class="lineNum">    2516 </span><span class="lineNoCov">          0 :         newindices6[j]=indices[i];</span>
<span class="lineNum">    2517 </span>            :       }
<span class="lineNum">    2518 </span>            :     }
<span class="lineNum">    2519 </span>            :   }
<span class="lineNum">    2520 </span>            : 
<span class="lineNum">    2521 </span>            :   // Now we calculate the sum of the (absolute) differences for each combination of the first 6 elements of each 
<span class="lineNum">    2522 </span>            :   // difference list (stored in sumdiff). Only combinations that contain no duplicate species are considered.
<span class="lineNum">    2523 </span>            :   // count2 is used to check if the combinations have duplicates - if it is &gt;0, then there is at least one duplicate.
<span class="lineNum">    2524 </span>            :   // combination is the vector of values for a combination. combinationindices is vector of corresponding species indices.
<span class="lineNum">    2525 </span>            :   // lowestdiff gives the body mass differences giving lowestsumdiff
<span class="lineNum">    2526 </span>            :   // bestindices is the list of indices that gives the smallest sum of differences.
<span class="lineNum">    2527 </span><span class="lineNoCov">          0 :   double sumdiff = 0.0; </span>
<span class="lineNum">    2528 </span><span class="lineNoCov">          0 :   double lowestsumdiff = 1e100;</span>
<span class="lineNum">    2529 </span><span class="lineNoCov">          0 :   int count2 = 0;</span>
<span class="lineNum">    2530 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; combination;</span>
<span class="lineNum">    2531 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; combinationindices;</span>
<span class="lineNum">    2532 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; lowestdiff;</span>
<span class="lineNum">    2533 </span><span class="lineNoCov">          0 :   sequence&lt;int&gt; bestindices;</span>
<span class="lineNum">    2534 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;6;i++){</span>
<span class="lineNum">    2535 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;6;j++){</span>
<span class="lineNum">    2536 </span><span class="lineNoCov">          0 :       for(int k=0;k&lt;6;k++){</span>
<span class="lineNum">    2537 </span><span class="lineNoCov">          0 :         for(int l=0;l&lt;6;l++){</span>
<span class="lineNum">    2538 </span><span class="lineNoCov">          0 :           for(int m=0;m&lt;6;m++){</span>
<span class="lineNum">    2539 </span><span class="lineNoCov">          0 :             for(int n=0;n&lt;6;n++){</span>
<span class="lineNum">    2540 </span><span class="lineNoCov">          0 :               combination[0]=species1Mdiffsorted[i];</span>
<span class="lineNum">    2541 </span><span class="lineNoCov">          0 :               combination[1]=species2Mdiffsorted[j];</span>
<span class="lineNum">    2542 </span><span class="lineNoCov">          0 :               combination[2]=species3Mdiffsorted[k];</span>
<span class="lineNum">    2543 </span><span class="lineNoCov">          0 :               combination[3]=species4Mdiffsorted[l];</span>
<span class="lineNum">    2544 </span><span class="lineNoCov">          0 :               combination[4]=species5Mdiffsorted[m];</span>
<span class="lineNum">    2545 </span><span class="lineNoCov">          0 :               combination[5]=species6Mdiffsorted[n];</span>
<span class="lineNum">    2546 </span><span class="lineNoCov">          0 :               combinationindices[0]=newindices1[i];</span>
<span class="lineNum">    2547 </span><span class="lineNoCov">          0 :               combinationindices[1]=newindices2[j];</span>
<span class="lineNum">    2548 </span><span class="lineNoCov">          0 :               combinationindices[2]=newindices3[k];</span>
<span class="lineNum">    2549 </span><span class="lineNoCov">          0 :               combinationindices[3]=newindices4[l];</span>
<span class="lineNum">    2550 </span><span class="lineNoCov">          0 :               combinationindices[4]=newindices5[m];</span>
<span class="lineNum">    2551 </span><span class="lineNoCov">          0 :               combinationindices[5]=newindices6[n];</span>
<span class="lineNum">    2552 </span>            :               // Check for duplicates for current combination.
<span class="lineNum">    2553 </span><span class="lineNoCov">          0 :               for(int o=0;o&lt;6;o++){</span>
<span class="lineNum">    2554 </span><span class="lineNoCov">          0 :                 for(int p=o+1;p&lt;6;p++){</span>
<span class="lineNum">    2555 </span><span class="lineNoCov">          0 :                   if(combinationindices[o]==combinationindices[p]){count2++;}</span>
<span class="lineNum">    2556 </span>            :                 }  
<span class="lineNum">    2557 </span>            :               }
<span class="lineNum">    2558 </span>            :               // If there are no duplicates, then work out the sum of differences.
<span class="lineNum">    2559 </span>            :               // If there are duplicates, then sumdiff is set to a very large number.
<span class="lineNum">    2560 </span><span class="lineNoCov">          0 :               if(count2==0){</span>
<span class="lineNum">    2561 </span><span class="lineNoCov">          0 :                 for(int q=0;q&lt;6;q++){</span>
<span class="lineNum">    2562 </span><span class="lineNoCov">          0 :                   sumdiff += combination[q]; </span>
<span class="lineNum">    2563 </span>            :                 }
<span class="lineNum">    2564 </span>            :               } else {
<span class="lineNum">    2565 </span>            :                 sumdiff = 1e100;
<span class="lineNum">    2566 </span>            :               }
<span class="lineNum">    2567 </span>            :               // Update lowestsumdiff and bestindices if necessary.
<span class="lineNum">    2568 </span><span class="lineNoCov">          0 :               if(sumdiff&lt;lowestsumdiff){</span>
<span class="lineNum">    2569 </span><span class="lineNoCov">          0 :                 lowestsumdiff=sumdiff;</span>
<span class="lineNum">    2570 </span><span class="lineNoCov">          0 :                 lowestdiff[0]=combination[0];</span>
<span class="lineNum">    2571 </span><span class="lineNoCov">          0 :                 lowestdiff[1]=combination[1];</span>
<span class="lineNum">    2572 </span><span class="lineNoCov">          0 :                 lowestdiff[2]=combination[2];</span>
<span class="lineNum">    2573 </span><span class="lineNoCov">          0 :                 lowestdiff[3]=combination[3];</span>
<span class="lineNum">    2574 </span><span class="lineNoCov">          0 :                 lowestdiff[4]=combination[4];</span>
<span class="lineNum">    2575 </span><span class="lineNoCov">          0 :                 lowestdiff[5]=combination[5];</span>
<span class="lineNum">    2576 </span><span class="lineNoCov">          0 :                 bestindices[0]=combinationindices[0];</span>
<span class="lineNum">    2577 </span><span class="lineNoCov">          0 :                 bestindices[1]=combinationindices[1];</span>
<span class="lineNum">    2578 </span><span class="lineNoCov">          0 :                 bestindices[2]=combinationindices[2];</span>
<span class="lineNum">    2579 </span><span class="lineNoCov">          0 :                 bestindices[3]=combinationindices[3];</span>
<span class="lineNum">    2580 </span><span class="lineNoCov">          0 :                 bestindices[4]=combinationindices[4];</span>
<span class="lineNum">    2581 </span><span class="lineNoCov">          0 :                 bestindices[5]=combinationindices[5];</span>
<span class="lineNum">    2582 </span>            :               }
<span class="lineNum">    2583 </span><span class="lineNoCov">          0 :               sumdiff = 0.0;</span>
<span class="lineNum">    2584 </span><span class="lineNoCov">          0 :               count2 = 0;</span>
<span class="lineNum">    2585 </span>            :             }
<span class="lineNum">    2586 </span>            :           }
<span class="lineNum">    2587 </span>            :         }
<span class="lineNum">    2588 </span>            :       }
<span class="lineNum">    2589 </span>            :     }
<span class="lineNum">    2590 </span>            :   }
<span class="lineNum">    2591 </span>            : 
<span class="lineNum">    2592 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;lowestsumdiff = &quot; &lt;&lt; lowestsumdiff &lt;&lt; endl;</span>
<span class="lineNum">    2593 </span>            : 
<span class="lineNum">    2594 </span>            :   int bestindex = 0;
<span class="lineNum">    2595 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;6;i++){</span>
<span class="lineNum">    2596 </span><span class="lineNoCov">          0 :     bestindex = bestindices[i];</span>
<span class="lineNum">    2597 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;body mass of species giving lowest difference with &quot; &lt;&lt; i &lt;&lt; &quot;th species = &quot; &lt;&lt; s[bestindex].bodymass() &lt;&lt; endl;</span>
<span class="lineNum">    2598 </span><span class="lineNoCov">          0 :     cout &lt;&lt; i &lt;&lt; &quot;th element of lowestdiff = &quot; &lt;&lt; lowestdiff[i] &lt;&lt; endl;</span>
<span class="lineNum">    2599 </span>            :   }
<span class="lineNum">    2600 </span>            : 
<span class="lineNum">    2601 </span>            :   // Now we apply F to all model fish species. 
<span class="lineNum">    2602 </span><span class="lineNoCov">          0 :   double fishing_value=0;</span>
<span class="lineNum">    2603 </span>            :   // First, F is applied to all species according to straight lines between the 6 known F values. Equation of a straight line used. 
<span class="lineNum">    2604 </span>            :   // For model fish species smaller than the smallest species with known F, the line derived from the 2 smallest species with known F is used. 
<span class="lineNum">    2605 </span>            :   // For model fish species larger than the largest species with known F, the line derived from the 2 largest species with known F is used.
<span class="lineNum">    2606 </span>            :   // A random gaussian variable is also added if addrandF is 1, with mean 0 and std randFstd.
<span class="lineNum">    2607 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2608 </span><span class="lineNoCov">          0 :     if((s[i].bodymass() &gt; n*eval_here(&quot;kilogram&quot;)) </span>
<span class="lineNum">    2609 </span><span class="lineNoCov">          0 :        &amp;&amp; (s[i].bodymass() &lt; fishMrangemax*eval_here(&quot;kilogram&quot;))){</span>
<span class="lineNum">    2610 </span><span class="lineNoCov">          0 :       if(s[i].bodymass() &lt;= species2M){ fishing_value = ((species2F-species1F)/(species2M-species1M))*(s[i].bodymass()-species1M)+species1F; }</span>
<span class="lineNum">    2611 </span><span class="lineNoCov">          0 :       if((s[i].bodymass() &gt; species2M)&amp;&amp;(s[i].bodymass() &lt;= species3M)){ fishing_value = ((species3F-species2F)/(species3M-species2M))*(s[i].bodymass()-species2M)+species2F; }</span>
<span class="lineNum">    2612 </span><span class="lineNoCov">          0 :       if((s[i].bodymass() &gt; species3M)&amp;&amp;(s[i].bodymass() &lt;= species4M)){ fishing_value = ((species4F-species3F)/(species4M-species3M))*(s[i].bodymass()-species3M)+species3F; }</span>
<span class="lineNum">    2613 </span><span class="lineNoCov">          0 :       if((s[i].bodymass() &gt; species4M)&amp;&amp;(s[i].bodymass() &lt;= species5M)){ fishing_value = ((species5F-species4F)/(species5M-species4M))*(s[i].bodymass()-species4M)+species4F; }</span>
<span class="lineNum">    2614 </span><span class="lineNoCov">          0 :       if(s[i].bodymass() &gt; species5M){ fishing_value = ((species6F-species5F)/(species6M-species5M))*(s[i].bodymass()-species5M)+species5F; }</span>
<span class="lineNum">    2615 </span><span class="lineNoCov">          0 :       if(addrandF==1){ fishing_value = fishing_value + gaussian(0,randFstd); }</span>
<span class="lineNum">    2616 </span>            :       // The final line has a negative slope, so we need to ensure that the fishing_value does not become negative. 
<span class="lineNum">    2617 </span>            :       // Also, the addition of a negative Guassian random number may give a negative fishing value, so again, we need to ensure it does not become negative.
<span class="lineNum">    2618 </span><span class="lineNoCov">          0 :       if(fishing_value&lt;0){ fishing_value=0; }; </span>
<span class="lineNum">    2619 </span>            :       // cout &lt;&lt; &quot;fishing_value = &quot; &lt;&lt; fishing_value &lt;&lt; endl;
<span class="lineNum">    2620 </span><span class="lineNoCov">          0 :       s[i].set_fishing_mortality(fishing_value);</span>
<span class="lineNum">    2621 </span>            :     }
<span class="lineNum">    2622 </span>            :   }
<span class="lineNum">    2623 </span>            :   // Now we apply the known F values to the 6 model species with closest body mass.
<span class="lineNum">    2624 </span><span class="lineNoCov">          0 :   int index1 = 0;</span>
<span class="lineNum">    2625 </span><span class="lineNoCov">          0 :   index1 = bestindices[0];</span>
<span class="lineNum">    2626 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species1F);</span>
<span class="lineNum">    2627 </span><span class="lineNoCov">          0 :   index1 = bestindices[1];</span>
<span class="lineNum">    2628 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species2F);</span>
<span class="lineNum">    2629 </span><span class="lineNoCov">          0 :   index1 = bestindices[2];</span>
<span class="lineNum">    2630 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species3F);</span>
<span class="lineNum">    2631 </span><span class="lineNoCov">          0 :   index1 = bestindices[3];</span>
<span class="lineNum">    2632 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species4F);</span>
<span class="lineNum">    2633 </span><span class="lineNoCov">          0 :   index1 = bestindices[4];</span>
<span class="lineNum">    2634 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species5F);</span>
<span class="lineNum">    2635 </span><span class="lineNoCov">          0 :   index1 = bestindices[5];</span>
<span class="lineNum">    2636 </span><span class="lineNoCov">          0 :   s[index1].set_fishing_mortality(species6F);</span>
<span class="lineNum">    2637 </span>            :   
<span class="lineNum">    2638 </span><span class="lineNoCov">          0 : }</span>
<a name="2639"><span class="lineNum">    2639 </span>            : </a>
<span class="lineNum">    2640 </span>            : 
<span class="lineNum">    2641 </span><span class="lineNoCov">          0 : void NewWeb::delete_plant_fraction(double r){</span>
<span class="lineNum">    2642 </span>            : 
<span class="lineNum">    2643 </span><span class="lineNoCov">          0 :   ALWAYS_ASSERT(r&lt;1);</span>
<span class="lineNum">    2644 </span><span class="lineNoCov">          0 :   int plants_to_delete=int(r*number_of_plants());</span>
<span class="lineNum">    2645 </span>            :   
<span class="lineNum">    2646 </span><span class="lineNoCov">          0 :   while(plants_to_delete--){</span>
<span class="lineNum">    2647 </span><span class="lineNoCov">          0 :     int n=s.n_animals+random_integer(number_of_plants());</span>
<span class="lineNum">    2648 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;deleting plant &quot; &lt;&lt; assigned_column[n] &lt;&lt; endl;</span>
<span class="lineNum">    2649 </span><span class="lineNoCov">          0 :     delete_species(n);</span>
<span class="lineNum">    2650 </span>            :   }
<a name="2651"><span class="lineNum">    2651 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2652 </span>            : 
<span class="lineNum">    2653 </span><span class="lineNoCov">          0 : void NewWeb::</span>
<span class="lineNum">    2654 </span>            : delete_lower_fraction_of_property(const sequence&lt;double&gt; &amp; property,
<span class="lineNum">    2655 </span>            :                                   double r){
<span class="lineNum">    2656 </span>            :   //quick and dirty implementation
<span class="lineNum">    2657 </span><span class="lineNoCov">          0 :   ALWAYS_ASSERT(property.size()==number_of_species());</span>
<span class="lineNum">    2658 </span><span class="lineNoCov">          0 :   ALWAYS_ASSERT(0&lt;=r and r&lt;1);</span>
<span class="lineNum">    2659 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; prop_copy=property;</span>
<span class="lineNum">    2660 </span><span class="lineNoCov">          0 :   sort(prop_copy.begin(),prop_copy.end());</span>
<span class="lineNum">    2661 </span><span class="lineNoCov">          0 :   const double threshold=prop_copy[number_of_species()*r];</span>
<span class="lineNum">    2662 </span><span class="lineNoCov">          0 :   REPORT(threshold);</span>
<span class="lineNum">    2663 </span>            :   // This must be a backwards loop!
<span class="lineNum">    2664 </span><span class="lineNoCov">          0 :   for(int i=number_of_species();i--&gt;0;){</span>
<span class="lineNum">    2665 </span><span class="lineNoCov">          0 :     if(property[i]&lt;threshold){</span>
<span class="lineNum">    2666 </span><span class="lineNoCov">          0 :       cout &lt;&lt; &quot;deleting &quot; </span>
<span class="lineNum">    2667 </span><span class="lineNoCov">          0 :            &lt;&lt; s[i].taxon_name()</span>
<span class="lineNum">    2668 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; &quot; &lt;&lt; assigned_column[i] &lt;&lt; endl;</span>
<span class="lineNum">    2669 </span><span class="lineNoCov">          0 :       delete_species(i);</span>
<span class="lineNum">    2670 </span>            :     }
<span class="lineNum">    2671 </span>            :   }
<a name="2672"><span class="lineNum">    2672 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2673 </span>            : 
<span class="lineNum">    2674 </span><span class="lineNoCov">          0 : void NewWeb::delete_plants_by_vulnerability_trait(double r){</span>
<span class="lineNum">    2675 </span><span class="lineNoCov">          0 :   sequence&lt; double &gt; V1(number_of_species());</span>
<span class="lineNum">    2676 </span><span class="lineNoCov">          0 :   double V1_max=0;// it's no problem if all plant V1 are &lt; 0 ...</span>
<span class="lineNum">    2677 </span><span class="lineNoCov">          0 :   for(int i=number_of_species();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2678 </span><span class="lineNoCov">          0 :     V1[i]=s[i].vulnerability_V()[1];</span>
<span class="lineNum">    2679 </span><span class="lineNoCov">          0 :     if(V1[i]&gt;V1_max) V1_max=V1[i];</span>
<span class="lineNum">    2680 </span>            :   }
<span class="lineNum">    2681 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2682 </span><span class="lineNoCov">          0 :     V1[i]=V1_max;</span>
<span class="lineNum">    2683 </span>            :   }
<span class="lineNum">    2684 </span>            :   double fraction=
<span class="lineNum">    2685 </span><span class="lineNoCov">          0 :     (r*number_of_plants())/</span>
<span class="lineNum">    2686 </span><span class="lineNoCov">          0 :     number_of_species();</span>
<span class="lineNum">    2687 </span><span class="lineNoCov">          0 :   delete_lower_fraction_of_property(V1,fraction);</span>
<a name="2688"><span class="lineNum">    2688 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2689 </span>            : 
<span class="lineNum">    2690 </span><span class="lineNoCov">          0 : void NewWeb::delete_rare_species_fraction(double r){</span>
<span class="lineNum">    2691 </span>            : 
<span class="lineNum">    2692 </span>            :   // compute cutoff body mass:
<span class="lineNum">    2693 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Biomass(s.size());</span>
<span class="lineNum">    2694 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2695 </span><span class="lineNoCov">          0 :     Biomass(i)=s(i).biomass_abundance_B();</span>
<span class="lineNum">    2696 </span>            :   }
<span class="lineNum">    2697 </span><span class="lineNoCov">          0 :   delete_lower_fraction_of_property(Biomass,r);</span>
<a name="2698"><span class="lineNum">    2698 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2699 </span>            : 
<span class="lineNum">    2700 </span><span class="lineNoCov">          0 : void NewWeb::delete_large_species_fraction(double r){</span>
<span class="lineNum">    2701 </span>            : 
<span class="lineNum">    2702 </span>            :   // compute cutoff body mass:
<span class="lineNum">    2703 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; neg_bodymass=get_bodymass_M()*-1;</span>
<span class="lineNum">    2704 </span><span class="lineNoCov">          0 :   delete_lower_fraction_of_property(neg_bodymass,r);</span>
<a name="2705"><span class="lineNum">    2705 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2706 </span>            : 
<span class="lineNum">    2707 </span><span class="lineNoCov">          0 : void NewWeb::delete_10_species_near_size(double size){</span>
<span class="lineNum">    2708 </span>            :   // compute cutoff body mass:
<span class="lineNum">    2709 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; diff_bodymass=get_bodymass_M()-size;</span>
<span class="lineNum">    2710 </span><span class="lineNoCov">          0 :   diff_bodymass*=diff_bodymass;</span>
<span class="lineNum">    2711 </span><span class="lineNoCov">          0 :   delete_lower_fraction_of_property(diff_bodymass,10.5/number_of_species());</span>
<span class="lineNum">    2712 </span><span class="lineNoCov">          0 : }</span>
<a name="2713"><span class="lineNum">    2713 </span>            : </a>
<span class="lineNum">    2714 </span>            : 
<span class="lineNum">    2715 </span><span class="lineNoCov">          0 : Interaction_Matrix NewWeb::trivial_loop_removal(const Interaction_Matrix &amp; im){</span>
<span class="lineNum">    2716 </span><span class="lineNoCov">          0 :   ALWAYS_ASSERT(im.size()==s.size());</span>
<span class="lineNum">    2717 </span><span class="lineNoCov">          0 :   const int S=s.size();</span>
<span class="lineNum">    2718 </span><span class="lineNoCov">          0 :   Interaction_Matrix im2(im);</span>
<span class="lineNum">    2719 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    2720 </span><span class="lineNoCov">          0 :     for(int j=S;j--&gt;0;){</span>
<span class="lineNum">    2721 </span><span class="lineNoCov">          0 :       if((!s[i].is_a_plant()) &amp;&amp; (!s[j].is_a_plant()) &amp;&amp; </span>
<span class="lineNum">    2722 </span><span class="lineNoCov">          0 :          s[i].bodymass() &lt;= s[j].bodymass() ){</span>
<span class="lineNum">    2723 </span><span class="lineNoCov">          0 :         im2[i][j]=NetworkAnalysis::none;</span>
<span class="lineNum">    2724 </span>            :       }
<span class="lineNum">    2725 </span>            :     }
<span class="lineNum">    2726 </span>            :   }
<span class="lineNum">    2727 </span><span class="lineNoCov">          0 :   return im2;</span>
<a name="2728"><span class="lineNum">    2728 </span>            : }</a>
<span class="lineNum">    2729 </span>            : 
<span class="lineNum">    2730 </span><span class="lineCov">      21109 : bool NewWeb::small_values_in(ODE_vector &amp; state,</span>
<span class="lineNum">    2731 </span>            :                              const species_set_t&amp;  conserved){
<span class="lineNum">    2732 </span><span class="lineCov">      21109 :   const double log_tolerance = log_small_value_tolerance;</span>
<span class="lineNum">    2733 </span><span class="lineCov">      21109 :   double log_conservation_tolerance=log(conservation_tolerance);</span>
<span class="lineNum">    2734 </span><span class="lineCov">    8361902 :   for(int j=0;j&lt;s.size();j++){</span>
<span class="lineNum">    2735 </span>            :     //cout &lt;&lt; state[j] &lt;&lt; &quot;, &quot; &lt;&lt; s(j).the_log_mean_bodymass_M &lt;&lt; std::endl;
<span class="lineNum">    2736 </span><span class="lineCov">   16639652 :     if(state[j] &lt; log(s(j).get_threshold_biomass_B()) - log_tolerance -</span>
<span class="lineNum">    2737 </span><span class="lineCov">    8319826 :        (conserved.count(assigned_column[j])?log_conservation_tolerance:0))</span>
<span class="lineNum">    2738 </span>            :       return true;
<span class="lineNum">    2739 </span>            :   }
<span class="lineNum">    2740 </span>            :   return false;
<a name="2741"><span class="lineNum">    2741 </span>            : }</a>
<span class="lineNum">    2742 </span>            : 
<span class="lineNum">    2743 </span><span class="lineCov">      91318 : int NewWeb::number_of_species() const{</span>
<span class="lineNum">    2744 </span><span class="lineCov">     182636 :   return s.size();</span>
<span class="lineNum">    2745 </span>            : }
<a name="2746"><span class="lineNum">    2746 </span>            : </a>
<span class="lineNum">    2747 </span>            :   
<span class="lineNum">    2748 </span><span class="lineNoCov">          0 : int NewWeb::number_of_animals() const{</span>
<span class="lineNum">    2749 </span><span class="lineCov">       1396 :   return s.n_animals;</span>
<a name="2750"><span class="lineNum">    2750 </span>            : }</a>
<span class="lineNum">    2751 </span>            : 
<span class="lineNum">    2752 </span><span class="lineNoCov">          0 : int NewWeb::number_of_plants() const{</span>
<span class="lineNum">    2753 </span><span class="lineCov">       1576 :   return s.size()-s.n_animals;</span>
<a name="2754"><span class="lineNum">    2754 </span>            : }</a>
<span class="lineNum">    2755 </span>            : 
<span class="lineNum">    2756 </span><span class="lineNoCov">          0 : int NewWeb::number_of_fish() const{</span>
<span class="lineNum">    2757 </span><span class="lineNoCov">          0 :   int fishcount=0;  </span>
<span class="lineNum">    2758 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2759 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    2760 </span><span class="lineNoCov">          0 :       fishcount++;</span>
<span class="lineNum">    2761 </span>            :     }
<span class="lineNum">    2762 </span>            :   }
<span class="lineNum">    2763 </span><span class="lineNoCov">          0 :   return fishcount;</span>
<span class="lineNum">    2764 </span>            : }
<span class="lineNum">    2765 </span>            : 
<span class="lineNum">    2766 </span><span class="lineCov">         45 : const double gram=eval_here(&quot;1*gram&quot;); //get a dimensionless gram</span>
<span class="lineNum">    2767 </span><span class="lineCov">         45 : const double unit_mass=eval_here(&quot;1*kilogram&quot;); //for output files</span>
<span class="lineNum">    2768 </span><span class="lineCov">         45 : const double meter2=eval_here(&quot;1*meter^2&quot;);</span>
<span class="lineNum">    2769 </span><span class="lineCov">         45 : const double unit_area=eval_here(&quot;1*meter^2&quot;); //for output files</span>
<a name="2770"><span class="lineNum">    2770 </span><span class="lineCov">         45 : const double year=eval_here(&quot;1*year&quot;);</span></a>
<span class="lineNum">    2771 </span>            : 
<span class="lineNum">    2772 </span><span class="lineNoCov">          0 : void NewWeb::rank_abundance_plot(const char* filename,bool with_plants){</span>
<span class="lineNum">    2773 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    2774 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; abund;</span>
<span class="lineNum">    2775 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2776 </span><span class="lineNoCov">          0 :     if(with_plants || ! s[i].is_a_plant()){</span>
<span class="lineNum">    2777 </span><span class="lineNoCov">          0 :       abund[abund.size()]=s[i].biomass_abundance_B()/</span>
<span class="lineNum">    2778 </span><span class="lineNoCov">          0 :         s[i].bodymass();</span>
<span class="lineNum">    2779 </span>            :     }
<span class="lineNum">    2780 </span>            :   }
<span class="lineNum">    2781 </span><span class="lineNoCov">          0 :   sort(abund.begin(),abund.end());</span>
<span class="lineNum">    2782 </span><span class="lineNoCov">          0 :   for(int i=abund.size();i--&gt;0;){</span>
<span class="lineNum">    2783 </span><span class="lineNoCov">          0 :     os &lt;&lt; abund.size()-i &lt;&lt; &quot; &quot; &lt;&lt; abund[i] &lt;&lt; std::endl;</span>
<span class="lineNum">    2784 </span>            :   }
<span class="lineNum">    2785 </span>            : 
<span class="lineNum">    2786 </span><span class="lineNoCov">          0 :   abund.resize(0);</span>
<span class="lineNum">    2787 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    2788 </span><span class="lineNoCov">          0 :     abund[abund.size()]=s[i].biomass_abundance_B();</span>
<span class="lineNum">    2789 </span>            :   }
<span class="lineNum">    2790 </span><span class="lineNoCov">          0 :   sort(abund.begin(),abund.end());</span>
<span class="lineNum">    2791 </span><span class="lineNoCov">          0 :   std::ostringstream afname;</span>
<span class="lineNum">    2792 </span><span class="lineNoCov">          0 :   afname &lt;&lt; &quot;a&quot; &lt;&lt; filename;</span>
<span class="lineNum">    2793 </span><span class="lineNoCov">          0 :   std::ofstream as(afname.str().c_str());</span>
<span class="lineNum">    2794 </span><span class="lineNoCov">          0 :   for(int i=abund.size();i--&gt;0;){</span>
<span class="lineNum">    2795 </span><span class="lineNoCov">          0 :     as &lt;&lt; abund.size()-i &lt;&lt; &quot; &quot; &lt;&lt; abund[i] &lt;&lt; std::endl;</span>
<span class="lineNum">    2796 </span>            :   }
<span class="lineNum">    2797 </span>            : 
<span class="lineNum">    2798 </span><span class="lineNoCov">          0 :   if(with_plants){</span>
<span class="lineNum">    2799 </span><span class="lineNoCov">          0 :     abund.resize(0);</span>
<span class="lineNum">    2800 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2801 </span><span class="lineNoCov">          0 :       abund[abund.size()]=s[i].biomass_abundance_B();</span>
<span class="lineNum">    2802 </span>            :     }
<span class="lineNum">    2803 </span><span class="lineNoCov">          0 :     sort(abund.begin(),abund.end());</span>
<span class="lineNum">    2804 </span><span class="lineNoCov">          0 :     std::ostringstream pfname;</span>
<span class="lineNum">    2805 </span><span class="lineNoCov">          0 :     pfname &lt;&lt; &quot;p&quot; &lt;&lt; filename;</span>
<span class="lineNum">    2806 </span><span class="lineNoCov">          0 :     std::ofstream ps(pfname.str().c_str());</span>
<span class="lineNum">    2807 </span><span class="lineNoCov">          0 :     for(int i=abund.size();i--&gt;0;){</span>
<span class="lineNum">    2808 </span><span class="lineNoCov">          0 :       ps &lt;&lt; abund.size()-i &lt;&lt; &quot; &quot; &lt;&lt; abund[i] &lt;&lt; std::endl;</span>
<span class="lineNum">    2809 </span>            :     }
<span class="lineNum">    2810 </span>            :   }
<a name="2811"><span class="lineNum">    2811 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2812 </span>            : 
<span class="lineNum">    2813 </span><span class="lineNoCov">          0 : void NewWeb::size_spectrum(const char* filename,bool plants,bool animals){</span>
<span class="lineNum">    2814 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; abundance;</span>
<span class="lineNum">    2815 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; bodymass;</span>
<span class="lineNum">    2816 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    2817 </span>            : 
<span class="lineNum">    2818 </span><span class="lineNoCov">          0 :   int j=0;</span>
<span class="lineNum">    2819 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2820 </span><span class="lineNoCov">          0 :     if((s[i].is_a_plant() &amp;&amp; plants) || (!s[i].is_a_plant() &amp;&amp; animals)){</span>
<span class="lineNum">    2821 </span><span class="lineNoCov">          0 :       abundance[j]=s[i].biomass_abundance_B()/s[i].bodymass()/</span>
<span class="lineNum">    2822 </span><span class="lineNoCov">          0 :         area;</span>
<span class="lineNum">    2823 </span><span class="lineNoCov">          0 :       bodymass[j]=s[i].bodymass()/</span>
<span class="lineNum">    2824 </span><span class="lineNoCov">          0 :         unit_mass;</span>
<span class="lineNum">    2825 </span><span class="lineNoCov">          0 :       j++;</span>
<span class="lineNum">    2826 </span>            :     }
<span class="lineNum">    2827 </span>            :   }
<span class="lineNum">    2828 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    2829 </span><span class="lineNoCov">          0 :   os &lt;&lt; log_spectrum(xy_graph(bodymass,abundance),10).log_xy();</span>
<a name="2830"><span class="lineNum">    2830 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2831 </span>            : 
<span class="lineNum">    2832 </span><span class="lineNoCov">          0 : void NewWeb::biomass_spectrum(const char* filename,bool plants,bool animals){</span>
<span class="lineNum">    2833 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; biomass;</span>
<span class="lineNum">    2834 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; bodymass;</span>
<span class="lineNum">    2835 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    2836 </span>            : 
<span class="lineNum">    2837 </span><span class="lineNoCov">          0 :   int j=0;</span>
<span class="lineNum">    2838 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    2839 </span><span class="lineNoCov">          0 :     if((s[i].is_a_plant() &amp;&amp; plants) || (!s[i].is_a_plant() &amp;&amp; animals)){</span>
<span class="lineNum">    2840 </span><span class="lineNoCov">          0 :       biomass[j]=s[i].biomass_abundance_B()/area/unit_mass;</span>
<span class="lineNum">    2841 </span><span class="lineNoCov">          0 :       bodymass[j]=s[i].bodymass()/unit_mass;</span>
<span class="lineNum">    2842 </span><span class="lineNoCov">          0 :       j++;</span>
<span class="lineNum">    2843 </span>            :     }
<span class="lineNum">    2844 </span>            :   }
<span class="lineNum">    2845 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    2846 </span><span class="lineNoCov">          0 :   os &lt;&lt; log_spectrum(xy_graph(bodymass,biomass),10).log_xy();</span>
<a name="2847"><span class="lineNum">    2847 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    2848 </span>            : 
<span class="lineNum">    2849 </span><span class="lineNoCov">          0 : link_strength_matrix NewWeb::trophic_distance_matrix(){</span>
<span class="lineNum">    2850 </span><span class="lineNoCov">          0 :   int S=number_of_species();</span>
<span class="lineNum">    2851 </span><span class="lineNoCov">          0 :   link_strength_matrix d;</span>
<span class="lineNum">    2852 </span><span class="lineNoCov">          0 :   d.resize(S);</span>
<span class="lineNum">    2853 </span>            : 
<span class="lineNum">    2854 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    2855 </span><span class="lineNoCov">          0 :     for(int j=S;j--&gt;0;){</span>
<span class="lineNum">    2856 </span><span class="lineNoCov">          0 :       d(i,j)=s[j].foraging_distance_to(s[i]);</span>
<span class="lineNum">    2857 </span>            :     }
<span class="lineNum">    2858 </span>            :   }
<span class="lineNum">    2859 </span><span class="lineNoCov">          0 :   return d;</span>
<a name="2860"><span class="lineNum">    2860 </span>            : }</a>
<span class="lineNum">    2861 </span>            : 
<span class="lineNum">    2862 </span><span class="lineNoCov">          0 : void NewWeb::species_table(const char* filename,</span>
<span class="lineNum">    2863 </span>            :                            bool with_plants,double th,Snapshot &amp; snap,
<span class="lineNum">    2864 </span>            :                            bool jolly){
<span class="lineNum">    2865 </span>            : 
<span class="lineNum">    2866 </span>            :   bool links_are_random=
<span class="lineNum">    2867 </span><span class="lineNoCov">          0 :     (get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;)!=0);</span>
<span class="lineNum">    2868 </span>            : 
<span class="lineNum">    2869 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_headings;</span>
<span class="lineNum">    2870 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_data;</span>
<span class="lineNum">    2871 </span>            : 
<span class="lineNum">    2872 </span><span class="lineNoCov">          0 :   int column=0;</span>
<span class="lineNum">    2873 </span>            : 
<span class="lineNum">    2874 </span><span class="lineNoCov">          0 :   int S=s.size();</span>
<span class="lineNum">    2875 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    2876 </span>            :   
<span class="lineNum">    2877 </span>            :   // compute niche widths and mean interaction strength
<span class="lineNum">    2878 </span><span class="lineNoCov">          0 :   link_strength_matrix tdm=trophic_distance_matrix();</span>
<span class="lineNum">    2879 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; niche_width(S);</span>
<span class="lineNum">    2880 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; meanC(S);</span>
<span class="lineNum">    2881 </span><span class="lineNoCov">          0 :   for(int j=s.n_animals;j--&gt;0;){</span>
<span class="lineNum">    2882 </span><span class="lineNoCov">          0 :     for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    2883 </span><span class="lineNoCov">          0 :       niche_width(j)+=tdm(i,j)*snap.ifrac()(i,j);</span>
<span class="lineNum">    2884 </span><span class="lineNoCov">          0 :       meanC(j)+=s[j].aggressivity_g()*</span>
<span class="lineNum">    2885 </span><span class="lineNoCov">          0 :         s[j].foraging_strength_c_on(s[i])*snap.ifrac()(i,j);</span>
<span class="lineNum">    2886 </span>            :     }
<span class="lineNum">    2887 </span>            :   }
<span class="lineNum">    2888 </span><span class="lineNoCov">          0 :   meanC*=unit_mass/unit_area;</span>
<span class="lineNum">    2889 </span>            : 
<span class="lineNum">    2890 </span>            :   // compute GPP
<span class="lineNum">    2891 </span><span class="lineNoCov">          0 :   double GPP=0;</span>
<span class="lineNum">    2892 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    2893 </span><span class="lineNoCov">          0 :     GPP+=s[i].the_GP;</span>
<span class="lineNum">    2894 </span>            :   }
<span class="lineNum">    2895 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;GPP &quot; &lt;&lt; GPP/area*year/gram &lt;&lt; endl; </span>
<span class="lineNum">    2896 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;(in units of g m^-2 yr^-1)&quot; &lt;&lt; endl;</span>
<span class="lineNum">    2897 </span>            : 
<span class="lineNum">    2898 </span>            :   // compute remaining niche space main axis:
<span class="lineNum">    2899 </span><span class="lineNoCov">          0 :   simple_vector&lt;bool&gt; selection(niche_space_dimensions_D,true);</span>
<span class="lineNum">    2900 </span><span class="lineNoCov">          0 :   selection[0]=false;</span>
<span class="lineNum">    2901 </span><span class="lineNoCov">          0 :   simple_vector&lt;double&gt; VV1(niche_space_dimensions_D,0);</span>
<span class="lineNum">    2902 </span><span class="lineNoCov">          0 :   simple_vector&lt;double&gt; FFa1(niche_space_dimensions_D,0);</span>
<span class="lineNum">    2903 </span><span class="lineNoCov">          0 :   simple_vector&lt;double&gt; FFp1(niche_space_dimensions_D,0);</span>
<span class="lineNum">    2904 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; pa_separation(niche_space_dimensions_D,0);</span>
<span class="lineNum">    2905 </span><span class="lineNoCov">          0 :   if(!links_are_random){</span>
<span class="lineNum">    2906 </span><span class="lineNoCov">          0 :     chi_square_meter VV(selection);</span>
<span class="lineNum">    2907 </span><span class="lineNoCov">          0 :     chi_square_meter VVp(selection);</span>
<span class="lineNum">    2908 </span><span class="lineNoCov">          0 :     chi_square_meter VVa(selection);</span>
<span class="lineNum">    2909 </span><span class="lineNoCov">          0 :     chi_square_meter FFp(selection);</span>
<span class="lineNum">    2910 </span><span class="lineNoCov">          0 :     chi_square_meter FFa(selection);</span>
<span class="lineNum">    2911 </span><span class="lineNoCov">          0 :     for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    2912 </span><span class="lineNoCov">          0 :       VV.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    2913 </span><span class="lineNoCov">          0 :       if(is_plant(n)){</span>
<span class="lineNum">    2914 </span><span class="lineNoCov">          0 :         VVp.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    2915 </span><span class="lineNoCov">          0 :         FFp.sample(s[n].niche_G());</span>
<span class="lineNum">    2916 </span>            :       }else{
<span class="lineNum">    2917 </span><span class="lineNoCov">          0 :         VVa.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    2918 </span><span class="lineNoCov">          0 :         FFa.sample(s[n].foraging_F());</span>
<span class="lineNum">    2919 </span>            :       }
<span class="lineNum">    2920 </span>            :     }
<span class="lineNum">    2921 </span><span class="lineNoCov">          0 :     VV1=VV.estimate().main_axis();</span>
<span class="lineNum">    2922 </span><span class="lineNoCov">          0 :     FFa1=FFa.estimate().main_axis();</span>
<span class="lineNum">    2923 </span><span class="lineNoCov">          0 :     FFp1=FFp.estimate().main_axis();</span>
<span class="lineNum">    2924 </span><span class="lineNoCov">          0 :     pa_separation=sequence&lt;double&gt;(VVp.mean())-VVa.mean();</span>
<span class="lineNum">    2925 </span><span class="lineNoCov">          0 :     pa_separation[0]=0;</span>
<span class="lineNum">    2926 </span><span class="lineNoCov">          0 :     pa_separation/=abs(pa_separation);</span>
<span class="lineNum">    2927 </span><span class="lineNoCov">          0 :     VV1.prepend(0);</span>
<span class="lineNum">    2928 </span><span class="lineNoCov">          0 :     FFa1.prepend(0);</span>
<span class="lineNum">    2929 </span><span class="lineNoCov">          0 :     FFp1.prepend(0);</span>
<span class="lineNum">    2930 </span>            :   }
<span class="lineNum">    2931 </span>            : 
<span class="lineNum">    2932 </span>            : 
<span class="lineNum">    2933 </span>            :   // compute some switching exponents
<span class="lineNum">    2934 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; switching_b(S);</span>
<span class="lineNum">    2935 </span><span class="lineNoCov">          0 :   if(!jolly){</span>
<span class="lineNum">    2936 </span>            :     // By the way: this algorithm is not optimized. We need only one
<span class="lineNum">    2937 </span>            :     // column of the intake matrix in each iteration, not the full
<span class="lineNum">    2938 </span>            :     // thing.
<span class="lineNum">    2939 </span><span class="lineNoCov">          0 :     if(S&gt;=2){    </span>
<span class="lineNum">    2940 </span><span class="lineNoCov">          0 :       prepare_for_integration();</span>
<span class="lineNum">    2941 </span><span class="lineNoCov">          0 :       ODE_vector state(number_of_variables()),</span>
<span class="lineNum">    2942 </span><span class="lineNoCov">          0 :         time_derivative(number_of_variables());</span>
<span class="lineNum">    2943 </span><span class="lineNoCov">          0 :       NewWeb::write_state_to(state);</span>
<span class="lineNum">    2944 </span><span class="lineNoCov">          0 :       compute_flows(state,true); // initialize flow computation</span>
<span class="lineNum">    2945 </span><span class="lineNoCov">          0 :       for(int j=s.n_animals;j--&gt;0;){</span>
<span class="lineNum">    2946 </span>            :         // first get two most important diet items:
<span class="lineNum">    2947 </span><span class="lineNoCov">          0 :         int first=0,second=1;</span>
<span class="lineNum">    2948 </span><span class="lineNoCov">          0 :         if(snap.ifrac()(0,j)&gt;snap.ifrac()(1,j)){</span>
<span class="lineNum">    2949 </span><span class="lineNoCov">          0 :           second=0;</span>
<span class="lineNum">    2950 </span><span class="lineNoCov">          0 :           first=1;</span>
<span class="lineNum">    2951 </span>            :         }
<span class="lineNum">    2952 </span><span class="lineNoCov">          0 :         for(int i=S;i--&gt;2;){</span>
<span class="lineNum">    2953 </span><span class="lineNoCov">          0 :           if(snap.ifrac()(i,j)&gt;snap.ifrac()(first,j)){</span>
<span class="lineNum">    2954 </span>            :             // new first
<span class="lineNum">    2955 </span>            :             second=first;
<span class="lineNum">    2956 </span>            :             first=i;
<span class="lineNum">    2957 </span><span class="lineNoCov">          0 :           }else if(snap.ifrac()(i,j)&gt;snap.ifrac()(second,j)){</span>
<span class="lineNum">    2958 </span>            :             // new second
<span class="lineNum">    2959 </span><span class="lineNoCov">          0 :             second=i;</span>
<span class="lineNum">    2960 </span>            :           }
<span class="lineNum">    2961 </span>            :         }
<span class="lineNum">    2962 </span>            :         // compute switching b between first and second
<span class="lineNum">    2963 </span><span class="lineNoCov">          0 :         double delta=0.01;</span>
<span class="lineNum">    2964 </span><span class="lineNoCov">          0 :         NewWeb::write_state_to(state);</span>
<span class="lineNum">    2965 </span><span class="lineNoCov">          0 :         state[first]-=delta/2;</span>
<span class="lineNum">    2966 </span><span class="lineNoCov">          0 :         state[second]+=delta/2;</span>
<span class="lineNum">    2967 </span><span class="lineNoCov">          0 :         compute_flows(state,false);</span>
<span class="lineNum">    2968 </span><span class="lineNoCov">          0 :         double diet_ratio=fx(first,j)/fx(second,j);</span>
<span class="lineNum">    2969 </span><span class="lineNoCov">          0 :         state[first]+=delta;</span>
<span class="lineNum">    2970 </span><span class="lineNoCov">          0 :         state[second]-=delta;</span>
<span class="lineNum">    2971 </span><span class="lineNoCov">          0 :         compute_flows(state,false);</span>
<span class="lineNum">    2972 </span><span class="lineNoCov">          0 :         double diet_ratio1=fx(first,j)/fx(second,j);</span>
<span class="lineNum">    2973 </span><span class="lineNoCov">          0 :         switching_b(j)=log(diet_ratio1/diet_ratio)/(2*delta);</span>
<span class="lineNum">    2974 </span>            :       }
<span class="lineNum">    2975 </span>            :     }
<span class="lineNum">    2976 </span>            :   }
<span class="lineNum">    2977 </span>            : 
<span class="lineNum">    2978 </span><span class="lineNoCov">          0 :   simple_vector&lt;weighted_average_meter&gt; mean_link_strength(number_of_animals());</span>
<span class="lineNum">    2979 </span>            :   // compute mean attack rate
<span class="lineNum">    2980 </span><span class="lineNoCov">          0 :   for(int i=number_of_animals();i--&gt;0;){</span>
<span class="lineNum">    2981 </span><span class="lineNoCov">          0 :     for(int j=number_of_species();j--&gt;0;){</span>
<span class="lineNum">    2982 </span><span class="lineNoCov">          0 :       mean_link_strength[i].</span>
<span class="lineNum">    2983 </span><span class="lineNoCov">          0 :         sample(s[i].foraging_strength_c_on(s[j]),</span>
<span class="lineNum">    2984 </span><span class="lineNoCov">          0 :                exp(s[i].log_mass_matching(s[j])) </span>
<span class="lineNum">    2985 </span><span class="lineNoCov">          0 :                );</span>
<span class="lineNum">    2986 </span>            :     }
<span class="lineNum">    2987 </span>            :   }
<span class="lineNum">    2988 </span>            : 
<span class="lineNum">    2989 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    2990 </span><span class="lineNoCov">          0 :     &quot;logAg (log10 aggressivity)&quot;;</span>
<span class="lineNum">    2991 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    2992 </span><span class="lineNoCov">          0 :     &quot;V0    (first component of vulnerability vector)&quot;;</span>
<span class="lineNum">    2993 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    2994 </span><span class="lineNoCov">          0 :     &quot;F0    (first component of foraging vector)&quot;;</span>
<span class="lineNum">    2995 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    2996 </span><span class="lineNoCov">          0 :     &quot;id    (sequential ID for each species)&quot;;</span>
<span class="lineNum">    2997 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    2998 </span><span class="lineNoCov">          0 :     &quot;cid   (unique ID for each clade)&quot;;</span>
<span class="lineNum">    2999 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3000 </span><span class="lineNoCov">          0 :     &quot;pn    (passive(!) ingestion efficiency)&quot;;</span>
<span class="lineNum">    3001 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3002 </span><span class="lineNoCov">          0 :     &quot;f     (feeding level)&quot;;</span>
<span class="lineNum">    3003 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3004 </span><span class="lineNoCov">          0 :     &quot;cs    (competition strength)&quot;;</span>
<span class="lineNum">    3005 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3006 </span><span class="lineNoCov">          0 :     &quot;ls    (light strength)&quot;;</span>
<span class="lineNum">    3007 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3008 </span>            :     (not jolly ? 
<span class="lineNum">    3009 </span>            :      &quot;b     (switching exponent)&quot; :  
<span class="lineNum">    3010 </span><span class="lineNoCov">          0 :      &quot;b     (NOT COMPUTED! switching exponent)&quot; );</span>
<span class="lineNum">    3011 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3012 </span><span class="lineNoCov">          0 :     &quot;nw    (niche width)&quot;;</span>
<span class="lineNum">    3013 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3014 </span><span class="lineNoCov">          0 :     &quot;col   (assigned column)&quot;;</span>
<span class="lineNum">    3015 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3016 </span><span class="lineNoCov">          0 :     &quot;V1    (second component of vulnerability)&quot;;</span>
<span class="lineNum">    3017 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3018 </span><span class="lineNoCov">          0 :     &quot;F1    (second component of foraging)&quot;;</span>
<span class="lineNum">    3019 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3020 </span><span class="lineNoCov">          0 :     &quot;Vm    (main component of remaining vulnerability)&quot;;</span>
<span class="lineNum">    3021 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3022 </span><span class="lineNoCov">          0 :     &quot;Fm    (corresponding component of foraging vector)&quot;;</span>
<span class="lineNum">    3023 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3024 </span><span class="lineNoCov">          0 :     &quot;Vr    (length of vulnerability vector)&quot;;</span>
<span class="lineNum">    3025 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3026 </span><span class="lineNoCov">          0 :     &quot;Fr    (length of foraging vector)&quot;;</span>
<span class="lineNum">    3027 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3028 </span><span class="lineNoCov">          0 :     &quot;GP    (yearly gross production density)&quot;;</span>
<span class="lineNum">    3029 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3030 </span><span class="lineNoCov">          0 :     &quot;tm    (trade-off multiplier)&quot;;</span>
<span class="lineNum">    3031 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3032 </span><span class="lineNoCov">          0 :     &quot;Vpa   (animal-plant separating component)&quot;;</span>
<span class="lineNum">    3033 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3034 </span><span class="lineNoCov">          0 :     &quot;Fpa   (corresponding foraging component)&quot;;</span>
<span class="lineNum">    3035 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3036 </span><span class="lineNoCov">          0 :     &quot;logC  (log10 diet-weighted interaction strength)&quot;;</span>
<span class="lineNum">    3037 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3038 </span><span class="lineNoCov">          0 :     &quot;wt    (trophic niche width)&quot;;</span>
<span class="lineNum">    3039 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3040 </span><span class="lineNoCov">          0 :     &quot;mc    (log10(mean link strength))&quot;;</span>
<span class="lineNum">    3041 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3042 </span>            :     &quot;F     (fishing mortality)&quot;;
<span class="lineNum">    3043 </span>            : 
<span class="lineNum">    3044 </span>            : 
<span class="lineNum">    3045 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    3046 </span><span class="lineNoCov">          0 :     std::ostringstream os;</span>
<span class="lineNum">    3047 </span>            :     //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    3048 </span><span class="lineNoCov">          0 :     os.precision(7);</span>
<span class="lineNum">    3049 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    3050 </span><span class="lineNoCov">          0 :     if(with_plants || !sp.is_a_plant()){</span>
<span class="lineNum">    3051 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3052 </span><span class="lineNoCov">          0 :       os &lt;&lt; (sp.is_a_plant() ? 0 : </span>
<span class="lineNum">    3053 </span><span class="lineNoCov">          0 :              log10(sp.aggressivity_g()*unit_mass/unit_area)) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3054 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3055 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.vulnerability_V()[0] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3056 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3057 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.foraging_F()[0] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3058 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.sequential_id() &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3059 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.clade_id() &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3060 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3061 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.the_top_down_strength/(1+sp.the_top_down_strength) </span>
<span class="lineNum">    3062 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; &quot;; //= ingestion efficiency</span>
<span class="lineNum">    3063 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3064 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.the_saturation_strength &lt;&lt; &quot; &quot;; //= feeding level</span>
<span class="lineNum">    3065 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3066 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.the_competition_strength &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3067 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3068 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.the_light_strength &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3069 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3070 </span><span class="lineNoCov">          0 :       os &lt;&lt; (not jolly ? switching_b(n) : 0) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3071 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3072 </span><span class="lineNoCov">          0 :       os &lt;&lt; niche_width(n) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3073 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3074 </span><span class="lineNoCov">          0 :       os &lt;&lt; assigned_column(n) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3075 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3076 </span><span class="lineNoCov">          0 :       os &lt;&lt; (niche_space_dimensions_D&lt;2?0:sp.vulnerability_V()[1]) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3077 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3078 </span><span class="lineNoCov">          0 :       os &lt;&lt; (niche_space_dimensions_D&lt;2?0:sp.foraging_F()[1]) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3079 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3080 </span><span class="lineNoCov">          0 :       os &lt;&lt; dot(sp.vulnerability_V(),VV1) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3081 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3082 </span><span class="lineNoCov">          0 :       os &lt;&lt; dot(sp.foraging_F(),sp.is_a_plant() ? FFp1 : VV1) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3083 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3084 </span><span class="lineNoCov">          0 :       os &lt;&lt; sqrt(dot(sp.vulnerability_V(),sp.vulnerability_V())) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3085 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3086 </span><span class="lineNoCov">          0 :       os &lt;&lt; sqrt(dot(sp.foraging_F(),sp.foraging_F())) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3087 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3088 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.the_GP/area*year &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3089 </span><span class="lineNoCov">          0 :       os.width(9);</span>
<span class="lineNum">    3090 </span><span class="lineNoCov">          0 :       os &lt;&lt; sp.get_trade_off_multiplier() &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3091 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3092 </span><span class="lineNoCov">          0 :       os &lt;&lt; dot(sp.vulnerability_V(),pa_separation) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3093 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3094 </span><span class="lineNoCov">          0 :       os &lt;&lt; dot(sp.foraging_F(),pa_separation) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3095 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3096 </span><span class="lineNoCov">          0 :       os &lt;&lt; ( sp.is_a_plant() ? 0 : log10(meanC(n)) ) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3097 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3098 </span><span class="lineNoCov">          0 :       os &lt;&lt; ( sp.is_a_plant() ? 0 : sp.niche_width_wt() ) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3099 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3100 </span><span class="lineNoCov">          0 :       os &lt;&lt; ( sp.is_a_plant() ? 0 : log10(mean_link_strength[n]) ) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3101 </span><span class="lineNoCov">          0 :       os.width(5);</span>
<span class="lineNum">    3102 </span><span class="lineNoCov">          0 :       os &lt;&lt; ( sp.fishing_mortality()*year ) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    3103 </span><span class="lineNoCov">          0 :       additional_data[n]=os.str();</span>
<span class="lineNum">    3104 </span>            :     }
<span class="lineNum">    3105 </span>            :   }
<span class="lineNum">    3106 </span><span class="lineNoCov">          0 :   snap.species_table(filename,with_plants,th,</span>
<span class="lineNum">    3107 </span><span class="lineNoCov">          0 :                      additional_headings,additional_data);</span>
<a name="3108"><span class="lineNum">    3108 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    3109 </span>            : 
<span class="lineNum">    3110 </span><span class="lineNoCov">          0 : void NewWeb::species_table2(const char* filename,</span>
<span class="lineNum">    3111 </span>            :                            bool with_plants,double th,Snapshot &amp; snap,
<span class="lineNum">    3112 </span>            :                            link_strength_matrix &amp; intake, int colno,
<span class="lineNum">    3113 </span>            :                            bool jolly){
<span class="lineNum">    3114 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    3115 </span>            : 
<span class="lineNum">    3116 </span><span class="lineNoCov">          0 :   if(intake.size()==0)</span>
<span class="lineNum">    3117 </span><span class="lineNoCov">          0 :     intake=intake_matrix();</span>
<span class="lineNum">    3118 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    3119 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    3120 </span>            :   // Work out number of fish species
<span class="lineNum">    3121 </span><span class="lineNoCov">          0 :   double Sfish = 0.0;</span>
<span class="lineNum">    3122 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    3123 </span><span class="lineNoCov">          0 :     if(log10(s[n].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    3124 </span><span class="lineNoCov">          0 :       Sfish += 1;</span>
<span class="lineNum">    3125 </span>            :     }
<span class="lineNum">    3126 </span>            :   }
<span class="lineNum">    3127 </span>            :   //cout &lt;&lt; &quot;Sfish = &quot; &lt;&lt; Sfish &lt;&lt; endl;
<span class="lineNum">    3128 </span>            : 
<span class="lineNum">    3129 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_headings;</span>
<span class="lineNum">    3130 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_data;</span>
<span class="lineNum">    3131 </span>            : 
<span class="lineNum">    3132 </span><span class="lineNoCov">          0 :   int column=0;</span>
<span class="lineNum">    3133 </span>            : 
<span class="lineNum">    3134 </span>            :   //int S=s.size();
<span class="lineNum">    3135 </span>            :   //double area=area_per_compartment/unit_area;
<span class="lineNum">    3136 </span>            : 
<span class="lineNum">    3137 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3138 </span><span class="lineNoCov">          0 :     &quot;col   (assigned column)&quot;;</span>
<span class="lineNum">    3139 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3140 </span><span class="lineNoCov">          0 :     &quot;prod   (productivity)&quot;;</span>
<span class="lineNum">    3141 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3142 </span><span class="lineNoCov">          0 :     &quot;pred   (predation mortality)&quot;;</span>
<span class="lineNum">    3143 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3144 </span><span class="lineNoCov">          0 :     &quot;comp   (mean dietary overlap for fish species)&quot;;</span>
<span class="lineNum">    3145 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3146 </span><span class="lineNoCov">          0 :     &quot;nin   (nin for fish species, considering all species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3147 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3148 </span><span class="lineNoCov">          0 :     &quot;nout   (nout for fish species, considering all species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3149 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3150 </span><span class="lineNoCov">          0 :     &quot;ninw   (nin for fish species, considering all species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3151 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3152 </span><span class="lineNoCov">          0 :     &quot;noutw   (nout for fish species, considering all species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3153 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3154 </span><span class="lineNoCov">          0 :     &quot;ninf   (nin for fish species, considering just fish species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3155 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3156 </span><span class="lineNoCov">          0 :     &quot;noutf   (nout for fish species, considering just fish species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3157 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3158 </span><span class="lineNoCov">          0 :     &quot;ninwf   (nin for fish species, considering just fish species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3159 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3160 </span><span class="lineNoCov">          0 :     &quot;noutwf   (nout for fish species, considering just fish species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    3161 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3162 </span><span class="lineNoCov">          0 :     &quot;gen   (generality for fish species, using diet fraction threshold of default 0.01)&quot;;</span>
<span class="lineNum">    3163 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3164 </span><span class="lineNoCov">          0 :     &quot;vul   (generality for fish species, using diet fraction threshold of default 0.01)&quot;;</span>
<span class="lineNum">    3165 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3166 </span><span class="lineNoCov">          0 :     &quot;conn   (connectivity for fish species, using diet fraction threshold of default 0.01)&quot;;</span>
<span class="lineNum">    3167 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3168 </span><span class="lineNoCov">          0 :     &quot;Mxsim   (max trophic similarity for fish species, using diet fraction threshold of default 0.01)&quot;;</span>
<span class="lineNum">    3169 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    3170 </span><span class="lineNoCov">          0 :     &quot;MPL   (min path length to deleted fish species for fish species, using diet fraction threshold of default 0.01)&quot;;</span>
<span class="lineNum">    3171 </span>            :   
<span class="lineNum">    3172 </span>            :   // Calculate indicators for each fish species
<span class="lineNum">    3173 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotI;</span>
<span class="lineNum">    3174 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjI;</span>
<span class="lineNum">    3175 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotIf;</span>
<span class="lineNum">    3176 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjIf;</span>
<span class="lineNum">    3177 </span><span class="lineNoCov">          0 :   double b_dotdotI = 0.0;</span>
<span class="lineNum">    3178 </span><span class="lineNoCov">          0 :   double b_dotdotIf = 0.0;</span>
<span class="lineNum">    3179 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_ink;</span>
<span class="lineNum">    3180 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outk;</span>
<span class="lineNum">    3181 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_ink;</span>
<span class="lineNum">    3182 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outk;</span>
<span class="lineNum">    3183 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_inkf;</span>
<span class="lineNum">    3184 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outkf;</span>
<span class="lineNum">    3185 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_inkf;</span>
<span class="lineNum">    3186 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outkf;</span>
<span class="lineNum">    3187 </span><span class="lineNoCov">          0 :   double dummy3 = 0.0;</span>
<span class="lineNum">    3188 </span><span class="lineNoCov">          0 :   double dummy4 = 0.0;</span>
<span class="lineNum">    3189 </span><span class="lineNoCov">          0 :   double dummy5 = 0.0;</span>
<span class="lineNum">    3190 </span><span class="lineNoCov">          0 :   double dummy6 = 0.0;</span>
<span class="lineNum">    3191 </span><span class="lineNoCov">          0 :   double dummy7 = 0.0;</span>
<span class="lineNum">    3192 </span><span class="lineNoCov">          0 :   double resolog10M = 0.0;</span>
<span class="lineNum">    3193 </span><span class="lineNoCov">          0 :   double conslog10M = 0.0;</span>
<span class="lineNum">    3194 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Gen_I;</span>
<span class="lineNum">    3195 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Vul_I;</span>
<span class="lineNum">    3196 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; Conn_I;</span>
<span class="lineNum">    3197 </span><span class="lineNoCov">          0 :   double dietfractionthreshold = 0.01; </span>
<span class="lineNum">    3198 </span>            :   // These are matrices where ijth entry is number of prey shared by species i and j,
<span class="lineNum">    3199 </span>            :   // number of predators shared by species i and j,
<span class="lineNum">    3200 </span>            :   // number of prey and predator species shared by i and j divided by the total number
<span class="lineNum">    3201 </span>            :   // of prey and predators for both species (trophic similarity), all using diet threshold of 0.01.
<span class="lineNum">    3202 </span><span class="lineNoCov">          0 :   link_strength_matrix Npreyshared=intake;</span>
<span class="lineNum">    3203 </span><span class="lineNoCov">          0 :   link_strength_matrix Npredshared=intake;</span>
<span class="lineNum">    3204 </span><span class="lineNoCov">          0 :   link_strength_matrix Trophsim=intake;</span>
<span class="lineNum">    3205 </span>            :   // Vector of max TrophSim for each species
<span class="lineNum">    3206 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; MaxTrophsim;</span>
<span class="lineNum">    3207 </span>            :   // This is matrix indicating whether there are two links, one link or no links between two species,
<span class="lineNum">    3208 </span>            :   // using diet threshold of 0.01 (2, 1 or 0).
<span class="lineNum">    3209 </span>            :   // Diagonal entries are set to 0 as we are interested in path lengths between species, and setting
<span class="lineNum">    3210 </span>            :   // diagonal entries to non-zero means adding an extra link that should not be counted as a link in a path
<span class="lineNum">    3211 </span>            :   // between species.
<span class="lineNum">    3212 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot=intake;</span>
<span class="lineNum">    3213 </span>            :   // First populate b_idotI, b_dotjI, b_idotIf and b_dotjIf.
<span class="lineNum">    3214 </span>            :   // Also calcuate b_dotdotI and b_dotdotIf.
<span class="lineNum">    3215 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3216 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    3217 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    3218 </span><span class="lineNoCov">          0 :     dummy3 = 0;</span>
<span class="lineNum">    3219 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    3220 </span><span class="lineNoCov">          0 :     dummy5 = 0;</span>
<span class="lineNum">    3221 </span><span class="lineNoCov">          0 :     dummy6 = 0;</span>
<span class="lineNum">    3222 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    3223 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];</span>
<span class="lineNum">    3224 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    3225 </span><span class="lineNoCov">          0 :       dummy3 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3226 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3227 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3228 </span><span class="lineNoCov">          0 :       if(resolog10M &gt; -3){</span>
<span class="lineNum">    3229 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3230 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3231 </span>            :       }
<span class="lineNum">    3232 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){</span>
<span class="lineNum">    3233 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3234 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3235 </span>            :       }
<span class="lineNum">    3236 </span>            :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &lt;= -3)){
<span class="lineNum">    3237 </span>            :         dummy7 += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    3238 </span>            :       }
<span class="lineNum">    3239 </span>            :       // End loop for j.
<span class="lineNum">    3240 </span>            :     }
<span class="lineNum">    3241 </span><span class="lineNoCov">          0 :     b_idotI[i] = dummy3;</span>
<span class="lineNum">    3242 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    3243 </span><span class="lineNoCov">          0 :     b_idotIf[i] = dummy5;</span>
<span class="lineNum">    3244 </span><span class="lineNoCov">          0 :     b_dotjIf[i] = dummy6;</span>
<span class="lineNum">    3245 </span>            :     // End loop for i.
<span class="lineNum">    3246 </span>            :   }
<span class="lineNum">    3247 </span>            :   b_dotdotIf = b_dotdotI - dummy7;
<span class="lineNum">    3248 </span>            :   // Now populate H_ink, H_outk, n_ink, n_outk.
<span class="lineNum">    3249 </span>            :   // Also populate H_inkf, H_outkf, n_inkf, n_outkf.
<span class="lineNum">    3250 </span>            :   // Also populate Gen_I, Vul_I and 
<span class="lineNum">    3251 </span>            :   // Conn_I (= Gen + Vul)
<span class="lineNum">    3252 </span>            :   // for each species.
<span class="lineNum">    3253 </span>            :   // Also calculate Conn_tot_I. To avoid double-counting, only count links for each species as a consumer.
<span class="lineNum">    3254 </span>            :   double dummy100 = 0.0;
<span class="lineNum">    3255 </span>            :   double dummy101 = 0.0;
<span class="lineNum">    3256 </span>            :   double dummy102 = 0.0;
<span class="lineNum">    3257 </span>            :   double dummy103 = 0.0;
<span class="lineNum">    3258 </span>            :   double dummy104 = 0.0;
<span class="lineNum">    3259 </span>            :   double dummy105 = 0.0;
<span class="lineNum">    3260 </span>            :   double sumGen = 0.0;
<span class="lineNum">    3261 </span>            :   double sumVul = 0.0;
<span class="lineNum">    3262 </span>            :   double sumConn = 0.0;
<span class="lineNum">    3263 </span>            :   double sumConntot = 0.0;
<span class="lineNum">    3264 </span>            :   double Conn_tot_I = 0.0;
<span class="lineNum">    3265 </span>            :   double sumpreyshared = 0.0;
<span class="lineNum">    3266 </span>            :   double sumpredshared = 0.0;
<span class="lineNum">    3267 </span>            :   double sumpreypred = 0.0;
<span class="lineNum">    3268 </span>            :   double dummy106 = 0.0;
<span class="lineNum">    3269 </span>            :   double dummy107 = 0.0;
<span class="lineNum">    3270 </span>            :   double dummy108 = 0.0;
<span class="lineNum">    3271 </span>            :   double dummy109 = 0.0;
<span class="lineNum">    3272 </span>            :   double sumGentot = 0.0;
<span class="lineNum">    3273 </span>            :   double sumGensquaredtot = 0.0;
<span class="lineNum">    3274 </span>            :   double sumVultot = 0.0;
<span class="lineNum">    3275 </span>            :   double sumVulsquaredtot = 0.0; 
<span class="lineNum">    3276 </span>            :   //double sumMaxTrophsim = 0.0;
<span class="lineNum">    3277 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3278 </span>            :     dummy102 = 0.0;
<span class="lineNum">    3279 </span>            :     dummy103 = 0.0;
<span class="lineNum">    3280 </span>            :     dummy104 = 0.0;
<span class="lineNum">    3281 </span>            :     dummy105 = 0.0;
<span class="lineNum">    3282 </span>            :     sumGen = 0;
<span class="lineNum">    3283 </span>            :     sumVul = 0;
<span class="lineNum">    3284 </span>            :     sumConn = 0;
<span class="lineNum">    3285 </span>            :     dummy109 = 0.0;
<span class="lineNum">    3286 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    3287 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3288 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3289 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjI[i]&gt;0)){</span>
<span class="lineNum">    3290 </span><span class="lineNoCov">          0 :         dummy102 = dummy102 - ((dummy101/b_dotjI[i])*</span>
<span class="lineNum">    3291 </span><span class="lineNoCov">          0 :                                (log10(dummy101/b_dotjI[i])/log10(2)));</span>
<span class="lineNum">    3292 </span>            :       }
<span class="lineNum">    3293 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotI[i]&gt;0)){</span>
<span class="lineNum">    3294 </span><span class="lineNoCov">          0 :         dummy103 = dummy103 - ((dummy100/b_idotI[i])*</span>
<span class="lineNum">    3295 </span><span class="lineNoCov">          0 :                                (log10(dummy100/b_idotI[i])/log10(2)));</span>
<span class="lineNum">    3296 </span>            :       }
<span class="lineNum">    3297 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjIf[i]&gt;0)){</span>
<span class="lineNum">    3298 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    3299 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    3300 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    3301 </span>            :         }
<span class="lineNum">    3302 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&gt;-3)){</span>
<span class="lineNum">    3303 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    3304 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    3305 </span>            :         }
<span class="lineNum">    3306 </span>            :       }
<span class="lineNum">    3307 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotIf[i]&gt;0)){</span>
<span class="lineNum">    3308 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    3309 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    3310 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    3311 </span>            :         }
<span class="lineNum">    3312 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&lt;=-3)){</span>
<span class="lineNum">    3313 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    3314 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    3315 </span>            :         }
<span class="lineNum">    3316 </span>            :       }  
<span class="lineNum">    3317 </span>            :       // Work out Gen, Vul and Conn.
<span class="lineNum">    3318 </span><span class="lineNoCov">          0 :       if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    3319 </span><span class="lineNoCov">          0 :         if((dummy101/b_dotjI[i])&gt;dietfractionthreshold){</span>
<span class="lineNum">    3320 </span><span class="lineNoCov">          0 :           sumGen = sumGen + 1;</span>
<span class="lineNum">    3321 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    3322 </span>            :         }
<span class="lineNum">    3323 </span>            :       }
<span class="lineNum">    3324 </span><span class="lineNoCov">          0 :       if(b_dotjI[j]&gt;0){</span>
<span class="lineNum">    3325 </span><span class="lineNoCov">          0 :         if((dummy100/b_dotjI[j])&gt;dietfractionthreshold){</span>
<span class="lineNum">    3326 </span><span class="lineNoCov">          0 :           sumVul = sumVul + 1;</span>
<span class="lineNum">    3327 </span><span class="lineNoCov">          0 :           sumConn = sumConn + 1;</span>
<span class="lineNum">    3328 </span>            :         }
<span class="lineNum">    3329 </span>            :       }
<span class="lineNum">    3330 </span>            :       // For species i and j, work out Npreyshared, Npredshared and Trophsim.
<span class="lineNum">    3331 </span>            :       // Only do this for pairs of fish species.
<span class="lineNum">    3332 </span><span class="lineNoCov">          0 :       if((log10(s[i].bodymass()/unit_mass)&gt;-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&gt;-3)){</span>
<span class="lineNum">    3333 </span>            :         sumpreyshared = 0.0;
<span class="lineNum">    3334 </span>            :         sumpredshared = 0.0;
<span class="lineNum">    3335 </span>            :         sumpreypred = 0.0;
<span class="lineNum">    3336 </span><span class="lineNoCov">          0 :         for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3337 </span><span class="lineNoCov">          0 :           dummy106 = intake(k,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3338 </span><span class="lineNoCov">          0 :           dummy107 = intake(k,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3339 </span><span class="lineNoCov">          0 :           dummy108 = 0.0;</span>
<span class="lineNum">    3340 </span><span class="lineNoCov">          0 :           if((b_dotjI[i]&gt;0)&amp;&amp;((dummy106/b_dotjI[i])&gt;dietfractionthreshold)&amp;&amp;(b_dotjI[j]&gt;0)&amp;&amp;((dummy107/b_dotjI[j])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3341 </span><span class="lineNoCov">          0 :             sumpreyshared = sumpreyshared + 1;</span>
<span class="lineNum">    3342 </span>            :           }
<span class="lineNum">    3343 </span><span class="lineNoCov">          0 :           if((b_dotjI[i]&gt;0)&amp;&amp;((dummy106/b_dotjI[i])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3344 </span><span class="lineNoCov">          0 :             dummy108 = 1;</span>
<span class="lineNum">    3345 </span>            :           }
<span class="lineNum">    3346 </span><span class="lineNoCov">          0 :           if((b_dotjI[j]&gt;0)&amp;&amp;((dummy107/b_dotjI[j])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3347 </span><span class="lineNoCov">          0 :             dummy108 = 1;</span>
<span class="lineNum">    3348 </span>            :           }
<span class="lineNum">    3349 </span><span class="lineNoCov">          0 :           if(dummy108==1){</span>
<span class="lineNum">    3350 </span><span class="lineNoCov">          0 :             sumpreypred = sumpreypred + 1;</span>
<span class="lineNum">    3351 </span>            :           }
<span class="lineNum">    3352 </span><span class="lineNoCov">          0 :           dummy106 = intake(i,k)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3353 </span><span class="lineNoCov">          0 :           dummy107 = intake(j,k)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3354 </span><span class="lineNoCov">          0 :           dummy108 = 0.0;</span>
<span class="lineNum">    3355 </span><span class="lineNoCov">          0 :           if((b_dotjI[k]&gt;0)&amp;&amp;((dummy106/b_dotjI[k])&gt;dietfractionthreshold)&amp;&amp;((dummy107/b_dotjI[k])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3356 </span><span class="lineNoCov">          0 :             sumpredshared = sumpredshared + 1;</span>
<span class="lineNum">    3357 </span>            :           }
<span class="lineNum">    3358 </span><span class="lineNoCov">          0 :           if((b_dotjI[k]&gt;0)&amp;&amp;((dummy106/b_dotjI[k])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3359 </span><span class="lineNoCov">          0 :             dummy108 = 1;</span>
<span class="lineNum">    3360 </span>            :           }
<span class="lineNum">    3361 </span><span class="lineNoCov">          0 :           if((b_dotjI[k]&gt;0)&amp;&amp;((dummy107/b_dotjI[k])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3362 </span><span class="lineNoCov">          0 :             dummy108 = 1;</span>
<span class="lineNum">    3363 </span>            :           }
<span class="lineNum">    3364 </span><span class="lineNoCov">          0 :           if(dummy108==1){</span>
<span class="lineNum">    3365 </span><span class="lineNoCov">          0 :             sumpreypred = sumpreypred + 1;</span>
<span class="lineNum">    3366 </span>            :           }
<span class="lineNum">    3367 </span>            :         }
<span class="lineNum">    3368 </span><span class="lineNoCov">          0 :         Npreyshared(i,j)=sumpreyshared;</span>
<span class="lineNum">    3369 </span><span class="lineNoCov">          0 :         Npredshared(i,j)=sumpredshared;</span>
<span class="lineNum">    3370 </span><span class="lineNoCov">          0 :         Trophsim(i,j)=(sumpreyshared+sumpredshared)/sumpreypred;</span>
<span class="lineNum">    3371 </span>            :         // Update max value of TrophSim if necessary.
<span class="lineNum">    3372 </span>            :         // Remember constraint that i is not equal to j (Williams and Martinez, 2000).
<span class="lineNum">    3373 </span><span class="lineNoCov">          0 :         if((Trophsim(i,j)&gt;dummy109)&amp;&amp;(i!=j)){</span>
<span class="lineNum">    3374 </span>            :           dummy109=Trophsim(i,j);
<span class="lineNum">    3375 </span>            :         }
<span class="lineNum">    3376 </span>            :       }
<span class="lineNum">    3377 </span>            :       // Update Linkornot matrix.
<span class="lineNum">    3378 </span><span class="lineNoCov">          0 :       if((b_dotjI[j]&gt;0)&amp;&amp;((dummy100/b_dotjI[j])&gt;dietfractionthreshold)&amp;&amp;(b_dotjI[i]&gt;0)&amp;&amp;((dummy101/b_dotjI[i])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3379 </span><span class="lineNoCov">          0 :         Linkornot(i,j)=2;</span>
<span class="lineNum">    3380 </span>            :       }else{
<span class="lineNum">    3381 </span><span class="lineNoCov">          0 :         if((b_dotjI[j]&gt;0)&amp;&amp;((dummy100/b_dotjI[j])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3382 </span><span class="lineNoCov">          0 :           Linkornot(i,j)=1;</span>
<span class="lineNum">    3383 </span>            :         }else{
<span class="lineNum">    3384 </span><span class="lineNoCov">          0 :           if((b_dotjI[i]&gt;0)&amp;&amp;((dummy101/b_dotjI[i])&gt;dietfractionthreshold)){</span>
<span class="lineNum">    3385 </span><span class="lineNoCov">          0 :             Linkornot(i,j)=1;</span>
<span class="lineNum">    3386 </span>            :           }else{
<span class="lineNum">    3387 </span><span class="lineNoCov">          0 :             Linkornot(i,j)=0;</span>
<span class="lineNum">    3388 </span>            :           }
<span class="lineNum">    3389 </span>            :         }
<span class="lineNum">    3390 </span>            :       }
<span class="lineNum">    3391 </span>            :       // If diagonal entry, set Linkornot to 0.
<span class="lineNum">    3392 </span><span class="lineNoCov">          0 :       if(i==j){</span>
<span class="lineNum">    3393 </span><span class="lineNoCov">          0 :         Linkornot(i,j)=0;</span>
<span class="lineNum">    3394 </span>            :       }
<span class="lineNum">    3395 </span>            :       // End loop for j.
<span class="lineNum">    3396 </span>            :     }
<span class="lineNum">    3397 </span><span class="lineNoCov">          0 :     H_ink[i] = dummy102;</span>
<span class="lineNum">    3398 </span><span class="lineNoCov">          0 :     H_outk[i] = dummy103;</span>
<span class="lineNum">    3399 </span><span class="lineNoCov">          0 :     if(b_idotI[i]&gt;0){</span>
<span class="lineNum">    3400 </span><span class="lineNoCov">          0 :       n_outk[i] = pow(2,H_outk[i]);</span>
<span class="lineNum">    3401 </span>            :     }else{
<span class="lineNum">    3402 </span><span class="lineNoCov">          0 :       n_outk[i] = 0;</span>
<span class="lineNum">    3403 </span>            :     }
<span class="lineNum">    3404 </span><span class="lineNoCov">          0 :     if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    3405 </span><span class="lineNoCov">          0 :       n_ink[i] = pow(2,H_ink[i]);</span>
<span class="lineNum">    3406 </span>            :     }else{
<span class="lineNum">    3407 </span><span class="lineNoCov">          0 :       n_ink[i] = 0;</span>
<span class="lineNum">    3408 </span>            :     }
<span class="lineNum">    3409 </span><span class="lineNoCov">          0 :     H_inkf[i] = dummy104;</span>
<span class="lineNum">    3410 </span><span class="lineNoCov">          0 :     H_outkf[i] = dummy105;</span>
<span class="lineNum">    3411 </span><span class="lineNoCov">          0 :     if(b_idotIf[i]&gt;0){</span>
<span class="lineNum">    3412 </span><span class="lineNoCov">          0 :       n_outkf[i] = pow(2,H_outkf[i]);</span>
<span class="lineNum">    3413 </span>            :     }else{
<span class="lineNum">    3414 </span><span class="lineNoCov">          0 :       n_outkf[i] = 0;</span>
<span class="lineNum">    3415 </span>            :     }
<span class="lineNum">    3416 </span><span class="lineNoCov">          0 :     if(b_dotjIf[i]&gt;0){</span>
<span class="lineNum">    3417 </span><span class="lineNoCov">          0 :       n_inkf[i] = pow(2,H_inkf[i]);</span>
<span class="lineNum">    3418 </span>            :     }else{
<span class="lineNum">    3419 </span><span class="lineNoCov">          0 :       n_inkf[i] = 0;</span>
<span class="lineNum">    3420 </span>            :     }
<span class="lineNum">    3421 </span><span class="lineNoCov">          0 :     Gen_I[i] = sumGen;</span>
<span class="lineNum">    3422 </span><span class="lineNoCov">          0 :     Vul_I[i] = sumVul;</span>
<span class="lineNum">    3423 </span><span class="lineNoCov">          0 :     Conn_I[i] = sumConn;</span>
<span class="lineNum">    3424 </span><span class="lineNoCov">          0 :     Conn_tot_I = Conn_tot_I + sumGen;</span>
<span class="lineNum">    3425 </span>            :     //MaxTrophsim[i] = dummy109;
<span class="lineNum">    3426 </span><span class="lineNoCov">          0 :     sumGentot = sumGentot + sumGen;</span>
<span class="lineNum">    3427 </span><span class="lineNoCov">          0 :     sumGensquaredtot = sumGensquaredtot + (sumGen*sumGen);</span>
<span class="lineNum">    3428 </span><span class="lineNoCov">          0 :     sumVultot = sumVultot + sumVul;</span>
<span class="lineNum">    3429 </span><span class="lineNoCov">          0 :     sumVulsquaredtot = sumVulsquaredtot + (sumVul*sumVul);</span>
<span class="lineNum">    3430 </span>            :     //sumMaxTrophsim = sumMaxTrophsim + dummy109;
<span class="lineNum">    3431 </span>            :     // End loop for i.
<span class="lineNum">    3432 </span>            :   }
<span class="lineNum">    3433 </span>            :   // Work out Conn and topological LD and C for whole web.
<span class="lineNum">    3434 </span>            :   // Also work out topological mean standardised Gen, s.d. standardised Gen, 
<span class="lineNum">    3435 </span>            :   // mean standardised Vul and s.d. standardised Vul for whole web.
<span class="lineNum">    3436 </span>            :   // Print these values out.
<span class="lineNum">    3437 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Conn_tot_I = &quot; &lt;&lt; Conn_tot_I &lt;&lt; endl;</span>
<span class="lineNum">    3438 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LD_tot_I = &quot; &lt;&lt; Conn_tot_I/S &lt;&lt; endl;</span>
<span class="lineNum">    3439 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;C_tot_I = &quot; &lt;&lt; Conn_tot_I/(S*S) &lt;&lt; endl;</span>
<span class="lineNum">    3440 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Mean_stand_Gen_I = &quot; &lt;&lt; sumGentot/Conn_tot_I &lt;&lt; endl;</span>
<span class="lineNum">    3441 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sd_stand_Gen_I = &quot; &lt;&lt; ((sumGensquaredtot)*(S/(Conn_tot_I*Conn_tot_I)))-((sumGentot/Conn_tot_I)*(sumGentot/Conn_tot_I)) &lt;&lt; endl;</span>
<span class="lineNum">    3442 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Mean_stand_Vul_I = &quot; &lt;&lt; sumVultot/Conn_tot_I &lt;&lt; endl;</span>
<span class="lineNum">    3443 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sd_stand_Vul_I = &quot; &lt;&lt; ((sumVulsquaredtot)*(S/(Conn_tot_I*Conn_tot_I)))-((sumVultot/Conn_tot_I)*(sumVultot/Conn_tot_I)) &lt;&lt; endl;</span>
<span class="lineNum">    3444 </span>            :   //cout &lt;&lt; &quot;Mean_MaxTrophsim = &quot; &lt;&lt; sumMaxTrophsim/S &lt;&lt; endl;
<span class="lineNum">    3445 </span>            :   // Work out entries for matrix for whether there is a path between two species of length 2,3,4,...,10, using diet threshold of 0.01.
<span class="lineNum">    3446 </span>            :   // Only calculate for entries in column corresponding to assigned_column for deleted species.
<span class="lineNum">    3447 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot2=intake;</span>
<span class="lineNum">    3448 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot3=intake;</span>
<span class="lineNum">    3449 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot4=intake;</span>
<span class="lineNum">    3450 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot5=intake;</span>
<span class="lineNum">    3451 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot6=intake;</span>
<span class="lineNum">    3452 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot7=intake;</span>
<span class="lineNum">    3453 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot8=intake;</span>
<span class="lineNum">    3454 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot9=intake;</span>
<span class="lineNum">    3455 </span><span class="lineNoCov">          0 :   link_strength_matrix Linkornot10=intake;</span>
<span class="lineNum">    3456 </span>            :   // First find index corresponding to assigned_column of deleted species.
<span class="lineNum">    3457 </span><span class="lineNoCov">          0 :   int indexdelS = -1;</span>
<span class="lineNum">    3458 </span>            :   //cout &lt;&lt; &quot;colno = &quot; &lt;&lt; colno &lt;&lt; endl;
<span class="lineNum">    3459 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3460 </span><span class="lineNoCov">          0 :     if(assigned_column(i)==colno){</span>
<span class="lineNum">    3461 </span><span class="lineNoCov">          0 :       indexdelS=i;</span>
<span class="lineNum">    3462 </span>            :     }
<span class="lineNum">    3463 </span>            :   }
<span class="lineNum">    3464 </span>            :   //cout &lt;&lt; &quot;indexdelS = &quot; &lt;&lt; indexdelS &lt;&lt; endl;
<span class="lineNum">    3465 </span>            : 
<span class="lineNum">    3466 </span>            :   double sumMatentry=0.0;
<span class="lineNum">    3467 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3468 </span>            :     //cout &lt;&lt; i &lt;&lt; endl;
<span class="lineNum">    3469 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3470 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3471 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot(k,indexdelS));</span>
<span class="lineNum">    3472 </span>            :     }
<span class="lineNum">    3473 </span><span class="lineNoCov">          0 :     Linkornot2(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3474 </span>            :     //cout &lt;&lt; &quot;Linkornot2(i,indexdelS) = &quot; &lt;&lt; Linkornot2(i,indexdelS) &lt;&lt; endl;
<span class="lineNum">    3475 </span>            :   }
<span class="lineNum">    3476 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3477 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3478 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3479 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot2(k,indexdelS));</span>
<span class="lineNum">    3480 </span>            :     }
<span class="lineNum">    3481 </span><span class="lineNoCov">          0 :     Linkornot3(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3482 </span>            :   }
<span class="lineNum">    3483 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3484 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3485 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3486 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot3(k,indexdelS));</span>
<span class="lineNum">    3487 </span>            :     }
<span class="lineNum">    3488 </span><span class="lineNoCov">          0 :     Linkornot4(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3489 </span>            :   }
<span class="lineNum">    3490 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3491 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3492 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3493 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot4(k,indexdelS));</span>
<span class="lineNum">    3494 </span>            :     }
<span class="lineNum">    3495 </span><span class="lineNoCov">          0 :     Linkornot5(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3496 </span>            :   }
<span class="lineNum">    3497 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3498 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3499 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3500 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot5(k,indexdelS));</span>
<span class="lineNum">    3501 </span>            :     }
<span class="lineNum">    3502 </span><span class="lineNoCov">          0 :     Linkornot6(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3503 </span>            :   }
<span class="lineNum">    3504 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3505 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3506 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3507 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot6(k,indexdelS));</span>
<span class="lineNum">    3508 </span>            :     }
<span class="lineNum">    3509 </span><span class="lineNoCov">          0 :     Linkornot7(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3510 </span>            :   }
<span class="lineNum">    3511 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3512 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3513 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3514 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot7(k,indexdelS));</span>
<span class="lineNum">    3515 </span>            :     }
<span class="lineNum">    3516 </span><span class="lineNoCov">          0 :     Linkornot8(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3517 </span>            :   }
<span class="lineNum">    3518 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3519 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3520 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3521 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot8(k,indexdelS));</span>
<span class="lineNum">    3522 </span>            :     }
<span class="lineNum">    3523 </span><span class="lineNoCov">          0 :     Linkornot9(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3524 </span>            :   }
<span class="lineNum">    3525 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3526 </span>            :     sumMatentry=0.0;
<span class="lineNum">    3527 </span><span class="lineNoCov">          0 :     for(int k=0;k&lt;S;k++){</span>
<span class="lineNum">    3528 </span><span class="lineNoCov">          0 :       sumMatentry=sumMatentry+(Linkornot(i,k)*Linkornot9(k,indexdelS));</span>
<span class="lineNum">    3529 </span>            :     }
<span class="lineNum">    3530 </span><span class="lineNoCov">          0 :     Linkornot10(i,indexdelS)=sumMatentry;</span>
<span class="lineNum">    3531 </span>            :   }
<span class="lineNum">    3532 </span>            :   // Work out minimum path length between two species, using diet threshold of 0.01. 11 represents &gt;=11.
<span class="lineNum">    3533 </span>            :   // Only calculate for entries in column corresponding to assigned_column for deleted species.
<span class="lineNum">    3534 </span>            :   // For diagonal entries, Minpathlength set to 0.
<span class="lineNum">    3535 </span><span class="lineNoCov">          0 :   link_strength_matrix Minpathlength=intake;</span>
<span class="lineNum">    3536 </span><span class="lineNoCov">          0 :   int Minpathlenghentry=0;</span>
<span class="lineNum">    3537 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3538 </span><span class="lineNoCov">          0 :     Minpathlenghentry=0;</span>
<span class="lineNum">    3539 </span><span class="lineNoCov">          0 :     if(Linkornot(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3540 </span>            :       if(Minpathlenghentry==0){
<span class="lineNum">    3541 </span><span class="lineNoCov">          0 :         Minpathlenghentry=1;</span>
<span class="lineNum">    3542 </span>            :       }
<span class="lineNum">    3543 </span>            :     }
<span class="lineNum">    3544 </span><span class="lineNoCov">          0 :     if(Linkornot2(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3545 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3546 </span><span class="lineNoCov">          0 :         Minpathlenghentry=2;</span>
<span class="lineNum">    3547 </span>            :       }
<span class="lineNum">    3548 </span>            :     }
<span class="lineNum">    3549 </span><span class="lineNoCov">          0 :     if(Linkornot3(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3550 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3551 </span><span class="lineNoCov">          0 :         Minpathlenghentry=3;</span>
<span class="lineNum">    3552 </span>            :       }
<span class="lineNum">    3553 </span>            :     }
<span class="lineNum">    3554 </span><span class="lineNoCov">          0 :     if(Linkornot4(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3555 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3556 </span><span class="lineNoCov">          0 :         Minpathlenghentry=4;</span>
<span class="lineNum">    3557 </span>            :       }
<span class="lineNum">    3558 </span>            :     }
<span class="lineNum">    3559 </span><span class="lineNoCov">          0 :     if(Linkornot5(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3560 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3561 </span><span class="lineNoCov">          0 :         Minpathlenghentry=5;</span>
<span class="lineNum">    3562 </span>            :       }
<span class="lineNum">    3563 </span>            :     }
<span class="lineNum">    3564 </span><span class="lineNoCov">          0 :     if(Linkornot6(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3565 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3566 </span><span class="lineNoCov">          0 :         Minpathlenghentry=6;</span>
<span class="lineNum">    3567 </span>            :       }
<span class="lineNum">    3568 </span>            :     }
<span class="lineNum">    3569 </span><span class="lineNoCov">          0 :     if(Linkornot7(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3570 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3571 </span><span class="lineNoCov">          0 :         Minpathlenghentry=7;</span>
<span class="lineNum">    3572 </span>            :       }
<span class="lineNum">    3573 </span>            :     }
<span class="lineNum">    3574 </span><span class="lineNoCov">          0 :     if(Linkornot8(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3575 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3576 </span><span class="lineNoCov">          0 :         Minpathlenghentry=8;</span>
<span class="lineNum">    3577 </span>            :       }
<span class="lineNum">    3578 </span>            :     }
<span class="lineNum">    3579 </span><span class="lineNoCov">          0 :     if(Linkornot9(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3580 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3581 </span><span class="lineNoCov">          0 :         Minpathlenghentry=9;</span>
<span class="lineNum">    3582 </span>            :       }
<span class="lineNum">    3583 </span>            :     }
<span class="lineNum">    3584 </span><span class="lineNoCov">          0 :     if(Linkornot10(i,indexdelS)&gt;0){</span>
<span class="lineNum">    3585 </span><span class="lineNoCov">          0 :       if(Minpathlenghentry==0){</span>
<span class="lineNum">    3586 </span><span class="lineNoCov">          0 :         Minpathlenghentry=10;</span>
<span class="lineNum">    3587 </span>            :       }
<span class="lineNum">    3588 </span>            :     }   
<span class="lineNum">    3589 </span><span class="lineNoCov">          0 :     if((Minpathlenghentry==0)&amp;&amp;(i!=indexdelS)){</span>
<span class="lineNum">    3590 </span><span class="lineNoCov">          0 :       Minpathlenghentry=11;</span>
<span class="lineNum">    3591 </span>            :     }
<span class="lineNum">    3592 </span><span class="lineNoCov">          0 :     if(i==indexdelS){</span>
<span class="lineNum">    3593 </span><span class="lineNoCov">          0 :       Minpathlenghentry=0;</span>
<span class="lineNum">    3594 </span>            :     }
<span class="lineNum">    3595 </span><span class="lineNoCov">          0 :     Minpathlength(i,indexdelS)=Minpathlenghentry;</span>
<span class="lineNum">    3596 </span>            :   }
<span class="lineNum">    3597 </span>            :   //cout &lt;&lt; &quot;Minpathlength(indexdelS,indexdelS) = &quot; &lt;&lt; Minpathlength(indexdelS,indexdelS) &lt;&lt; endl;
<span class="lineNum">    3598 </span>            : 
<span class="lineNum">    3599 </span>            :   // Work out TLs
<span class="lineNum">    3600 </span><span class="lineNoCov">          0 :   NewVector level;</span>
<span class="lineNum">    3601 </span><span class="lineNoCov">          0 :   NewMatrix dietF;</span>
<span class="lineNum">    3602 </span><span class="lineNoCov">          0 :   dietF=ifrac;</span>
<span class="lineNum">    3603 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    3604 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3605 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    3606 </span>            :   }
<span class="lineNum">    3607 </span><span class="lineNoCov">          0 :   level=ones;</span>
<span class="lineNum">    3608 </span><span class="lineNoCov">          0 :   NewVector level2;</span>
<span class="lineNum">    3609 </span><span class="lineNoCov">          0 :   NewVector leveldiff;</span>
<span class="lineNum">    3610 </span><span class="lineNoCov">          0 :   double dummycounter = 0;</span>
<span class="lineNum">    3611 </span><span class="lineNoCov">          0 :   double dummydiff = 0;</span>
<span class="lineNum">    3612 </span>            :   do{
<span class="lineNum">    3613 </span><span class="lineNoCov">          0 :     level2=level;</span>
<span class="lineNum">    3614 </span><span class="lineNoCov">          0 :     level=prod(dietF,level)+ones;</span>
<span class="lineNum">    3615 </span><span class="lineNoCov">          0 :     leveldiff=level-level2;</span>
<span class="lineNum">    3616 </span><span class="lineNoCov">          0 :     dummydiff=NewVectorAbs(leveldiff);</span>
<span class="lineNum">    3617 </span><span class="lineNoCov">          0 :     dummycounter=dummycounter+1;</span>
<span class="lineNum">    3618 </span>            :     //cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;
<span class="lineNum">    3619 </span>            :     //cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;
<span class="lineNum">    3620 </span><span class="lineNoCov">          0 :   }while(dummydiff&gt;=0.0001);</span>
<span class="lineNum">    3621 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummycounter = &quot; &lt;&lt; dummycounter &lt;&lt; endl;</span>
<span class="lineNum">    3622 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;dummydiff = &quot; &lt;&lt; dummydiff &lt;&lt; endl;</span>
<span class="lineNum">    3623 </span>            : 
<span class="lineNum">    3624 </span>            :   // Calculate indicators involving TL.
<span class="lineNum">    3625 </span><span class="lineNoCov">          0 :   double dummy1 = 0.0;</span>
<span class="lineNum">    3626 </span><span class="lineNoCov">          0 :   int dummy2 = 0;</span>
<span class="lineNum">    3627 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; rho_TL;</span>
<span class="lineNum">    3628 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;45;i++){</span>
<span class="lineNum">    3629 </span><span class="lineNoCov">          0 :     rho_TL[i]=0;</span>
<span class="lineNum">    3630 </span>            :   }
<span class="lineNum">    3631 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3632 </span><span class="lineNoCov">          0 :     dummy1 = (level[i] - 1)/0.1;</span>
<span class="lineNum">    3633 </span>            :     //cout &lt;&lt; &quot;dummy1 = &quot; &lt;&lt; dummy1 &lt;&lt; endl;
<span class="lineNum">    3634 </span><span class="lineNoCov">          0 :     dummy2 = floor(dummy1);</span>
<span class="lineNum">    3635 </span>            :     //cout &lt;&lt; &quot;dummy2 = &quot; &lt;&lt; dummy2 &lt;&lt; endl;
<span class="lineNum">    3636 </span><span class="lineNoCov">          0 :     rho_TL[dummy2] += biomass_B(i)/unit_mass/area;</span>
<span class="lineNum">    3637 </span>            :   }
<span class="lineNum">    3638 </span>            :   //for(int i=0;i&lt;45;i++){
<span class="lineNum">    3639 </span>            :   //cout &lt;&lt; &quot;rho_TL[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; rho_TL[i] &lt;&lt; endl;
<span class="lineNum">    3640 </span>            :   //}
<span class="lineNum">    3641 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1_1point1_TL = &quot; &lt;&lt; rho_TL[0] &lt;&lt; endl;</span>
<span class="lineNum">    3642 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point1_1point2_TL = &quot; &lt;&lt; rho_TL[1] &lt;&lt; endl;</span>
<span class="lineNum">    3643 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point2_1point3_TL = &quot; &lt;&lt; rho_TL[2] &lt;&lt; endl;</span>
<span class="lineNum">    3644 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point3_1point4_TL = &quot; &lt;&lt; rho_TL[3] &lt;&lt; endl;</span>
<span class="lineNum">    3645 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point4_1point5_TL = &quot; &lt;&lt; rho_TL[4] &lt;&lt; endl;</span>
<span class="lineNum">    3646 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point5_1point6_TL = &quot; &lt;&lt; rho_TL[5] &lt;&lt; endl;</span>
<span class="lineNum">    3647 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point6_1point7_TL = &quot; &lt;&lt; rho_TL[6] &lt;&lt; endl;</span>
<span class="lineNum">    3648 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point7_1point8_TL = &quot; &lt;&lt; rho_TL[7] &lt;&lt; endl;</span>
<span class="lineNum">    3649 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point8_1point9_TL = &quot; &lt;&lt; rho_TL[8] &lt;&lt; endl;</span>
<span class="lineNum">    3650 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point9_2_TL = &quot; &lt;&lt; rho_TL[9] &lt;&lt; endl;</span>
<span class="lineNum">    3651 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2_2point1_TL = &quot; &lt;&lt; rho_TL[10] &lt;&lt; endl;</span>
<span class="lineNum">    3652 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point1_2point2_TL = &quot; &lt;&lt; rho_TL[11] &lt;&lt; endl;</span>
<span class="lineNum">    3653 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point2_2point3_TL = &quot; &lt;&lt; rho_TL[12] &lt;&lt; endl;</span>
<span class="lineNum">    3654 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point3_2point4_TL = &quot; &lt;&lt; rho_TL[13] &lt;&lt; endl;</span>
<span class="lineNum">    3655 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point4_2point5_TL = &quot; &lt;&lt; rho_TL[14] &lt;&lt; endl;</span>
<span class="lineNum">    3656 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point5_2point6_TL = &quot; &lt;&lt; rho_TL[15] &lt;&lt; endl;</span>
<span class="lineNum">    3657 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point6_2point7_TL = &quot; &lt;&lt; rho_TL[16] &lt;&lt; endl;</span>
<span class="lineNum">    3658 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point7_2point8_TL = &quot; &lt;&lt; rho_TL[17] &lt;&lt; endl;</span>
<span class="lineNum">    3659 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point8_2point9_TL = &quot; &lt;&lt; rho_TL[18] &lt;&lt; endl;</span>
<span class="lineNum">    3660 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point9_3_TL = &quot; &lt;&lt; rho_TL[19] &lt;&lt; endl;</span>
<span class="lineNum">    3661 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3_3point1_TL = &quot; &lt;&lt; rho_TL[20] &lt;&lt; endl;</span>
<span class="lineNum">    3662 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point1_3point2_TL = &quot; &lt;&lt; rho_TL[21] &lt;&lt; endl;</span>
<span class="lineNum">    3663 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point2_3point3_TL = &quot; &lt;&lt; rho_TL[22] &lt;&lt; endl;</span>
<span class="lineNum">    3664 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point3_3point4_TL = &quot; &lt;&lt; rho_TL[23] &lt;&lt; endl;</span>
<span class="lineNum">    3665 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point4_3point5_TL = &quot; &lt;&lt; rho_TL[24] &lt;&lt; endl;</span>
<span class="lineNum">    3666 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point5_3point6_TL = &quot; &lt;&lt; rho_TL[25] &lt;&lt; endl;</span>
<span class="lineNum">    3667 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point6_3point7_TL = &quot; &lt;&lt; rho_TL[26] &lt;&lt; endl;</span>
<span class="lineNum">    3668 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point7_3point8_TL = &quot; &lt;&lt; rho_TL[27] &lt;&lt; endl;</span>
<span class="lineNum">    3669 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point8_3point9_TL = &quot; &lt;&lt; rho_TL[28] &lt;&lt; endl;</span>
<span class="lineNum">    3670 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_3point9_4_TL = &quot; &lt;&lt; rho_TL[29] &lt;&lt; endl;</span>
<span class="lineNum">    3671 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4_4point1_TL = &quot; &lt;&lt; rho_TL[30] &lt;&lt; endl;</span>
<span class="lineNum">    3672 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point1_4point2_TL = &quot; &lt;&lt; rho_TL[31] &lt;&lt; endl;</span>
<span class="lineNum">    3673 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point2_4point3_TL = &quot; &lt;&lt; rho_TL[32] &lt;&lt; endl;</span>
<span class="lineNum">    3674 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point3_4point4_TL = &quot; &lt;&lt; rho_TL[33] &lt;&lt; endl;</span>
<span class="lineNum">    3675 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point4_4point5_TL = &quot; &lt;&lt; rho_TL[34] &lt;&lt; endl;</span>
<span class="lineNum">    3676 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point5_4point6_TL = &quot; &lt;&lt; rho_TL[35] &lt;&lt; endl;</span>
<span class="lineNum">    3677 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point6_4point7_TL = &quot; &lt;&lt; rho_TL[36] &lt;&lt; endl;</span>
<span class="lineNum">    3678 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point7_4point8_TL = &quot; &lt;&lt; rho_TL[37] &lt;&lt; endl;</span>
<span class="lineNum">    3679 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point8_4point9_TL = &quot; &lt;&lt; rho_TL[38] &lt;&lt; endl;</span>
<span class="lineNum">    3680 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_4point9_5_TL = &quot; &lt;&lt; rho_TL[39] &lt;&lt; endl;</span>
<span class="lineNum">    3681 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_5_5point1_TL = &quot; &lt;&lt; rho_TL[40] &lt;&lt; endl;</span>
<span class="lineNum">    3682 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_5point1_5point2_TL = &quot; &lt;&lt; rho_TL[41] &lt;&lt; endl;</span>
<span class="lineNum">    3683 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_5point2_5point3_TL = &quot; &lt;&lt; rho_TL[42] &lt;&lt; endl;</span>
<span class="lineNum">    3684 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_5point3_5point4_TL = &quot; &lt;&lt; rho_TL[43] &lt;&lt; endl;</span>
<span class="lineNum">    3685 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_5point4_5point5_TL = &quot; &lt;&lt; rho_TL[44] &lt;&lt; endl;</span>
<span class="lineNum">    3686 </span>            : 
<span class="lineNum">    3687 </span>            :   // Flows from organisms of lower or equal TL to those of higher TL
<span class="lineNum">    3688 </span>            :   // Flows from organisms of higher TL to those of lower or equal TL
<span class="lineNum">    3689 </span>            :   // Then work out b_xTL.
<span class="lineNum">    3690 </span><span class="lineNoCov">          0 :   double S_c = number_of_animals();</span>
<span class="lineNum">    3691 </span><span class="lineNoCov">          0 :   double S_f = 0.0;</span>
<span class="lineNum">    3692 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_lowtohigh_TL;</span>
<span class="lineNum">    3693 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_lowtohigh_TL_Mcorrected;</span>
<span class="lineNum">    3694 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_hightolow_TL;</span>
<span class="lineNum">    3695 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_hightolow_TL_Mcorrected;</span>
<span class="lineNum">    3696 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;36;i++){</span>
<span class="lineNum">    3697 </span><span class="lineNoCov">          0 :     b_lowtohigh_TL[i]=0;</span>
<span class="lineNum">    3698 </span><span class="lineNoCov">          0 :     b_lowtohigh_TL_Mcorrected[i]=0;</span>
<span class="lineNum">    3699 </span><span class="lineNoCov">          0 :     b_hightolow_TL[i]=0;</span>
<span class="lineNum">    3700 </span><span class="lineNoCov">          0 :     b_hightolow_TL_Mcorrected[i]=0;</span>
<span class="lineNum">    3701 </span>            :   }
<span class="lineNum">    3702 </span>            :   resolog10M = 0.0;
<span class="lineNum">    3703 </span>            :   conslog10M = 0.0;
<span class="lineNum">    3704 </span>            :   //sequence&lt;double&gt; b_dotjI;
<span class="lineNum">    3705 </span>            :   //sequence&lt;double&gt; b_dotjIf;
<span class="lineNum">    3706 </span>            :   b_dotdotI = 0.0;
<span class="lineNum">    3707 </span>            :   b_dotdotIf = 0.0;
<span class="lineNum">    3708 </span>            :   double resoTL = 0.0;
<span class="lineNum">    3709 </span>            :   double consTL = 0.0;
<span class="lineNum">    3710 </span>            :   dummy4 = 0.0;
<span class="lineNum">    3711 </span>            :   dummy6 = 0.0;
<span class="lineNum">    3712 </span>            :   dummy7 = 0.0;
<span class="lineNum">    3713 </span>            :   
<span class="lineNum">    3714 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    3715 </span>            :     
<span class="lineNum">    3716 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    3717 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    3718 </span><span class="lineNoCov">          0 :     resoTL = level[i];</span>
<span class="lineNum">    3719 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    3720 </span><span class="lineNoCov">          0 :     dummy6 = 0;     </span>
<span class="lineNum">    3721 </span>            :     
<span class="lineNum">    3722 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    3723 </span>            :       
<span class="lineNum">    3724 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];       </span>
<span class="lineNum">    3725 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    3726 </span><span class="lineNoCov">          0 :       consTL = level[j];</span>
<span class="lineNum">    3727 </span>            :       // Update sums for calculation of flows for species
<span class="lineNum">    3728 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3729 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3730 </span><span class="lineNoCov">          0 :       if(resolog10M &gt; -3){</span>
<span class="lineNum">    3731 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3732 </span>            :       }
<span class="lineNum">    3733 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){</span>
<span class="lineNum">    3734 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3735 </span>            :       }
<span class="lineNum">    3736 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &lt;= -3)){</span>
<span class="lineNum">    3737 </span><span class="lineNoCov">          0 :         dummy7 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3738 </span>            :       }
<span class="lineNum">    3739 </span>            :       
<span class="lineNum">    3740 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 1.9)&amp;&amp;(consTL &gt; 1.9)){</span>
<span class="lineNum">    3741 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[0] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3742 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3743 </span>            :       }
<span class="lineNum">    3744 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2)&amp;&amp;(consTL &gt; 2)){</span>
<span class="lineNum">    3745 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[1] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3746 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3747 </span>            :       }
<span class="lineNum">    3748 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.1)&amp;&amp;(consTL &gt; 2.1)){</span>
<span class="lineNum">    3749 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[2] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3750 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3751 </span>            :       }
<span class="lineNum">    3752 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.2)&amp;&amp;(consTL &gt; 2.2)){</span>
<span class="lineNum">    3753 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[3] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3754 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3755 </span>            :       }
<span class="lineNum">    3756 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.3)&amp;&amp;(consTL &gt; 2.3)){</span>
<span class="lineNum">    3757 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[4] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3758 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3759 </span>            :       }
<span class="lineNum">    3760 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.4)&amp;&amp;(consTL &gt; 2.4)){</span>
<span class="lineNum">    3761 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[5] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3762 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3763 </span>            :       }
<span class="lineNum">    3764 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.5)&amp;&amp;(consTL &gt; 2.5)){</span>
<span class="lineNum">    3765 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[6] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3766 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3767 </span>            :       }
<span class="lineNum">    3768 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.6)&amp;&amp;(consTL &gt; 2.6)){</span>
<span class="lineNum">    3769 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[7] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3770 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3771 </span>            :       }
<span class="lineNum">    3772 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.7)&amp;&amp;(consTL &gt; 2.7)){</span>
<span class="lineNum">    3773 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[8] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3774 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3775 </span>            :       }
<span class="lineNum">    3776 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.8)&amp;&amp;(consTL &gt; 2.8)){</span>
<span class="lineNum">    3777 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[9] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3778 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3779 </span>            :       }
<span class="lineNum">    3780 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 2.9)&amp;&amp;(consTL &gt; 2.9)){</span>
<span class="lineNum">    3781 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[10] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3782 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3783 </span>            :       }
<span class="lineNum">    3784 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3)&amp;&amp;(consTL &gt; 3)){</span>
<span class="lineNum">    3785 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[11] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3786 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3787 </span>            :       }
<span class="lineNum">    3788 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.1)&amp;&amp;(consTL &gt; 3.1)){</span>
<span class="lineNum">    3789 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[12] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3790 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3791 </span>            :       }
<span class="lineNum">    3792 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.2)&amp;&amp;(consTL &gt; 3.2)){</span>
<span class="lineNum">    3793 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[13] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3794 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3795 </span>            :       }
<span class="lineNum">    3796 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.3)&amp;&amp;(consTL &gt; 3.3)){</span>
<span class="lineNum">    3797 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[14] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3798 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3799 </span>            :       }
<span class="lineNum">    3800 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.4)&amp;&amp;(consTL &gt; 3.4)){</span>
<span class="lineNum">    3801 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[15] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3802 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3803 </span>            :       }
<span class="lineNum">    3804 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.5)&amp;&amp;(consTL &gt; 3.5)){</span>
<span class="lineNum">    3805 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[16] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3806 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3807 </span>            :       }
<span class="lineNum">    3808 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.6)&amp;&amp;(consTL &gt; 3.6)){</span>
<span class="lineNum">    3809 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[17] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3810 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3811 </span>            :       }
<span class="lineNum">    3812 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.7)&amp;&amp;(consTL &gt; 3.7)){</span>
<span class="lineNum">    3813 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[18] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3814 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3815 </span>            :       }
<span class="lineNum">    3816 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.8)&amp;&amp;(consTL &gt; 3.8)){</span>
<span class="lineNum">    3817 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[19] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3818 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3819 </span>            :       }
<span class="lineNum">    3820 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 3.9)&amp;&amp;(consTL &gt; 3.9)){</span>
<span class="lineNum">    3821 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[20] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3822 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3823 </span>            :       }
<span class="lineNum">    3824 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4)&amp;&amp;(consTL &gt; 4)){</span>
<span class="lineNum">    3825 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[21] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3826 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3827 </span>            :       }
<span class="lineNum">    3828 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.1)&amp;&amp;(consTL &gt; 4.1)){</span>
<span class="lineNum">    3829 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[22] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3830 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3831 </span>            :       }
<span class="lineNum">    3832 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.2)&amp;&amp;(consTL &gt; 4.2)){</span>
<span class="lineNum">    3833 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[23] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3834 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3835 </span>            :       }
<span class="lineNum">    3836 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.3)&amp;&amp;(consTL &gt; 4.3)){</span>
<span class="lineNum">    3837 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[24] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3838 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3839 </span>            :       }
<span class="lineNum">    3840 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.4)&amp;&amp;(consTL &gt; 4.4)){</span>
<span class="lineNum">    3841 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[25] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3842 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3843 </span>            :       }
<span class="lineNum">    3844 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.5)&amp;&amp;(consTL &gt; 4.5)){</span>
<span class="lineNum">    3845 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[26] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3846 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3847 </span>            :       }
<span class="lineNum">    3848 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.6)&amp;&amp;(consTL &gt; 4.6)){</span>
<span class="lineNum">    3849 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[27] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3850 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3851 </span>            :       }
<span class="lineNum">    3852 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.7)&amp;&amp;(consTL &gt; 4.7)){</span>
<span class="lineNum">    3853 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[28] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3854 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3855 </span>            :       }
<span class="lineNum">    3856 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.8)&amp;&amp;(consTL &gt; 4.8)){</span>
<span class="lineNum">    3857 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[29] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3858 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3859 </span>            :       }
<span class="lineNum">    3860 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 4.9)&amp;&amp;(consTL &gt; 4.9)){</span>
<span class="lineNum">    3861 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[30] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3862 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3863 </span>            :       }
<span class="lineNum">    3864 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 5)&amp;&amp;(consTL &gt; 5)){</span>
<span class="lineNum">    3865 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[31] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3866 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3867 </span>            :       }
<span class="lineNum">    3868 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 5.1)&amp;&amp;(consTL &gt; 5.1)){</span>
<span class="lineNum">    3869 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[32] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3870 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3871 </span>            :       }
<span class="lineNum">    3872 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 5.2)&amp;&amp;(consTL &gt; 5.2)){</span>
<span class="lineNum">    3873 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[33] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3874 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3875 </span>            :       }
<span class="lineNum">    3876 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 5.3)&amp;&amp;(consTL &gt; 5.3)){</span>
<span class="lineNum">    3877 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[34] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3878 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3879 </span>            :       }
<span class="lineNum">    3880 </span><span class="lineNoCov">          0 :       if((resoTL &lt;= 5.4)&amp;&amp;(consTL &gt; 5.4)){</span>
<span class="lineNum">    3881 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL[35] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3882 </span><span class="lineNoCov">          0 :         b_lowtohigh_TL_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3883 </span>            :       }
<span class="lineNum">    3884 </span>            :       
<span class="lineNum">    3885 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 1.9)&amp;&amp;(consTL &lt;= 1.9)){</span>
<span class="lineNum">    3886 </span><span class="lineNoCov">          0 :         b_hightolow_TL[0] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3887 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3888 </span>            :       }
<span class="lineNum">    3889 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2)&amp;&amp;(consTL &lt;= 2)){</span>
<span class="lineNum">    3890 </span><span class="lineNoCov">          0 :         b_hightolow_TL[1] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3891 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3892 </span>            :       }
<span class="lineNum">    3893 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.1)&amp;&amp;(consTL &lt;= 2.1)){</span>
<span class="lineNum">    3894 </span><span class="lineNoCov">          0 :         b_hightolow_TL[2] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3895 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3896 </span>            :       }
<span class="lineNum">    3897 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.2)&amp;&amp;(consTL &lt;= 2.2)){</span>
<span class="lineNum">    3898 </span><span class="lineNoCov">          0 :         b_hightolow_TL[3] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3899 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3900 </span>            :       }
<span class="lineNum">    3901 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.3)&amp;&amp;(consTL &lt;= 2.3)){</span>
<span class="lineNum">    3902 </span><span class="lineNoCov">          0 :         b_hightolow_TL[4] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3903 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3904 </span>            :       }
<span class="lineNum">    3905 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.4)&amp;&amp;(consTL &lt;= 2.4)){</span>
<span class="lineNum">    3906 </span><span class="lineNoCov">          0 :         b_hightolow_TL[5] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3907 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3908 </span>            :       }
<span class="lineNum">    3909 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.5)&amp;&amp;(consTL &lt;= 2.5)){</span>
<span class="lineNum">    3910 </span><span class="lineNoCov">          0 :         b_hightolow_TL[6] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3911 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3912 </span>            :       }
<span class="lineNum">    3913 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.6)&amp;&amp;(consTL &lt;= 2.6)){</span>
<span class="lineNum">    3914 </span><span class="lineNoCov">          0 :         b_hightolow_TL[7] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3915 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3916 </span>            :       }
<span class="lineNum">    3917 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.7)&amp;&amp;(consTL &lt;= 2.7)){</span>
<span class="lineNum">    3918 </span><span class="lineNoCov">          0 :         b_hightolow_TL[8] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3919 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3920 </span>            :       }
<span class="lineNum">    3921 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.8)&amp;&amp;(consTL &lt;= 2.8)){</span>
<span class="lineNum">    3922 </span><span class="lineNoCov">          0 :         b_hightolow_TL[9] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3923 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3924 </span>            :       }
<span class="lineNum">    3925 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 2.9)&amp;&amp;(consTL &lt;= 2.9)){</span>
<span class="lineNum">    3926 </span><span class="lineNoCov">          0 :         b_hightolow_TL[10] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3927 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3928 </span>            :       }
<span class="lineNum">    3929 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3)&amp;&amp;(consTL &lt;= 3)){</span>
<span class="lineNum">    3930 </span><span class="lineNoCov">          0 :         b_hightolow_TL[11] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3931 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3932 </span>            :       }
<span class="lineNum">    3933 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.1)&amp;&amp;(consTL &lt;= 3.1)){</span>
<span class="lineNum">    3934 </span><span class="lineNoCov">          0 :         b_hightolow_TL[12] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3935 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3936 </span>            :       }
<span class="lineNum">    3937 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.2)&amp;&amp;(consTL &lt;= 3.2)){</span>
<span class="lineNum">    3938 </span><span class="lineNoCov">          0 :         b_hightolow_TL[13] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3939 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3940 </span>            :       }
<span class="lineNum">    3941 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.3)&amp;&amp;(consTL &lt;= 3.3)){</span>
<span class="lineNum">    3942 </span><span class="lineNoCov">          0 :         b_hightolow_TL[14] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3943 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3944 </span>            :       }
<span class="lineNum">    3945 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.4)&amp;&amp;(consTL &lt;= 3.4)){</span>
<span class="lineNum">    3946 </span><span class="lineNoCov">          0 :         b_hightolow_TL[15] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3947 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3948 </span>            :       }
<span class="lineNum">    3949 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.5)&amp;&amp;(consTL &lt;= 3.5)){</span>
<span class="lineNum">    3950 </span><span class="lineNoCov">          0 :         b_hightolow_TL[16] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3951 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3952 </span>            :       }
<span class="lineNum">    3953 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.6)&amp;&amp;(consTL &lt;= 3.6)){</span>
<span class="lineNum">    3954 </span><span class="lineNoCov">          0 :         b_hightolow_TL[17] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3955 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3956 </span>            :       }
<span class="lineNum">    3957 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.7)&amp;&amp;(consTL &lt;= 3.7)){</span>
<span class="lineNum">    3958 </span><span class="lineNoCov">          0 :         b_hightolow_TL[18] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3959 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3960 </span>            :       }
<span class="lineNum">    3961 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.8)&amp;&amp;(consTL &lt;= 3.8)){</span>
<span class="lineNum">    3962 </span><span class="lineNoCov">          0 :         b_hightolow_TL[19] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3963 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3964 </span>            :       }
<span class="lineNum">    3965 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 3.9)&amp;&amp;(consTL &lt;= 3.9)){</span>
<span class="lineNum">    3966 </span><span class="lineNoCov">          0 :         b_hightolow_TL[20] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3967 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3968 </span>            :       }
<span class="lineNum">    3969 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4)&amp;&amp;(consTL &lt;= 4)){</span>
<span class="lineNum">    3970 </span><span class="lineNoCov">          0 :         b_hightolow_TL[21] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3971 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3972 </span>            :       }
<span class="lineNum">    3973 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.1)&amp;&amp;(consTL &lt;= 4.1)){</span>
<span class="lineNum">    3974 </span><span class="lineNoCov">          0 :         b_hightolow_TL[22] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3975 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3976 </span>            :       }
<span class="lineNum">    3977 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.2)&amp;&amp;(consTL &lt;= 4.2)){</span>
<span class="lineNum">    3978 </span><span class="lineNoCov">          0 :         b_hightolow_TL[23] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3979 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3980 </span>            :       }
<span class="lineNum">    3981 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.3)&amp;&amp;(consTL &lt;= 4.3)){</span>
<span class="lineNum">    3982 </span><span class="lineNoCov">          0 :         b_hightolow_TL[24] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3983 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3984 </span>            :       }
<span class="lineNum">    3985 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.4)&amp;&amp;(consTL &lt;= 4.4)){</span>
<span class="lineNum">    3986 </span><span class="lineNoCov">          0 :         b_hightolow_TL[25] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3987 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3988 </span>            :       }
<span class="lineNum">    3989 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.5)&amp;&amp;(consTL &lt;= 4.5)){</span>
<span class="lineNum">    3990 </span><span class="lineNoCov">          0 :         b_hightolow_TL[26] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3991 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3992 </span>            :       }
<span class="lineNum">    3993 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.6)&amp;&amp;(consTL &lt;= 4.6)){</span>
<span class="lineNum">    3994 </span><span class="lineNoCov">          0 :         b_hightolow_TL[27] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3995 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    3996 </span>            :       }
<span class="lineNum">    3997 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.7)&amp;&amp;(consTL &lt;= 4.7)){</span>
<span class="lineNum">    3998 </span><span class="lineNoCov">          0 :         b_hightolow_TL[28] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    3999 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4000 </span>            :       }
<span class="lineNum">    4001 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.8)&amp;&amp;(consTL &lt;= 4.8)){</span>
<span class="lineNum">    4002 </span><span class="lineNoCov">          0 :         b_hightolow_TL[29] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4003 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4004 </span>            :       }
<span class="lineNum">    4005 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 4.9)&amp;&amp;(consTL &lt;= 4.9)){</span>
<span class="lineNum">    4006 </span><span class="lineNoCov">          0 :         b_hightolow_TL[30] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4007 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4008 </span>            :       }
<span class="lineNum">    4009 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 5)&amp;&amp;(consTL &lt;= 5)){</span>
<span class="lineNum">    4010 </span><span class="lineNoCov">          0 :         b_hightolow_TL[31] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4011 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4012 </span>            :       }
<span class="lineNum">    4013 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 5.1)&amp;&amp;(consTL &lt;= 5.1)){</span>
<span class="lineNum">    4014 </span><span class="lineNoCov">          0 :         b_hightolow_TL[32] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4015 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4016 </span>            :       }
<span class="lineNum">    4017 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 5.2)&amp;&amp;(consTL &lt;= 5.2)){</span>
<span class="lineNum">    4018 </span><span class="lineNoCov">          0 :         b_hightolow_TL[33] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4019 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4020 </span>            :       }
<span class="lineNum">    4021 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 5.3)&amp;&amp;(consTL &lt;= 5.3)){</span>
<span class="lineNum">    4022 </span><span class="lineNoCov">          0 :         b_hightolow_TL[34] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4023 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4024 </span>            :       }
<span class="lineNum">    4025 </span><span class="lineNoCov">          0 :       if((resoTL &gt; 5.4)&amp;&amp;(consTL &lt;= 5.4)){</span>
<span class="lineNum">    4026 </span><span class="lineNoCov">          0 :         b_hightolow_TL[35] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4027 </span><span class="lineNoCov">          0 :         b_hightolow_TL_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    4028 </span>            :       }
<span class="lineNum">    4029 </span>            :       
<span class="lineNum">    4030 </span>            :       // close loop for j
<span class="lineNum">    4031 </span>            :     }
<span class="lineNum">    4032 </span>            :     
<span class="lineNum">    4033 </span>            :     // Update vectors of flows for species
<span class="lineNum">    4034 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    4035 </span><span class="lineNoCov">          0 :     b_dotjIf[i] = dummy6;</span>
<span class="lineNum">    4036 </span>            :     
<span class="lineNum">    4037 </span>            :     // Update species richness
<span class="lineNum">    4038 </span><span class="lineNoCov">          0 :     if(resolog10M &gt; -3){</span>
<span class="lineNum">    4039 </span><span class="lineNoCov">          0 :       S_f += 1;</span>
<span class="lineNum">    4040 </span>            :     }
<span class="lineNum">    4041 </span>            :       
<span class="lineNum">    4042 </span>            :     // close loop for i 
<span class="lineNum">    4043 </span>            :   }
<span class="lineNum">    4044 </span>            : 
<span class="lineNum">    4045 </span><span class="lineNoCov">          0 :   b_dotdotIf = b_dotdotI - dummy7;</span>
<span class="lineNum">    4046 </span>            : 
<span class="lineNum">    4047 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[0]-b_hightolow_TL[0] &lt;&lt; endl;</span>
<span class="lineNum">    4048 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2_TL = &quot; &lt;&lt; b_lowtohigh_TL[1]-b_hightolow_TL[1] &lt;&lt; endl;</span>
<span class="lineNum">    4049 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[2]-b_hightolow_TL[2] &lt;&lt; endl;</span>
<span class="lineNum">    4050 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[3]-b_hightolow_TL[3] &lt;&lt; endl;</span>
<span class="lineNum">    4051 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[4]-b_hightolow_TL[4] &lt;&lt; endl;</span>
<span class="lineNum">    4052 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[5]-b_hightolow_TL[5] &lt;&lt; endl;</span>
<span class="lineNum">    4053 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[6]-b_hightolow_TL[6] &lt;&lt; endl;</span>
<span class="lineNum">    4054 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[7]-b_hightolow_TL[7] &lt;&lt; endl;</span>
<span class="lineNum">    4055 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[8]-b_hightolow_TL[8] &lt;&lt; endl;</span>
<span class="lineNum">    4056 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[9]-b_hightolow_TL[9] &lt;&lt; endl;</span>
<span class="lineNum">    4057 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[10]-b_hightolow_TL[10] &lt;&lt; endl;</span>
<span class="lineNum">    4058 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3_TL = &quot; &lt;&lt; b_lowtohigh_TL[11]-b_hightolow_TL[11] &lt;&lt; endl;</span>
<span class="lineNum">    4059 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[12]-b_hightolow_TL[12] &lt;&lt; endl;</span>
<span class="lineNum">    4060 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[13]-b_hightolow_TL[13] &lt;&lt; endl;</span>
<span class="lineNum">    4061 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[14]-b_hightolow_TL[14] &lt;&lt; endl;</span>
<span class="lineNum">    4062 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[15]-b_hightolow_TL[15] &lt;&lt; endl;</span>
<span class="lineNum">    4063 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[16]-b_hightolow_TL[16] &lt;&lt; endl;</span>
<span class="lineNum">    4064 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[17]-b_hightolow_TL[17] &lt;&lt; endl;</span>
<span class="lineNum">    4065 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[18]-b_hightolow_TL[18] &lt;&lt; endl;</span>
<span class="lineNum">    4066 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[19]-b_hightolow_TL[19] &lt;&lt; endl;</span>
<span class="lineNum">    4067 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[20]-b_hightolow_TL[20] &lt;&lt; endl;</span>
<span class="lineNum">    4068 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4_TL = &quot; &lt;&lt; b_lowtohigh_TL[21]-b_hightolow_TL[21] &lt;&lt; endl;</span>
<span class="lineNum">    4069 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[22]-b_hightolow_TL[22] &lt;&lt; endl;</span>
<span class="lineNum">    4070 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[23]-b_hightolow_TL[23] &lt;&lt; endl;</span>
<span class="lineNum">    4071 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[24]-b_hightolow_TL[24] &lt;&lt; endl;</span>
<span class="lineNum">    4072 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[25]-b_hightolow_TL[25] &lt;&lt; endl;</span>
<span class="lineNum">    4073 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[26]-b_hightolow_TL[26] &lt;&lt; endl;</span>
<span class="lineNum">    4074 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[27]-b_hightolow_TL[27] &lt;&lt; endl;</span>
<span class="lineNum">    4075 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[28]-b_hightolow_TL[28] &lt;&lt; endl;</span>
<span class="lineNum">    4076 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[29]-b_hightolow_TL[29] &lt;&lt; endl;</span>
<span class="lineNum">    4077 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[30]-b_hightolow_TL[30] &lt;&lt; endl;</span>
<span class="lineNum">    4078 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5_TL = &quot; &lt;&lt; b_lowtohigh_TL[31]-b_hightolow_TL[31] &lt;&lt; endl;</span>
<span class="lineNum">    4079 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[32]-b_hightolow_TL[32] &lt;&lt; endl;</span>
<span class="lineNum">    4080 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[33]-b_hightolow_TL[33] &lt;&lt; endl;</span>
<span class="lineNum">    4081 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[34]-b_hightolow_TL[34] &lt;&lt; endl;</span>
<span class="lineNum">    4082 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[35]-b_hightolow_TL[35] &lt;&lt; endl;</span>
<span class="lineNum">    4083 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[0]-b_hightolow_TL_Mcorrected[0] &lt;&lt; endl;</span>
<span class="lineNum">    4084 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[1]-b_hightolow_TL_Mcorrected[1] &lt;&lt; endl;</span>
<span class="lineNum">    4085 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[2]-b_hightolow_TL_Mcorrected[2] &lt;&lt; endl;</span>
<span class="lineNum">    4086 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[3]-b_hightolow_TL_Mcorrected[3] &lt;&lt; endl;</span>
<span class="lineNum">    4087 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[4]-b_hightolow_TL_Mcorrected[4] &lt;&lt; endl;</span>
<span class="lineNum">    4088 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[5]-b_hightolow_TL_Mcorrected[5] &lt;&lt; endl;</span>
<span class="lineNum">    4089 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[6]-b_hightolow_TL_Mcorrected[6] &lt;&lt; endl;</span>
<span class="lineNum">    4090 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[7]-b_hightolow_TL_Mcorrected[7] &lt;&lt; endl;</span>
<span class="lineNum">    4091 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[8]-b_hightolow_TL_Mcorrected[8] &lt;&lt; endl;</span>
<span class="lineNum">    4092 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[9]-b_hightolow_TL_Mcorrected[9] &lt;&lt; endl;</span>
<span class="lineNum">    4093 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[10]-b_hightolow_TL_Mcorrected[10] &lt;&lt; endl;</span>
<span class="lineNum">    4094 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[11]-b_hightolow_TL_Mcorrected[11] &lt;&lt; endl;</span>
<span class="lineNum">    4095 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[12]-b_hightolow_TL_Mcorrected[12] &lt;&lt; endl;</span>
<span class="lineNum">    4096 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[13]-b_hightolow_TL_Mcorrected[13] &lt;&lt; endl;</span>
<span class="lineNum">    4097 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[14]-b_hightolow_TL_Mcorrected[14] &lt;&lt; endl;</span>
<span class="lineNum">    4098 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[15]-b_hightolow_TL_Mcorrected[15] &lt;&lt; endl;</span>
<span class="lineNum">    4099 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[16]-b_hightolow_TL_Mcorrected[16] &lt;&lt; endl;</span>
<span class="lineNum">    4100 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[17]-b_hightolow_TL_Mcorrected[17] &lt;&lt; endl;</span>
<span class="lineNum">    4101 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[18]-b_hightolow_TL_Mcorrected[18] &lt;&lt; endl;</span>
<span class="lineNum">    4102 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[19]-b_hightolow_TL_Mcorrected[19] &lt;&lt; endl;</span>
<span class="lineNum">    4103 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_3point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[20]-b_hightolow_TL_Mcorrected[20] &lt;&lt; endl;</span>
<span class="lineNum">    4104 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[21]-b_hightolow_TL_Mcorrected[21] &lt;&lt; endl;</span>
<span class="lineNum">    4105 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[22]-b_hightolow_TL_Mcorrected[22] &lt;&lt; endl;</span>
<span class="lineNum">    4106 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[23]-b_hightolow_TL_Mcorrected[23] &lt;&lt; endl;</span>
<span class="lineNum">    4107 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[24]-b_hightolow_TL_Mcorrected[24] &lt;&lt; endl;</span>
<span class="lineNum">    4108 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[25]-b_hightolow_TL_Mcorrected[25] &lt;&lt; endl;</span>
<span class="lineNum">    4109 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[26]-b_hightolow_TL_Mcorrected[26] &lt;&lt; endl;</span>
<span class="lineNum">    4110 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[27]-b_hightolow_TL_Mcorrected[27] &lt;&lt; endl;</span>
<span class="lineNum">    4111 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[28]-b_hightolow_TL_Mcorrected[28] &lt;&lt; endl;</span>
<span class="lineNum">    4112 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[29]-b_hightolow_TL_Mcorrected[29] &lt;&lt; endl;</span>
<span class="lineNum">    4113 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_4point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[30]-b_hightolow_TL_Mcorrected[30] &lt;&lt; endl;</span>
<span class="lineNum">    4114 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[31]-b_hightolow_TL_Mcorrected[31] &lt;&lt; endl;</span>
<span class="lineNum">    4115 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[32]-b_hightolow_TL_Mcorrected[32] &lt;&lt; endl;</span>
<span class="lineNum">    4116 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[33]-b_hightolow_TL_Mcorrected[33] &lt;&lt; endl;</span>
<span class="lineNum">    4117 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[34]-b_hightolow_TL_Mcorrected[34] &lt;&lt; endl;</span>
<span class="lineNum">    4118 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_5point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[35]-b_hightolow_TL_Mcorrected[35] &lt;&lt; endl;</span>
<span class="lineNum">    4119 </span>            :   
<span class="lineNum">    4120 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; omn_j;</span>
<span class="lineNum">    4121 </span><span class="lineNoCov">          0 :   dummy100 = 0.0;</span>
<span class="lineNum">    4122 </span><span class="lineNoCov">          0 :   dummy101 = 0.0;</span>
<span class="lineNum">    4123 </span><span class="lineNoCov">          0 :   double dummy110 = 0.0;</span>
<span class="lineNum">    4124 </span><span class="lineNoCov">          0 :   double dummy111 = 0.0;</span>
<span class="lineNum">    4125 </span><span class="lineNoCov">          0 :   double dummy112 = 0.0;</span>
<span class="lineNum">    4126 </span><span class="lineNoCov">          0 :   double dummy113 = 0.0;</span>
<span class="lineNum">    4127 </span><span class="lineNoCov">          0 :   double dummy114 = 0.0;</span>
<span class="lineNum">    4128 </span><span class="lineNoCov">          0 :   double dummy115 = 0.0;</span>
<span class="lineNum">    4129 </span>            : 
<span class="lineNum">    4130 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4131 </span>            :     
<span class="lineNum">    4132 </span>            :     // Reset sums for vectors
<span class="lineNum">    4133 </span>            :     dummy110 = 0;
<span class="lineNum">    4134 </span>            :     
<span class="lineNum">    4135 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4136 </span>            :       
<span class="lineNum">    4137 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4138 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4139 </span>            :       
<span class="lineNum">    4140 </span><span class="lineNoCov">          0 :       if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    4141 </span><span class="lineNoCov">          0 :         dummy110 += (dummy101/b_dotjI[i])*pow(level[j]-level[i],2);</span>
<span class="lineNum">    4142 </span>            :       }
<span class="lineNum">    4143 </span>            :       
<span class="lineNum">    4144 </span><span class="lineNoCov">          0 :       if((level[i]&gt;=1.5)&amp;&amp;(level[i]&lt;2.5)&amp;&amp;(level[j]&gt;=2.5)&amp;&amp;(level[j]&lt;3.5)){</span>
<span class="lineNum">    4145 </span>            :         dummy113 += dummy100;
<span class="lineNum">    4146 </span>            :       }
<span class="lineNum">    4147 </span><span class="lineNoCov">          0 :       if((level[i]&gt;=2.5)&amp;&amp;(level[i]&lt;3.5)&amp;&amp;(level[j]&gt;=3.5)&amp;&amp;(level[j]&lt;4.5)){</span>
<span class="lineNum">    4148 </span>            :         dummy114 += dummy100;
<span class="lineNum">    4149 </span>            :       }
<span class="lineNum">    4150 </span><span class="lineNoCov">          0 :       if((level[i]&gt;=3.5)&amp;&amp;(level[i]&lt;4.5)&amp;&amp;(level[j]&gt;=4.5)&amp;&amp;(level[j]&lt;5.5)){</span>
<span class="lineNum">    4151 </span>            :         dummy115 += dummy100;
<span class="lineNum">    4152 </span>            :       }
<span class="lineNum">    4153 </span>            :       
<span class="lineNum">    4154 </span>            :       // end loop for j
<span class="lineNum">    4155 </span>            :     }
<span class="lineNum">    4156 </span>            :     
<span class="lineNum">    4157 </span><span class="lineNoCov">          0 :     omn_j[i] = sqrt(dummy110);</span>
<span class="lineNum">    4158 </span>            :     
<span class="lineNum">    4159 </span><span class="lineNoCov">          0 :     if(level[i]==1){ dummy112 += (s[i].the_GP)/unit_mass/area/(1/year); } </span>
<span class="lineNum">    4160 </span>            :     
<span class="lineNum">    4161 </span>            :     // end loop for i
<span class="lineNum">    4162 </span>            :   }
<span class="lineNum">    4163 </span>            : 
<span class="lineNum">    4164 </span>            :   double omn_prime = 0.0;
<span class="lineNum">    4165 </span>            :   double omn = 0.0;
<span class="lineNum">    4166 </span>            :   double omn_f_prime = 0.0;
<span class="lineNum">    4167 </span>            :   double omn_f = 0.0;
<span class="lineNum">    4168 </span>            :   double epsilon_3 = 0.0;
<span class="lineNum">    4169 </span>            :   double epsilon_4 = 0.0;
<span class="lineNum">    4170 </span>            :   double epsilon_5 = 0.0;
<span class="lineNum">    4171 </span>            :   double dummy204 = 0.0;
<span class="lineNum">    4172 </span>            :   double dummy205 = 0.0;
<span class="lineNum">    4173 </span>            :   double dummy206 = 0.0;
<span class="lineNum">    4174 </span>            :   double dummy207 = 0.0;
<span class="lineNum">    4175 </span>            :   double dummy208 = 0.0;    
<span class="lineNum">    4176 </span>            :   
<span class="lineNum">    4177 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4178 </span><span class="lineNoCov">          0 :     if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4179 </span><span class="lineNoCov">          0 :       dummy208 += b_dotjI[i];</span>
<span class="lineNum">    4180 </span>            :     }
<span class="lineNum">    4181 </span>            :   }
<span class="lineNum">    4182 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4183 </span><span class="lineNoCov">          0 :     dummy204 += omn_j[i];</span>
<span class="lineNum">    4184 </span><span class="lineNoCov">          0 :     dummy205 += (b_dotjI[i]/b_dotdotI)*omn_j[i];</span>
<span class="lineNum">    4185 </span><span class="lineNoCov">          0 :     if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4186 </span><span class="lineNoCov">          0 :       dummy206 += omn_j[i];</span>
<span class="lineNum">    4187 </span><span class="lineNoCov">          0 :       dummy207 += (b_dotjI[i]/dummy208)*omn_j[i];</span>
<span class="lineNum">    4188 </span>            :     }
<span class="lineNum">    4189 </span>            :   }
<span class="lineNum">    4190 </span>            :   // It has been checked that dividing by S gives decimal
<span class="lineNum">    4191 </span><span class="lineNoCov">          0 :   omn_prime = dummy204/S_c;</span>
<span class="lineNum">    4192 </span><span class="lineNoCov">          0 :   omn = dummy205;</span>
<span class="lineNum">    4193 </span><span class="lineNoCov">          0 :   omn_f_prime = dummy206/S_f;</span>
<span class="lineNum">    4194 </span><span class="lineNoCov">          0 :   omn_f = dummy207;</span>
<span class="lineNum">    4195 </span><span class="lineNoCov">          0 :   epsilon_3 = dummy113/dummy112;</span>
<span class="lineNum">    4196 </span><span class="lineNoCov">          0 :   epsilon_4 = dummy114/dummy113;</span>
<span class="lineNum">    4197 </span><span class="lineNoCov">          0 :   epsilon_5 = dummy115/dummy114;</span>
<span class="lineNum">    4198 </span>            :   
<span class="lineNum">    4199 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;omn_prime = &quot; &lt;&lt; omn_prime &lt;&lt; endl;</span>
<span class="lineNum">    4200 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;omn = &quot; &lt;&lt; omn &lt;&lt; endl;</span>
<span class="lineNum">    4201 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;omn_f_prime = &quot; &lt;&lt; omn_f_prime &lt;&lt; endl;</span>
<span class="lineNum">    4202 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;omn_f = &quot; &lt;&lt; omn_f &lt;&lt; endl;</span>
<span class="lineNum">    4203 </span>            : 
<span class="lineNum">    4204 </span>            :   
<span class="lineNum">    4205 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4206 </span><span class="lineNoCov">          0 :     std::ostringstream os;</span>
<span class="lineNum">    4207 </span><span class="lineNoCov">          0 :     double prod = 0.0;</span>
<span class="lineNum">    4208 </span><span class="lineNoCov">          0 :     double pred = 0.0;</span>
<span class="lineNum">    4209 </span><span class="lineNoCov">          0 :     double comp = 0.0;</span>
<span class="lineNum">    4210 </span><span class="lineNoCov">          0 :     int counter1 = 0;</span>
<span class="lineNum">    4211 </span><span class="lineNoCov">          0 :     int counter2 = 0;</span>
<span class="lineNum">    4212 </span><span class="lineNoCov">          0 :     int counter3 = 0;</span>
<span class="lineNum">    4213 </span><span class="lineNoCov">          0 :     int counter4 = 0;</span>
<span class="lineNum">    4214 </span>            :     //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4215 </span><span class="lineNoCov">          0 :     os.precision(7);</span>
<span class="lineNum">    4216 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];     </span>
<span class="lineNum">    4217 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4218 </span><span class="lineNoCov">          0 :       if(with_plants || !sp.is_a_plant()){</span>
<span class="lineNum">    4219 </span><span class="lineNoCov">          0 :         os.width(1);</span>
<span class="lineNum">    4220 </span><span class="lineNoCov">          0 :         os &lt;&lt; assigned_column(n) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4221 </span><span class="lineNoCov">          0 :         for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4222 </span><span class="lineNoCov">          0 :           NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4223 </span><span class="lineNoCov">          0 :           prod += 0.6*(intake(i,n)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4224 </span><span class="lineNoCov">          0 :           pred += intake(n,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4225 </span><span class="lineNoCov">          0 :           if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4226 </span>            :             double comp1 = 0.0;
<span class="lineNum">    4227 </span>            :             double comp2 = 0.0;
<span class="lineNum">    4228 </span>            :             double comp3 = 0.0;
<span class="lineNum">    4229 </span><span class="lineNoCov">          0 :             for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4230 </span><span class="lineNoCov">          0 :               comp1 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4231 </span><span class="lineNoCov">          0 :               comp2 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,n)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4232 </span><span class="lineNoCov">          0 :               comp3 += (intake(j,i)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4233 </span>            :               // End loop for j.
<span class="lineNum">    4234 </span>            :             }
<span class="lineNum">    4235 </span><span class="lineNoCov">          0 :             comp += comp1/(sqrt(comp2*comp3));</span>
<span class="lineNum">    4236 </span>            :           }
<span class="lineNum">    4237 </span>            :           // End loop for i.
<span class="lineNum">    4238 </span>            :         }
<span class="lineNum">    4239 </span>            :         // Work out mean of competition coefficients
<span class="lineNum">    4240 </span><span class="lineNoCov">          0 :         comp = comp/Sfish;</span>
<span class="lineNum">    4241 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4242 </span><span class="lineNoCov">          0 :         os &lt;&lt; prod &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4243 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4244 </span><span class="lineNoCov">          0 :         os &lt;&lt; pred &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4245 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4246 </span><span class="lineNoCov">          0 :         os &lt;&lt; comp &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4247 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4248 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_ink[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4249 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4250 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_outk[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4251 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4252 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_dotjI[n]/b_dotdotI)*n_ink[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4253 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4254 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_idotI[n]/b_dotdotI)*n_outk[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4255 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4256 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_inkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4257 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4258 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_outkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4259 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4260 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_dotjIf[n]/b_dotdotIf)*n_inkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4261 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4262 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_idotIf[n]/b_dotdotIf)*n_outkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4263 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4264 </span><span class="lineNoCov">          0 :         os &lt;&lt; Gen_I[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4265 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4266 </span><span class="lineNoCov">          0 :         os &lt;&lt; Vul_I[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4267 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4268 </span><span class="lineNoCov">          0 :         os &lt;&lt; Conn_I[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4269 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4270 </span><span class="lineNoCov">          0 :         os &lt;&lt; MaxTrophsim[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4271 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4272 </span><span class="lineNoCov">          0 :         os &lt;&lt; Minpathlength(n,indexdelS) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4273 </span><span class="lineNoCov">          0 :         additional_data[n]=os.str();</span>
<span class="lineNum">    4274 </span>            :       }
<span class="lineNum">    4275 </span>            :     }
<span class="lineNum">    4276 </span>            :   }
<span class="lineNum">    4277 </span><span class="lineNoCov">          0 :   snap.species_table2(filename,with_plants,th,</span>
<span class="lineNum">    4278 </span><span class="lineNoCov">          0 :                      additional_headings,additional_data);</span>
<span class="lineNum">    4279 </span>            : 
<span class="lineNum">    4280 </span>            :   // Work out matrix of consumption terms for fish species.
<span class="lineNum">    4281 </span>            :   // Each row gives, for each fish species, consumption on
<span class="lineNum">    4282 </span>            :   // other fish species in order of increasing body mass.
<span class="lineNum">    4283 </span><span class="lineNoCov">          0 :   std::ofstream os(&quot;consum_matrix.dat&quot;);</span>
<span class="lineNum">    4284 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4285 </span><span class="lineNoCov">          0 :   os.precision(7);</span>
<span class="lineNum">    4286 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4287 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4288 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4289 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_consum;</span>
<span class="lineNum">    4290 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4291 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4292 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4293 </span><span class="lineNoCov">          0 :           bodymass_consum.push_back(make_pair(sp2.bodymass(),intake(i,n)/unit_mass/area/(1/year)));</span>
<span class="lineNum">    4294 </span>            :         }
<span class="lineNum">    4295 </span>            :       }
<span class="lineNum">    4296 </span><span class="lineNoCov">          0 :       sort(bodymass_consum.begin(),bodymass_consum.end());</span>
<span class="lineNum">    4297 </span><span class="lineNoCov">          0 :       os &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4298 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_consum.size();i++){</span>
<span class="lineNum">    4299 </span>            :         //cout &lt;&lt; bodymass_consum.at(i).first &lt;&lt; endl;
<span class="lineNum">    4300 </span><span class="lineNoCov">          0 :         os &lt;&lt; &quot; &quot; &lt;&lt; bodymass_consum.at(i).second;</span>
<span class="lineNum">    4301 </span>            :       }
<span class="lineNum">    4302 </span><span class="lineNoCov">          0 :       os &lt;&lt; endl;</span>
<span class="lineNum">    4303 </span>            :     }
<span class="lineNum">    4304 </span>            :   }
<span class="lineNum">    4305 </span>            : 
<span class="lineNum">    4306 </span>            :   // Work out matrix of diet overlaps for fish species.
<span class="lineNum">    4307 </span>            :   // Each row gives, for each fish species, diet overlap
<span class="lineNum">    4308 </span>            :   // with other fish species in order of increasing body mass.
<span class="lineNum">    4309 </span><span class="lineNoCov">          0 :   std::ofstream os2(&quot;dietoverlap_matrix.dat&quot;);</span>
<span class="lineNum">    4310 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4311 </span><span class="lineNoCov">          0 :   os2.precision(7);</span>
<span class="lineNum">    4312 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4313 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4314 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4315 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_dietoverlap;</span>
<span class="lineNum">    4316 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4317 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4318 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4319 </span>            :           double comp1 = 0.0;
<span class="lineNum">    4320 </span>            :           double comp2 = 0.0;
<span class="lineNum">    4321 </span>            :           double comp3 = 0.0;
<span class="lineNum">    4322 </span>            :           double comp = 0.0;
<span class="lineNum">    4323 </span><span class="lineNoCov">          0 :           for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4324 </span><span class="lineNoCov">          0 :             comp1 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4325 </span><span class="lineNoCov">          0 :             comp2 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,n)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4326 </span><span class="lineNoCov">          0 :             comp3 += (intake(j,i)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4327 </span>            :           }
<span class="lineNum">    4328 </span><span class="lineNoCov">          0 :           comp = comp1/(sqrt(comp2*comp3));</span>
<span class="lineNum">    4329 </span><span class="lineNoCov">          0 :           bodymass_dietoverlap.push_back(make_pair(sp2.bodymass(),comp));</span>
<span class="lineNum">    4330 </span>            :         }
<span class="lineNum">    4331 </span>            :       }
<span class="lineNum">    4332 </span><span class="lineNoCov">          0 :       sort(bodymass_dietoverlap.begin(),bodymass_dietoverlap.end());</span>
<span class="lineNum">    4333 </span><span class="lineNoCov">          0 :       os2 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4334 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_dietoverlap.size();i++){</span>
<span class="lineNum">    4335 </span>            :         //cout &lt;&lt; bodymass_dietoverlap.at(i).first &lt;&lt; endl;
<span class="lineNum">    4336 </span><span class="lineNoCov">          0 :         os2 &lt;&lt; &quot; &quot; &lt;&lt; bodymass_dietoverlap.at(i).second;</span>
<span class="lineNum">    4337 </span>            :       }
<span class="lineNum">    4338 </span><span class="lineNoCov">          0 :       os2 &lt;&lt; endl;</span>
<span class="lineNum">    4339 </span>            :     }
<span class="lineNum">    4340 </span>            :   }
<span class="lineNum">    4341 </span>            : 
<span class="lineNum">    4342 </span>            :   // Work out matrix of c coefficient overlaps for fish species.
<span class="lineNum">    4343 </span>            :   // Each row gives, for each fish species, c coefficient overlap
<span class="lineNum">    4344 </span>            :   // with other fish species in order of increasing body mass.
<span class="lineNum">    4345 </span><span class="lineNoCov">          0 :   std::ofstream os3(&quot;ccoeffoverlap_matrix.dat&quot;);</span>
<span class="lineNum">    4346 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4347 </span><span class="lineNoCov">          0 :   os3.precision(7);</span>
<span class="lineNum">    4348 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4349 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4350 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4351 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_ccoeffoverlap;</span>
<span class="lineNum">    4352 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4353 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4354 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4355 </span>            :           double ccoeff1 = 0.0;
<span class="lineNum">    4356 </span>            :           double ccoeff2 = 0.0;
<span class="lineNum">    4357 </span>            :           double ccoeff3 = 0.0;
<span class="lineNum">    4358 </span>            :           double ccoeff = 0.0;
<span class="lineNum">    4359 </span><span class="lineNoCov">          0 :           for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4360 </span><span class="lineNoCov">          0 :             ccoeff1 += (s[n].foraging_strength_c_on(s[j]))*(s[i].foraging_strength_c_on(s[j]));</span>
<span class="lineNum">    4361 </span><span class="lineNoCov">          0 :             ccoeff2 += (s[n].foraging_strength_c_on(s[j]))*(s[n].foraging_strength_c_on(s[j]));</span>
<span class="lineNum">    4362 </span><span class="lineNoCov">          0 :             ccoeff3 += (s[i].foraging_strength_c_on(s[j]))*(s[i].foraging_strength_c_on(s[j]));</span>
<span class="lineNum">    4363 </span>            :           }
<span class="lineNum">    4364 </span><span class="lineNoCov">          0 :           ccoeff = ccoeff1/(sqrt(ccoeff2*ccoeff3));</span>
<span class="lineNum">    4365 </span><span class="lineNoCov">          0 :           bodymass_ccoeffoverlap.push_back(make_pair(sp2.bodymass(),ccoeff));</span>
<span class="lineNum">    4366 </span>            :         }
<span class="lineNum">    4367 </span>            :       }
<span class="lineNum">    4368 </span><span class="lineNoCov">          0 :       sort(bodymass_ccoeffoverlap.begin(),bodymass_ccoeffoverlap.end());</span>
<span class="lineNum">    4369 </span><span class="lineNoCov">          0 :       os3 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4370 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_ccoeffoverlap.size();i++){</span>
<span class="lineNum">    4371 </span>            :         //cout &lt;&lt; bodymass_ccoeffoverlap.at(i).first &lt;&lt; endl;
<span class="lineNum">    4372 </span><span class="lineNoCov">          0 :         os3 &lt;&lt; &quot; &quot; &lt;&lt; bodymass_ccoeffoverlap.at(i).second;</span>
<span class="lineNum">    4373 </span>            :       }
<span class="lineNum">    4374 </span><span class="lineNoCov">          0 :       os3 &lt;&lt; endl;</span>
<span class="lineNum">    4375 </span>            :     }
<span class="lineNum">    4376 </span>            :   }
<span class="lineNum">    4377 </span>            : 
<span class="lineNum">    4378 </span>            :   // Work out matrix of Npreyshared for fish species.
<span class="lineNum">    4379 </span>            :   // Each row gives, for each fish species, Npreyshared
<span class="lineNum">    4380 </span>            :   // with other fish species in order of increasing body mass.
<span class="lineNum">    4381 </span><span class="lineNoCov">          0 :   std::ofstream os4(&quot;Npreyshared_matrix.dat&quot;);</span>
<span class="lineNum">    4382 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4383 </span><span class="lineNoCov">          0 :   os4.precision(7);</span>
<span class="lineNum">    4384 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4385 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4386 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4387 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_Npreyshared;</span>
<span class="lineNum">    4388 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4389 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4390 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4391 </span><span class="lineNoCov">          0 :           bodymass_Npreyshared.push_back(make_pair(sp2.bodymass(),Npreyshared(n,i)));</span>
<span class="lineNum">    4392 </span>            :         }
<span class="lineNum">    4393 </span>            :       }
<span class="lineNum">    4394 </span><span class="lineNoCov">          0 :       sort(bodymass_Npreyshared.begin(),bodymass_Npreyshared.end());</span>
<span class="lineNum">    4395 </span><span class="lineNoCov">          0 :       os4 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4396 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_Npreyshared.size();i++){</span>
<span class="lineNum">    4397 </span>            :         //cout &lt;&lt; bodymass_Npreyshared.at(i).first &lt;&lt; endl;
<span class="lineNum">    4398 </span><span class="lineNoCov">          0 :         os4 &lt;&lt; &quot; &quot; &lt;&lt; bodymass_Npreyshared.at(i).second;</span>
<span class="lineNum">    4399 </span>            :       }
<span class="lineNum">    4400 </span><span class="lineNoCov">          0 :       os4 &lt;&lt; endl;</span>
<span class="lineNum">    4401 </span>            :     }
<span class="lineNum">    4402 </span>            :   }
<span class="lineNum">    4403 </span>            : 
<span class="lineNum">    4404 </span>            :   // Work out matrix of Npredshared for fish species.
<span class="lineNum">    4405 </span>            :   // Each row gives, for each fish species, Npredshared
<span class="lineNum">    4406 </span>            :   // with other fish species in order of increasing body mass.
<span class="lineNum">    4407 </span><span class="lineNoCov">          0 :   std::ofstream os5(&quot;Npredshared_matrix.dat&quot;);</span>
<span class="lineNum">    4408 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4409 </span><span class="lineNoCov">          0 :   os5.precision(7);</span>
<span class="lineNum">    4410 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4411 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4412 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4413 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_Npredshared;</span>
<span class="lineNum">    4414 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4415 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4416 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4417 </span><span class="lineNoCov">          0 :           bodymass_Npredshared.push_back(make_pair(sp2.bodymass(),Npredshared(n,i)));</span>
<span class="lineNum">    4418 </span>            :         }
<span class="lineNum">    4419 </span>            :       }
<span class="lineNum">    4420 </span><span class="lineNoCov">          0 :       sort(bodymass_Npredshared.begin(),bodymass_Npredshared.end());</span>
<span class="lineNum">    4421 </span><span class="lineNoCov">          0 :       os5 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4422 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_Npredshared.size();i++){</span>
<span class="lineNum">    4423 </span>            :         //cout &lt;&lt; bodymass_Npredshared.at(i).first &lt;&lt; endl;
<span class="lineNum">    4424 </span><span class="lineNoCov">          0 :         os5 &lt;&lt; &quot; &quot; &lt;&lt; bodymass_Npredshared.at(i).second;</span>
<span class="lineNum">    4425 </span>            :       }
<span class="lineNum">    4426 </span><span class="lineNoCov">          0 :       os5 &lt;&lt; endl;</span>
<span class="lineNum">    4427 </span>            :     }
<span class="lineNum">    4428 </span>            :   }
<span class="lineNum">    4429 </span>            : 
<span class="lineNum">    4430 </span>            :   // Work out matrix of Trophsim for fish species.
<span class="lineNum">    4431 </span>            :   // Each row gives, for each fish species, Trophsim
<span class="lineNum">    4432 </span>            :   // with other fish species in order of increasing body mass.
<span class="lineNum">    4433 </span><span class="lineNoCov">          0 :   std::ofstream os6(&quot;Trophsim_matrix.dat&quot;);</span>
<span class="lineNum">    4434 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4435 </span><span class="lineNoCov">          0 :   os6.precision(7);</span>
<span class="lineNum">    4436 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4437 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4438 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4439 </span><span class="lineNoCov">          0 :       sequence&lt; pair&lt;double,double&gt; &gt; bodymass_Trophsim;</span>
<span class="lineNum">    4440 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4441 </span><span class="lineNoCov">          0 :         NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4442 </span><span class="lineNoCov">          0 :         if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4443 </span><span class="lineNoCov">          0 :           bodymass_Trophsim.push_back(make_pair(sp2.bodymass(),Trophsim(n,i)));</span>
<span class="lineNum">    4444 </span>            :         }
<span class="lineNum">    4445 </span>            :       }
<span class="lineNum">    4446 </span><span class="lineNoCov">          0 :       sort(bodymass_Trophsim.begin(),bodymass_Trophsim.end());</span>
<span class="lineNum">    4447 </span><span class="lineNoCov">          0 :       os6 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4448 </span><span class="lineNoCov">          0 :       for(int i=0;i&lt;bodymass_Trophsim.size();i++){</span>
<span class="lineNum">    4449 </span>            :         //cout &lt;&lt; bodymass_Trophsim.at(i).first &lt;&lt; endl;
<span class="lineNum">    4450 </span><span class="lineNoCov">          0 :         os6 &lt;&lt; &quot; &quot; &lt;&lt; bodymass_Trophsim.at(i).second;</span>
<span class="lineNum">    4451 </span>            :       }
<span class="lineNum">    4452 </span><span class="lineNoCov">          0 :       os6 &lt;&lt; endl;</span>
<span class="lineNum">    4453 </span>            :     }
<span class="lineNum">    4454 </span>            :   }
<span class="lineNum">    4455 </span>            : 
<span class="lineNum">    4456 </span>            :   // Work out matrix oflog10(bodymass), log10(biomass density) and TL  
<span class="lineNum">    4457 </span>            :   // for each species.
<span class="lineNum">    4458 </span><span class="lineNoCov">          0 :   std::ofstream os7(&quot;log10M_log10B_TL.dat&quot;);</span>
<span class="lineNum">    4459 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4460 </span><span class="lineNoCov">          0 :   os7.precision(7);</span>
<span class="lineNum">    4461 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4462 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4463 </span><span class="lineNoCov">          0 :     os7 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4464 </span><span class="lineNoCov">          0 :     os7 &lt;&lt; &quot; &quot; &lt;&lt; log10(biomass_B(n)/unit_mass/area);</span>
<span class="lineNum">    4465 </span><span class="lineNoCov">          0 :     os7 &lt;&lt; &quot; &quot; &lt;&lt; level[n];</span>
<span class="lineNum">    4466 </span><span class="lineNoCov">          0 :     os7 &lt;&lt; endl;</span>
<span class="lineNum">    4467 </span>            :   }
<span class="lineNum">    4468 </span>            : 
<span class="lineNum">    4469 </span>            :   // Work out matrix oflog10(bodymass), log10(biomass density), TL, 
<span class="lineNum">    4470 </span>            :   // Gen, Vul and Conn for each species.
<span class="lineNum">    4471 </span><span class="lineNoCov">          0 :   std::ofstream os8(&quot;log10M_log10B_TL_Gen_Vul_Conn.dat&quot;);</span>
<span class="lineNum">    4472 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4473 </span><span class="lineNoCov">          0 :   os8.precision(7);</span>
<span class="lineNum">    4474 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4475 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];</span>
<span class="lineNum">    4476 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; log10(sp.bodymass()/unit_mass);</span>
<span class="lineNum">    4477 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; &quot; &quot; &lt;&lt; log10(biomass_B(n)/unit_mass/area);</span>
<span class="lineNum">    4478 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; &quot; &quot; &lt;&lt; level[n];</span>
<span class="lineNum">    4479 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; &quot; &quot; &lt;&lt; Gen_I[n];</span>
<span class="lineNum">    4480 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; &quot; &quot; &lt;&lt; Vul_I[n];</span>
<span class="lineNum">    4481 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; &quot; &quot; &lt;&lt; Conn_I[n];</span>
<span class="lineNum">    4482 </span><span class="lineNoCov">          0 :     os8 &lt;&lt; endl;</span>
<span class="lineNum">    4483 </span>            :   }
<span class="lineNum">    4484 </span>            : 
<a name="4485"><span class="lineNum">    4485 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4486 </span>            : 
<span class="lineNum">    4487 </span><span class="lineNoCov">          0 : void NewWeb::species_table3(const char* filename,</span>
<span class="lineNum">    4488 </span>            :                            bool with_plants,double th,Snapshot &amp; snap,
<span class="lineNum">    4489 </span>            :                            link_strength_matrix &amp; intake,
<span class="lineNum">    4490 </span>            :                            bool jolly){
<span class="lineNum">    4491 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    4492 </span>            : 
<span class="lineNum">    4493 </span><span class="lineNoCov">          0 :   if(intake.size()==0)</span>
<span class="lineNum">    4494 </span><span class="lineNoCov">          0 :     intake=intake_matrix();</span>
<span class="lineNum">    4495 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    4496 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    4497 </span>            :   // Work out number of fish species
<span class="lineNum">    4498 </span><span class="lineNoCov">          0 :   double Sfish = 0.0;</span>
<span class="lineNum">    4499 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4500 </span><span class="lineNoCov">          0 :     if(log10(s[n].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4501 </span><span class="lineNoCov">          0 :       Sfish += 1;</span>
<span class="lineNum">    4502 </span>            :     }
<span class="lineNum">    4503 </span>            :   }
<span class="lineNum">    4504 </span>            :   //cout &lt;&lt; &quot;Sfish = &quot; &lt;&lt; Sfish &lt;&lt; endl;
<span class="lineNum">    4505 </span>            : 
<span class="lineNum">    4506 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_headings;</span>
<span class="lineNum">    4507 </span><span class="lineNoCov">          0 :   sequence&lt;std::string&gt; additional_data;</span>
<span class="lineNum">    4508 </span>            : 
<span class="lineNum">    4509 </span><span class="lineNoCov">          0 :   int column=0;</span>
<span class="lineNum">    4510 </span>            : 
<span class="lineNum">    4511 </span>            :   //int S=s.size();
<span class="lineNum">    4512 </span>            :   //double area=area_per_compartment/unit_area;
<span class="lineNum">    4513 </span>            : 
<span class="lineNum">    4514 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4515 </span><span class="lineNoCov">          0 :     &quot;col   (assigned column)&quot;;</span>
<span class="lineNum">    4516 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4517 </span><span class="lineNoCov">          0 :     &quot;prod   (productivity)&quot;;</span>
<span class="lineNum">    4518 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4519 </span><span class="lineNoCov">          0 :     &quot;pred   (predation mortality)&quot;;</span>
<span class="lineNum">    4520 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4521 </span><span class="lineNoCov">          0 :     &quot;comp   (mean dietary overlap for fish species)&quot;;</span>
<span class="lineNum">    4522 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4523 </span><span class="lineNoCov">          0 :     &quot;nin   (nin for fish species, considering all species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4524 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4525 </span><span class="lineNoCov">          0 :     &quot;nout   (nout for fish species, considering all species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4526 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4527 </span><span class="lineNoCov">          0 :     &quot;ninw   (nin for fish species, considering all species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4528 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4529 </span><span class="lineNoCov">          0 :     &quot;noutw   (nout for fish species, considering all species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4530 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4531 </span><span class="lineNoCov">          0 :     &quot;ninf   (nin for fish species, considering just fish species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4532 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4533 </span><span class="lineNoCov">          0 :     &quot;noutf   (nout for fish species, considering just fish species; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4534 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4535 </span><span class="lineNoCov">          0 :     &quot;ninwf   (nin for fish species, considering just fish species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4536 </span><span class="lineNoCov">          0 :   additional_headings[column++]=</span>
<span class="lineNum">    4537 </span><span class="lineNoCov">          0 :     &quot;noutwf   (nout for fish species, considering just fish species and weighted; see Bersier et al. (2002) for definition)&quot;;</span>
<span class="lineNum">    4538 </span>            :   
<span class="lineNum">    4539 </span>            :   // Calculate indicators for each fish species
<span class="lineNum">    4540 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotI;</span>
<span class="lineNum">    4541 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjI;</span>
<span class="lineNum">    4542 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotIf;</span>
<span class="lineNum">    4543 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjIf;</span>
<span class="lineNum">    4544 </span><span class="lineNoCov">          0 :   double b_dotdotI = 0.0;</span>
<span class="lineNum">    4545 </span><span class="lineNoCov">          0 :   double b_dotdotIf = 0.0;</span>
<span class="lineNum">    4546 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_ink;</span>
<span class="lineNum">    4547 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outk;</span>
<span class="lineNum">    4548 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_ink;</span>
<span class="lineNum">    4549 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outk;</span>
<span class="lineNum">    4550 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_inkf;</span>
<span class="lineNum">    4551 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outkf;</span>
<span class="lineNum">    4552 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_inkf;</span>
<span class="lineNum">    4553 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outkf;</span>
<span class="lineNum">    4554 </span><span class="lineNoCov">          0 :   double dummy3 = 0.0;</span>
<span class="lineNum">    4555 </span><span class="lineNoCov">          0 :   double dummy4 = 0.0;</span>
<span class="lineNum">    4556 </span><span class="lineNoCov">          0 :   double dummy5 = 0.0;</span>
<span class="lineNum">    4557 </span><span class="lineNoCov">          0 :   double dummy6 = 0.0;</span>
<span class="lineNum">    4558 </span><span class="lineNoCov">          0 :   double dummy7 = 0.0;</span>
<span class="lineNum">    4559 </span><span class="lineNoCov">          0 :   double resolog10M = 0.0;</span>
<span class="lineNum">    4560 </span><span class="lineNoCov">          0 :   double conslog10M = 0.0;</span>
<span class="lineNum">    4561 </span>            :   // First populate b_idotI, b_dotjI, b_idotIf and b_dotjIf.
<span class="lineNum">    4562 </span>            :   // Also calcuate b_dotdotI and b_dotdotIf.
<span class="lineNum">    4563 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4564 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    4565 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    4566 </span><span class="lineNoCov">          0 :     dummy3 = 0;</span>
<span class="lineNum">    4567 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    4568 </span><span class="lineNoCov">          0 :     dummy5 = 0;</span>
<span class="lineNum">    4569 </span><span class="lineNoCov">          0 :     dummy6 = 0;</span>
<span class="lineNum">    4570 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4571 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];</span>
<span class="lineNum">    4572 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    4573 </span><span class="lineNoCov">          0 :       dummy3 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4574 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4575 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4576 </span><span class="lineNoCov">          0 :       if(resolog10M &gt; -3){</span>
<span class="lineNum">    4577 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4578 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4579 </span>            :       }
<span class="lineNum">    4580 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){</span>
<span class="lineNum">    4581 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4582 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4583 </span>            :       }
<span class="lineNum">    4584 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &lt;= -3)){</span>
<span class="lineNum">    4585 </span><span class="lineNoCov">          0 :         dummy7 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4586 </span>            :       }
<span class="lineNum">    4587 </span>            :       // End loop for j.
<span class="lineNum">    4588 </span>            :     }
<span class="lineNum">    4589 </span><span class="lineNoCov">          0 :     b_idotI[i] = dummy3;</span>
<span class="lineNum">    4590 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    4591 </span><span class="lineNoCov">          0 :     b_idotIf[i] = dummy5;</span>
<span class="lineNum">    4592 </span><span class="lineNoCov">          0 :     b_dotjIf[i] = dummy6;</span>
<span class="lineNum">    4593 </span>            :     // End loop for i.
<span class="lineNum">    4594 </span>            :   }
<span class="lineNum">    4595 </span><span class="lineNoCov">          0 :   b_dotdotIf = b_dotdotI - dummy7;</span>
<span class="lineNum">    4596 </span>            :   // Now populate H_ink, H_outk, n_ink, n_outk.
<span class="lineNum">    4597 </span>            :   // Also populate H_inkf, H_outkf, n_inkf, n_outkf.
<span class="lineNum">    4598 </span><span class="lineNoCov">          0 :   double dummy100 = 0.0;</span>
<span class="lineNum">    4599 </span><span class="lineNoCov">          0 :   double dummy101 = 0.0;</span>
<span class="lineNum">    4600 </span><span class="lineNoCov">          0 :   double dummy102 = 0.0;</span>
<span class="lineNum">    4601 </span><span class="lineNoCov">          0 :   double dummy103 = 0.0;</span>
<span class="lineNum">    4602 </span><span class="lineNoCov">          0 :   double dummy104 = 0.0;</span>
<span class="lineNum">    4603 </span><span class="lineNoCov">          0 :   double dummy105 = 0.0;</span>
<span class="lineNum">    4604 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4605 </span>            :     dummy102 = 0;
<span class="lineNum">    4606 </span>            :     dummy103 = 0;
<span class="lineNum">    4607 </span>            :     dummy104 = 0;
<span class="lineNum">    4608 </span>            :     dummy105 = 0;
<span class="lineNum">    4609 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4610 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4611 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4612 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjI[i]&gt;0)){</span>
<span class="lineNum">    4613 </span><span class="lineNoCov">          0 :         dummy102 = dummy102 - ((dummy101/b_dotjI[i])*</span>
<span class="lineNum">    4614 </span><span class="lineNoCov">          0 :                                (log10(dummy101/b_dotjI[i])/log10(2)));</span>
<span class="lineNum">    4615 </span>            :       }
<span class="lineNum">    4616 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotI[i]&gt;0)){</span>
<span class="lineNum">    4617 </span><span class="lineNoCov">          0 :         dummy103 = dummy103 - ((dummy100/b_idotI[i])*</span>
<span class="lineNum">    4618 </span><span class="lineNoCov">          0 :                                (log10(dummy100/b_idotI[i])/log10(2)));</span>
<span class="lineNum">    4619 </span>            :       }
<span class="lineNum">    4620 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjIf[i]&gt;0)){</span>
<span class="lineNum">    4621 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4622 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    4623 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    4624 </span>            :         }
<span class="lineNum">    4625 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&gt;-3)){</span>
<span class="lineNum">    4626 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    4627 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    4628 </span>            :         }
<span class="lineNum">    4629 </span>            :       }
<span class="lineNum">    4630 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotIf[i]&gt;0)){</span>
<span class="lineNum">    4631 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4632 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    4633 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    4634 </span>            :         }
<span class="lineNum">    4635 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&lt;=-3)){</span>
<span class="lineNum">    4636 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    4637 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    4638 </span>            :         }
<span class="lineNum">    4639 </span>            :       }  
<span class="lineNum">    4640 </span>            :       // End loop for j.
<span class="lineNum">    4641 </span>            :     }
<span class="lineNum">    4642 </span><span class="lineNoCov">          0 :     H_ink[i] = dummy102;</span>
<span class="lineNum">    4643 </span><span class="lineNoCov">          0 :     H_outk[i] = dummy103;</span>
<span class="lineNum">    4644 </span><span class="lineNoCov">          0 :     if(b_idotI[i]&gt;0){</span>
<span class="lineNum">    4645 </span><span class="lineNoCov">          0 :       n_outk[i] = pow(2,H_outk[i]);</span>
<span class="lineNum">    4646 </span>            :     }else{
<span class="lineNum">    4647 </span><span class="lineNoCov">          0 :       n_outk[i] = 0;</span>
<span class="lineNum">    4648 </span>            :     }
<span class="lineNum">    4649 </span><span class="lineNoCov">          0 :     if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    4650 </span><span class="lineNoCov">          0 :       n_ink[i] = pow(2,H_ink[i]);</span>
<span class="lineNum">    4651 </span>            :     }else{
<span class="lineNum">    4652 </span><span class="lineNoCov">          0 :       n_ink[i] = 0;</span>
<span class="lineNum">    4653 </span>            :     }
<span class="lineNum">    4654 </span><span class="lineNoCov">          0 :     H_inkf[i] = dummy104;</span>
<span class="lineNum">    4655 </span><span class="lineNoCov">          0 :     H_outkf[i] = dummy105;</span>
<span class="lineNum">    4656 </span><span class="lineNoCov">          0 :     if(b_idotIf[i]&gt;0){</span>
<span class="lineNum">    4657 </span><span class="lineNoCov">          0 :       n_outkf[i] = pow(2,H_outkf[i]);</span>
<span class="lineNum">    4658 </span>            :     }else{
<span class="lineNum">    4659 </span><span class="lineNoCov">          0 :       n_outkf[i] = 0;</span>
<span class="lineNum">    4660 </span>            :     }
<span class="lineNum">    4661 </span><span class="lineNoCov">          0 :     if(b_dotjIf[i]&gt;0){</span>
<span class="lineNum">    4662 </span><span class="lineNoCov">          0 :       n_inkf[i] = pow(2,H_inkf[i]);</span>
<span class="lineNum">    4663 </span>            :     }else{
<span class="lineNum">    4664 </span><span class="lineNoCov">          0 :       n_inkf[i] = 0;</span>
<span class="lineNum">    4665 </span>            :     }
<span class="lineNum">    4666 </span>            :     // End loop for i.
<span class="lineNum">    4667 </span>            :   }
<span class="lineNum">    4668 </span>            :   
<span class="lineNum">    4669 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4670 </span><span class="lineNoCov">          0 :     std::ostringstream os;</span>
<span class="lineNum">    4671 </span><span class="lineNoCov">          0 :     double prod = 0.0;</span>
<span class="lineNum">    4672 </span><span class="lineNoCov">          0 :     double pred = 0.0;</span>
<span class="lineNum">    4673 </span><span class="lineNoCov">          0 :     double comp = 0.0;</span>
<span class="lineNum">    4674 </span><span class="lineNoCov">          0 :     int counter1 = 0;</span>
<span class="lineNum">    4675 </span><span class="lineNoCov">          0 :     int counter2 = 0;</span>
<span class="lineNum">    4676 </span><span class="lineNoCov">          0 :     int counter3 = 0;</span>
<span class="lineNum">    4677 </span><span class="lineNoCov">          0 :     int counter4 = 0;</span>
<span class="lineNum">    4678 </span>            :     //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4679 </span><span class="lineNoCov">          0 :     os.precision(7);</span>
<span class="lineNum">    4680 </span><span class="lineNoCov">          0 :     NewSpecies &amp; sp=s[n];     </span>
<span class="lineNum">    4681 </span><span class="lineNoCov">          0 :     if(log10(sp.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4682 </span><span class="lineNoCov">          0 :       if(with_plants || !sp.is_a_plant()){</span>
<span class="lineNum">    4683 </span><span class="lineNoCov">          0 :         os.width(1);</span>
<span class="lineNum">    4684 </span><span class="lineNoCov">          0 :         os &lt;&lt; assigned_column(n) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4685 </span><span class="lineNoCov">          0 :         for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4686 </span><span class="lineNoCov">          0 :           NewSpecies &amp; sp2=s[i];</span>
<span class="lineNum">    4687 </span><span class="lineNoCov">          0 :           prod += 0.6*(intake(i,n)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4688 </span><span class="lineNoCov">          0 :           pred += intake(n,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    4689 </span><span class="lineNoCov">          0 :           if(log10(sp2.bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    4690 </span>            :             double comp1 = 0.0;
<span class="lineNum">    4691 </span>            :             double comp2 = 0.0;
<span class="lineNum">    4692 </span>            :             double comp3 = 0.0;
<span class="lineNum">    4693 </span><span class="lineNoCov">          0 :             for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4694 </span><span class="lineNoCov">          0 :               comp1 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4695 </span><span class="lineNoCov">          0 :               comp2 += (intake(j,n)/unit_mass/area/(1/year))*(intake(j,n)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4696 </span><span class="lineNoCov">          0 :               comp3 += (intake(j,i)/unit_mass/area/(1/year))*(intake(j,i)/unit_mass/area/(1/year));</span>
<span class="lineNum">    4697 </span>            :               // End loop for j.
<span class="lineNum">    4698 </span>            :             }
<span class="lineNum">    4699 </span><span class="lineNoCov">          0 :             comp += comp1/(sqrt(comp2*comp3));</span>
<span class="lineNum">    4700 </span>            :           }
<span class="lineNum">    4701 </span>            :           // End loop for i.
<span class="lineNum">    4702 </span>            :         }
<span class="lineNum">    4703 </span>            :         // Work out mean of competition coefficients
<span class="lineNum">    4704 </span><span class="lineNoCov">          0 :         comp = comp/Sfish;</span>
<span class="lineNum">    4705 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4706 </span><span class="lineNoCov">          0 :         os &lt;&lt; prod &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4707 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4708 </span><span class="lineNoCov">          0 :         os &lt;&lt; pred &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4709 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4710 </span><span class="lineNoCov">          0 :         os &lt;&lt; comp &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4711 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4712 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_ink[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4713 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4714 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_outk[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4715 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4716 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_dotjI[n]/b_dotdotI)*n_ink[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4717 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4718 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_idotI[n]/b_dotdotI)*n_outk[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4719 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4720 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_inkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4721 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4722 </span><span class="lineNoCov">          0 :         os &lt;&lt; n_outkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4723 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4724 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_dotjIf[n]/b_dotdotIf)*n_inkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4725 </span><span class="lineNoCov">          0 :         os.width(5);</span>
<span class="lineNum">    4726 </span><span class="lineNoCov">          0 :         os &lt;&lt; (b_idotIf[n]/b_dotdotIf)*n_outkf[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4727 </span><span class="lineNoCov">          0 :         additional_data[n]=os.str();</span>
<span class="lineNum">    4728 </span>            :       }
<span class="lineNum">    4729 </span>            :     }
<span class="lineNum">    4730 </span>            :   }
<span class="lineNum">    4731 </span><span class="lineNoCov">          0 :   snap.species_table3(filename,with_plants,th,</span>
<span class="lineNum">    4732 </span><span class="lineNoCov">          0 :                      additional_headings,additional_data);</span>
<span class="lineNum">    4733 </span>            : 
<span class="lineNum">    4734 </span>            :   // Work out mean, standard deviation and skewness of interaction strengths (measured as flows)
<span class="lineNum">    4735 </span>            :   // Exclude interaction strengths of magnitude 0
<span class="lineNum">    4736 </span>            :   // Formula for skewness has been verified using a set of data and R code
<span class="lineNum">    4737 </span>            :   double mean_interaction_strengths = 0.0;
<span class="lineNum">    4738 </span>            :   double sd_interaction_strengths = 0.0;
<span class="lineNum">    4739 </span>            :   double skewness_interaction_strengths = 0.0;
<span class="lineNum">    4740 </span>            :   double sumnoofentries = 0.0;
<span class="lineNum">    4741 </span>            :   double sumX = 0.0;
<span class="lineNum">    4742 </span>            :   double sumX2 = 0.0;
<span class="lineNum">    4743 </span>            :   double sumX3 = 0.0;
<span class="lineNum">    4744 </span>            :   double interaction_strength_dummy = 0.0;
<span class="lineNum">    4745 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4746 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4747 </span><span class="lineNoCov">          0 :       if((intake(i,j)/area/(1/year))&gt;0){</span>
<span class="lineNum">    4748 </span><span class="lineNoCov">          0 :         interaction_strength_dummy = intake(i,j)/area/(1/year);</span>
<span class="lineNum">    4749 </span><span class="lineNoCov">          0 :         sumnoofentries = sumnoofentries+1;</span>
<span class="lineNum">    4750 </span><span class="lineNoCov">          0 :         sumX = sumX+interaction_strength_dummy;</span>
<span class="lineNum">    4751 </span><span class="lineNoCov">          0 :         sumX2 = sumX2+(interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4752 </span><span class="lineNoCov">          0 :         sumX3 = sumX3+(interaction_strength_dummy*interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4753 </span>            :       }
<span class="lineNum">    4754 </span>            :     }
<span class="lineNum">    4755 </span>            :   }
<span class="lineNum">    4756 </span><span class="lineNoCov">          0 :   mean_interaction_strengths = sumX/sumnoofentries;</span>
<span class="lineNum">    4757 </span><span class="lineNoCov">          0 :   sd_interaction_strengths = sqrt((sumX2/sumnoofentries)-(mean_interaction_strengths*mean_interaction_strengths));</span>
<span class="lineNum">    4758 </span><span class="lineNoCov">          0 :   skewness_interaction_strengths = ((sumX3/sumnoofentries)-(3*mean_interaction_strengths*sd_interaction_strengths*sd_interaction_strengths)</span>
<span class="lineNum">    4759 </span><span class="lineNoCov">          0 :                                     -(mean_interaction_strengths*mean_interaction_strengths*mean_interaction_strengths))/</span>
<span class="lineNum">    4760 </span><span class="lineNoCov">          0 :     (sd_interaction_strengths*sd_interaction_strengths*sd_interaction_strengths);</span>
<span class="lineNum">    4761 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Ltot = &quot; &lt;&lt; sumnoofentries &lt;&lt; endl;</span>
<span class="lineNum">    4762 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LDtot = &quot; &lt;&lt; sumnoofentries/S &lt;&lt; endl;</span>
<span class="lineNum">    4763 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Ctot = &quot; &lt;&lt; sumnoofentries/(S*S) &lt;&lt; endl;</span>
<span class="lineNum">    4764 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;mean_interaction_strengths = &quot; &lt;&lt; mean_interaction_strengths &lt;&lt; endl;</span>
<span class="lineNum">    4765 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sd_interaction_strengths = &quot; &lt;&lt; sd_interaction_strengths &lt;&lt; endl;</span>
<span class="lineNum">    4766 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;skewness_interaction_strengths = &quot; &lt;&lt; skewness_interaction_strengths &lt;&lt; endl;</span>
<span class="lineNum">    4767 </span>            :   
<span class="lineNum">    4768 </span>            :   // Work out mean, standard deviation and skewness of interaction strengths (measured as flows)
<span class="lineNum">    4769 </span>            :   // divided by biomass densities of predator and prey
<span class="lineNum">    4770 </span>            :   // Exclude interaction strengths of magnitude 0
<span class="lineNum">    4771 </span>            :   // Formula for skewness has been verified using a set of data and R code
<span class="lineNum">    4772 </span>            :   double mean_interaction_strengths2 = 0.0;
<span class="lineNum">    4773 </span>            :   double sd_interaction_strengths2 = 0.0;
<span class="lineNum">    4774 </span>            :   double skewness_interaction_strengths2 = 0.0;
<span class="lineNum">    4775 </span>            :   sumnoofentries = 0.0;
<span class="lineNum">    4776 </span>            :   sumX = 0.0;
<span class="lineNum">    4777 </span>            :   sumX2 = 0.0;
<span class="lineNum">    4778 </span>            :   sumX3 = 0.0;
<span class="lineNum">    4779 </span>            :   interaction_strength_dummy = 0.0;
<span class="lineNum">    4780 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4781 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4782 </span><span class="lineNoCov">          0 :       if((intake(i,j)/area/(1/year))&gt;0){</span>
<span class="lineNum">    4783 </span><span class="lineNoCov">          0 :         interaction_strength_dummy = (intake(i,j)/area/(1/year))/((biomass_B(i)/unit_mass/area)*(biomass_B(j)/unit_mass/area));</span>
<span class="lineNum">    4784 </span><span class="lineNoCov">          0 :         sumnoofentries = sumnoofentries+1;</span>
<span class="lineNum">    4785 </span><span class="lineNoCov">          0 :         sumX = sumX+interaction_strength_dummy;</span>
<span class="lineNum">    4786 </span><span class="lineNoCov">          0 :         sumX2 = sumX2+(interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4787 </span><span class="lineNoCov">          0 :         sumX3 = sumX3+(interaction_strength_dummy*interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4788 </span>            :       }
<span class="lineNum">    4789 </span>            :     }
<span class="lineNum">    4790 </span>            :   }
<span class="lineNum">    4791 </span><span class="lineNoCov">          0 :   mean_interaction_strengths2 = sumX/sumnoofentries;</span>
<span class="lineNum">    4792 </span><span class="lineNoCov">          0 :   sd_interaction_strengths2 = sqrt((sumX2/sumnoofentries)-(mean_interaction_strengths2*mean_interaction_strengths2));</span>
<span class="lineNum">    4793 </span><span class="lineNoCov">          0 :   skewness_interaction_strengths2 = ((sumX3/sumnoofentries)-(3*mean_interaction_strengths2*sd_interaction_strengths2*sd_interaction_strengths2)</span>
<span class="lineNum">    4794 </span><span class="lineNoCov">          0 :                                     -(mean_interaction_strengths2*mean_interaction_strengths2*mean_interaction_strengths2))/</span>
<span class="lineNum">    4795 </span><span class="lineNoCov">          0 :     (sd_interaction_strengths2*sd_interaction_strengths2*sd_interaction_strengths2);</span>
<span class="lineNum">    4796 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;mean_interaction_strengths2 = &quot; &lt;&lt; mean_interaction_strengths2 &lt;&lt; endl;</span>
<span class="lineNum">    4797 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sd_interaction_strengths2 = &quot; &lt;&lt; sd_interaction_strengths2 &lt;&lt; endl;</span>
<span class="lineNum">    4798 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;skewness_interaction_strengths2 = &quot; &lt;&lt; skewness_interaction_strengths2 &lt;&lt; endl;</span>
<span class="lineNum">    4799 </span>            : 
<span class="lineNum">    4800 </span>            :   // Work out mean, standard deviation and skewness of interaction strengths (measured as flows)
<span class="lineNum">    4801 </span>            :   // divided by biomass density of predator
<span class="lineNum">    4802 </span>            :   // Exclude interaction strengths of magnitude 0
<span class="lineNum">    4803 </span>            :   // Formula for skewness has been verified using a set of data and R code
<span class="lineNum">    4804 </span>            :   double mean_interaction_strengths3 = 0.0;
<span class="lineNum">    4805 </span>            :   double sd_interaction_strengths3 = 0.0;
<span class="lineNum">    4806 </span>            :   double skewness_interaction_strengths3 = 0.0;
<span class="lineNum">    4807 </span>            :   sumnoofentries = 0.0;
<span class="lineNum">    4808 </span>            :   sumX = 0.0;
<span class="lineNum">    4809 </span>            :   sumX2 = 0.0;
<span class="lineNum">    4810 </span>            :   sumX3 = 0.0;
<span class="lineNum">    4811 </span>            :   interaction_strength_dummy = 0.0;
<span class="lineNum">    4812 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    4813 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    4814 </span><span class="lineNoCov">          0 :       if((intake(i,j)/area/(1/year))&gt;0){</span>
<span class="lineNum">    4815 </span><span class="lineNoCov">          0 :         interaction_strength_dummy = (intake(i,j)/area/(1/year))/(biomass_B(j)/unit_mass/area);</span>
<span class="lineNum">    4816 </span><span class="lineNoCov">          0 :         sumnoofentries = sumnoofentries+1;</span>
<span class="lineNum">    4817 </span><span class="lineNoCov">          0 :         sumX = sumX+interaction_strength_dummy;</span>
<span class="lineNum">    4818 </span><span class="lineNoCov">          0 :         sumX2 = sumX2+(interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4819 </span><span class="lineNoCov">          0 :         sumX3 = sumX3+(interaction_strength_dummy*interaction_strength_dummy*interaction_strength_dummy);</span>
<span class="lineNum">    4820 </span>            :       }
<span class="lineNum">    4821 </span>            :     }
<span class="lineNum">    4822 </span>            :   }
<span class="lineNum">    4823 </span><span class="lineNoCov">          0 :   mean_interaction_strengths3 = sumX/sumnoofentries;</span>
<span class="lineNum">    4824 </span><span class="lineNoCov">          0 :   sd_interaction_strengths3 = sqrt((sumX2/sumnoofentries)-(mean_interaction_strengths3*mean_interaction_strengths3));</span>
<span class="lineNum">    4825 </span><span class="lineNoCov">          0 :   skewness_interaction_strengths3 = ((sumX3/sumnoofentries)-(3*mean_interaction_strengths3*sd_interaction_strengths3*sd_interaction_strengths3)</span>
<span class="lineNum">    4826 </span><span class="lineNoCov">          0 :                                     -(mean_interaction_strengths3*mean_interaction_strengths3*mean_interaction_strengths3))/</span>
<span class="lineNum">    4827 </span><span class="lineNoCov">          0 :     (sd_interaction_strengths3*sd_interaction_strengths3*sd_interaction_strengths3);</span>
<span class="lineNum">    4828 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;mean_interaction_strengths3 = &quot; &lt;&lt; mean_interaction_strengths3 &lt;&lt; endl;</span>
<span class="lineNum">    4829 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sd_interaction_strengths3 = &quot; &lt;&lt; sd_interaction_strengths3 &lt;&lt; endl;</span>
<span class="lineNum">    4830 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;skewness_interaction_strengths3 = &quot; &lt;&lt; skewness_interaction_strengths3 &lt;&lt; endl;</span>
<span class="lineNum">    4831 </span>            :   
<a name="4832"><span class="lineNum">    4832 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4833 </span>            : 
<span class="lineNum">    4834 </span><span class="lineNoCov">          0 : void NewWeb::link_table(const char* filename,double th,</span>
<span class="lineNum">    4835 </span>            :                         link_strength_matrix &amp; intake,
<span class="lineNum">    4836 </span>            :                         const sequence&lt;double&gt; &amp; biomass_B){
<span class="lineNum">    4837 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    4838 </span>            : 
<span class="lineNum">    4839 </span><span class="lineNoCov">          0 :   if(intake.size()==0)</span>
<span class="lineNum">    4840 </span><span class="lineNoCov">          0 :     intake=intake_matrix();</span>
<span class="lineNum">    4841 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    4842 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    4843 </span>            :   
<span class="lineNum">    4844 </span>            :   // compute the trophic level vector:
<span class="lineNum">    4845 </span><span class="lineNoCov">          0 :   NewMatrix F=ifrac;</span>
<span class="lineNum">    4846 </span><span class="lineNoCov">          0 :   NewVector ones(S);</span>
<span class="lineNum">    4847 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;)</span>
<span class="lineNum">    4848 </span><span class="lineNoCov">          0 :     ones[i]=1;</span>
<span class="lineNum">    4849 </span><span class="lineNoCov">          0 :   NewMatrix D=NewIdentityMatrix(S,S)-F;</span>
<span class="lineNum">    4850 </span><span class="lineNoCov">          0 :   NewVector level=solve(D,ones);</span>
<span class="lineNum">    4851 </span>            :   
<span class="lineNum">    4852 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;writing a link table to file \&quot;&quot; &lt;&lt; filename &lt;&lt; &quot;\&quot;&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4853 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;mass unit: &quot; &lt;&lt; unit_mass/gram &lt;&lt; &quot; gram;&quot;</span>
<span class="lineNum">    4854 </span><span class="lineNoCov">          0 :             &lt;&lt; &quot; area unit: &quot; &lt;&lt; unit_area/meter2 &lt;&lt; &quot; meter^2&quot; </span>
<span class="lineNum">    4855 </span><span class="lineNoCov">          0 :             &lt;&lt; std::endl;</span>
<span class="lineNum">    4856 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;the meaning of the columns is &quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4857 </span><span class="lineNoCov">          0 :   int column=1;</span>
<span class="lineNum">    4858 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: hc (consumer trophic level)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4859 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: hr (resource trophic level)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4860 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Mc (log10 consumer body mass)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4861 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Mr (log10 resource body mass)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4862 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Bc (log10 consumer biomass density)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4863 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Br (log10 resource biomass density)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4864 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: cc (consumer column)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4865 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: cr (resource column)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4866 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: F  (biomass flow density [per year])&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4867 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: f  (consumer diet fraction)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4868 </span><span class="lineNoCov">          0 :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: c  (log10 coupling coefficient)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    4869 </span>            : 
<span class="lineNum">    4870 </span>            :   /* template:
<span class="lineNum">    4871 </span>            :      std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: ()&quot; &lt;&lt; std::endl;
<span class="lineNum">    4872 </span>            :   */
<span class="lineNum">    4873 </span>            : 
<span class="lineNum">    4874 </span>            : 
<span class="lineNum">    4875 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    4876 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    4877 </span><span class="lineNoCov">          0 :   os.precision(4);</span>
<span class="lineNum">    4878 </span>            :   
<span class="lineNum">    4879 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;S;n++){</span>
<span class="lineNum">    4880 </span><span class="lineNoCov">          0 :     for(int m=0;m&lt;S;m++){</span>
<span class="lineNum">    4881 </span><span class="lineNoCov">          0 :       if(ifrac(m,n)&gt;th){</span>
<span class="lineNum">    4882 </span><span class="lineNoCov">          0 :         NewSpecies &amp; cons=s[n];</span>
<span class="lineNum">    4883 </span><span class="lineNoCov">          0 :         NewSpecies &amp; reso=s[m];</span>
<span class="lineNum">    4884 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4885 </span><span class="lineNoCov">          0 :         os &lt;&lt; level[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4886 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4887 </span><span class="lineNoCov">          0 :         os &lt;&lt; level[m] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4888 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4889 </span><span class="lineNoCov">          0 :         os &lt;&lt; log10(cons.bodymass()/unit_mass) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4890 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4891 </span><span class="lineNoCov">          0 :         os &lt;&lt; log10(reso.bodymass()/unit_mass) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4892 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4893 </span><span class="lineNoCov">          0 :         os &lt;&lt; log10(biomass_B(n)/unit_mass/area) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4894 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4895 </span><span class="lineNoCov">          0 :         os &lt;&lt; log10(biomass_B(m)/unit_mass/area) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4896 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4897 </span><span class="lineNoCov">          0 :         os &lt;&lt; assigned_column[n] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4898 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4899 </span><span class="lineNoCov">          0 :         os &lt;&lt; assigned_column[m] &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4900 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4901 </span><span class="lineNoCov">          0 :         os &lt;&lt; intake(m,n)/unit_mass/area/(1/year) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4902 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4903 </span><span class="lineNoCov">          0 :         os &lt;&lt; ifrac(m,n) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4904 </span><span class="lineNoCov">          0 :         os.width(9);</span>
<span class="lineNum">    4905 </span><span class="lineNoCov">          0 :         os &lt;&lt; log10(precomputed[n].c[m]) &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    4906 </span>            :         os &lt;&lt; std::endl;
<span class="lineNum">    4907 </span>            :       }
<span class="lineNum">    4908 </span>            :     }
<span class="lineNum">    4909 </span>            :   }
<a name="4910"><span class="lineNum">    4910 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    4911 </span>            : 
<span class="lineNum">    4912 </span><span class="lineNoCov">          0 : void NewWeb::link_table2(const char* filename,double th,</span>
<span class="lineNum">    4913 </span>            :                         link_strength_matrix &amp; intake,
<span class="lineNum">    4914 </span>            :                         const sequence&lt;double&gt; &amp; biomass_B){
<span class="lineNum">    4915 </span><span class="lineNoCov">          0 :   double area=area_per_compartment/unit_area;</span>
<span class="lineNum">    4916 </span>            : 
<span class="lineNum">    4917 </span><span class="lineNoCov">          0 :   if(intake.size()==0)</span>
<span class="lineNum">    4918 </span><span class="lineNoCov">          0 :     intake=intake_matrix();</span>
<span class="lineNum">    4919 </span><span class="lineNoCov">          0 :   link_strength_matrix ifrac=in_fraction(intake);</span>
<span class="lineNum">    4920 </span><span class="lineNoCov">          0 :   int S=ifrac.size();</span>
<span class="lineNum">    4921 </span>            : 
<span class="lineNum">    4922 </span>            :   // Determine whether to calculate TL indicators or not
<span class="lineNum">    4923 </span><span class="lineNoCov">          0 :   int compute_TL_indicators = 0;</span>
<span class="lineNum">    4924 </span>            :   
<span class="lineNum">    4925 </span>            :   // compute the trophic level vector:
<span class="lineNum">    4926 </span>            :   if(compute_TL_indicators==1){
<span class="lineNum">    4927 </span>            : 
<span class="lineNum">    4928 </span>            :     NewMatrix F=ifrac;
<span class="lineNum">    4929 </span>            :     NewVector ones(S);
<span class="lineNum">    4930 </span>            :     for(int i=S;i--&gt;0;)
<span class="lineNum">    4931 </span>            :       ones[i]=1;
<span class="lineNum">    4932 </span>            :     NewMatrix D=NewIdentityMatrix(S,S)-F;
<span class="lineNum">    4933 </span>            :     NewVector level=solve(D,ones);
<span class="lineNum">    4934 </span>            : 
<span class="lineNum">    4935 </span>            :     double dummy1 = 0.0;
<span class="lineNum">    4936 </span>            :     int dummy2 = 0;
<span class="lineNum">    4937 </span>            :     sequence&lt;double&gt; rho_TL;
<span class="lineNum">    4938 </span>            :     for(int i=0;i&lt;45;i++){
<span class="lineNum">    4939 </span>            :       rho_TL[i]=0;
<span class="lineNum">    4940 </span>            :     }
<span class="lineNum">    4941 </span>            :     for(int i=0;i&lt;S;i++){
<span class="lineNum">    4942 </span>            :       dummy1 = (level[i] - 1)/0.1;
<span class="lineNum">    4943 </span>            :       //cout &lt;&lt; &quot;dummy1 = &quot; &lt;&lt; dummy1 &lt;&lt; endl;
<span class="lineNum">    4944 </span>            :       dummy2 = floor(dummy1);
<span class="lineNum">    4945 </span>            :       //cout &lt;&lt; &quot;dummy2 = &quot; &lt;&lt; dummy2 &lt;&lt; endl;
<span class="lineNum">    4946 </span>            :       rho_TL[dummy2] += biomass_B(i)/unit_mass/area;
<span class="lineNum">    4947 </span>            :     }
<span class="lineNum">    4948 </span>            :     //for(int i=0;i&lt;45;i++){
<span class="lineNum">    4949 </span>            :     //cout &lt;&lt; &quot;rho_TL[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; rho_TL[i] &lt;&lt; endl;
<span class="lineNum">    4950 </span>            :     //}
<span class="lineNum">    4951 </span>            :     cout &lt;&lt; &quot;rho_1_1point1_TL = &quot; &lt;&lt; rho_TL[0] &lt;&lt; endl;
<span class="lineNum">    4952 </span>            :     cout &lt;&lt; &quot;rho_1point1_1point2_TL = &quot; &lt;&lt; rho_TL[1] &lt;&lt; endl;
<span class="lineNum">    4953 </span>            :     cout &lt;&lt; &quot;rho_1point2_1point3_TL = &quot; &lt;&lt; rho_TL[2] &lt;&lt; endl;
<span class="lineNum">    4954 </span>            :     cout &lt;&lt; &quot;rho_1point3_1point4_TL = &quot; &lt;&lt; rho_TL[3] &lt;&lt; endl;
<span class="lineNum">    4955 </span>            :     cout &lt;&lt; &quot;rho_1point4_1point5_TL = &quot; &lt;&lt; rho_TL[4] &lt;&lt; endl;
<span class="lineNum">    4956 </span>            :     cout &lt;&lt; &quot;rho_1point5_1point6_TL = &quot; &lt;&lt; rho_TL[5] &lt;&lt; endl;
<span class="lineNum">    4957 </span>            :     cout &lt;&lt; &quot;rho_1point6_1point7_TL = &quot; &lt;&lt; rho_TL[6] &lt;&lt; endl;
<span class="lineNum">    4958 </span>            :     cout &lt;&lt; &quot;rho_1point7_1point8_TL = &quot; &lt;&lt; rho_TL[7] &lt;&lt; endl;
<span class="lineNum">    4959 </span>            :     cout &lt;&lt; &quot;rho_1point8_1point9_TL = &quot; &lt;&lt; rho_TL[8] &lt;&lt; endl;
<span class="lineNum">    4960 </span>            :     cout &lt;&lt; &quot;rho_1point9_2_TL = &quot; &lt;&lt; rho_TL[9] &lt;&lt; endl;
<span class="lineNum">    4961 </span>            :     cout &lt;&lt; &quot;rho_2_2point1_TL = &quot; &lt;&lt; rho_TL[10] &lt;&lt; endl;
<span class="lineNum">    4962 </span>            :     cout &lt;&lt; &quot;rho_2point1_2point2_TL = &quot; &lt;&lt; rho_TL[11] &lt;&lt; endl;
<span class="lineNum">    4963 </span>            :     cout &lt;&lt; &quot;rho_2point2_2point3_TL = &quot; &lt;&lt; rho_TL[12] &lt;&lt; endl;
<span class="lineNum">    4964 </span>            :     cout &lt;&lt; &quot;rho_2point3_2point4_TL = &quot; &lt;&lt; rho_TL[13] &lt;&lt; endl;
<span class="lineNum">    4965 </span>            :     cout &lt;&lt; &quot;rho_2point4_2point5_TL = &quot; &lt;&lt; rho_TL[14] &lt;&lt; endl;
<span class="lineNum">    4966 </span>            :     cout &lt;&lt; &quot;rho_2point5_2point6_TL = &quot; &lt;&lt; rho_TL[15] &lt;&lt; endl;
<span class="lineNum">    4967 </span>            :     cout &lt;&lt; &quot;rho_2point6_2point7_TL = &quot; &lt;&lt; rho_TL[16] &lt;&lt; endl;
<span class="lineNum">    4968 </span>            :     cout &lt;&lt; &quot;rho_2point7_2point8_TL = &quot; &lt;&lt; rho_TL[17] &lt;&lt; endl;
<span class="lineNum">    4969 </span>            :     cout &lt;&lt; &quot;rho_2point8_2point9_TL = &quot; &lt;&lt; rho_TL[18] &lt;&lt; endl;
<span class="lineNum">    4970 </span>            :     cout &lt;&lt; &quot;rho_2point9_3_TL = &quot; &lt;&lt; rho_TL[19] &lt;&lt; endl;
<span class="lineNum">    4971 </span>            :     cout &lt;&lt; &quot;rho_3_3point1_TL = &quot; &lt;&lt; rho_TL[20] &lt;&lt; endl;
<span class="lineNum">    4972 </span>            :     cout &lt;&lt; &quot;rho_3point1_3point2_TL = &quot; &lt;&lt; rho_TL[21] &lt;&lt; endl;
<span class="lineNum">    4973 </span>            :     cout &lt;&lt; &quot;rho_3point2_3point3_TL = &quot; &lt;&lt; rho_TL[22] &lt;&lt; endl;
<span class="lineNum">    4974 </span>            :     cout &lt;&lt; &quot;rho_3point3_3point4_TL = &quot; &lt;&lt; rho_TL[23] &lt;&lt; endl;
<span class="lineNum">    4975 </span>            :     cout &lt;&lt; &quot;rho_3point4_3point5_TL = &quot; &lt;&lt; rho_TL[24] &lt;&lt; endl;
<span class="lineNum">    4976 </span>            :     cout &lt;&lt; &quot;rho_3point5_3point6_TL = &quot; &lt;&lt; rho_TL[25] &lt;&lt; endl;
<span class="lineNum">    4977 </span>            :     cout &lt;&lt; &quot;rho_3point6_3point7_TL = &quot; &lt;&lt; rho_TL[26] &lt;&lt; endl;
<span class="lineNum">    4978 </span>            :     cout &lt;&lt; &quot;rho_3point7_3point8_TL = &quot; &lt;&lt; rho_TL[27] &lt;&lt; endl;
<span class="lineNum">    4979 </span>            :     cout &lt;&lt; &quot;rho_3point8_3point9_TL = &quot; &lt;&lt; rho_TL[28] &lt;&lt; endl;
<span class="lineNum">    4980 </span>            :     cout &lt;&lt; &quot;rho_3point9_4_TL = &quot; &lt;&lt; rho_TL[29] &lt;&lt; endl;
<span class="lineNum">    4981 </span>            :     cout &lt;&lt; &quot;rho_4_4point1_TL = &quot; &lt;&lt; rho_TL[30] &lt;&lt; endl;
<span class="lineNum">    4982 </span>            :     cout &lt;&lt; &quot;rho_4point1_4point2_TL = &quot; &lt;&lt; rho_TL[31] &lt;&lt; endl;
<span class="lineNum">    4983 </span>            :     cout &lt;&lt; &quot;rho_4point2_4point3_TL = &quot; &lt;&lt; rho_TL[32] &lt;&lt; endl;
<span class="lineNum">    4984 </span>            :     cout &lt;&lt; &quot;rho_4point3_4point4_TL = &quot; &lt;&lt; rho_TL[33] &lt;&lt; endl;
<span class="lineNum">    4985 </span>            :     cout &lt;&lt; &quot;rho_4point4_4point5_TL = &quot; &lt;&lt; rho_TL[34] &lt;&lt; endl;
<span class="lineNum">    4986 </span>            :     cout &lt;&lt; &quot;rho_4point5_4point6_TL = &quot; &lt;&lt; rho_TL[35] &lt;&lt; endl;
<span class="lineNum">    4987 </span>            :     cout &lt;&lt; &quot;rho_4point6_4point7_TL = &quot; &lt;&lt; rho_TL[36] &lt;&lt; endl;
<span class="lineNum">    4988 </span>            :     cout &lt;&lt; &quot;rho_4point7_4point8_TL = &quot; &lt;&lt; rho_TL[37] &lt;&lt; endl;
<span class="lineNum">    4989 </span>            :     cout &lt;&lt; &quot;rho_4point8_4point9_TL = &quot; &lt;&lt; rho_TL[38] &lt;&lt; endl;
<span class="lineNum">    4990 </span>            :     cout &lt;&lt; &quot;rho_4point9_5_TL = &quot; &lt;&lt; rho_TL[39] &lt;&lt; endl;
<span class="lineNum">    4991 </span>            :     cout &lt;&lt; &quot;rho_5_5point1_TL = &quot; &lt;&lt; rho_TL[40] &lt;&lt; endl;
<span class="lineNum">    4992 </span>            :     cout &lt;&lt; &quot;rho_5point1_5point2_TL = &quot; &lt;&lt; rho_TL[41] &lt;&lt; endl;
<span class="lineNum">    4993 </span>            :     cout &lt;&lt; &quot;rho_5point2_5point3_TL = &quot; &lt;&lt; rho_TL[42] &lt;&lt; endl;
<span class="lineNum">    4994 </span>            :     cout &lt;&lt; &quot;rho_5point3_5point4_TL = &quot; &lt;&lt; rho_TL[43] &lt;&lt; endl;
<span class="lineNum">    4995 </span>            :     cout &lt;&lt; &quot;rho_5point4_5point5_TL = &quot; &lt;&lt; rho_TL[44] &lt;&lt; endl;
<span class="lineNum">    4996 </span>            : 
<span class="lineNum">    4997 </span>            :     // Flows from organisms of lower or equal TL to those of higher TL
<span class="lineNum">    4998 </span>            :     // Flows from organisms of higher TL to those of lower or equal TL
<span class="lineNum">    4999 </span>            :     // Then work out b_xTL.
<span class="lineNum">    5000 </span>            :     double S_c = number_of_animals();
<span class="lineNum">    5001 </span>            :     double S_f = 0.0;
<span class="lineNum">    5002 </span>            :     sequence&lt;double&gt; b_lowtohigh_TL;
<span class="lineNum">    5003 </span>            :     sequence&lt;double&gt; b_lowtohigh_TL_Mcorrected;
<span class="lineNum">    5004 </span>            :     sequence&lt;double&gt; b_hightolow_TL;
<span class="lineNum">    5005 </span>            :     sequence&lt;double&gt; b_hightolow_TL_Mcorrected;
<span class="lineNum">    5006 </span>            :     for(int i=0;i&lt;36;i++){
<span class="lineNum">    5007 </span>            :       b_lowtohigh_TL[i]=0;
<span class="lineNum">    5008 </span>            :       b_lowtohigh_TL_Mcorrected[i]=0;
<span class="lineNum">    5009 </span>            :       b_hightolow_TL[i]=0;
<span class="lineNum">    5010 </span>            :       b_hightolow_TL_Mcorrected[i]=0;
<span class="lineNum">    5011 </span>            :     }
<span class="lineNum">    5012 </span>            :     double resolog10M = 0.0;
<span class="lineNum">    5013 </span>            :     double conslog10M = 0.0;
<span class="lineNum">    5014 </span>            :     sequence&lt;double&gt; b_dotjI;
<span class="lineNum">    5015 </span>            :     sequence&lt;double&gt; b_dotjIf;
<span class="lineNum">    5016 </span>            :     double b_dotdotI = 0.0;
<span class="lineNum">    5017 </span>            :     double b_dotdotIf = 0.0;
<span class="lineNum">    5018 </span>            :     double resoTL = 0.0;
<span class="lineNum">    5019 </span>            :     double consTL = 0.0;
<span class="lineNum">    5020 </span>            :     double dummy4 = 0.0;
<span class="lineNum">    5021 </span>            :     double dummy6 = 0.0;
<span class="lineNum">    5022 </span>            :     double dummy7 = 0.0;
<span class="lineNum">    5023 </span>            : 
<span class="lineNum">    5024 </span>            :     for(int i=0;i&lt;S;i++){
<span class="lineNum">    5025 </span>            : 
<span class="lineNum">    5026 </span>            :       NewSpecies &amp; reso=s[i];
<span class="lineNum">    5027 </span>            :       resolog10M = log10(reso.bodymass()/unit_mass);
<span class="lineNum">    5028 </span>            :       resoTL = level[i];
<span class="lineNum">    5029 </span>            :       dummy4 = 0;
<span class="lineNum">    5030 </span>            :       dummy6 = 0;     
<span class="lineNum">    5031 </span>            : 
<span class="lineNum">    5032 </span>            :       for(int j=0;j&lt;S;j++){
<span class="lineNum">    5033 </span>            :         
<span class="lineNum">    5034 </span>            :         NewSpecies &amp; cons=s[j];     
<span class="lineNum">    5035 </span>            :         conslog10M = log10(cons.bodymass()/unit_mass);
<span class="lineNum">    5036 </span>            :         consTL = level[j];
<span class="lineNum">    5037 </span>            :         // Update sums for calculation of flows for species
<span class="lineNum">    5038 </span>            :         dummy4 += intake(j,i)/unit_mass/area/(1/year);
<span class="lineNum">    5039 </span>            :         b_dotdotI += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5040 </span>            :         if(resolog10M &gt; -3){
<span class="lineNum">    5041 </span>            :           dummy6 += intake(j,i)/unit_mass/area/(1/year);
<span class="lineNum">    5042 </span>            :         }
<span class="lineNum">    5043 </span>            :         if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){
<span class="lineNum">    5044 </span>            :           dummy6 += intake(j,i)/unit_mass/area/(1/year);
<span class="lineNum">    5045 </span>            :         }
<span class="lineNum">    5046 </span>            :         if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &lt;= -3)){
<span class="lineNum">    5047 </span>            :         dummy7 += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5048 </span>            :         }
<span class="lineNum">    5049 </span>            :          
<span class="lineNum">    5050 </span>            :         if((resoTL &lt;= 1.9)&amp;&amp;(consTL &gt; 1.9)){
<span class="lineNum">    5051 </span>            :           b_lowtohigh_TL[0] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5052 </span>            :           b_lowtohigh_TL_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5053 </span>            :         }
<span class="lineNum">    5054 </span>            :         if((resoTL &lt;= 2)&amp;&amp;(consTL &gt; 2)){
<span class="lineNum">    5055 </span>            :           b_lowtohigh_TL[1] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5056 </span>            :           b_lowtohigh_TL_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5057 </span>            :         }
<span class="lineNum">    5058 </span>            :         if((resoTL &lt;= 2.1)&amp;&amp;(consTL &gt; 2.1)){
<span class="lineNum">    5059 </span>            :           b_lowtohigh_TL[2] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5060 </span>            :           b_lowtohigh_TL_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5061 </span>            :         }
<span class="lineNum">    5062 </span>            :         if((resoTL &lt;= 2.2)&amp;&amp;(consTL &gt; 2.2)){
<span class="lineNum">    5063 </span>            :           b_lowtohigh_TL[3] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5064 </span>            :           b_lowtohigh_TL_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5065 </span>            :         }
<span class="lineNum">    5066 </span>            :         if((resoTL &lt;= 2.3)&amp;&amp;(consTL &gt; 2.3)){
<span class="lineNum">    5067 </span>            :           b_lowtohigh_TL[4] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5068 </span>            :           b_lowtohigh_TL_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5069 </span>            :         }
<span class="lineNum">    5070 </span>            :         if((resoTL &lt;= 2.4)&amp;&amp;(consTL &gt; 2.4)){
<span class="lineNum">    5071 </span>            :           b_lowtohigh_TL[5] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5072 </span>            :           b_lowtohigh_TL_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5073 </span>            :         }
<span class="lineNum">    5074 </span>            :         if((resoTL &lt;= 2.5)&amp;&amp;(consTL &gt; 2.5)){
<span class="lineNum">    5075 </span>            :           b_lowtohigh_TL[6] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5076 </span>            :           b_lowtohigh_TL_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5077 </span>            :         }
<span class="lineNum">    5078 </span>            :         if((resoTL &lt;= 2.6)&amp;&amp;(consTL &gt; 2.6)){
<span class="lineNum">    5079 </span>            :           b_lowtohigh_TL[7] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5080 </span>            :           b_lowtohigh_TL_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5081 </span>            :         }
<span class="lineNum">    5082 </span>            :         if((resoTL &lt;= 2.7)&amp;&amp;(consTL &gt; 2.7)){
<span class="lineNum">    5083 </span>            :           b_lowtohigh_TL[8] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5084 </span>            :           b_lowtohigh_TL_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5085 </span>            :         }
<span class="lineNum">    5086 </span>            :         if((resoTL &lt;= 2.8)&amp;&amp;(consTL &gt; 2.8)){
<span class="lineNum">    5087 </span>            :           b_lowtohigh_TL[9] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5088 </span>            :           b_lowtohigh_TL_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5089 </span>            :         }
<span class="lineNum">    5090 </span>            :         if((resoTL &lt;= 2.9)&amp;&amp;(consTL &gt; 2.9)){
<span class="lineNum">    5091 </span>            :           b_lowtohigh_TL[10] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5092 </span>            :           b_lowtohigh_TL_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5093 </span>            :         }
<span class="lineNum">    5094 </span>            :         if((resoTL &lt;= 3)&amp;&amp;(consTL &gt; 3)){
<span class="lineNum">    5095 </span>            :           b_lowtohigh_TL[11] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5096 </span>            :           b_lowtohigh_TL_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5097 </span>            :         }
<span class="lineNum">    5098 </span>            :         if((resoTL &lt;= 3.1)&amp;&amp;(consTL &gt; 3.1)){
<span class="lineNum">    5099 </span>            :           b_lowtohigh_TL[12] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5100 </span>            :           b_lowtohigh_TL_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5101 </span>            :         }
<span class="lineNum">    5102 </span>            :         if((resoTL &lt;= 3.2)&amp;&amp;(consTL &gt; 3.2)){
<span class="lineNum">    5103 </span>            :           b_lowtohigh_TL[13] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5104 </span>            :           b_lowtohigh_TL_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5105 </span>            :         }
<span class="lineNum">    5106 </span>            :         if((resoTL &lt;= 3.3)&amp;&amp;(consTL &gt; 3.3)){
<span class="lineNum">    5107 </span>            :           b_lowtohigh_TL[14] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5108 </span>            :           b_lowtohigh_TL_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5109 </span>            :         }
<span class="lineNum">    5110 </span>            :         if((resoTL &lt;= 3.4)&amp;&amp;(consTL &gt; 3.4)){
<span class="lineNum">    5111 </span>            :           b_lowtohigh_TL[15] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5112 </span>            :           b_lowtohigh_TL_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5113 </span>            :         }
<span class="lineNum">    5114 </span>            :         if((resoTL &lt;= 3.5)&amp;&amp;(consTL &gt; 3.5)){
<span class="lineNum">    5115 </span>            :           b_lowtohigh_TL[16] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5116 </span>            :           b_lowtohigh_TL_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5117 </span>            :         }
<span class="lineNum">    5118 </span>            :         if((resoTL &lt;= 3.6)&amp;&amp;(consTL &gt; 3.6)){
<span class="lineNum">    5119 </span>            :           b_lowtohigh_TL[17] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5120 </span>            :           b_lowtohigh_TL_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5121 </span>            :         }
<span class="lineNum">    5122 </span>            :         if((resoTL &lt;= 3.7)&amp;&amp;(consTL &gt; 3.7)){
<span class="lineNum">    5123 </span>            :           b_lowtohigh_TL[18] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5124 </span>            :           b_lowtohigh_TL_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5125 </span>            :         }
<span class="lineNum">    5126 </span>            :         if((resoTL &lt;= 3.8)&amp;&amp;(consTL &gt; 3.8)){
<span class="lineNum">    5127 </span>            :           b_lowtohigh_TL[19] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5128 </span>            :           b_lowtohigh_TL_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5129 </span>            :         }
<span class="lineNum">    5130 </span>            :         if((resoTL &lt;= 3.9)&amp;&amp;(consTL &gt; 3.9)){
<span class="lineNum">    5131 </span>            :           b_lowtohigh_TL[20] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5132 </span>            :           b_lowtohigh_TL_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5133 </span>            :         }
<span class="lineNum">    5134 </span>            :         if((resoTL &lt;= 4)&amp;&amp;(consTL &gt; 4)){
<span class="lineNum">    5135 </span>            :           b_lowtohigh_TL[21] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5136 </span>            :           b_lowtohigh_TL_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5137 </span>            :         }
<span class="lineNum">    5138 </span>            :         if((resoTL &lt;= 4.1)&amp;&amp;(consTL &gt; 4.1)){
<span class="lineNum">    5139 </span>            :           b_lowtohigh_TL[22] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5140 </span>            :           b_lowtohigh_TL_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5141 </span>            :         }
<span class="lineNum">    5142 </span>            :         if((resoTL &lt;= 4.2)&amp;&amp;(consTL &gt; 4.2)){
<span class="lineNum">    5143 </span>            :           b_lowtohigh_TL[23] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5144 </span>            :           b_lowtohigh_TL_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5145 </span>            :         }
<span class="lineNum">    5146 </span>            :         if((resoTL &lt;= 4.3)&amp;&amp;(consTL &gt; 4.3)){
<span class="lineNum">    5147 </span>            :           b_lowtohigh_TL[24] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5148 </span>            :           b_lowtohigh_TL_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5149 </span>            :         }
<span class="lineNum">    5150 </span>            :         if((resoTL &lt;= 4.4)&amp;&amp;(consTL &gt; 4.4)){
<span class="lineNum">    5151 </span>            :           b_lowtohigh_TL[25] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5152 </span>            :           b_lowtohigh_TL_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5153 </span>            :         }
<span class="lineNum">    5154 </span>            :         if((resoTL &lt;= 4.5)&amp;&amp;(consTL &gt; 4.5)){
<span class="lineNum">    5155 </span>            :           b_lowtohigh_TL[26] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5156 </span>            :           b_lowtohigh_TL_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5157 </span>            :         }
<span class="lineNum">    5158 </span>            :         if((resoTL &lt;= 4.6)&amp;&amp;(consTL &gt; 4.6)){
<span class="lineNum">    5159 </span>            :           b_lowtohigh_TL[27] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5160 </span>            :           b_lowtohigh_TL_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5161 </span>            :         }
<span class="lineNum">    5162 </span>            :         if((resoTL &lt;= 4.7)&amp;&amp;(consTL &gt; 4.7)){
<span class="lineNum">    5163 </span>            :           b_lowtohigh_TL[28] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5164 </span>            :           b_lowtohigh_TL_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5165 </span>            :         }
<span class="lineNum">    5166 </span>            :         if((resoTL &lt;= 4.8)&amp;&amp;(consTL &gt; 4.8)){
<span class="lineNum">    5167 </span>            :           b_lowtohigh_TL[29] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5168 </span>            :           b_lowtohigh_TL_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5169 </span>            :         }
<span class="lineNum">    5170 </span>            :         if((resoTL &lt;= 4.9)&amp;&amp;(consTL &gt; 4.9)){
<span class="lineNum">    5171 </span>            :           b_lowtohigh_TL[30] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5172 </span>            :           b_lowtohigh_TL_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5173 </span>            :         }
<span class="lineNum">    5174 </span>            :         if((resoTL &lt;= 5)&amp;&amp;(consTL &gt; 5)){
<span class="lineNum">    5175 </span>            :           b_lowtohigh_TL[31] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5176 </span>            :           b_lowtohigh_TL_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5177 </span>            :         }
<span class="lineNum">    5178 </span>            :         if((resoTL &lt;= 5.1)&amp;&amp;(consTL &gt; 5.1)){
<span class="lineNum">    5179 </span>            :           b_lowtohigh_TL[32] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5180 </span>            :           b_lowtohigh_TL_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5181 </span>            :         }
<span class="lineNum">    5182 </span>            :         if((resoTL &lt;= 5.2)&amp;&amp;(consTL &gt; 5.2)){
<span class="lineNum">    5183 </span>            :           b_lowtohigh_TL[33] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5184 </span>            :           b_lowtohigh_TL_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5185 </span>            :         }
<span class="lineNum">    5186 </span>            :         if((resoTL &lt;= 5.3)&amp;&amp;(consTL &gt; 5.3)){
<span class="lineNum">    5187 </span>            :           b_lowtohigh_TL[34] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5188 </span>            :           b_lowtohigh_TL_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5189 </span>            :         }
<span class="lineNum">    5190 </span>            :         if((resoTL &lt;= 5.4)&amp;&amp;(consTL &gt; 5.4)){
<span class="lineNum">    5191 </span>            :           b_lowtohigh_TL[35] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5192 </span>            :           b_lowtohigh_TL_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5193 </span>            :         }
<span class="lineNum">    5194 </span>            :         
<span class="lineNum">    5195 </span>            :         if((resoTL &gt; 1.9)&amp;&amp;(consTL &lt;= 1.9)){
<span class="lineNum">    5196 </span>            :           b_hightolow_TL[0] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5197 </span>            :           b_hightolow_TL_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5198 </span>            :         }
<span class="lineNum">    5199 </span>            :         if((resoTL &gt; 2)&amp;&amp;(consTL &lt;= 2)){
<span class="lineNum">    5200 </span>            :           b_hightolow_TL[1] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5201 </span>            :           b_hightolow_TL_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5202 </span>            :         }
<span class="lineNum">    5203 </span>            :         if((resoTL &gt; 2.1)&amp;&amp;(consTL &lt;= 2.1)){
<span class="lineNum">    5204 </span>            :           b_hightolow_TL[2] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5205 </span>            :           b_hightolow_TL_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5206 </span>            :         }
<span class="lineNum">    5207 </span>            :         if((resoTL &gt; 2.2)&amp;&amp;(consTL &lt;= 2.2)){
<span class="lineNum">    5208 </span>            :           b_hightolow_TL[3] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5209 </span>            :           b_hightolow_TL_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5210 </span>            :         }
<span class="lineNum">    5211 </span>            :         if((resoTL &gt; 2.3)&amp;&amp;(consTL &lt;= 2.3)){
<span class="lineNum">    5212 </span>            :           b_hightolow_TL[4] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5213 </span>            :           b_hightolow_TL_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5214 </span>            :         }
<span class="lineNum">    5215 </span>            :         if((resoTL &gt; 2.4)&amp;&amp;(consTL &lt;= 2.4)){
<span class="lineNum">    5216 </span>            :           b_hightolow_TL[5] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5217 </span>            :           b_hightolow_TL_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5218 </span>            :         }
<span class="lineNum">    5219 </span>            :         if((resoTL &gt; 2.5)&amp;&amp;(consTL &lt;= 2.5)){
<span class="lineNum">    5220 </span>            :           b_hightolow_TL[6] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5221 </span>            :           b_hightolow_TL_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5222 </span>            :         }
<span class="lineNum">    5223 </span>            :         if((resoTL &gt; 2.6)&amp;&amp;(consTL &lt;= 2.6)){
<span class="lineNum">    5224 </span>            :           b_hightolow_TL[7] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5225 </span>            :           b_hightolow_TL_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5226 </span>            :         }
<span class="lineNum">    5227 </span>            :         if((resoTL &gt; 2.7)&amp;&amp;(consTL &lt;= 2.7)){
<span class="lineNum">    5228 </span>            :           b_hightolow_TL[8] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5229 </span>            :           b_hightolow_TL_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5230 </span>            :         }
<span class="lineNum">    5231 </span>            :         if((resoTL &gt; 2.8)&amp;&amp;(consTL &lt;= 2.8)){
<span class="lineNum">    5232 </span>            :           b_hightolow_TL[9] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5233 </span>            :           b_hightolow_TL_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5234 </span>            :         }
<span class="lineNum">    5235 </span>            :         if((resoTL &gt; 2.9)&amp;&amp;(consTL &lt;= 2.9)){
<span class="lineNum">    5236 </span>            :           b_hightolow_TL[10] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5237 </span>            :           b_hightolow_TL_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5238 </span>            :         }
<span class="lineNum">    5239 </span>            :         if((resoTL &gt; 3)&amp;&amp;(consTL &lt;= 3)){
<span class="lineNum">    5240 </span>            :           b_hightolow_TL[11] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5241 </span>            :           b_hightolow_TL_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5242 </span>            :         }
<span class="lineNum">    5243 </span>            :         if((resoTL &gt; 3.1)&amp;&amp;(consTL &lt;= 3.1)){
<span class="lineNum">    5244 </span>            :           b_hightolow_TL[12] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5245 </span>            :           b_hightolow_TL_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5246 </span>            :         }
<span class="lineNum">    5247 </span>            :         if((resoTL &gt; 3.2)&amp;&amp;(consTL &lt;= 3.2)){
<span class="lineNum">    5248 </span>            :           b_hightolow_TL[13] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5249 </span>            :           b_hightolow_TL_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5250 </span>            :         }
<span class="lineNum">    5251 </span>            :         if((resoTL &gt; 3.3)&amp;&amp;(consTL &lt;= 3.3)){
<span class="lineNum">    5252 </span>            :           b_hightolow_TL[14] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5253 </span>            :           b_hightolow_TL_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5254 </span>            :         }
<span class="lineNum">    5255 </span>            :         if((resoTL &gt; 3.4)&amp;&amp;(consTL &lt;= 3.4)){
<span class="lineNum">    5256 </span>            :           b_hightolow_TL[15] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5257 </span>            :           b_hightolow_TL_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5258 </span>            :         }
<span class="lineNum">    5259 </span>            :         if((resoTL &gt; 3.5)&amp;&amp;(consTL &lt;= 3.5)){
<span class="lineNum">    5260 </span>            :           b_hightolow_TL[16] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5261 </span>            :           b_hightolow_TL_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5262 </span>            :         }
<span class="lineNum">    5263 </span>            :         if((resoTL &gt; 3.6)&amp;&amp;(consTL &lt;= 3.6)){
<span class="lineNum">    5264 </span>            :           b_hightolow_TL[17] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5265 </span>            :           b_hightolow_TL_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5266 </span>            :         }
<span class="lineNum">    5267 </span>            :         if((resoTL &gt; 3.7)&amp;&amp;(consTL &lt;= 3.7)){
<span class="lineNum">    5268 </span>            :           b_hightolow_TL[18] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5269 </span>            :           b_hightolow_TL_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5270 </span>            :         }
<span class="lineNum">    5271 </span>            :         if((resoTL &gt; 3.8)&amp;&amp;(consTL &lt;= 3.8)){
<span class="lineNum">    5272 </span>            :           b_hightolow_TL[19] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5273 </span>            :           b_hightolow_TL_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5274 </span>            :         }
<span class="lineNum">    5275 </span>            :         if((resoTL &gt; 3.9)&amp;&amp;(consTL &lt;= 3.9)){
<span class="lineNum">    5276 </span>            :           b_hightolow_TL[20] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5277 </span>            :           b_hightolow_TL_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5278 </span>            :         }
<span class="lineNum">    5279 </span>            :         if((resoTL &gt; 4)&amp;&amp;(consTL &lt;= 4)){
<span class="lineNum">    5280 </span>            :           b_hightolow_TL[21] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5281 </span>            :           b_hightolow_TL_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5282 </span>            :         }
<span class="lineNum">    5283 </span>            :         if((resoTL &gt; 4.1)&amp;&amp;(consTL &lt;= 4.1)){
<span class="lineNum">    5284 </span>            :           b_hightolow_TL[22] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5285 </span>            :           b_hightolow_TL_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5286 </span>            :         }
<span class="lineNum">    5287 </span>            :         if((resoTL &gt; 4.2)&amp;&amp;(consTL &lt;= 4.2)){
<span class="lineNum">    5288 </span>            :           b_hightolow_TL[23] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5289 </span>            :           b_hightolow_TL_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5290 </span>            :         }
<span class="lineNum">    5291 </span>            :         if((resoTL &gt; 4.3)&amp;&amp;(consTL &lt;= 4.3)){
<span class="lineNum">    5292 </span>            :           b_hightolow_TL[24] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5293 </span>            :           b_hightolow_TL_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5294 </span>            :         }
<span class="lineNum">    5295 </span>            :         if((resoTL &gt; 4.4)&amp;&amp;(consTL &lt;= 4.4)){
<span class="lineNum">    5296 </span>            :           b_hightolow_TL[25] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5297 </span>            :           b_hightolow_TL_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5298 </span>            :         }
<span class="lineNum">    5299 </span>            :         if((resoTL &gt; 4.5)&amp;&amp;(consTL &lt;= 4.5)){
<span class="lineNum">    5300 </span>            :           b_hightolow_TL[26] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5301 </span>            :           b_hightolow_TL_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5302 </span>            :         }
<span class="lineNum">    5303 </span>            :         if((resoTL &gt; 4.6)&amp;&amp;(consTL &lt;= 4.6)){
<span class="lineNum">    5304 </span>            :           b_hightolow_TL[27] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5305 </span>            :           b_hightolow_TL_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5306 </span>            :         }
<span class="lineNum">    5307 </span>            :         if((resoTL &gt; 4.7)&amp;&amp;(consTL &lt;= 4.7)){
<span class="lineNum">    5308 </span>            :           b_hightolow_TL[28] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5309 </span>            :           b_hightolow_TL_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5310 </span>            :         }
<span class="lineNum">    5311 </span>            :         if((resoTL &gt; 4.8)&amp;&amp;(consTL &lt;= 4.8)){
<span class="lineNum">    5312 </span>            :           b_hightolow_TL[29] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5313 </span>            :           b_hightolow_TL_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5314 </span>            :         }
<span class="lineNum">    5315 </span>            :         if((resoTL &gt; 4.9)&amp;&amp;(consTL &lt;= 4.9)){
<span class="lineNum">    5316 </span>            :           b_hightolow_TL[30] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5317 </span>            :           b_hightolow_TL_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5318 </span>            :         }
<span class="lineNum">    5319 </span>            :         if((resoTL &gt; 5)&amp;&amp;(consTL &lt;= 5)){
<span class="lineNum">    5320 </span>            :           b_hightolow_TL[31] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5321 </span>            :           b_hightolow_TL_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5322 </span>            :         }
<span class="lineNum">    5323 </span>            :         if((resoTL &gt; 5.1)&amp;&amp;(consTL &lt;= 5.1)){
<span class="lineNum">    5324 </span>            :           b_hightolow_TL[32] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5325 </span>            :           b_hightolow_TL_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5326 </span>            :         }
<span class="lineNum">    5327 </span>            :         if((resoTL &gt; 5.2)&amp;&amp;(consTL &lt;= 5.2)){
<span class="lineNum">    5328 </span>            :           b_hightolow_TL[33] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5329 </span>            :           b_hightolow_TL_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5330 </span>            :         }
<span class="lineNum">    5331 </span>            :         if((resoTL &gt; 5.3)&amp;&amp;(consTL &lt;= 5.3)){
<span class="lineNum">    5332 </span>            :           b_hightolow_TL[34] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5333 </span>            :           b_hightolow_TL_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5334 </span>            :         }
<span class="lineNum">    5335 </span>            :         if((resoTL &gt; 5.4)&amp;&amp;(consTL &lt;= 5.4)){
<span class="lineNum">    5336 </span>            :           b_hightolow_TL[35] += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5337 </span>            :           b_hightolow_TL_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));
<span class="lineNum">    5338 </span>            :         }
<span class="lineNum">    5339 </span>            : 
<span class="lineNum">    5340 </span>            :         // close loop for j
<span class="lineNum">    5341 </span>            :       }
<span class="lineNum">    5342 </span>            : 
<span class="lineNum">    5343 </span>            :       // Update vectors of flows for species
<span class="lineNum">    5344 </span>            :       b_dotjI[i] = dummy4;
<span class="lineNum">    5345 </span>            :       b_dotjIf[i] = dummy6;
<span class="lineNum">    5346 </span>            :       
<span class="lineNum">    5347 </span>            :       // Update species richness
<span class="lineNum">    5348 </span>            :       if(resolog10M &gt; -3){
<span class="lineNum">    5349 </span>            :         S_f += 1;
<span class="lineNum">    5350 </span>            :       }
<span class="lineNum">    5351 </span>            :       
<span class="lineNum">    5352 </span>            :       // close loop for i 
<span class="lineNum">    5353 </span>            :     }
<span class="lineNum">    5354 </span>            : 
<span class="lineNum">    5355 </span>            :     b_dotdotIf = b_dotdotI - dummy7;
<span class="lineNum">    5356 </span>            : 
<span class="lineNum">    5357 </span>            :     cout &lt;&lt; &quot;b_1point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[0]-b_hightolow_TL[0] &lt;&lt; endl;
<span class="lineNum">    5358 </span>            :     cout &lt;&lt; &quot;b_2_TL = &quot; &lt;&lt; b_lowtohigh_TL[1]-b_hightolow_TL[1] &lt;&lt; endl;
<span class="lineNum">    5359 </span>            :     cout &lt;&lt; &quot;b_2point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[2]-b_hightolow_TL[2] &lt;&lt; endl;
<span class="lineNum">    5360 </span>            :     cout &lt;&lt; &quot;b_2point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[3]-b_hightolow_TL[3] &lt;&lt; endl;
<span class="lineNum">    5361 </span>            :     cout &lt;&lt; &quot;b_2point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[4]-b_hightolow_TL[4] &lt;&lt; endl;
<span class="lineNum">    5362 </span>            :     cout &lt;&lt; &quot;b_2point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[5]-b_hightolow_TL[5] &lt;&lt; endl;
<span class="lineNum">    5363 </span>            :     cout &lt;&lt; &quot;b_2point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[6]-b_hightolow_TL[6] &lt;&lt; endl;
<span class="lineNum">    5364 </span>            :     cout &lt;&lt; &quot;b_2point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[7]-b_hightolow_TL[7] &lt;&lt; endl;
<span class="lineNum">    5365 </span>            :     cout &lt;&lt; &quot;b_2point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[8]-b_hightolow_TL[8] &lt;&lt; endl;
<span class="lineNum">    5366 </span>            :     cout &lt;&lt; &quot;b_2point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[9]-b_hightolow_TL[9] &lt;&lt; endl;
<span class="lineNum">    5367 </span>            :     cout &lt;&lt; &quot;b_2point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[10]-b_hightolow_TL[10] &lt;&lt; endl;
<span class="lineNum">    5368 </span>            :     cout &lt;&lt; &quot;b_3_TL = &quot; &lt;&lt; b_lowtohigh_TL[11]-b_hightolow_TL[11] &lt;&lt; endl;
<span class="lineNum">    5369 </span>            :     cout &lt;&lt; &quot;b_3point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[12]-b_hightolow_TL[12] &lt;&lt; endl;
<span class="lineNum">    5370 </span>            :     cout &lt;&lt; &quot;b_3point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[13]-b_hightolow_TL[13] &lt;&lt; endl;
<span class="lineNum">    5371 </span>            :     cout &lt;&lt; &quot;b_3point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[14]-b_hightolow_TL[14] &lt;&lt; endl;
<span class="lineNum">    5372 </span>            :     cout &lt;&lt; &quot;b_3point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[15]-b_hightolow_TL[15] &lt;&lt; endl;
<span class="lineNum">    5373 </span>            :     cout &lt;&lt; &quot;b_3point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[16]-b_hightolow_TL[16] &lt;&lt; endl;
<span class="lineNum">    5374 </span>            :     cout &lt;&lt; &quot;b_3point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[17]-b_hightolow_TL[17] &lt;&lt; endl;
<span class="lineNum">    5375 </span>            :     cout &lt;&lt; &quot;b_3point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[18]-b_hightolow_TL[18] &lt;&lt; endl;
<span class="lineNum">    5376 </span>            :     cout &lt;&lt; &quot;b_3point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[19]-b_hightolow_TL[19] &lt;&lt; endl;
<span class="lineNum">    5377 </span>            :     cout &lt;&lt; &quot;b_3point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[20]-b_hightolow_TL[20] &lt;&lt; endl;
<span class="lineNum">    5378 </span>            :     cout &lt;&lt; &quot;b_4_TL = &quot; &lt;&lt; b_lowtohigh_TL[21]-b_hightolow_TL[21] &lt;&lt; endl;
<span class="lineNum">    5379 </span>            :     cout &lt;&lt; &quot;b_4point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[22]-b_hightolow_TL[22] &lt;&lt; endl;
<span class="lineNum">    5380 </span>            :     cout &lt;&lt; &quot;b_4point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[23]-b_hightolow_TL[23] &lt;&lt; endl;
<span class="lineNum">    5381 </span>            :     cout &lt;&lt; &quot;b_4point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[24]-b_hightolow_TL[24] &lt;&lt; endl;
<span class="lineNum">    5382 </span>            :     cout &lt;&lt; &quot;b_4point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[25]-b_hightolow_TL[25] &lt;&lt; endl;
<span class="lineNum">    5383 </span>            :     cout &lt;&lt; &quot;b_4point5_TL = &quot; &lt;&lt; b_lowtohigh_TL[26]-b_hightolow_TL[26] &lt;&lt; endl;
<span class="lineNum">    5384 </span>            :     cout &lt;&lt; &quot;b_4point6_TL = &quot; &lt;&lt; b_lowtohigh_TL[27]-b_hightolow_TL[27] &lt;&lt; endl;
<span class="lineNum">    5385 </span>            :     cout &lt;&lt; &quot;b_4point7_TL = &quot; &lt;&lt; b_lowtohigh_TL[28]-b_hightolow_TL[28] &lt;&lt; endl;
<span class="lineNum">    5386 </span>            :     cout &lt;&lt; &quot;b_4point8_TL = &quot; &lt;&lt; b_lowtohigh_TL[29]-b_hightolow_TL[29] &lt;&lt; endl;
<span class="lineNum">    5387 </span>            :     cout &lt;&lt; &quot;b_4point9_TL = &quot; &lt;&lt; b_lowtohigh_TL[30]-b_hightolow_TL[30] &lt;&lt; endl;
<span class="lineNum">    5388 </span>            :     cout &lt;&lt; &quot;b_5_TL = &quot; &lt;&lt; b_lowtohigh_TL[31]-b_hightolow_TL[31] &lt;&lt; endl;
<span class="lineNum">    5389 </span>            :     cout &lt;&lt; &quot;b_5point1_TL = &quot; &lt;&lt; b_lowtohigh_TL[32]-b_hightolow_TL[32] &lt;&lt; endl;
<span class="lineNum">    5390 </span>            :     cout &lt;&lt; &quot;b_5point2_TL = &quot; &lt;&lt; b_lowtohigh_TL[33]-b_hightolow_TL[33] &lt;&lt; endl;
<span class="lineNum">    5391 </span>            :     cout &lt;&lt; &quot;b_5point3_TL = &quot; &lt;&lt; b_lowtohigh_TL[34]-b_hightolow_TL[34] &lt;&lt; endl;
<span class="lineNum">    5392 </span>            :     cout &lt;&lt; &quot;b_5point4_TL = &quot; &lt;&lt; b_lowtohigh_TL[35]-b_hightolow_TL[35] &lt;&lt; endl;
<span class="lineNum">    5393 </span>            :     cout &lt;&lt; &quot;b_1point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[0]-b_hightolow_TL_Mcorrected[0] &lt;&lt; endl;
<span class="lineNum">    5394 </span>            :     cout &lt;&lt; &quot;b_2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[1]-b_hightolow_TL_Mcorrected[1] &lt;&lt; endl;
<span class="lineNum">    5395 </span>            :     cout &lt;&lt; &quot;b_2point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[2]-b_hightolow_TL_Mcorrected[2] &lt;&lt; endl;
<span class="lineNum">    5396 </span>            :     cout &lt;&lt; &quot;b_2point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[3]-b_hightolow_TL_Mcorrected[3] &lt;&lt; endl;
<span class="lineNum">    5397 </span>            :     cout &lt;&lt; &quot;b_2point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[4]-b_hightolow_TL_Mcorrected[4] &lt;&lt; endl;
<span class="lineNum">    5398 </span>            :     cout &lt;&lt; &quot;b_2point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[5]-b_hightolow_TL_Mcorrected[5] &lt;&lt; endl;
<span class="lineNum">    5399 </span>            :     cout &lt;&lt; &quot;b_2point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[6]-b_hightolow_TL_Mcorrected[6] &lt;&lt; endl;
<span class="lineNum">    5400 </span>            :     cout &lt;&lt; &quot;b_2point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[7]-b_hightolow_TL_Mcorrected[7] &lt;&lt; endl;
<span class="lineNum">    5401 </span>            :     cout &lt;&lt; &quot;b_2point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[8]-b_hightolow_TL_Mcorrected[8] &lt;&lt; endl;
<span class="lineNum">    5402 </span>            :     cout &lt;&lt; &quot;b_2point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[9]-b_hightolow_TL_Mcorrected[9] &lt;&lt; endl;
<span class="lineNum">    5403 </span>            :     cout &lt;&lt; &quot;b_2point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[10]-b_hightolow_TL_Mcorrected[10] &lt;&lt; endl;
<span class="lineNum">    5404 </span>            :     cout &lt;&lt; &quot;b_3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[11]-b_hightolow_TL_Mcorrected[11] &lt;&lt; endl;
<span class="lineNum">    5405 </span>            :     cout &lt;&lt; &quot;b_3point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[12]-b_hightolow_TL_Mcorrected[12] &lt;&lt; endl;
<span class="lineNum">    5406 </span>            :     cout &lt;&lt; &quot;b_3point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[13]-b_hightolow_TL_Mcorrected[13] &lt;&lt; endl;
<span class="lineNum">    5407 </span>            :     cout &lt;&lt; &quot;b_3point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[14]-b_hightolow_TL_Mcorrected[14] &lt;&lt; endl;
<span class="lineNum">    5408 </span>            :     cout &lt;&lt; &quot;b_3point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[15]-b_hightolow_TL_Mcorrected[15] &lt;&lt; endl;
<span class="lineNum">    5409 </span>            :     cout &lt;&lt; &quot;b_3point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[16]-b_hightolow_TL_Mcorrected[16] &lt;&lt; endl;
<span class="lineNum">    5410 </span>            :     cout &lt;&lt; &quot;b_3point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[17]-b_hightolow_TL_Mcorrected[17] &lt;&lt; endl;
<span class="lineNum">    5411 </span>            :     cout &lt;&lt; &quot;b_3point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[18]-b_hightolow_TL_Mcorrected[18] &lt;&lt; endl;
<span class="lineNum">    5412 </span>            :     cout &lt;&lt; &quot;b_3point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[19]-b_hightolow_TL_Mcorrected[19] &lt;&lt; endl;
<span class="lineNum">    5413 </span>            :     cout &lt;&lt; &quot;b_3point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[20]-b_hightolow_TL_Mcorrected[20] &lt;&lt; endl;
<span class="lineNum">    5414 </span>            :     cout &lt;&lt; &quot;b_4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[21]-b_hightolow_TL_Mcorrected[21] &lt;&lt; endl;
<span class="lineNum">    5415 </span>            :     cout &lt;&lt; &quot;b_4point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[22]-b_hightolow_TL_Mcorrected[22] &lt;&lt; endl;
<span class="lineNum">    5416 </span>            :     cout &lt;&lt; &quot;b_4point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[23]-b_hightolow_TL_Mcorrected[23] &lt;&lt; endl;
<span class="lineNum">    5417 </span>            :     cout &lt;&lt; &quot;b_4point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[24]-b_hightolow_TL_Mcorrected[24] &lt;&lt; endl;
<span class="lineNum">    5418 </span>            :     cout &lt;&lt; &quot;b_4point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[25]-b_hightolow_TL_Mcorrected[25] &lt;&lt; endl;
<span class="lineNum">    5419 </span>            :     cout &lt;&lt; &quot;b_4point5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[26]-b_hightolow_TL_Mcorrected[26] &lt;&lt; endl;
<span class="lineNum">    5420 </span>            :     cout &lt;&lt; &quot;b_4point6_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[27]-b_hightolow_TL_Mcorrected[27] &lt;&lt; endl;
<span class="lineNum">    5421 </span>            :     cout &lt;&lt; &quot;b_4point7_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[28]-b_hightolow_TL_Mcorrected[28] &lt;&lt; endl;
<span class="lineNum">    5422 </span>            :     cout &lt;&lt; &quot;b_4point8_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[29]-b_hightolow_TL_Mcorrected[29] &lt;&lt; endl;
<span class="lineNum">    5423 </span>            :     cout &lt;&lt; &quot;b_4point9_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[30]-b_hightolow_TL_Mcorrected[30] &lt;&lt; endl;
<span class="lineNum">    5424 </span>            :     cout &lt;&lt; &quot;b_5_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[31]-b_hightolow_TL_Mcorrected[31] &lt;&lt; endl;
<span class="lineNum">    5425 </span>            :     cout &lt;&lt; &quot;b_5point1_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[32]-b_hightolow_TL_Mcorrected[32] &lt;&lt; endl;
<span class="lineNum">    5426 </span>            :     cout &lt;&lt; &quot;b_5point2_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[33]-b_hightolow_TL_Mcorrected[33] &lt;&lt; endl;
<span class="lineNum">    5427 </span>            :     cout &lt;&lt; &quot;b_5point3_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[34]-b_hightolow_TL_Mcorrected[34] &lt;&lt; endl;
<span class="lineNum">    5428 </span>            :     cout &lt;&lt; &quot;b_5point4_TL_Mcorrected = &quot; &lt;&lt; b_lowtohigh_TL_Mcorrected[35]-b_hightolow_TL_Mcorrected[35] &lt;&lt; endl;
<span class="lineNum">    5429 </span>            : 
<span class="lineNum">    5430 </span>            :     sequence&lt;double&gt; omn_j;
<span class="lineNum">    5431 </span>            :     double dummy100 = 0.0;
<span class="lineNum">    5432 </span>            :     double dummy101 = 0.0;
<span class="lineNum">    5433 </span>            :     double dummy110 = 0.0;
<span class="lineNum">    5434 </span>            :     double dummy111 = 0.0;
<span class="lineNum">    5435 </span>            :     double dummy112 = 0.0;
<span class="lineNum">    5436 </span>            :     double dummy113 = 0.0;
<span class="lineNum">    5437 </span>            :     double dummy114 = 0.0;
<span class="lineNum">    5438 </span>            :     double dummy115 = 0.0;
<span class="lineNum">    5439 </span>            : 
<span class="lineNum">    5440 </span>            :     for(int i=0;i&lt;S;i++){
<span class="lineNum">    5441 </span>            : 
<span class="lineNum">    5442 </span>            :       // Reset sums for vectors
<span class="lineNum">    5443 </span>            :       dummy110 = 0;
<span class="lineNum">    5444 </span>            : 
<span class="lineNum">    5445 </span>            :       for(int j=0;j&lt;S;j++){
<span class="lineNum">    5446 </span>            : 
<span class="lineNum">    5447 </span>            :         dummy100 = intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5448 </span>            :         dummy101 = intake(j,i)/unit_mass/area/(1/year);
<span class="lineNum">    5449 </span>            :       
<span class="lineNum">    5450 </span>            :         if(b_dotjI[i]&gt;0){
<span class="lineNum">    5451 </span>            :           dummy110 += (dummy101/b_dotjI[i])*pow(level[j]-level[i],2);
<span class="lineNum">    5452 </span>            :         }
<span class="lineNum">    5453 </span>            : 
<span class="lineNum">    5454 </span>            :         if((level[i]&gt;=1.5)&amp;&amp;(level[i]&lt;2.5)&amp;&amp;(level[j]&gt;=2.5)&amp;&amp;(level[j]&lt;3.5)){
<span class="lineNum">    5455 </span>            :           dummy113 += dummy100;
<span class="lineNum">    5456 </span>            :         }
<span class="lineNum">    5457 </span>            :         if((level[i]&gt;=2.5)&amp;&amp;(level[i]&lt;3.5)&amp;&amp;(level[j]&gt;=3.5)&amp;&amp;(level[j]&lt;4.5)){
<span class="lineNum">    5458 </span>            :           dummy114 += dummy100;
<span class="lineNum">    5459 </span>            :         }
<span class="lineNum">    5460 </span>            :         if((level[i]&gt;=3.5)&amp;&amp;(level[i]&lt;4.5)&amp;&amp;(level[j]&gt;=4.5)&amp;&amp;(level[j]&lt;5.5)){
<span class="lineNum">    5461 </span>            :           dummy115 += dummy100;
<span class="lineNum">    5462 </span>            :         }
<span class="lineNum">    5463 </span>            :       
<span class="lineNum">    5464 </span>            :         // end loop for j
<span class="lineNum">    5465 </span>            :       }
<span class="lineNum">    5466 </span>            : 
<span class="lineNum">    5467 </span>            :       omn_j[i] = sqrt(dummy110);
<span class="lineNum">    5468 </span>            :       
<span class="lineNum">    5469 </span>            :       if(level[i]==1){ dummy112 += (s[i].the_GP)/unit_mass/area/(1/year); } 
<span class="lineNum">    5470 </span>            :     
<span class="lineNum">    5471 </span>            :       // end loop for i
<span class="lineNum">    5472 </span>            :     }
<span class="lineNum">    5473 </span>            : 
<span class="lineNum">    5474 </span>            :     double omn_prime = 0.0;
<span class="lineNum">    5475 </span>            :     double omn = 0.0;
<span class="lineNum">    5476 </span>            :     double omn_f_prime = 0.0;
<span class="lineNum">    5477 </span>            :     double omn_f = 0.0;
<span class="lineNum">    5478 </span>            :     double epsilon_3 = 0.0;
<span class="lineNum">    5479 </span>            :     double epsilon_4 = 0.0;
<span class="lineNum">    5480 </span>            :     double epsilon_5 = 0.0;
<span class="lineNum">    5481 </span>            :     double dummy204 = 0.0;
<span class="lineNum">    5482 </span>            :     double dummy205 = 0.0;
<span class="lineNum">    5483 </span>            :     double dummy206 = 0.0;
<span class="lineNum">    5484 </span>            :     double dummy207 = 0.0;
<span class="lineNum">    5485 </span>            :     double dummy208 = 0.0;    
<span class="lineNum">    5486 </span>            : 
<span class="lineNum">    5487 </span>            :     for(int i=0;i&lt;S;i++){
<span class="lineNum">    5488 </span>            :       if(log10(s[i].bodymass()/unit_mass)&gt;-3){
<span class="lineNum">    5489 </span>            :         dummy208 += b_dotjI[i];
<span class="lineNum">    5490 </span>            :       }
<span class="lineNum">    5491 </span>            :     }
<span class="lineNum">    5492 </span>            :     for(int i=0;i&lt;S;i++){
<span class="lineNum">    5493 </span>            :       dummy204 += omn_j[i];
<span class="lineNum">    5494 </span>            :       dummy205 += (b_dotjI[i]/b_dotdotI)*omn_j[i];
<span class="lineNum">    5495 </span>            :       if(log10(s[i].bodymass()/unit_mass)&gt;-3){
<span class="lineNum">    5496 </span>            :         dummy206 += omn_j[i];
<span class="lineNum">    5497 </span>            :         dummy207 += (b_dotjI[i]/dummy208)*omn_j[i];
<span class="lineNum">    5498 </span>            :       }
<span class="lineNum">    5499 </span>            :     }
<span class="lineNum">    5500 </span>            :     // It has been checked that dividing by S gives decimal
<span class="lineNum">    5501 </span>            :     omn_prime = dummy204/S_c;
<span class="lineNum">    5502 </span>            :     omn = dummy205;
<span class="lineNum">    5503 </span>            :     omn_f_prime = dummy206/S_f;
<span class="lineNum">    5504 </span>            :     omn_f = dummy207;
<span class="lineNum">    5505 </span>            :     epsilon_3 = dummy113/dummy112;
<span class="lineNum">    5506 </span>            :     epsilon_4 = dummy114/dummy113;
<span class="lineNum">    5507 </span>            :     epsilon_5 = dummy115/dummy114;
<span class="lineNum">    5508 </span>            : 
<span class="lineNum">    5509 </span>            :     cout &lt;&lt; &quot;omn_prime = &quot; &lt;&lt; omn_prime &lt;&lt; endl;
<span class="lineNum">    5510 </span>            :     cout &lt;&lt; &quot;omn = &quot; &lt;&lt; omn &lt;&lt; endl;
<span class="lineNum">    5511 </span>            :     cout &lt;&lt; &quot;omn_f_prime = &quot; &lt;&lt; omn_f_prime &lt;&lt; endl;
<span class="lineNum">    5512 </span>            :     cout &lt;&lt; &quot;omn_f = &quot; &lt;&lt; omn_f &lt;&lt; endl;
<span class="lineNum">    5513 </span>            :   
<span class="lineNum">    5514 </span>            : 
<span class="lineNum">    5515 </span>            :     // end if statement for TL indicators
<span class="lineNum">    5516 </span>            :   }
<span class="lineNum">    5517 </span>            :   
<span class="lineNum">    5518 </span>            : 
<span class="lineNum">    5519 </span>            :   /*std::cout &lt;&lt; &quot;writing a link table to file \&quot;&quot; &lt;&lt; filename &lt;&lt; &quot;\&quot;&quot; &lt;&lt; std::endl;
<span class="lineNum">    5520 </span>            :   std::cout &lt;&lt; &quot;mass unit: &quot; &lt;&lt; unit_mass/gram &lt;&lt; &quot; gram;&quot;
<span class="lineNum">    5521 </span>            :             &lt;&lt; &quot; area unit: &quot; &lt;&lt; unit_area/meter2 &lt;&lt; &quot; meter^2&quot; 
<span class="lineNum">    5522 </span>            :             &lt;&lt; std::endl;
<span class="lineNum">    5523 </span>            :   std::cout &lt;&lt; &quot;the meaning of the columns is &quot; &lt;&lt; std::endl;
<span class="lineNum">    5524 </span>            :   int column=1;
<span class="lineNum">    5525 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: hc (consumer trophic level)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5526 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: hr (resource trophic level)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5527 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Mc (log10 consumer body mass)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5528 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Mr (log10 resource body mass)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5529 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Bc (log10 consumer biomass density)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5530 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: Br (log10 resource biomass density)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5531 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: cc (consumer column)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5532 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: cr (resource column)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5533 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: F  (biomass flow density [per year])&quot; &lt;&lt; std::endl;
<span class="lineNum">    5534 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: f  (consumer diet fraction)&quot; &lt;&lt; std::endl;
<span class="lineNum">    5535 </span>            :   std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: c  (log10 coupling coefficient)&quot; &lt;&lt; std::endl;*/
<span class="lineNum">    5536 </span>            : 
<span class="lineNum">    5537 </span>            :   /* template:
<span class="lineNum">    5538 </span>            :      std::cout &lt;&lt; &quot;column &quot; &lt;&lt; column++ &lt;&lt; &quot;: ()&quot; &lt;&lt; std::endl;
<span class="lineNum">    5539 </span>            :   */
<span class="lineNum">    5540 </span>            : 
<span class="lineNum">    5541 </span>            : 
<span class="lineNum">    5542 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    5543 </span>            :   //os.setf(std::ios::scientific, std::ios::floatfield);
<span class="lineNum">    5544 </span><span class="lineNoCov">          0 :   os.precision(4);</span>
<span class="lineNum">    5545 </span>            : 
<span class="lineNum">    5546 </span>            :   // Print out species richness
<span class="lineNum">    5547 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S = &quot; &lt;&lt; S &lt;&lt; endl;</span>
<span class="lineNum">    5548 </span><span class="lineNoCov">          0 :   double S_p = number_of_plants();</span>
<span class="lineNum">    5549 </span><span class="lineNoCov">          0 :   double S_c = number_of_animals();</span>
<span class="lineNum">    5550 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S_p = &quot; &lt;&lt; S_p &lt;&lt; endl;</span>
<span class="lineNum">    5551 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S_c = &quot; &lt;&lt; S_c &lt;&lt; endl;</span>
<span class="lineNum">    5552 </span>            : 
<span class="lineNum">    5553 </span>            :   // The code below calculates and prints out the stock indicators
<span class="lineNum">    5554 </span>            : 
<span class="lineNum">    5555 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; rho_M;</span>
<span class="lineNum">    5556 </span><span class="lineNoCov">          0 :   double dummy1 = 0.0;</span>
<span class="lineNum">    5557 </span><span class="lineNoCov">          0 :   int dummy2 = 0;</span>
<span class="lineNum">    5558 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;71;i++){</span>
<span class="lineNum">    5559 </span><span class="lineNoCov">          0 :     rho_M[i]=0;</span>
<span class="lineNum">    5560 </span>            :   }
<span class="lineNum">    5561 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    5562 </span><span class="lineNoCov">          0 :     NewSpecies &amp; speciesM=s[i];</span>
<span class="lineNum">    5563 </span>            :     //cout &lt;&lt; &quot;log10(speciesM.bodymass()/unit_mass)[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; log10(speciesM.bodymass()/unit_mass) &lt;&lt; endl;
<span class="lineNum">    5564 </span><span class="lineNoCov">          0 :     dummy1 = (log10(speciesM.bodymass()/unit_mass) + 15)/0.25;</span>
<span class="lineNum">    5565 </span>            :     //cout &lt;&lt; &quot;dummy1 = &quot; &lt;&lt; dummy1 &lt;&lt; endl;
<span class="lineNum">    5566 </span><span class="lineNoCov">          0 :     dummy2 = floor(dummy1);</span>
<span class="lineNum">    5567 </span>            :     //cout &lt;&lt; &quot;dummy2 = &quot; &lt;&lt; dummy2 &lt;&lt; endl;
<span class="lineNum">    5568 </span><span class="lineNoCov">          0 :     rho_M[dummy2] += biomass_B(i)/unit_mass/area;</span>
<span class="lineNum">    5569 </span>            :   }
<span class="lineNum">    5570 </span>            :   //for(int i=0;i&lt;71;i++){
<span class="lineNum">    5571 </span>            :   //cout &lt;&lt; &quot;rho_M[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; rho_M[i] &lt;&lt; endl;
<span class="lineNum">    5572 </span>            :   //}
<span class="lineNum">    5573 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus15_minus14point75_M = &quot; &lt;&lt; rho_M[0] &lt;&lt; endl;</span>
<span class="lineNum">    5574 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus14point75_minus14point5_M = &quot; &lt;&lt; rho_M[1] &lt;&lt; endl;</span>
<span class="lineNum">    5575 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus14point5_minus14point25_M = &quot; &lt;&lt; rho_M[2] &lt;&lt; endl;</span>
<span class="lineNum">    5576 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus14point25_minus14_M = &quot; &lt;&lt; rho_M[3] &lt;&lt; endl;</span>
<span class="lineNum">    5577 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus14_minus13point75_M = &quot; &lt;&lt; rho_M[4] &lt;&lt; endl;</span>
<span class="lineNum">    5578 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus13point75_minus13point5_M = &quot; &lt;&lt; rho_M[5] &lt;&lt; endl;</span>
<span class="lineNum">    5579 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus13point5_minus13point25_M = &quot; &lt;&lt; rho_M[6] &lt;&lt; endl;</span>
<span class="lineNum">    5580 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus13point25_minus13_M = &quot; &lt;&lt; rho_M[7] &lt;&lt; endl;</span>
<span class="lineNum">    5581 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus13_minus12point75_M = &quot; &lt;&lt; rho_M[8] &lt;&lt; endl;</span>
<span class="lineNum">    5582 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus12point75_minus12point5_M = &quot; &lt;&lt; rho_M[9] &lt;&lt; endl;</span>
<span class="lineNum">    5583 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus12point5_minus12point25_M = &quot; &lt;&lt; rho_M[10] &lt;&lt; endl;</span>
<span class="lineNum">    5584 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus12point25_minus12_M = &quot; &lt;&lt; rho_M[11] &lt;&lt; endl;</span>
<span class="lineNum">    5585 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus12_minus11point75_M = &quot; &lt;&lt; rho_M[12] &lt;&lt; endl;</span>
<span class="lineNum">    5586 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus11point75_minus11point5_M = &quot; &lt;&lt; rho_M[13] &lt;&lt; endl;</span>
<span class="lineNum">    5587 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus11point5_minus11point25_M = &quot; &lt;&lt; rho_M[14] &lt;&lt; endl;</span>
<span class="lineNum">    5588 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus11point25_minus11_M = &quot; &lt;&lt; rho_M[15] &lt;&lt; endl;</span>
<span class="lineNum">    5589 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus11_minus10point75_M = &quot; &lt;&lt; rho_M[16] &lt;&lt; endl;</span>
<span class="lineNum">    5590 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus10point75_minus10point5_M = &quot; &lt;&lt; rho_M[17] &lt;&lt; endl;</span>
<span class="lineNum">    5591 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus10point5_minus10point25_M = &quot; &lt;&lt; rho_M[18] &lt;&lt; endl;</span>
<span class="lineNum">    5592 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus10point25_minus10_M = &quot; &lt;&lt; rho_M[19] &lt;&lt; endl;</span>
<span class="lineNum">    5593 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus10_minus9point75_M = &quot; &lt;&lt; rho_M[20] &lt;&lt; endl;</span>
<span class="lineNum">    5594 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus9point75_minus9point5_M = &quot; &lt;&lt; rho_M[21] &lt;&lt; endl;</span>
<span class="lineNum">    5595 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus9point5_minus9point25_M = &quot; &lt;&lt; rho_M[22] &lt;&lt; endl;</span>
<span class="lineNum">    5596 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus9point25_minus9_M = &quot; &lt;&lt; rho_M[23] &lt;&lt; endl;</span>
<span class="lineNum">    5597 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus9_minus8point75_M = &quot; &lt;&lt; rho_M[24] &lt;&lt; endl;</span>
<span class="lineNum">    5598 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus8point75_minus8point5_M = &quot; &lt;&lt; rho_M[25] &lt;&lt; endl;</span>
<span class="lineNum">    5599 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus8point5_minus8point25_M = &quot; &lt;&lt; rho_M[26] &lt;&lt; endl;</span>
<span class="lineNum">    5600 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus8point25_minus8_M = &quot; &lt;&lt; rho_M[27] &lt;&lt; endl;</span>
<span class="lineNum">    5601 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus8_minus7point75_M = &quot; &lt;&lt; rho_M[28] &lt;&lt; endl;</span>
<span class="lineNum">    5602 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus7point75_minus7point5_M = &quot; &lt;&lt; rho_M[29] &lt;&lt; endl;</span>
<span class="lineNum">    5603 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus7point5_minus7point25_M = &quot; &lt;&lt; rho_M[30] &lt;&lt; endl;</span>
<span class="lineNum">    5604 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus7point25_minus7_M = &quot; &lt;&lt; rho_M[31] &lt;&lt; endl;</span>
<span class="lineNum">    5605 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus7_minus6point75_M = &quot; &lt;&lt; rho_M[32] &lt;&lt; endl;</span>
<span class="lineNum">    5606 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus6point75_minus6point5_M = &quot; &lt;&lt; rho_M[33] &lt;&lt; endl;</span>
<span class="lineNum">    5607 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus6point5_minus6point25_M = &quot; &lt;&lt; rho_M[34] &lt;&lt; endl;</span>
<span class="lineNum">    5608 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus6point25_minus6_M = &quot; &lt;&lt; rho_M[35] &lt;&lt; endl;</span>
<span class="lineNum">    5609 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus6_minus5point75_M = &quot; &lt;&lt; rho_M[36] &lt;&lt; endl;</span>
<span class="lineNum">    5610 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus5point75_minus5point5_M = &quot; &lt;&lt; rho_M[37] &lt;&lt; endl;</span>
<span class="lineNum">    5611 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus5point5_minus5point25_M = &quot; &lt;&lt; rho_M[38] &lt;&lt; endl;</span>
<span class="lineNum">    5612 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus5point25_minus5_M = &quot; &lt;&lt; rho_M[39] &lt;&lt; endl;</span>
<span class="lineNum">    5613 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus5_minus4point75_M = &quot; &lt;&lt; rho_M[40] &lt;&lt; endl;</span>
<span class="lineNum">    5614 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus4point75_minus4point5_M = &quot; &lt;&lt; rho_M[41] &lt;&lt; endl;</span>
<span class="lineNum">    5615 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus4point5_minus4point25_M = &quot; &lt;&lt; rho_M[42] &lt;&lt; endl;</span>
<span class="lineNum">    5616 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus4point25_minus4_M = &quot; &lt;&lt; rho_M[43] &lt;&lt; endl;</span>
<span class="lineNum">    5617 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus4_minus3point75_M = &quot; &lt;&lt; rho_M[44] &lt;&lt; endl;</span>
<span class="lineNum">    5618 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus3point75_minus3point5_M = &quot; &lt;&lt; rho_M[45] &lt;&lt; endl;</span>
<span class="lineNum">    5619 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus3point5_minus3point25_M = &quot; &lt;&lt; rho_M[46] &lt;&lt; endl;</span>
<span class="lineNum">    5620 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus3point25_minus3_M = &quot; &lt;&lt; rho_M[47] &lt;&lt; endl;</span>
<span class="lineNum">    5621 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus3_minus2point75_M = &quot; &lt;&lt; rho_M[48] &lt;&lt; endl;</span>
<span class="lineNum">    5622 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus2point75_minus2point5_M = &quot; &lt;&lt; rho_M[49] &lt;&lt; endl;</span>
<span class="lineNum">    5623 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus2point5_minus2point25_M = &quot; &lt;&lt; rho_M[50] &lt;&lt; endl;</span>
<span class="lineNum">    5624 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus2point25_minus2_M = &quot; &lt;&lt; rho_M[51] &lt;&lt; endl;</span>
<span class="lineNum">    5625 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus2_minus1point75_M = &quot; &lt;&lt; rho_M[52] &lt;&lt; endl;</span>
<span class="lineNum">    5626 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus1point75_minus1point5_M = &quot; &lt;&lt; rho_M[53] &lt;&lt; endl;</span>
<span class="lineNum">    5627 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus1point5_minus1point25_M = &quot; &lt;&lt; rho_M[54] &lt;&lt; endl;</span>
<span class="lineNum">    5628 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus1point25_minus1_M = &quot; &lt;&lt; rho_M[55] &lt;&lt; endl;</span>
<span class="lineNum">    5629 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus1_minus0point75_M = &quot; &lt;&lt; rho_M[56] &lt;&lt; endl;</span>
<span class="lineNum">    5630 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus0point75_minus0point5_M = &quot; &lt;&lt; rho_M[57] &lt;&lt; endl;</span>
<span class="lineNum">    5631 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus0point5_minus0point25_M = &quot; &lt;&lt; rho_M[58] &lt;&lt; endl;</span>
<span class="lineNum">    5632 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_minus0point25_0_M = &quot; &lt;&lt; rho_M[59] &lt;&lt; endl;</span>
<span class="lineNum">    5633 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_0_0point25_M = &quot; &lt;&lt; rho_M[60] &lt;&lt; endl;</span>
<span class="lineNum">    5634 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_0point25_0point5_M = &quot; &lt;&lt; rho_M[61] &lt;&lt; endl;</span>
<span class="lineNum">    5635 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_0point5_0point75_M = &quot; &lt;&lt; rho_M[62] &lt;&lt; endl;</span>
<span class="lineNum">    5636 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_0point75_1_M = &quot; &lt;&lt; rho_M[63] &lt;&lt; endl;</span>
<span class="lineNum">    5637 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1_1point25_M = &quot; &lt;&lt; rho_M[64] &lt;&lt; endl;</span>
<span class="lineNum">    5638 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point25_1point5_M = &quot; &lt;&lt; rho_M[65] &lt;&lt; endl;</span>
<span class="lineNum">    5639 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point5_1point75_M = &quot; &lt;&lt; rho_M[66] &lt;&lt; endl;</span>
<span class="lineNum">    5640 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_1point75_2_M = &quot; &lt;&lt; rho_M[67] &lt;&lt; endl;</span>
<span class="lineNum">    5641 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2_2point25_M = &quot; &lt;&lt; rho_M[68] &lt;&lt; endl;</span>
<span class="lineNum">    5642 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point25_2point5_M = &quot; &lt;&lt; rho_M[69] &lt;&lt; endl;</span>
<span class="lineNum">    5643 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_2point5_2point75_M = &quot; &lt;&lt; rho_M[70] &lt;&lt; endl;</span>
<span class="lineNum">    5644 </span>            : 
<span class="lineNum">    5645 </span>            :   double rho_f = 0.0;
<span class="lineNum">    5646 </span><span class="lineNoCov">          0 :   for(int i=48;i&lt;71;i++){</span>
<span class="lineNum">    5647 </span><span class="lineNoCov">          0 :     rho_f += rho_M[i];</span>
<span class="lineNum">    5648 </span>            :   }
<span class="lineNum">    5649 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;rho_f = &quot; &lt;&lt; rho_f &lt;&lt; endl;</span>
<span class="lineNum">    5650 </span>            : 
<span class="lineNum">    5651 </span>            :   
<span class="lineNum">    5652 </span>            :   // The code below calculates and prints out the flow indicators, 
<span class="lineNum">    5653 </span>            :   // as well as some species richness indicators
<span class="lineNum">    5654 </span>            :   // S_t is the number of top predators
<span class="lineNum">    5655 </span>            :   // S_i is number of intermediate species
<span class="lineNum">    5656 </span>            :   // There are also vectors showing flows for a species
<span class="lineNum">    5657 </span><span class="lineNoCov">          0 :   double S_f = 0.0;</span>
<span class="lineNum">    5658 </span><span class="lineNoCov">          0 :   double S_t = 0.0;</span>
<span class="lineNum">    5659 </span><span class="lineNoCov">          0 :   double S_i = 0.0;</span>
<span class="lineNum">    5660 </span>            :   //sequence&lt;double&gt; b_idot;
<span class="lineNum">    5661 </span>            :   //sequence&lt;double&gt; b_dotj;
<span class="lineNum">    5662 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotI;</span>
<span class="lineNum">    5663 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjI;</span>
<span class="lineNum">    5664 </span>            :   //sequence&lt;double&gt; b_idotf;
<span class="lineNum">    5665 </span>            :   //sequence&lt;double&gt; b_dotjf;
<span class="lineNum">    5666 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_idotIf;</span>
<span class="lineNum">    5667 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_dotjIf;</span>
<span class="lineNum">    5668 </span><span class="lineNoCov">          0 :   double dummy3 = 0.0;</span>
<span class="lineNum">    5669 </span><span class="lineNoCov">          0 :   double dummy4 = 0.0;</span>
<span class="lineNum">    5670 </span><span class="lineNoCov">          0 :   double dummy5 = 0.0;</span>
<span class="lineNum">    5671 </span><span class="lineNoCov">          0 :   double dummy6 = 0.0;</span>
<span class="lineNum">    5672 </span><span class="lineNoCov">          0 :   double dummy7 = 0.0;</span>
<span class="lineNum">    5673 </span><span class="lineNoCov">          0 :   double dummy8 = 0.0;</span>
<span class="lineNum">    5674 </span>            :   
<span class="lineNum">    5675 </span>            :   // Flows from organisms of lower or equal M to those of higher M
<span class="lineNum">    5676 </span>            :   // Flows from organisms of higher M to those of lower or equal M
<span class="lineNum">    5677 </span>            :   // Then work out b_xM.
<span class="lineNum">    5678 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_lowtohigh;</span>
<span class="lineNum">    5679 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_lowtohigh_Mcorrected;</span>
<span class="lineNum">    5680 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_hightolow;</span>
<span class="lineNum">    5681 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; b_hightolow_Mcorrected;</span>
<span class="lineNum">    5682 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;70;i++){</span>
<span class="lineNum">    5683 </span><span class="lineNoCov">          0 :     b_lowtohigh[i]=0;</span>
<span class="lineNum">    5684 </span><span class="lineNoCov">          0 :     b_lowtohigh_Mcorrected[i]=0;</span>
<span class="lineNum">    5685 </span><span class="lineNoCov">          0 :     b_hightolow[i]=0;</span>
<span class="lineNum">    5686 </span><span class="lineNoCov">          0 :     b_hightolow_Mcorrected[i]=0;</span>
<span class="lineNum">    5687 </span>            :   }
<span class="lineNum">    5688 </span>            :   double resolog10M = 0.0;
<span class="lineNum">    5689 </span>            :   double conslog10M = 0.0;
<span class="lineNum">    5690 </span>            :   // Total consumption by fish species
<span class="lineNum">    5691 </span>            :   double Q_f = 0.0;
<span class="lineNum">    5692 </span>            :   // TST values
<span class="lineNum">    5693 </span>            :   //double b_dotdot = 0.0;
<span class="lineNum">    5694 </span>            :   double b_dotdotI = 0.0;
<span class="lineNum">    5695 </span>            :   //double b_dotdotf = 0.0;
<span class="lineNum">    5696 </span>            :   double b_dotdotIf = 0.0;
<span class="lineNum">    5697 </span>            : 
<span class="lineNum">    5698 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    5699 </span>            : 
<span class="lineNum">    5700 </span><span class="lineNoCov">          0 :     NewSpecies &amp; reso=s[i];</span>
<span class="lineNum">    5701 </span><span class="lineNoCov">          0 :     resolog10M = log10(reso.bodymass()/unit_mass);</span>
<span class="lineNum">    5702 </span><span class="lineNoCov">          0 :     dummy3 = 0;</span>
<span class="lineNum">    5703 </span><span class="lineNoCov">          0 :     dummy4 = 0;</span>
<span class="lineNum">    5704 </span><span class="lineNoCov">          0 :     dummy5 = 0;</span>
<span class="lineNum">    5705 </span><span class="lineNoCov">          0 :     dummy6 = 0;</span>
<span class="lineNum">    5706 </span>            : 
<span class="lineNum">    5707 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    5708 </span>            : 
<span class="lineNum">    5709 </span><span class="lineNoCov">          0 :       NewSpecies &amp; cons=s[j];</span>
<span class="lineNum">    5710 </span><span class="lineNoCov">          0 :       conslog10M = log10(cons.bodymass()/unit_mass);</span>
<span class="lineNum">    5711 </span>            :       // Update sums for calculation of flows for species
<span class="lineNum">    5712 </span>            :       // Update TST and TST minus respiration
<span class="lineNum">    5713 </span><span class="lineNoCov">          0 :       dummy3 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5714 </span><span class="lineNoCov">          0 :       dummy4 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5715 </span>            :       //b_dotdot += intake(i,j)/unit_mass/area/(1/year);
<span class="lineNum">    5716 </span><span class="lineNoCov">          0 :       b_dotdotI += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5717 </span><span class="lineNoCov">          0 :       if(resolog10M &gt; -3){</span>
<span class="lineNum">    5718 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5719 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5720 </span>            :       }
<span class="lineNum">    5721 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){</span>
<span class="lineNum">    5722 </span><span class="lineNoCov">          0 :         dummy5 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5723 </span><span class="lineNoCov">          0 :         dummy6 += intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5724 </span>            :       }
<span class="lineNum">    5725 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &lt;= -3)){</span>
<span class="lineNum">    5726 </span><span class="lineNoCov">          0 :         dummy7 += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5727 </span>            :       }
<span class="lineNum">    5728 </span>            : 
<span class="lineNum">    5729 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -14.75)&amp;&amp;(conslog10M &gt; -14.75)){</span>
<span class="lineNum">    5730 </span><span class="lineNoCov">          0 :         b_lowtohigh[0] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5731 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5732 </span>            :       }
<span class="lineNum">    5733 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -14.5)&amp;&amp;(conslog10M &gt; -14.5)){</span>
<span class="lineNum">    5734 </span><span class="lineNoCov">          0 :         b_lowtohigh[1] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5735 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5736 </span>            :       }
<span class="lineNum">    5737 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -14.25)&amp;&amp;(conslog10M &gt; -14.25)){</span>
<span class="lineNum">    5738 </span><span class="lineNoCov">          0 :         b_lowtohigh[2] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5739 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5740 </span>            :       }
<span class="lineNum">    5741 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -14)&amp;&amp;(conslog10M &gt; -14)){</span>
<span class="lineNum">    5742 </span><span class="lineNoCov">          0 :         b_lowtohigh[3] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5743 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5744 </span>            :       }
<span class="lineNum">    5745 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -13.75)&amp;&amp;(conslog10M &gt; -13.75)){</span>
<span class="lineNum">    5746 </span><span class="lineNoCov">          0 :         b_lowtohigh[4] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5747 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5748 </span>            :       }
<span class="lineNum">    5749 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -13.5)&amp;&amp;(conslog10M &gt; -13.5)){</span>
<span class="lineNum">    5750 </span><span class="lineNoCov">          0 :         b_lowtohigh[5] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5751 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5752 </span>            :       }
<span class="lineNum">    5753 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -13.25)&amp;&amp;(conslog10M &gt; -13.25)){</span>
<span class="lineNum">    5754 </span><span class="lineNoCov">          0 :         b_lowtohigh[6] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5755 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5756 </span>            :       }
<span class="lineNum">    5757 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -13)&amp;&amp;(conslog10M &gt; -13)){</span>
<span class="lineNum">    5758 </span><span class="lineNoCov">          0 :         b_lowtohigh[7] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5759 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5760 </span>            :       }
<span class="lineNum">    5761 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -12.75)&amp;&amp;(conslog10M &gt; -12.75)){</span>
<span class="lineNum">    5762 </span><span class="lineNoCov">          0 :         b_lowtohigh[8] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5763 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5764 </span>            :       }
<span class="lineNum">    5765 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -12.5)&amp;&amp;(conslog10M &gt; -12.5)){</span>
<span class="lineNum">    5766 </span><span class="lineNoCov">          0 :         b_lowtohigh[9] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5767 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5768 </span>            :       }
<span class="lineNum">    5769 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -12.25)&amp;&amp;(conslog10M &gt; -12.25)){</span>
<span class="lineNum">    5770 </span><span class="lineNoCov">          0 :         b_lowtohigh[10] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5771 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5772 </span>            :       }
<span class="lineNum">    5773 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -12)&amp;&amp;(conslog10M &gt; -12)){</span>
<span class="lineNum">    5774 </span><span class="lineNoCov">          0 :         b_lowtohigh[11] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5775 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5776 </span>            :       }
<span class="lineNum">    5777 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -11.75)&amp;&amp;(conslog10M &gt; -11.75)){</span>
<span class="lineNum">    5778 </span><span class="lineNoCov">          0 :         b_lowtohigh[12] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5779 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5780 </span>            :       }
<span class="lineNum">    5781 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -11.5)&amp;&amp;(conslog10M &gt; -11.5)){</span>
<span class="lineNum">    5782 </span><span class="lineNoCov">          0 :         b_lowtohigh[13] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5783 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5784 </span>            :       }
<span class="lineNum">    5785 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -11.25)&amp;&amp;(conslog10M &gt; -11.25)){</span>
<span class="lineNum">    5786 </span><span class="lineNoCov">          0 :         b_lowtohigh[14] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5787 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5788 </span>            :       }
<span class="lineNum">    5789 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -11)&amp;&amp;(conslog10M &gt; -11)){</span>
<span class="lineNum">    5790 </span><span class="lineNoCov">          0 :         b_lowtohigh[15] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5791 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5792 </span>            :       }
<span class="lineNum">    5793 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -10.75)&amp;&amp;(conslog10M &gt; -10.75)){</span>
<span class="lineNum">    5794 </span><span class="lineNoCov">          0 :         b_lowtohigh[16] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5795 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5796 </span>            :       }
<span class="lineNum">    5797 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -10.5)&amp;&amp;(conslog10M &gt; -10.5)){</span>
<span class="lineNum">    5798 </span><span class="lineNoCov">          0 :         b_lowtohigh[17] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5799 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5800 </span>            :       }
<span class="lineNum">    5801 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -10.25)&amp;&amp;(conslog10M &gt; -10.25)){</span>
<span class="lineNum">    5802 </span><span class="lineNoCov">          0 :         b_lowtohigh[18] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5803 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5804 </span>            :       }
<span class="lineNum">    5805 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -10)&amp;&amp;(conslog10M &gt; -10)){</span>
<span class="lineNum">    5806 </span><span class="lineNoCov">          0 :         b_lowtohigh[19] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5807 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5808 </span>            :       }
<span class="lineNum">    5809 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -9.75)&amp;&amp;(conslog10M &gt; -9.75)){</span>
<span class="lineNum">    5810 </span><span class="lineNoCov">          0 :         b_lowtohigh[20] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5811 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5812 </span>            :       }
<span class="lineNum">    5813 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -9.5)&amp;&amp;(conslog10M &gt; -9.5)){</span>
<span class="lineNum">    5814 </span><span class="lineNoCov">          0 :         b_lowtohigh[21] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5815 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5816 </span>            :       }
<span class="lineNum">    5817 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -9.25)&amp;&amp;(conslog10M &gt; -9.25)){</span>
<span class="lineNum">    5818 </span><span class="lineNoCov">          0 :         b_lowtohigh[22] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5819 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5820 </span>            :       }
<span class="lineNum">    5821 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -9)&amp;&amp;(conslog10M &gt; -9)){</span>
<span class="lineNum">    5822 </span><span class="lineNoCov">          0 :         b_lowtohigh[23] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5823 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5824 </span>            :       }
<span class="lineNum">    5825 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -8.75)&amp;&amp;(conslog10M &gt; -8.75)){</span>
<span class="lineNum">    5826 </span><span class="lineNoCov">          0 :         b_lowtohigh[24] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5827 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5828 </span>            :       }
<span class="lineNum">    5829 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -8.5)&amp;&amp;(conslog10M &gt; -8.5)){</span>
<span class="lineNum">    5830 </span><span class="lineNoCov">          0 :         b_lowtohigh[25] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5831 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5832 </span>            :       }
<span class="lineNum">    5833 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -8.25)&amp;&amp;(conslog10M &gt; -8.25)){</span>
<span class="lineNum">    5834 </span><span class="lineNoCov">          0 :         b_lowtohigh[26] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5835 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5836 </span>            :       }
<span class="lineNum">    5837 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -8)&amp;&amp;(conslog10M &gt; -8)){</span>
<span class="lineNum">    5838 </span><span class="lineNoCov">          0 :         b_lowtohigh[27] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5839 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5840 </span>            :       }
<span class="lineNum">    5841 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -7.75)&amp;&amp;(conslog10M &gt; -7.75)){</span>
<span class="lineNum">    5842 </span><span class="lineNoCov">          0 :         b_lowtohigh[28] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5843 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5844 </span>            :       }
<span class="lineNum">    5845 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -7.5)&amp;&amp;(conslog10M &gt; -7.5)){</span>
<span class="lineNum">    5846 </span><span class="lineNoCov">          0 :         b_lowtohigh[29] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5847 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5848 </span>            :       }
<span class="lineNum">    5849 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -7.25)&amp;&amp;(conslog10M &gt; -7.25)){</span>
<span class="lineNum">    5850 </span><span class="lineNoCov">          0 :         b_lowtohigh[30] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5851 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5852 </span>            :       }
<span class="lineNum">    5853 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -7)&amp;&amp;(conslog10M &gt; -7)){</span>
<span class="lineNum">    5854 </span><span class="lineNoCov">          0 :         b_lowtohigh[31] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5855 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5856 </span>            :       }
<span class="lineNum">    5857 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -6.75)&amp;&amp;(conslog10M &gt; -6.75)){</span>
<span class="lineNum">    5858 </span><span class="lineNoCov">          0 :         b_lowtohigh[32] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5859 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5860 </span>            :       }
<span class="lineNum">    5861 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -6.5)&amp;&amp;(conslog10M &gt; -6.5)){</span>
<span class="lineNum">    5862 </span><span class="lineNoCov">          0 :         b_lowtohigh[33] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5863 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5864 </span>            :       }
<span class="lineNum">    5865 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -6.25)&amp;&amp;(conslog10M &gt; -6.25)){</span>
<span class="lineNum">    5866 </span><span class="lineNoCov">          0 :         b_lowtohigh[34] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5867 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5868 </span>            :       }
<span class="lineNum">    5869 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -6)&amp;&amp;(conslog10M &gt; -6)){</span>
<span class="lineNum">    5870 </span><span class="lineNoCov">          0 :         b_lowtohigh[35] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5871 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5872 </span>            :       }
<span class="lineNum">    5873 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -5.75)&amp;&amp;(conslog10M &gt; -5.75)){</span>
<span class="lineNum">    5874 </span><span class="lineNoCov">          0 :         b_lowtohigh[36] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5875 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[36] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5876 </span>            :       }
<span class="lineNum">    5877 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -5.5)&amp;&amp;(conslog10M &gt; -5.5)){</span>
<span class="lineNum">    5878 </span><span class="lineNoCov">          0 :         b_lowtohigh[37] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5879 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[37] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5880 </span>            :       }
<span class="lineNum">    5881 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -5.25)&amp;&amp;(conslog10M &gt; -5.25)){</span>
<span class="lineNum">    5882 </span><span class="lineNoCov">          0 :         b_lowtohigh[38] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5883 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[38] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5884 </span>            :       }
<span class="lineNum">    5885 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -5)&amp;&amp;(conslog10M &gt; -5)){</span>
<span class="lineNum">    5886 </span><span class="lineNoCov">          0 :         b_lowtohigh[39] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5887 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[39] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5888 </span>            :       }
<span class="lineNum">    5889 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -4.75)&amp;&amp;(conslog10M &gt; -4.75)){</span>
<span class="lineNum">    5890 </span><span class="lineNoCov">          0 :         b_lowtohigh[40] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5891 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[40] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5892 </span>            :       }
<span class="lineNum">    5893 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -4.5)&amp;&amp;(conslog10M &gt; -4.5)){</span>
<span class="lineNum">    5894 </span><span class="lineNoCov">          0 :         b_lowtohigh[41] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5895 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[41] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5896 </span>            :       }
<span class="lineNum">    5897 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -4.25)&amp;&amp;(conslog10M &gt; -4.25)){</span>
<span class="lineNum">    5898 </span><span class="lineNoCov">          0 :         b_lowtohigh[42] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5899 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[42] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5900 </span>            :       }
<span class="lineNum">    5901 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -4)&amp;&amp;(conslog10M &gt; -4)){</span>
<span class="lineNum">    5902 </span><span class="lineNoCov">          0 :         b_lowtohigh[43] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5903 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[43] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5904 </span>            :       }
<span class="lineNum">    5905 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3.75)&amp;&amp;(conslog10M &gt; -3.75)){</span>
<span class="lineNum">    5906 </span><span class="lineNoCov">          0 :         b_lowtohigh[44] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5907 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[44] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5908 </span>            :       }
<span class="lineNum">    5909 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3.5)&amp;&amp;(conslog10M &gt; -3.5)){</span>
<span class="lineNum">    5910 </span><span class="lineNoCov">          0 :         b_lowtohigh[45] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5911 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[45] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5912 </span>            :       }
<span class="lineNum">    5913 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3.25)&amp;&amp;(conslog10M &gt; -3.25)){</span>
<span class="lineNum">    5914 </span><span class="lineNoCov">          0 :         b_lowtohigh[46] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5915 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[46] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5916 </span>            :       }
<span class="lineNum">    5917 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -3)&amp;&amp;(conslog10M &gt; -3)){</span>
<span class="lineNum">    5918 </span><span class="lineNoCov">          0 :         b_lowtohigh[47] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5919 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[47] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5920 </span>            :       }
<span class="lineNum">    5921 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -2.75)&amp;&amp;(conslog10M &gt; -2.75)){</span>
<span class="lineNum">    5922 </span><span class="lineNoCov">          0 :         b_lowtohigh[48] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5923 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[48] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5924 </span>            :       }
<span class="lineNum">    5925 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -2.5)&amp;&amp;(conslog10M &gt; -2.5)){</span>
<span class="lineNum">    5926 </span><span class="lineNoCov">          0 :         b_lowtohigh[49] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5927 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[49] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5928 </span>            :       }
<span class="lineNum">    5929 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -2.25)&amp;&amp;(conslog10M &gt; -2.25)){</span>
<span class="lineNum">    5930 </span><span class="lineNoCov">          0 :         b_lowtohigh[50] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5931 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[50] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5932 </span>            :       }
<span class="lineNum">    5933 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -2)&amp;&amp;(conslog10M &gt; -2)){</span>
<span class="lineNum">    5934 </span><span class="lineNoCov">          0 :         b_lowtohigh[51] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5935 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[51] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5936 </span>            :       }
<span class="lineNum">    5937 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -1.75)&amp;&amp;(conslog10M &gt; -1.75)){</span>
<span class="lineNum">    5938 </span><span class="lineNoCov">          0 :         b_lowtohigh[52] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5939 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[52] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5940 </span>            :       }
<span class="lineNum">    5941 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -1.5)&amp;&amp;(conslog10M &gt; -1.5)){</span>
<span class="lineNum">    5942 </span><span class="lineNoCov">          0 :         b_lowtohigh[53] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5943 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[53] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5944 </span>            :       }
<span class="lineNum">    5945 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -1.25)&amp;&amp;(conslog10M &gt; -1.25)){</span>
<span class="lineNum">    5946 </span><span class="lineNoCov">          0 :         b_lowtohigh[54] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5947 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[54] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5948 </span>            :       }
<span class="lineNum">    5949 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -1)&amp;&amp;(conslog10M &gt; -1)){</span>
<span class="lineNum">    5950 </span><span class="lineNoCov">          0 :         b_lowtohigh[55] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5951 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[55] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5952 </span>            :       }
<span class="lineNum">    5953 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -0.75)&amp;&amp;(conslog10M &gt; -0.75)){</span>
<span class="lineNum">    5954 </span><span class="lineNoCov">          0 :         b_lowtohigh[56] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5955 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[56] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5956 </span>            :       }
<span class="lineNum">    5957 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -0.5)&amp;&amp;(conslog10M &gt; -0.5)){</span>
<span class="lineNum">    5958 </span><span class="lineNoCov">          0 :         b_lowtohigh[57] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5959 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[57] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5960 </span>            :       }
<span class="lineNum">    5961 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= -0.25)&amp;&amp;(conslog10M &gt; -0.25)){</span>
<span class="lineNum">    5962 </span><span class="lineNoCov">          0 :         b_lowtohigh[58] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5963 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[58] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5964 </span>            :       }
<span class="lineNum">    5965 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 0)&amp;&amp;(conslog10M &gt; 0)){</span>
<span class="lineNum">    5966 </span><span class="lineNoCov">          0 :         b_lowtohigh[59] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5967 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[59] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5968 </span>            :       }
<span class="lineNum">    5969 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 0.25)&amp;&amp;(conslog10M &gt; 0.25)){</span>
<span class="lineNum">    5970 </span><span class="lineNoCov">          0 :         b_lowtohigh[60] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5971 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[60] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5972 </span>            :       }
<span class="lineNum">    5973 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 0.5)&amp;&amp;(conslog10M &gt; 0.5)){</span>
<span class="lineNum">    5974 </span><span class="lineNoCov">          0 :         b_lowtohigh[61] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5975 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[61] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5976 </span>            :       }
<span class="lineNum">    5977 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 0.75)&amp;&amp;(conslog10M &gt; 0.75)){</span>
<span class="lineNum">    5978 </span><span class="lineNoCov">          0 :         b_lowtohigh[62] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5979 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[62] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5980 </span>            :       }
<span class="lineNum">    5981 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 1)&amp;&amp;(conslog10M &gt; 1)){</span>
<span class="lineNum">    5982 </span><span class="lineNoCov">          0 :         b_lowtohigh[63] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5983 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[63] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5984 </span>            :       }
<span class="lineNum">    5985 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 1.25)&amp;&amp;(conslog10M &gt; 1.25)){</span>
<span class="lineNum">    5986 </span><span class="lineNoCov">          0 :         b_lowtohigh[64] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5987 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[64] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5988 </span>            :       }
<span class="lineNum">    5989 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 1.5)&amp;&amp;(conslog10M &gt; 1.5)){</span>
<span class="lineNum">    5990 </span><span class="lineNoCov">          0 :         b_lowtohigh[65] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5991 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[65] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5992 </span>            :       }
<span class="lineNum">    5993 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 1.75)&amp;&amp;(conslog10M &gt; 1.75)){</span>
<span class="lineNum">    5994 </span><span class="lineNoCov">          0 :         b_lowtohigh[66] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5995 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[66] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    5996 </span>            :       }
<span class="lineNum">    5997 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 2)&amp;&amp;(conslog10M &gt; 2)){</span>
<span class="lineNum">    5998 </span><span class="lineNoCov">          0 :         b_lowtohigh[67] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    5999 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[67] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6000 </span>            :       }
<span class="lineNum">    6001 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 2.25)&amp;&amp;(conslog10M &gt; 2.25)){</span>
<span class="lineNum">    6002 </span><span class="lineNoCov">          0 :         b_lowtohigh[68] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6003 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[68] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6004 </span>            :       }
<span class="lineNum">    6005 </span><span class="lineNoCov">          0 :       if((resolog10M &lt;= 2.5)&amp;&amp;(conslog10M &gt; 2.5)){</span>
<span class="lineNum">    6006 </span><span class="lineNoCov">          0 :         b_lowtohigh[69] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6007 </span><span class="lineNoCov">          0 :         b_lowtohigh_Mcorrected[69] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6008 </span>            :       }
<span class="lineNum">    6009 </span>            : 
<span class="lineNum">    6010 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -14.75)&amp;&amp;(conslog10M &lt;= -14.75)){</span>
<span class="lineNum">    6011 </span><span class="lineNoCov">          0 :         b_hightolow[0] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6012 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[0] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6013 </span>            :       }
<span class="lineNum">    6014 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -14.5)&amp;&amp;(conslog10M &lt;= -14.5)){</span>
<span class="lineNum">    6015 </span><span class="lineNoCov">          0 :         b_hightolow[1] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6016 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[1] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6017 </span>            :       }
<span class="lineNum">    6018 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -14.25)&amp;&amp;(conslog10M &lt;= -14.25)){</span>
<span class="lineNum">    6019 </span><span class="lineNoCov">          0 :         b_hightolow[2] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6020 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[2] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6021 </span>            :       }
<span class="lineNum">    6022 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -14)&amp;&amp;(conslog10M &lt;= -14)){</span>
<span class="lineNum">    6023 </span><span class="lineNoCov">          0 :         b_hightolow[3] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6024 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[3] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6025 </span>            :       }
<span class="lineNum">    6026 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -13.75)&amp;&amp;(conslog10M &lt;= -13.75)){</span>
<span class="lineNum">    6027 </span><span class="lineNoCov">          0 :         b_hightolow[4] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6028 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[4] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6029 </span>            :       }
<span class="lineNum">    6030 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -13.5)&amp;&amp;(conslog10M &lt;= -13.5)){</span>
<span class="lineNum">    6031 </span><span class="lineNoCov">          0 :         b_hightolow[5] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6032 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[5] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6033 </span>            :       }
<span class="lineNum">    6034 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -13.25)&amp;&amp;(conslog10M &lt;= -13.25)){</span>
<span class="lineNum">    6035 </span><span class="lineNoCov">          0 :         b_hightolow[6] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6036 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[6] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6037 </span>            :       }
<span class="lineNum">    6038 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -13)&amp;&amp;(conslog10M &lt;= -13)){</span>
<span class="lineNum">    6039 </span><span class="lineNoCov">          0 :         b_hightolow[7] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6040 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[7] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6041 </span>            :       }
<span class="lineNum">    6042 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -12.75)&amp;&amp;(conslog10M &lt;= -12.75)){</span>
<span class="lineNum">    6043 </span><span class="lineNoCov">          0 :         b_hightolow[8] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6044 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[8] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6045 </span>            :       }
<span class="lineNum">    6046 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -12.5)&amp;&amp;(conslog10M &lt;= -12.5)){</span>
<span class="lineNum">    6047 </span><span class="lineNoCov">          0 :         b_hightolow[9] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6048 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[9] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6049 </span>            :       }
<span class="lineNum">    6050 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -12.25)&amp;&amp;(conslog10M &lt;= -12.25)){</span>
<span class="lineNum">    6051 </span><span class="lineNoCov">          0 :         b_hightolow[10] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6052 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[10] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6053 </span>            :       }
<span class="lineNum">    6054 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -12)&amp;&amp;(conslog10M &lt;= -12)){</span>
<span class="lineNum">    6055 </span><span class="lineNoCov">          0 :         b_hightolow[11] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6056 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[11] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6057 </span>            :       }
<span class="lineNum">    6058 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -11.75)&amp;&amp;(conslog10M &lt;= -11.75)){</span>
<span class="lineNum">    6059 </span><span class="lineNoCov">          0 :         b_hightolow[12] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6060 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[12] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6061 </span>            :       }
<span class="lineNum">    6062 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -11.5)&amp;&amp;(conslog10M &lt;= -11.5)){</span>
<span class="lineNum">    6063 </span><span class="lineNoCov">          0 :         b_hightolow[13] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6064 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[13] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6065 </span>            :       }
<span class="lineNum">    6066 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -11.25)&amp;&amp;(conslog10M &lt;= -11.25)){</span>
<span class="lineNum">    6067 </span><span class="lineNoCov">          0 :         b_hightolow[14] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6068 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[14] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6069 </span>            :       }
<span class="lineNum">    6070 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -11)&amp;&amp;(conslog10M &lt;= -11)){</span>
<span class="lineNum">    6071 </span><span class="lineNoCov">          0 :         b_hightolow[15] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6072 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[15] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6073 </span>            :       }
<span class="lineNum">    6074 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -10.75)&amp;&amp;(conslog10M &lt;= -10.75)){</span>
<span class="lineNum">    6075 </span><span class="lineNoCov">          0 :         b_hightolow[16] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6076 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[16] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6077 </span>            :       }
<span class="lineNum">    6078 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -10.5)&amp;&amp;(conslog10M &lt;= -10.5)){</span>
<span class="lineNum">    6079 </span><span class="lineNoCov">          0 :         b_hightolow[17] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6080 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[17] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6081 </span>            :       }
<span class="lineNum">    6082 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -10.25)&amp;&amp;(conslog10M &lt;= -10.25)){</span>
<span class="lineNum">    6083 </span><span class="lineNoCov">          0 :         b_hightolow[18] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6084 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[18] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6085 </span>            :       }
<span class="lineNum">    6086 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -10)&amp;&amp;(conslog10M &lt;= -10)){</span>
<span class="lineNum">    6087 </span><span class="lineNoCov">          0 :         b_hightolow[19] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6088 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[19] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6089 </span>            :       }
<span class="lineNum">    6090 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -9.75)&amp;&amp;(conslog10M &lt;= -9.75)){</span>
<span class="lineNum">    6091 </span><span class="lineNoCov">          0 :         b_hightolow[20] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6092 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[20] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6093 </span>            :       }
<span class="lineNum">    6094 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -9.5)&amp;&amp;(conslog10M &lt;= -9.5)){</span>
<span class="lineNum">    6095 </span><span class="lineNoCov">          0 :         b_hightolow[21] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6096 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[21] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6097 </span>            :       }
<span class="lineNum">    6098 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -9.25)&amp;&amp;(conslog10M &lt;= -9.25)){</span>
<span class="lineNum">    6099 </span><span class="lineNoCov">          0 :         b_hightolow[22] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6100 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[22] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6101 </span>            :       }
<span class="lineNum">    6102 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -9)&amp;&amp;(conslog10M &lt;= -9)){</span>
<span class="lineNum">    6103 </span><span class="lineNoCov">          0 :         b_hightolow[23] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6104 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[23] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6105 </span>            :       }
<span class="lineNum">    6106 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -8.75)&amp;&amp;(conslog10M &lt;= -8.75)){</span>
<span class="lineNum">    6107 </span><span class="lineNoCov">          0 :         b_hightolow[24] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6108 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[24] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6109 </span>            :       }
<span class="lineNum">    6110 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -8.5)&amp;&amp;(conslog10M &lt;= -8.5)){</span>
<span class="lineNum">    6111 </span><span class="lineNoCov">          0 :         b_hightolow[25] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6112 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[25] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6113 </span>            :       }
<span class="lineNum">    6114 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -8.25)&amp;&amp;(conslog10M &lt;= -8.25)){</span>
<span class="lineNum">    6115 </span><span class="lineNoCov">          0 :         b_hightolow[26] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6116 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[26] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6117 </span>            :       }
<span class="lineNum">    6118 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -8)&amp;&amp;(conslog10M &lt;= -8)){</span>
<span class="lineNum">    6119 </span><span class="lineNoCov">          0 :         b_hightolow[27] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6120 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[27] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6121 </span>            :       }
<span class="lineNum">    6122 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -7.75)&amp;&amp;(conslog10M &lt;= -7.75)){</span>
<span class="lineNum">    6123 </span><span class="lineNoCov">          0 :         b_hightolow[28] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6124 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[28] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6125 </span>            :       }
<span class="lineNum">    6126 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -7.5)&amp;&amp;(conslog10M &lt;= -7.5)){</span>
<span class="lineNum">    6127 </span><span class="lineNoCov">          0 :         b_hightolow[29] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6128 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[29] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6129 </span>            :       }
<span class="lineNum">    6130 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -7.25)&amp;&amp;(conslog10M &lt;= -7.25)){</span>
<span class="lineNum">    6131 </span><span class="lineNoCov">          0 :         b_hightolow[30] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6132 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[30] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6133 </span>            :       }
<span class="lineNum">    6134 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -7)&amp;&amp;(conslog10M &lt;= -7)){</span>
<span class="lineNum">    6135 </span><span class="lineNoCov">          0 :         b_hightolow[31] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6136 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[31] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6137 </span>            :       }
<span class="lineNum">    6138 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -6.75)&amp;&amp;(conslog10M &lt;= -6.75)){</span>
<span class="lineNum">    6139 </span><span class="lineNoCov">          0 :         b_hightolow[32] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6140 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[32] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6141 </span>            :       }
<span class="lineNum">    6142 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -6.5)&amp;&amp;(conslog10M &lt;= -6.5)){</span>
<span class="lineNum">    6143 </span><span class="lineNoCov">          0 :         b_hightolow[33] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6144 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[33] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6145 </span>            :       }
<span class="lineNum">    6146 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -6.25)&amp;&amp;(conslog10M &lt;= -6.25)){</span>
<span class="lineNum">    6147 </span><span class="lineNoCov">          0 :         b_hightolow[34] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6148 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[34] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6149 </span>            :       }
<span class="lineNum">    6150 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -6)&amp;&amp;(conslog10M &lt;= -6)){</span>
<span class="lineNum">    6151 </span><span class="lineNoCov">          0 :         b_hightolow[35] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6152 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[35] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6153 </span>            :       }
<span class="lineNum">    6154 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -5.75)&amp;&amp;(conslog10M &lt;= -5.75)){</span>
<span class="lineNum">    6155 </span><span class="lineNoCov">          0 :         b_hightolow[36] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6156 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[36] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6157 </span>            :       }
<span class="lineNum">    6158 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -5.5)&amp;&amp;(conslog10M &lt;= -5.5)){</span>
<span class="lineNum">    6159 </span><span class="lineNoCov">          0 :         b_hightolow[37] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6160 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[37] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6161 </span>            :       }
<span class="lineNum">    6162 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -5.25)&amp;&amp;(conslog10M &lt;= -5.25)){</span>
<span class="lineNum">    6163 </span><span class="lineNoCov">          0 :         b_hightolow[38] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6164 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[38] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6165 </span>            :       }
<span class="lineNum">    6166 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -5)&amp;&amp;(conslog10M &lt;= -5)){</span>
<span class="lineNum">    6167 </span><span class="lineNoCov">          0 :         b_hightolow[39] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6168 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[39] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6169 </span>            :       }
<span class="lineNum">    6170 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -4.75)&amp;&amp;(conslog10M &lt;= -4.75)){</span>
<span class="lineNum">    6171 </span><span class="lineNoCov">          0 :         b_hightolow[40] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6172 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[40] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6173 </span>            :       }
<span class="lineNum">    6174 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -4.5)&amp;&amp;(conslog10M &lt;= -4.5)){</span>
<span class="lineNum">    6175 </span><span class="lineNoCov">          0 :         b_hightolow[41] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6176 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[41] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6177 </span>            :       }
<span class="lineNum">    6178 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -4.25)&amp;&amp;(conslog10M &lt;= -4.25)){</span>
<span class="lineNum">    6179 </span><span class="lineNoCov">          0 :         b_hightolow[42] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6180 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[42] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6181 </span>            :       }
<span class="lineNum">    6182 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -4)&amp;&amp;(conslog10M &lt;= -4)){</span>
<span class="lineNum">    6183 </span><span class="lineNoCov">          0 :         b_hightolow[43] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6184 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[43] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6185 </span>            :       }
<span class="lineNum">    6186 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -3.75)&amp;&amp;(conslog10M &lt;= -3.75)){</span>
<span class="lineNum">    6187 </span><span class="lineNoCov">          0 :         b_hightolow[44] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6188 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[44] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6189 </span>            :       }
<span class="lineNum">    6190 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -3.5)&amp;&amp;(conslog10M &lt;= -3.5)){</span>
<span class="lineNum">    6191 </span><span class="lineNoCov">          0 :         b_hightolow[45] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6192 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[45] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6193 </span>            :       }
<span class="lineNum">    6194 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -3.25)&amp;&amp;(conslog10M &lt;= -3.25)){</span>
<span class="lineNum">    6195 </span><span class="lineNoCov">          0 :         b_hightolow[46] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6196 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[46] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6197 </span>            :       }
<span class="lineNum">    6198 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -3)&amp;&amp;(conslog10M &lt;= -3)){</span>
<span class="lineNum">    6199 </span><span class="lineNoCov">          0 :         b_hightolow[47] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6200 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[47] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6201 </span>            :       }
<span class="lineNum">    6202 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -2.75)&amp;&amp;(conslog10M &lt;= -2.75)){</span>
<span class="lineNum">    6203 </span><span class="lineNoCov">          0 :         b_hightolow[48] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6204 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[48] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6205 </span>            :       }
<span class="lineNum">    6206 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -2.5)&amp;&amp;(conslog10M &lt;= -2.5)){</span>
<span class="lineNum">    6207 </span><span class="lineNoCov">          0 :         b_hightolow[49] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6208 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[49] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6209 </span>            :       }
<span class="lineNum">    6210 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -2.25)&amp;&amp;(conslog10M &lt;= -2.25)){</span>
<span class="lineNum">    6211 </span><span class="lineNoCov">          0 :         b_hightolow[50] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6212 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[50] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6213 </span>            :       }
<span class="lineNum">    6214 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -2)&amp;&amp;(conslog10M &lt;= -2)){</span>
<span class="lineNum">    6215 </span><span class="lineNoCov">          0 :         b_hightolow[51] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6216 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[51] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6217 </span>            :       }
<span class="lineNum">    6218 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -1.75)&amp;&amp;(conslog10M &lt;= -1.75)){</span>
<span class="lineNum">    6219 </span><span class="lineNoCov">          0 :         b_hightolow[52] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6220 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[52] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6221 </span>            :       }
<span class="lineNum">    6222 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -1.5)&amp;&amp;(conslog10M &lt;= -1.5)){</span>
<span class="lineNum">    6223 </span><span class="lineNoCov">          0 :         b_hightolow[53] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6224 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[53] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6225 </span>            :       }
<span class="lineNum">    6226 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -1.25)&amp;&amp;(conslog10M &lt;= -1.25)){</span>
<span class="lineNum">    6227 </span><span class="lineNoCov">          0 :         b_hightolow[54] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6228 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[54] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6229 </span>            :       }
<span class="lineNum">    6230 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -1)&amp;&amp;(conslog10M &lt;= -1)){</span>
<span class="lineNum">    6231 </span><span class="lineNoCov">          0 :         b_hightolow[55] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6232 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[55] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6233 </span>            :       }
<span class="lineNum">    6234 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -0.75)&amp;&amp;(conslog10M &lt;= -0.75)){</span>
<span class="lineNum">    6235 </span><span class="lineNoCov">          0 :         b_hightolow[56] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6236 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[56] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6237 </span>            :       }
<span class="lineNum">    6238 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -0.5)&amp;&amp;(conslog10M &lt;= -0.5)){</span>
<span class="lineNum">    6239 </span><span class="lineNoCov">          0 :         b_hightolow[57] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6240 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[57] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6241 </span>            :       }
<span class="lineNum">    6242 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; -0.25)&amp;&amp;(conslog10M &lt;= -0.25)){</span>
<span class="lineNum">    6243 </span><span class="lineNoCov">          0 :         b_hightolow[58] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6244 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[58] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6245 </span>            :       }
<span class="lineNum">    6246 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 0)&amp;&amp;(conslog10M &lt;= 0)){</span>
<span class="lineNum">    6247 </span><span class="lineNoCov">          0 :         b_hightolow[59] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6248 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[59] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6249 </span>            :       }
<span class="lineNum">    6250 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 0.25)&amp;&amp;(conslog10M &lt;= 0.25)){</span>
<span class="lineNum">    6251 </span><span class="lineNoCov">          0 :         b_hightolow[60] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6252 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[60] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6253 </span>            :       }
<span class="lineNum">    6254 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 0.5)&amp;&amp;(conslog10M &lt;= 0.5)){</span>
<span class="lineNum">    6255 </span><span class="lineNoCov">          0 :         b_hightolow[61] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6256 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[61] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6257 </span>            :       }
<span class="lineNum">    6258 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 0.75)&amp;&amp;(conslog10M &lt;= 0.75)){</span>
<span class="lineNum">    6259 </span><span class="lineNoCov">          0 :         b_hightolow[62] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6260 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[62] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6261 </span>            :       }
<span class="lineNum">    6262 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 1)&amp;&amp;(conslog10M &lt;= 1)){</span>
<span class="lineNum">    6263 </span><span class="lineNoCov">          0 :         b_hightolow[63] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6264 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[63] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6265 </span>            :       }
<span class="lineNum">    6266 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 1.25)&amp;&amp;(conslog10M &lt;= 1.25)){</span>
<span class="lineNum">    6267 </span><span class="lineNoCov">          0 :         b_hightolow[64] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6268 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[64] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6269 </span>            :       }
<span class="lineNum">    6270 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 1.5)&amp;&amp;(conslog10M &lt;= 1.5)){</span>
<span class="lineNum">    6271 </span><span class="lineNoCov">          0 :         b_hightolow[65] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6272 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[65] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6273 </span>            :       }
<span class="lineNum">    6274 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 1.75)&amp;&amp;(conslog10M &lt;= 1.75)){</span>
<span class="lineNum">    6275 </span><span class="lineNoCov">          0 :         b_hightolow[66] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6276 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[66] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6277 </span>            :       }
<span class="lineNum">    6278 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 2)&amp;&amp;(conslog10M &lt;= 2)){</span>
<span class="lineNum">    6279 </span><span class="lineNoCov">          0 :         b_hightolow[67] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6280 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[67] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6281 </span>            :       }
<span class="lineNum">    6282 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 2.25)&amp;&amp;(conslog10M &lt;= 2.25)){</span>
<span class="lineNum">    6283 </span><span class="lineNoCov">          0 :         b_hightolow[68] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6284 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[68] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6285 </span>            :       }
<span class="lineNum">    6286 </span><span class="lineNoCov">          0 :       if((resolog10M &gt; 2.5)&amp;&amp;(conslog10M &lt;= 2.5)){</span>
<span class="lineNum">    6287 </span><span class="lineNoCov">          0 :         b_hightolow[69] += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6288 </span><span class="lineNoCov">          0 :         b_hightolow_Mcorrected[69] += ((intake(i,j)/unit_mass/area/(1/year))/pow(cons.bodymass()/unit_mass,-0.25));</span>
<span class="lineNum">    6289 </span>            :       }
<span class="lineNum">    6290 </span>            : 
<span class="lineNum">    6291 </span><span class="lineNoCov">          0 :       if(conslog10M &gt; -3){</span>
<span class="lineNum">    6292 </span><span class="lineNoCov">          0 :         Q_f += intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6293 </span>            :       }
<span class="lineNum">    6294 </span>            : 
<span class="lineNum">    6295 </span>            :       // close loop for j  
<span class="lineNum">    6296 </span>            :     }
<span class="lineNum">    6297 </span>            :     
<span class="lineNum">    6298 </span>            :     // Update vectors of flows for species
<span class="lineNum">    6299 </span><span class="lineNoCov">          0 :     b_idotI[i] = dummy3;</span>
<span class="lineNum">    6300 </span><span class="lineNoCov">          0 :     b_dotjI[i] = dummy4;</span>
<span class="lineNum">    6301 </span>            :     //b_dotj[i] = dummy4;
<span class="lineNum">    6302 </span><span class="lineNoCov">          0 :     b_idotIf[i] = dummy5;</span>
<span class="lineNum">    6303 </span><span class="lineNoCov">          0 :     b_dotjIf[i] = dummy6;</span>
<span class="lineNum">    6304 </span>            :     //b_dotjf[i] = dummy6;
<span class="lineNum">    6305 </span>            : 
<span class="lineNum">    6306 </span>            :     // Update species richness
<span class="lineNum">    6307 </span><span class="lineNoCov">          0 :     if(resolog10M &gt; -3){</span>
<span class="lineNum">    6308 </span><span class="lineNoCov">          0 :       S_f += 1;</span>
<span class="lineNum">    6309 </span>            :     }
<span class="lineNum">    6310 </span><span class="lineNoCov">          0 :     if(b_idotI[i]==0){</span>
<span class="lineNum">    6311 </span><span class="lineNoCov">          0 :       S_t += 1;</span>
<span class="lineNum">    6312 </span>            :     }
<span class="lineNum">    6313 </span>            : 
<span class="lineNum">    6314 </span>            :     // Update TST and flows with respiration
<span class="lineNum">    6315 </span>            :     /*if(b_dotj[i]==0){
<span class="lineNum">    6316 </span>            :       // is a producer
<span class="lineNum">    6317 </span>            :       b_dotdot += (s[i].the_GP)/unit_mass/area/(1/year);
<span class="lineNum">    6318 </span>            :       b_idot[i] = dummy3 + (s[i].the_GP)/unit_mass/area/(1/year);
<span class="lineNum">    6319 </span>            :     }else{
<span class="lineNum">    6320 </span>            :       // is a consumer
<span class="lineNum">    6321 </span>            :       b_dotdot += 0.259*pow(reso.bodymass()/unit_mass,-0.25)*(biomass_B(i)/unit_mass/area);
<span class="lineNum">    6322 </span>            :       b_idot[i] = dummy3 + 0.259*pow(reso.bodymass()/unit_mass,-0.25)*(biomass_B(i)/unit_mass/area);
<span class="lineNum">    6323 </span>            :       if(resolog10M &gt; -3){ 
<span class="lineNum">    6324 </span>            :         dummy8 += 0.259*pow(reso.bodymass()/unit_mass,-0.25)*(biomass_B(i)/unit_mass/area);
<span class="lineNum">    6325 </span>            :         b_idotf[i] = dummy5 + 0.259*pow(reso.bodymass()/unit_mass,-0.25)*(biomass_B(i)/unit_mass/area);
<span class="lineNum">    6326 </span>            :       }
<span class="lineNum">    6327 </span>            :       } */
<span class="lineNum">    6328 </span>            : 
<span class="lineNum">    6329 </span>            :     // close loop for i
<span class="lineNum">    6330 </span>            :   }
<span class="lineNum">    6331 </span>            : 
<span class="lineNum">    6332 </span><span class="lineNoCov">          0 :   b_dotdotIf = b_dotdotI - dummy7;</span>
<span class="lineNum">    6333 </span>            :   //b_dotdotf = b_dotdotIf + dummy8;
<span class="lineNum">    6334 </span>            :   // Update flow vectors for compartment S+1
<span class="lineNum">    6335 </span>            :   /*b_idot[S] = 0;
<span class="lineNum">    6336 </span>            :   b_dotj[S] = b_dotdot - b_dotdotI;
<span class="lineNum">    6337 </span>            :   b_idotf[S] = 0;
<span class="lineNum">    6338 </span>            :   b_dotjf[S] = b_dotdotf - b_dotdotIf;*/
<span class="lineNum">    6339 </span>            : 
<span class="lineNum">    6340 </span>            :   /*for(int i=0;i&lt;S;i++){
<span class="lineNum">    6341 </span>            :     cout &lt;&lt; &quot;b_idot[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; b_idot[i] &lt;&lt; endl;
<span class="lineNum">    6342 </span>            :   }
<span class="lineNum">    6343 </span>            :   for(int i=0;i&lt;S;i++){
<span class="lineNum">    6344 </span>            :     cout &lt;&lt; &quot;b_dotj[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; b_dotj[i] &lt;&lt; endl;
<span class="lineNum">    6345 </span>            :     }*/
<span class="lineNum">    6346 </span>            : 
<span class="lineNum">    6347 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S_f = &quot; &lt;&lt; S_f &lt;&lt; endl;</span>
<span class="lineNum">    6348 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S_t = &quot; &lt;&lt; S_t &lt;&lt; endl;</span>
<span class="lineNum">    6349 </span><span class="lineNoCov">          0 :   S_i = S_c-S_t;</span>
<span class="lineNum">    6350 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;S_i = &quot; &lt;&lt; S_i &lt;&lt; endl;</span>
<span class="lineNum">    6351 </span>            : 
<span class="lineNum">    6352 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point75_M = &quot; &lt;&lt; b_lowtohigh[0]-b_hightolow[0] &lt;&lt; endl;</span>
<span class="lineNum">    6353 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point5_M = &quot; &lt;&lt; b_lowtohigh[1]-b_hightolow[1] &lt;&lt; endl;</span>
<span class="lineNum">    6354 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point25_M = &quot; &lt;&lt; b_lowtohigh[2]-b_hightolow[2] &lt;&lt; endl;</span>
<span class="lineNum">    6355 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14_M = &quot; &lt;&lt; b_lowtohigh[3]-b_hightolow[3] &lt;&lt; endl;</span>
<span class="lineNum">    6356 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point75_M = &quot; &lt;&lt; b_lowtohigh[4]-b_hightolow[4] &lt;&lt; endl;</span>
<span class="lineNum">    6357 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point5_M = &quot; &lt;&lt; b_lowtohigh[5]-b_hightolow[5] &lt;&lt; endl;</span>
<span class="lineNum">    6358 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point25_M = &quot; &lt;&lt; b_lowtohigh[6]-b_hightolow[6] &lt;&lt; endl;</span>
<span class="lineNum">    6359 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13_M = &quot; &lt;&lt; b_lowtohigh[7]-b_hightolow[7] &lt;&lt; endl;</span>
<span class="lineNum">    6360 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point75_M = &quot; &lt;&lt; b_lowtohigh[8]-b_hightolow[8] &lt;&lt; endl;</span>
<span class="lineNum">    6361 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point5_M = &quot; &lt;&lt; b_lowtohigh[9]-b_hightolow[9] &lt;&lt; endl;</span>
<span class="lineNum">    6362 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point25_M = &quot; &lt;&lt; b_lowtohigh[10]-b_hightolow[10] &lt;&lt; endl;</span>
<span class="lineNum">    6363 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12_M = &quot; &lt;&lt; b_lowtohigh[11]-b_hightolow[11] &lt;&lt; endl;</span>
<span class="lineNum">    6364 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point75_M = &quot; &lt;&lt; b_lowtohigh[12]-b_hightolow[12] &lt;&lt; endl;</span>
<span class="lineNum">    6365 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point5_M = &quot; &lt;&lt; b_lowtohigh[13]-b_hightolow[13] &lt;&lt; endl;</span>
<span class="lineNum">    6366 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point25_M = &quot; &lt;&lt; b_lowtohigh[14]-b_hightolow[14] &lt;&lt; endl;</span>
<span class="lineNum">    6367 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11_M = &quot; &lt;&lt; b_lowtohigh[15]-b_hightolow[15] &lt;&lt; endl;</span>
<span class="lineNum">    6368 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point75_M = &quot; &lt;&lt; b_lowtohigh[16]-b_hightolow[16] &lt;&lt; endl;</span>
<span class="lineNum">    6369 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point5_M = &quot; &lt;&lt; b_lowtohigh[17]-b_hightolow[17] &lt;&lt; endl;</span>
<span class="lineNum">    6370 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point25_M = &quot; &lt;&lt; b_lowtohigh[18]-b_hightolow[18] &lt;&lt; endl;</span>
<span class="lineNum">    6371 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10_M = &quot; &lt;&lt; b_lowtohigh[19]-b_hightolow[19] &lt;&lt; endl;</span>
<span class="lineNum">    6372 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point75_M = &quot; &lt;&lt; b_lowtohigh[20]-b_hightolow[20] &lt;&lt; endl;</span>
<span class="lineNum">    6373 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point5_M = &quot; &lt;&lt; b_lowtohigh[21]-b_hightolow[21] &lt;&lt; endl;</span>
<span class="lineNum">    6374 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point25_M = &quot; &lt;&lt; b_lowtohigh[22]-b_hightolow[22] &lt;&lt; endl;</span>
<span class="lineNum">    6375 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9_M = &quot; &lt;&lt; b_lowtohigh[23]-b_hightolow[23] &lt;&lt; endl;</span>
<span class="lineNum">    6376 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point75_M = &quot; &lt;&lt; b_lowtohigh[24]-b_hightolow[24] &lt;&lt; endl;</span>
<span class="lineNum">    6377 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point5_M = &quot; &lt;&lt; b_lowtohigh[25]-b_hightolow[25] &lt;&lt; endl;</span>
<span class="lineNum">    6378 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point25_M = &quot; &lt;&lt; b_lowtohigh[26]-b_hightolow[26] &lt;&lt; endl;</span>
<span class="lineNum">    6379 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8_M = &quot; &lt;&lt; b_lowtohigh[27]-b_hightolow[27] &lt;&lt; endl;</span>
<span class="lineNum">    6380 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point75_M = &quot; &lt;&lt; b_lowtohigh[28]-b_hightolow[28] &lt;&lt; endl;</span>
<span class="lineNum">    6381 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point5_M = &quot; &lt;&lt; b_lowtohigh[29]-b_hightolow[29] &lt;&lt; endl;</span>
<span class="lineNum">    6382 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point25_M = &quot; &lt;&lt; b_lowtohigh[30]-b_hightolow[30] &lt;&lt; endl;</span>
<span class="lineNum">    6383 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7_M = &quot; &lt;&lt; b_lowtohigh[31]-b_hightolow[31] &lt;&lt; endl;</span>
<span class="lineNum">    6384 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point75_M = &quot; &lt;&lt; b_lowtohigh[32]-b_hightolow[32] &lt;&lt; endl;</span>
<span class="lineNum">    6385 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point5_M = &quot; &lt;&lt; b_lowtohigh[33]-b_hightolow[33] &lt;&lt; endl;</span>
<span class="lineNum">    6386 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point25_M = &quot; &lt;&lt; b_lowtohigh[34]-b_hightolow[34] &lt;&lt; endl;</span>
<span class="lineNum">    6387 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6_M = &quot; &lt;&lt; b_lowtohigh[35]-b_hightolow[35] &lt;&lt; endl;</span>
<span class="lineNum">    6388 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point75_M = &quot; &lt;&lt; b_lowtohigh[36]-b_hightolow[36] &lt;&lt; endl;</span>
<span class="lineNum">    6389 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point5_M = &quot; &lt;&lt; b_lowtohigh[37]-b_hightolow[37] &lt;&lt; endl;</span>
<span class="lineNum">    6390 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point25_M = &quot; &lt;&lt; b_lowtohigh[38]-b_hightolow[38] &lt;&lt; endl;</span>
<span class="lineNum">    6391 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5_M = &quot; &lt;&lt; b_lowtohigh[39]-b_hightolow[39] &lt;&lt; endl;</span>
<span class="lineNum">    6392 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point75_M = &quot; &lt;&lt; b_lowtohigh[40]-b_hightolow[40] &lt;&lt; endl;</span>
<span class="lineNum">    6393 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point5_M = &quot; &lt;&lt; b_lowtohigh[41]-b_hightolow[41] &lt;&lt; endl;</span>
<span class="lineNum">    6394 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point25_M = &quot; &lt;&lt; b_lowtohigh[42]-b_hightolow[42] &lt;&lt; endl;</span>
<span class="lineNum">    6395 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4_M = &quot; &lt;&lt; b_lowtohigh[43]-b_hightolow[43] &lt;&lt; endl;</span>
<span class="lineNum">    6396 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point75_M = &quot; &lt;&lt; b_lowtohigh[44]-b_hightolow[44] &lt;&lt; endl;</span>
<span class="lineNum">    6397 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point5_M = &quot; &lt;&lt; b_lowtohigh[45]-b_hightolow[45] &lt;&lt; endl;</span>
<span class="lineNum">    6398 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point25_M = &quot; &lt;&lt; b_lowtohigh[46]-b_hightolow[46] &lt;&lt; endl;</span>
<span class="lineNum">    6399 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3_M = &quot; &lt;&lt; b_lowtohigh[47]-b_hightolow[47] &lt;&lt; endl;</span>
<span class="lineNum">    6400 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point75_M = &quot; &lt;&lt; b_lowtohigh[48]-b_hightolow[48] &lt;&lt; endl;</span>
<span class="lineNum">    6401 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point5_M = &quot; &lt;&lt; b_lowtohigh[49]-b_hightolow[49] &lt;&lt; endl;</span>
<span class="lineNum">    6402 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point25_M = &quot; &lt;&lt; b_lowtohigh[50]-b_hightolow[50] &lt;&lt; endl;</span>
<span class="lineNum">    6403 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2_M = &quot; &lt;&lt; b_lowtohigh[51]-b_hightolow[51] &lt;&lt; endl;</span>
<span class="lineNum">    6404 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point75_M = &quot; &lt;&lt; b_lowtohigh[52]-b_hightolow[52] &lt;&lt; endl;</span>
<span class="lineNum">    6405 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point5_M = &quot; &lt;&lt; b_lowtohigh[53]-b_hightolow[53] &lt;&lt; endl;</span>
<span class="lineNum">    6406 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point25_M = &quot; &lt;&lt; b_lowtohigh[54]-b_hightolow[54] &lt;&lt; endl;</span>
<span class="lineNum">    6407 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1_M = &quot; &lt;&lt; b_lowtohigh[55]-b_hightolow[55] &lt;&lt; endl;</span>
<span class="lineNum">    6408 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point75_M = &quot; &lt;&lt; b_lowtohigh[56]-b_hightolow[56] &lt;&lt; endl;</span>
<span class="lineNum">    6409 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point5_M = &quot; &lt;&lt; b_lowtohigh[57]-b_hightolow[57] &lt;&lt; endl;</span>
<span class="lineNum">    6410 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point25_M = &quot; &lt;&lt; b_lowtohigh[58]-b_hightolow[58] &lt;&lt; endl;</span>
<span class="lineNum">    6411 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0_M = &quot; &lt;&lt; b_lowtohigh[59]-b_hightolow[59] &lt;&lt; endl;</span>
<span class="lineNum">    6412 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point25_M = &quot; &lt;&lt; b_lowtohigh[60]-b_hightolow[60] &lt;&lt; endl;</span>
<span class="lineNum">    6413 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point5_M = &quot; &lt;&lt; b_lowtohigh[61]-b_hightolow[61] &lt;&lt; endl;</span>
<span class="lineNum">    6414 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point75_M = &quot; &lt;&lt; b_lowtohigh[62]-b_hightolow[62] &lt;&lt; endl;</span>
<span class="lineNum">    6415 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1_M = &quot; &lt;&lt; b_lowtohigh[63]-b_hightolow[63] &lt;&lt; endl;</span>
<span class="lineNum">    6416 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point25_M = &quot; &lt;&lt; b_lowtohigh[64]-b_hightolow[64] &lt;&lt; endl;</span>
<span class="lineNum">    6417 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point5_M = &quot; &lt;&lt; b_lowtohigh[65]-b_hightolow[65] &lt;&lt; endl;</span>
<span class="lineNum">    6418 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point75_M = &quot; &lt;&lt; b_lowtohigh[66]-b_hightolow[66] &lt;&lt; endl;</span>
<span class="lineNum">    6419 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2_M = &quot; &lt;&lt; b_lowtohigh[67]-b_hightolow[67] &lt;&lt; endl;</span>
<span class="lineNum">    6420 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point25_M = &quot; &lt;&lt; b_lowtohigh[68]-b_hightolow[68] &lt;&lt; endl;</span>
<span class="lineNum">    6421 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point5_M = &quot; &lt;&lt; b_lowtohigh[69]-b_hightolow[69] &lt;&lt; endl;</span>
<span class="lineNum">    6422 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[0]-b_hightolow_Mcorrected[0] &lt;&lt; endl;</span>
<span class="lineNum">    6423 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[1]-b_hightolow_Mcorrected[1] &lt;&lt; endl;</span>
<span class="lineNum">    6424 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[2]-b_hightolow_Mcorrected[2] &lt;&lt; endl;</span>
<span class="lineNum">    6425 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus14_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[3]-b_hightolow_Mcorrected[3] &lt;&lt; endl;</span>
<span class="lineNum">    6426 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[4]-b_hightolow_Mcorrected[4] &lt;&lt; endl;</span>
<span class="lineNum">    6427 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[5]-b_hightolow_Mcorrected[5] &lt;&lt; endl;</span>
<span class="lineNum">    6428 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[6]-b_hightolow_Mcorrected[6] &lt;&lt; endl;</span>
<span class="lineNum">    6429 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus13_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[7]-b_hightolow_Mcorrected[7] &lt;&lt; endl;</span>
<span class="lineNum">    6430 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[8]-b_hightolow_Mcorrected[8] &lt;&lt; endl;</span>
<span class="lineNum">    6431 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[9]-b_hightolow_Mcorrected[9] &lt;&lt; endl;</span>
<span class="lineNum">    6432 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[10]-b_hightolow_Mcorrected[10] &lt;&lt; endl;</span>
<span class="lineNum">    6433 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus12_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[11]-b_hightolow_Mcorrected[11] &lt;&lt; endl;</span>
<span class="lineNum">    6434 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[12]-b_hightolow_Mcorrected[12] &lt;&lt; endl;</span>
<span class="lineNum">    6435 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[13]-b_hightolow_Mcorrected[13] &lt;&lt; endl;</span>
<span class="lineNum">    6436 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[14]-b_hightolow_Mcorrected[14] &lt;&lt; endl;</span>
<span class="lineNum">    6437 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus11_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[15]-b_hightolow_Mcorrected[15] &lt;&lt; endl;</span>
<span class="lineNum">    6438 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[16]-b_hightolow_Mcorrected[16] &lt;&lt; endl;</span>
<span class="lineNum">    6439 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[17]-b_hightolow_Mcorrected[17] &lt;&lt; endl;</span>
<span class="lineNum">    6440 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[18]-b_hightolow_Mcorrected[18] &lt;&lt; endl;</span>
<span class="lineNum">    6441 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus10_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[19]-b_hightolow_Mcorrected[19] &lt;&lt; endl;</span>
<span class="lineNum">    6442 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[20]-b_hightolow_Mcorrected[20] &lt;&lt; endl;</span>
<span class="lineNum">    6443 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[21]-b_hightolow_Mcorrected[21] &lt;&lt; endl;</span>
<span class="lineNum">    6444 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[22]-b_hightolow_Mcorrected[22] &lt;&lt; endl;</span>
<span class="lineNum">    6445 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus9_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[23]-b_hightolow_Mcorrected[23] &lt;&lt; endl;</span>
<span class="lineNum">    6446 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[24]-b_hightolow_Mcorrected[24] &lt;&lt; endl;</span>
<span class="lineNum">    6447 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[25]-b_hightolow_Mcorrected[25] &lt;&lt; endl;</span>
<span class="lineNum">    6448 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[26]-b_hightolow_Mcorrected[26] &lt;&lt; endl;</span>
<span class="lineNum">    6449 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus8_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[27]-b_hightolow_Mcorrected[27] &lt;&lt; endl;</span>
<span class="lineNum">    6450 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[28]-b_hightolow_Mcorrected[28] &lt;&lt; endl;</span>
<span class="lineNum">    6451 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[29]-b_hightolow_Mcorrected[29] &lt;&lt; endl;</span>
<span class="lineNum">    6452 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[30]-b_hightolow_Mcorrected[30] &lt;&lt; endl;</span>
<span class="lineNum">    6453 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus7_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[31]-b_hightolow_Mcorrected[31] &lt;&lt; endl;</span>
<span class="lineNum">    6454 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[32]-b_hightolow_Mcorrected[32] &lt;&lt; endl;</span>
<span class="lineNum">    6455 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[33]-b_hightolow_Mcorrected[33] &lt;&lt; endl;</span>
<span class="lineNum">    6456 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[34]-b_hightolow_Mcorrected[34] &lt;&lt; endl;</span>
<span class="lineNum">    6457 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus6_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[35]-b_hightolow_Mcorrected[35] &lt;&lt; endl;</span>
<span class="lineNum">    6458 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[36]-b_hightolow_Mcorrected[36] &lt;&lt; endl;</span>
<span class="lineNum">    6459 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[37]-b_hightolow_Mcorrected[37] &lt;&lt; endl;</span>
<span class="lineNum">    6460 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[38]-b_hightolow_Mcorrected[38] &lt;&lt; endl;</span>
<span class="lineNum">    6461 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[39]-b_hightolow_Mcorrected[39] &lt;&lt; endl;</span>
<span class="lineNum">    6462 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[40]-b_hightolow_Mcorrected[40] &lt;&lt; endl;</span>
<span class="lineNum">    6463 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[41]-b_hightolow_Mcorrected[41] &lt;&lt; endl;</span>
<span class="lineNum">    6464 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[42]-b_hightolow_Mcorrected[42] &lt;&lt; endl;</span>
<span class="lineNum">    6465 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus4_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[43]-b_hightolow_Mcorrected[43] &lt;&lt; endl;</span>
<span class="lineNum">    6466 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[44]-b_hightolow_Mcorrected[44] &lt;&lt; endl;</span>
<span class="lineNum">    6467 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[45]-b_hightolow_Mcorrected[45] &lt;&lt; endl;</span>
<span class="lineNum">    6468 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[46]-b_hightolow_Mcorrected[46] &lt;&lt; endl;</span>
<span class="lineNum">    6469 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus3_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[47]-b_hightolow_Mcorrected[47] &lt;&lt; endl;</span>
<span class="lineNum">    6470 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[48]-b_hightolow_Mcorrected[48] &lt;&lt; endl;</span>
<span class="lineNum">    6471 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[49]-b_hightolow_Mcorrected[49] &lt;&lt; endl;</span>
<span class="lineNum">    6472 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[50]-b_hightolow_Mcorrected[50] &lt;&lt; endl;</span>
<span class="lineNum">    6473 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus2_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[51]-b_hightolow_Mcorrected[51] &lt;&lt; endl;</span>
<span class="lineNum">    6474 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[52]-b_hightolow_Mcorrected[52] &lt;&lt; endl;</span>
<span class="lineNum">    6475 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[53]-b_hightolow_Mcorrected[53] &lt;&lt; endl;</span>
<span class="lineNum">    6476 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[54]-b_hightolow_Mcorrected[54] &lt;&lt; endl;</span>
<span class="lineNum">    6477 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus1_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[55]-b_hightolow_Mcorrected[55] &lt;&lt; endl;</span>
<span class="lineNum">    6478 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[56]-b_hightolow_Mcorrected[56] &lt;&lt; endl;</span>
<span class="lineNum">    6479 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[57]-b_hightolow_Mcorrected[57] &lt;&lt; endl;</span>
<span class="lineNum">    6480 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_minus0point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[58]-b_hightolow_Mcorrected[58] &lt;&lt; endl;</span>
<span class="lineNum">    6481 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[59]-b_hightolow_Mcorrected[59] &lt;&lt; endl;</span>
<span class="lineNum">    6482 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[60]-b_hightolow_Mcorrected[60] &lt;&lt; endl;</span>
<span class="lineNum">    6483 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[61]-b_hightolow_Mcorrected[61] &lt;&lt; endl;</span>
<span class="lineNum">    6484 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_0point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[62]-b_hightolow_Mcorrected[62] &lt;&lt; endl;</span>
<span class="lineNum">    6485 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[63]-b_hightolow_Mcorrected[63] &lt;&lt; endl;</span>
<span class="lineNum">    6486 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[64]-b_hightolow_Mcorrected[64] &lt;&lt; endl;</span>
<span class="lineNum">    6487 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[65]-b_hightolow_Mcorrected[65] &lt;&lt; endl;</span>
<span class="lineNum">    6488 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_1point75_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[66]-b_hightolow_Mcorrected[66] &lt;&lt; endl;</span>
<span class="lineNum">    6489 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[67]-b_hightolow_Mcorrected[67] &lt;&lt; endl;</span>
<span class="lineNum">    6490 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point25_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[68]-b_hightolow_Mcorrected[68] &lt;&lt; endl;</span>
<span class="lineNum">    6491 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_2point5_M_Mcorrected = &quot; &lt;&lt; b_lowtohigh_Mcorrected[69]-b_hightolow_Mcorrected[69] &lt;&lt; endl;</span>
<span class="lineNum">    6492 </span>            : 
<span class="lineNum">    6493 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Q_f = &quot; &lt;&lt; Q_f &lt;&lt; endl;</span>
<span class="lineNum">    6494 </span>            :   //cout &lt;&lt; &quot;b_dotdot = &quot; &lt;&lt; b_dotdot &lt;&lt; endl;
<span class="lineNum">    6495 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_dotdotI = &quot; &lt;&lt; b_dotdotI &lt;&lt; endl;</span>
<span class="lineNum">    6496 </span>            :   //cout &lt;&lt; &quot;b_dotdotf = &quot; &lt;&lt; b_dotdotf &lt;&lt; endl;
<span class="lineNum">    6497 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;b_dotdotIf = &quot; &lt;&lt; b_dotdotIf &lt;&lt; endl;</span>
<span class="lineNum">    6498 </span>            : 
<span class="lineNum">    6499 </span>            : 
<span class="lineNum">    6500 </span>            :   // More flow indicators
<span class="lineNum">    6501 </span>            :   // There are some vectors too for H_ink, H_outk, n_ink, n_outk
<span class="lineNum">    6502 </span>            : 
<span class="lineNum">    6503 </span>            :   //double H_btot = 0.0;
<span class="lineNum">    6504 </span>            :   //double Asc = 0.0;
<span class="lineNum">    6505 </span>            :   //double AMI = 0.0;
<span class="lineNum">    6506 </span>            :   //double Cd = 0.0;
<span class="lineNum">    6507 </span><span class="lineNoCov">          0 :   double Asc_I = 0.0;</span>
<span class="lineNum">    6508 </span>            :   //double Asc_E = 0.0;
<span class="lineNum">    6509 </span><span class="lineNoCov">          0 :   double Cd_I = 0.0;</span>
<span class="lineNum">    6510 </span>            :   //double Cd_E = 0.0;
<span class="lineNum">    6511 </span><span class="lineNoCov">          0 :   double H_btotI = 0.0;</span>
<span class="lineNum">    6512 </span>            :   //double H_btotE = 0.0;
<span class="lineNum">    6513 </span><span class="lineNoCov">          0 :   double theta_I = 0.0;</span>
<span class="lineNum">    6514 </span>            :   //double theta_E = 0.0;
<span class="lineNum">    6515 </span><span class="lineNoCov">          0 :   double AMI_I = 0.0;</span>
<span class="lineNum">    6516 </span><span class="lineNoCov">          0 :   double effC = 0.0;</span>
<span class="lineNum">    6517 </span><span class="lineNoCov">          0 :   double effF = 1.0;</span>
<span class="lineNum">    6518 </span><span class="lineNoCov">          0 :   double effN = 0.0;</span>
<span class="lineNum">    6519 </span><span class="lineNoCov">          0 :   double effR = 0.0;</span>
<span class="lineNum">    6520 </span><span class="lineNoCov">          0 :   double H_bout = 0.0;</span>
<span class="lineNum">    6521 </span><span class="lineNoCov">          0 :   double H_bin = 0.0;</span>
<span class="lineNum">    6522 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_ink;</span>
<span class="lineNum">    6523 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outk;</span>
<span class="lineNum">    6524 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_ink;</span>
<span class="lineNum">    6525 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outk;</span>
<span class="lineNum">    6526 </span><span class="lineNoCov">          0 :   double LD_q_prime = 0.0;</span>
<span class="lineNum">    6527 </span><span class="lineNoCov">          0 :   double LD_q = 0.0;</span>
<span class="lineNum">    6528 </span><span class="lineNoCov">          0 :   double C_q_prime = 0.0;</span>
<span class="lineNum">    6529 </span><span class="lineNoCov">          0 :   double C_q = 0.0;</span>
<span class="lineNum">    6530 </span>            :   //double H_btotf = 0.0;
<span class="lineNum">    6531 </span>            :   //double Asc_f = 0.0;
<span class="lineNum">    6532 </span>            :   //double Cd_f = 0.0;
<span class="lineNum">    6533 </span>            :   //double theta_f = 0.0;
<span class="lineNum">    6534 </span><span class="lineNoCov">          0 :   double Asc_If = 0.0;</span>
<span class="lineNum">    6535 </span>            :   //double Asc_Ef = 0.0;
<span class="lineNum">    6536 </span><span class="lineNoCov">          0 :   double Cd_If = 0.0;</span>
<span class="lineNum">    6537 </span>            :   //double Cd_Ef = 0.0;
<span class="lineNum">    6538 </span><span class="lineNoCov">          0 :   double H_btotIf = 0.0;</span>
<span class="lineNum">    6539 </span>            :   //double H_btotEf = 0.0;
<span class="lineNum">    6540 </span><span class="lineNoCov">          0 :   double theta_If = 0.0;</span>
<span class="lineNum">    6541 </span>            :   //double theta_Ef = 0.0;
<span class="lineNum">    6542 </span><span class="lineNoCov">          0 :   double AMI_If = 0.0;</span>
<span class="lineNum">    6543 </span><span class="lineNoCov">          0 :   double effC_f = 0.0;</span>
<span class="lineNum">    6544 </span><span class="lineNoCov">          0 :   double effF_f = 1.0;</span>
<span class="lineNum">    6545 </span><span class="lineNoCov">          0 :   double effN_f = 0.0;</span>
<span class="lineNum">    6546 </span><span class="lineNoCov">          0 :   double effR_f = 0.0;</span>
<span class="lineNum">    6547 </span><span class="lineNoCov">          0 :   double H_boutf = 0.0;</span>
<span class="lineNum">    6548 </span><span class="lineNoCov">          0 :   double H_binf = 0.0;</span>
<span class="lineNum">    6549 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_inkf;</span>
<span class="lineNum">    6550 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; H_outkf;</span>
<span class="lineNum">    6551 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_inkf;</span>
<span class="lineNum">    6552 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; n_outkf;</span>
<span class="lineNum">    6553 </span><span class="lineNoCov">          0 :   double LD_qf_prime = 0.0;</span>
<span class="lineNum">    6554 </span><span class="lineNoCov">          0 :   double LD_qf = 0.0;</span>
<span class="lineNum">    6555 </span><span class="lineNoCov">          0 :   double C_qf_prime = 0.0;</span>
<span class="lineNum">    6556 </span><span class="lineNoCov">          0 :   double C_qf = 0.0;</span>
<span class="lineNum">    6557 </span><span class="lineNoCov">          0 :   double G_q_prime = 0.0;</span>
<span class="lineNum">    6558 </span><span class="lineNoCov">          0 :   double G_q = 0.0;</span>
<span class="lineNum">    6559 </span><span class="lineNoCov">          0 :   double V_q_prime = 0.0;</span>
<span class="lineNum">    6560 </span><span class="lineNoCov">          0 :   double V_q = 0.0;</span>
<span class="lineNum">    6561 </span>            : 
<span class="lineNum">    6562 </span><span class="lineNoCov">          0 :   double dummy100 = 0.0;</span>
<span class="lineNum">    6563 </span><span class="lineNoCov">          0 :   double dummy101 = 0.0;</span>
<span class="lineNum">    6564 </span><span class="lineNoCov">          0 :   double dummy102 = 0.0;</span>
<span class="lineNum">    6565 </span><span class="lineNoCov">          0 :   double dummy103 = 0.0;</span>
<span class="lineNum">    6566 </span><span class="lineNoCov">          0 :   double dummy104 = 0.0;</span>
<span class="lineNum">    6567 </span><span class="lineNoCov">          0 :   double dummy105 = 0.0;</span>
<span class="lineNum">    6568 </span><span class="lineNoCov">          0 :   double dummy106 = 0.0;</span>
<span class="lineNum">    6569 </span><span class="lineNoCov">          0 :   double dummy107 = 0.0;</span>
<span class="lineNum">    6570 </span><span class="lineNoCov">          0 :   double dummy108 = 0.0;</span>
<span class="lineNum">    6571 </span><span class="lineNoCov">          0 :   double dummy109 = 0.0;</span>
<span class="lineNum">    6572 </span><span class="lineNoCov">          0 :   double dummy110 = 0.0;</span>
<span class="lineNum">    6573 </span><span class="lineNoCov">          0 :   double dummy111 = 0.0;</span>
<span class="lineNum">    6574 </span><span class="lineNoCov">          0 :   double dummy112 = 0.0;</span>
<span class="lineNum">    6575 </span><span class="lineNoCov">          0 :   double dummy113 = 0.0;</span>
<span class="lineNum">    6576 </span><span class="lineNoCov">          0 :   double dummy114 = 0.0;</span>
<span class="lineNum">    6577 </span><span class="lineNoCov">          0 :   double dummy115 = 0.0;</span>
<span class="lineNum">    6578 </span>            : 
<span class="lineNum">    6579 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    6580 </span>            : 
<span class="lineNum">    6581 </span>            :     // Reset sums for vectors
<span class="lineNum">    6582 </span>            :     dummy102 = 0;
<span class="lineNum">    6583 </span>            :     dummy103 = 0;
<span class="lineNum">    6584 </span>            :     dummy104 = 0;
<span class="lineNum">    6585 </span>            :     dummy105 = 0;
<span class="lineNum">    6586 </span>            : 
<span class="lineNum">    6587 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    6588 </span>            : 
<span class="lineNum">    6589 </span><span class="lineNoCov">          0 :       dummy100 = intake(i,j)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6590 </span><span class="lineNoCov">          0 :       dummy101 = intake(j,i)/unit_mass/area/(1/year);</span>
<span class="lineNum">    6591 </span>            : 
<span class="lineNum">    6592 </span><span class="lineNoCov">          0 :       if(((b_idotI[i]*b_dotjI[j])&gt;0)&amp;&amp;(dummy100&gt;0)){</span>
<span class="lineNum">    6593 </span><span class="lineNoCov">          0 :         Asc_I += dummy100*(log10((dummy100*b_dotdotI)/(b_idotI[i]*b_dotjI[j]))/log10(2));</span>
<span class="lineNum">    6594 </span>            :       }
<span class="lineNum">    6595 </span><span class="lineNoCov">          0 :       if(dummy100&gt;0){</span>
<span class="lineNum">    6596 </span><span class="lineNoCov">          0 :         H_btotI = H_btotI - ((dummy100/b_dotdotI)*</span>
<span class="lineNum">    6597 </span><span class="lineNoCov">          0 :                            (log10(dummy100/b_dotdotI)/log10(2)));</span>
<span class="lineNum">    6598 </span><span class="lineNoCov">          0 :         effF = effF*pow(dummy100/b_dotdotI,-dummy100/b_dotdotI);</span>
<span class="lineNum">    6599 </span>            :       }
<span class="lineNum">    6600 </span>            :       // Updating sums for vectors
<span class="lineNum">    6601 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjI[i]&gt;0)){</span>
<span class="lineNum">    6602 </span><span class="lineNoCov">          0 :         dummy102 = dummy102 - ((dummy101/b_dotjI[i])*</span>
<span class="lineNum">    6603 </span><span class="lineNoCov">          0 :                                (log10(dummy101/b_dotjI[i])/log10(2)));</span>
<span class="lineNum">    6604 </span>            :       }
<span class="lineNum">    6605 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotI[i]&gt;0)){</span>
<span class="lineNum">    6606 </span><span class="lineNoCov">          0 :         dummy103 = dummy103 - ((dummy100/b_idotI[i])*</span>
<span class="lineNum">    6607 </span><span class="lineNoCov">          0 :                                (log10(dummy100/b_idotI[i])/log10(2)));</span>
<span class="lineNum">    6608 </span>            :       }
<span class="lineNum">    6609 </span>            :       // Fish indicators
<span class="lineNum">    6610 </span><span class="lineNoCov">          0 :       if(((b_idotIf[i]*b_dotjIf[j])&gt;0)&amp;&amp;(dummy100&gt;0)){</span>
<span class="lineNum">    6611 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&gt;-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&lt;=-3)){</span>
<span class="lineNum">    6612 </span><span class="lineNoCov">          0 :           Asc_If += dummy100*(log10((dummy100*b_dotdotIf)/(b_idotIf[i]*b_dotjIf[j]))/log10(2));</span>
<span class="lineNum">    6613 </span>            :         }
<span class="lineNum">    6614 </span><span class="lineNoCov">          0 :         if(log10(s[j].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    6615 </span><span class="lineNoCov">          0 :           Asc_If += dummy100*(log10((dummy100*b_dotdotIf)/(b_idotIf[i]*b_dotjIf[j]))/log10(2));</span>
<span class="lineNum">    6616 </span>            :         }
<span class="lineNum">    6617 </span>            :       }
<span class="lineNum">    6618 </span><span class="lineNoCov">          0 :       if(dummy100&gt;0){</span>
<span class="lineNum">    6619 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&gt;-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&lt;=-3)){</span>
<span class="lineNum">    6620 </span><span class="lineNoCov">          0 :           H_btotIf = H_btotIf - ((dummy100/b_dotdotIf)*</span>
<span class="lineNum">    6621 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_dotdotIf)/log10(2)));</span>
<span class="lineNum">    6622 </span><span class="lineNoCov">          0 :           effF_f = effF_f*pow(dummy100/b_dotdotIf,-dummy100/b_dotdotIf);</span>
<span class="lineNum">    6623 </span>            :         }
<span class="lineNum">    6624 </span><span class="lineNoCov">          0 :         if(log10(s[j].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    6625 </span><span class="lineNoCov">          0 :           H_btotIf = H_btotIf - ((dummy100/b_dotdotIf)*</span>
<span class="lineNum">    6626 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_dotdotIf)/log10(2)));</span>
<span class="lineNum">    6627 </span><span class="lineNoCov">          0 :           effF_f = effF_f*pow(dummy100/b_dotdotIf,-dummy100/b_dotdotIf);</span>
<span class="lineNum">    6628 </span>            :         }
<span class="lineNum">    6629 </span>            :       }
<span class="lineNum">    6630 </span>            :       // Updating sums for vectors
<span class="lineNum">    6631 </span><span class="lineNoCov">          0 :       if((dummy101&gt;0)&amp;&amp;(b_dotjIf[i]&gt;0)){</span>
<span class="lineNum">    6632 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    6633 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    6634 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    6635 </span>            :         }
<span class="lineNum">    6636 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&gt;-3)){</span>
<span class="lineNum">    6637 </span><span class="lineNoCov">          0 :           dummy104 = dummy104 - ((dummy101/b_dotjIf[i])*</span>
<span class="lineNum">    6638 </span><span class="lineNoCov">          0 :                                  (log10(dummy101/b_dotjIf[i])/log10(2)));</span>
<span class="lineNum">    6639 </span>            :         }
<span class="lineNum">    6640 </span>            :       }
<span class="lineNum">    6641 </span><span class="lineNoCov">          0 :       if((dummy100&gt;0)&amp;&amp;(b_idotIf[i]&gt;0)){</span>
<span class="lineNum">    6642 </span><span class="lineNoCov">          0 :         if(log10(s[i].bodymass()/unit_mass)&gt;-3){</span>
<span class="lineNum">    6643 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    6644 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    6645 </span>            :         }
<span class="lineNum">    6646 </span><span class="lineNoCov">          0 :         if((log10(s[i].bodymass()/unit_mass)&lt;=-3)&amp;&amp;(log10(s[j].bodymass()/unit_mass)&lt;=-3)){</span>
<span class="lineNum">    6647 </span><span class="lineNoCov">          0 :           dummy105 = dummy105 - ((dummy100/b_idotIf[i])*</span>
<span class="lineNum">    6648 </span><span class="lineNoCov">          0 :                                  (log10(dummy100/b_idotIf[i])/log10(2)));</span>
<span class="lineNum">    6649 </span>            :         }
<span class="lineNum">    6650 </span>            :       }
<span class="lineNum">    6651 </span>            :        
<span class="lineNum">    6652 </span>            :       // end loop for j
<span class="lineNum">    6653 </span>            :     }
<span class="lineNum">    6654 </span>            : 
<span class="lineNum">    6655 </span><span class="lineNoCov">          0 :     H_ink[i] = dummy102;</span>
<span class="lineNum">    6656 </span><span class="lineNoCov">          0 :     H_outk[i] = dummy103;</span>
<span class="lineNum">    6657 </span><span class="lineNoCov">          0 :     if(b_idotI[i]&gt;0){</span>
<span class="lineNum">    6658 </span><span class="lineNoCov">          0 :       H_bout = H_bout - ((b_idotI[i]/b_dotdotI)*</span>
<span class="lineNum">    6659 </span><span class="lineNoCov">          0 :                          (log10(b_idotI[i]/b_dotdotI)/log10(2)));</span>
<span class="lineNum">    6660 </span><span class="lineNoCov">          0 :       n_outk[i] = pow(2,H_outk[i]);</span>
<span class="lineNum">    6661 </span>            :     }else{
<span class="lineNum">    6662 </span><span class="lineNoCov">          0 :       n_outk[i] = 0;</span>
<span class="lineNum">    6663 </span>            :     }
<span class="lineNum">    6664 </span><span class="lineNoCov">          0 :     if(b_dotjI[i]&gt;0){</span>
<span class="lineNum">    6665 </span><span class="lineNoCov">          0 :       H_bin = H_bin - ((b_dotjI[i]/b_dotdotI)*</span>
<span class="lineNum">    6666 </span><span class="lineNoCov">          0 :                        (log10(b_dotjI[i]/b_dotdotI)/log10(2)));</span>
<span class="lineNum">    6667 </span><span class="lineNoCov">          0 :       n_ink[i] = pow(2,H_ink[i]);</span>
<span class="lineNum">    6668 </span>            :     }else{
<span class="lineNum">    6669 </span><span class="lineNoCov">          0 :       n_ink[i] = 0;</span>
<span class="lineNum">    6670 </span>            :     }
<span class="lineNum">    6671 </span>            :     // It has been checked that 1.0/(2.0*S) is a decimal
<span class="lineNum">    6672 </span><span class="lineNoCov">          0 :     LD_q_prime += (1.0/(2.0*S))*(n_outk[i]+n_ink[i]);</span>
<span class="lineNum">    6673 </span><span class="lineNoCov">          0 :     LD_q += (0.5)*(((b_idotI[i]/b_dotdotI)*n_outk[i])+((b_dotjI[i]/b_dotdotI)*n_ink[i]));</span>
<span class="lineNum">    6674 </span>            :     // It has been checked that e.g. 1.0/(S_t+S_i) is a decimal
<span class="lineNum">    6675 </span><span class="lineNoCov">          0 :     G_q_prime += (1.0/(S_t+S_i))*n_ink[i];</span>
<span class="lineNum">    6676 </span><span class="lineNoCov">          0 :     G_q += (b_dotjI[i]/b_dotdotI)*n_ink[i];</span>
<span class="lineNum">    6677 </span><span class="lineNoCov">          0 :     V_q_prime += (1.0/(S_i+S_p))*n_outk[i];</span>
<span class="lineNum">    6678 </span><span class="lineNoCov">          0 :     V_q += (b_idotI[i]/b_dotdotI)*n_outk[i];</span>
<span class="lineNum">    6679 </span>            : 
<span class="lineNum">    6680 </span><span class="lineNoCov">          0 :     H_inkf[i] = dummy104;</span>
<span class="lineNum">    6681 </span><span class="lineNoCov">          0 :     H_outkf[i] = dummy105;</span>
<span class="lineNum">    6682 </span><span class="lineNoCov">          0 :     if(b_idotIf[i]&gt;0){</span>
<span class="lineNum">    6683 </span><span class="lineNoCov">          0 :       H_boutf = H_boutf - ((b_idotIf[i]/b_dotdotIf)*</span>
<span class="lineNum">    6684 </span><span class="lineNoCov">          0 :                          (log10(b_idotIf[i]/b_dotdotIf)/log10(2)));</span>
<span class="lineNum">    6685 </span><span class="lineNoCov">          0 :       n_outkf[i] = pow(2,H_outkf[i]);</span>
<span class="lineNum">    6686 </span>            :     }else{
<span class="lineNum">    6687 </span><span class="lineNoCov">          0 :       n_outkf[i] = 0;</span>
<span class="lineNum">    6688 </span>            :     }
<span class="lineNum">    6689 </span><span class="lineNoCov">          0 :     if(b_dotjIf[i]&gt;0){</span>
<span class="lineNum">    6690 </span><span class="lineNoCov">          0 :       H_binf = H_binf - ((b_dotjIf[i]/b_dotdotIf)*</span>
<span class="lineNum">    6691 </span><span class="lineNoCov">          0 :                        (log10(b_dotjIf[i]/b_dotdotIf)/log10(2)));</span>
<span class="lineNum">    6692 </span><span class="lineNoCov">          0 :       n_inkf[i] = pow(2,H_inkf[i]);</span>
<span class="lineNum">    6693 </span>            :     }else{
<span class="lineNum">    6694 </span><span class="lineNoCov">          0 :       n_inkf[i] = 0;</span>
<span class="lineNum">    6695 </span>            :     }
<span class="lineNum">    6696 </span>            :     // It has been checked that 1.0/(2.0*S) is a decimal
<span class="lineNum">    6697 </span><span class="lineNoCov">          0 :     LD_qf_prime += (1.0/(2.0*S))*(n_outkf[i]+n_inkf[i]);</span>
<span class="lineNum">    6698 </span><span class="lineNoCov">          0 :     LD_qf += (0.5)*(((b_idotIf[i]/b_dotdotIf)*n_outkf[i])+((b_dotjIf[i]/b_dotdotIf)*n_inkf[i]));</span>
<span class="lineNum">    6699 </span>            : 
<span class="lineNum">    6700 </span><span class="lineNoCov">          0 :     dummy106 += n_ink[i];</span>
<span class="lineNum">    6701 </span><span class="lineNoCov">          0 :     dummy107 += b_dotjI[i]*n_ink[i];</span>
<span class="lineNum">    6702 </span><span class="lineNoCov">          0 :     dummy108 += n_outk[i];</span>
<span class="lineNum">    6703 </span><span class="lineNoCov">          0 :     dummy109 += b_idotI[i]*n_outk[i];</span>
<span class="lineNum">    6704 </span>            : 
<span class="lineNum">    6705 </span>            :     // end loop for i
<span class="lineNum">    6706 </span>            :   }
<span class="lineNum">    6707 </span>            : 
<span class="lineNum">    6708 </span>            :   /*for(int i=0;i&lt;S;i++){
<span class="lineNum">    6709 </span>            :     cout &lt;&lt; &quot;H_ink[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; H_ink[i] &lt;&lt; endl;
<span class="lineNum">    6710 </span>            :     cout &lt;&lt; &quot;H_outk[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; H_outk[i] &lt;&lt; endl;
<span class="lineNum">    6711 </span>            :     cout &lt;&lt; &quot;n_ink[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; n_ink[i] &lt;&lt; endl;
<span class="lineNum">    6712 </span>            :     cout &lt;&lt; &quot;n_outk[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; n_outk[i] &lt;&lt; endl;
<span class="lineNum">    6713 </span>            :     }
<span class="lineNum">    6714 </span>            :   for(int i=0;i&lt;S_c;i++){
<span class="lineNum">    6715 </span>            :     cout &lt;&lt; &quot;omn_j[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; omn_j[i] &lt;&lt; endl;
<span class="lineNum">    6716 </span>            :   }
<span class="lineNum">    6717 </span>            :   for(int i=0;i&lt;S_f;i++){
<span class="lineNum">    6718 </span>            :     cout &lt;&lt; &quot;omn_jf[&quot; &lt;&lt; i &lt;&lt; &quot;] = &quot; &lt;&lt; omn_jf[i] &lt;&lt; endl;
<span class="lineNum">    6719 </span>            :     }*/
<span class="lineNum">    6720 </span>            : 
<span class="lineNum">    6721 </span><span class="lineNoCov">          0 :   Cd_I = b_dotdotI*H_btotI;</span>
<span class="lineNum">    6722 </span><span class="lineNoCov">          0 :   theta_I = Cd_I - Asc_I;</span>
<span class="lineNum">    6723 </span><span class="lineNoCov">          0 :   AMI_I = Asc_I/b_dotdotI;</span>
<span class="lineNum">    6724 </span><span class="lineNoCov">          0 :   effC = pow(2,theta_I/(2.0*b_dotdotI));</span>
<span class="lineNum">    6725 </span><span class="lineNoCov">          0 :   effN = effF/effC;</span>
<span class="lineNum">    6726 </span><span class="lineNoCov">          0 :   effR = pow(2,AMI_I);</span>
<span class="lineNum">    6727 </span><span class="lineNoCov">          0 :   C_q_prime = LD_q_prime/S;</span>
<span class="lineNum">    6728 </span><span class="lineNoCov">          0 :   C_q = LD_q/S;</span>
<span class="lineNum">    6729 </span>            :   
<span class="lineNum">    6730 </span><span class="lineNoCov">          0 :   Cd_If = b_dotdotIf*H_btotIf;</span>
<span class="lineNum">    6731 </span><span class="lineNoCov">          0 :   theta_If = Cd_If - Asc_If;</span>
<span class="lineNum">    6732 </span><span class="lineNoCov">          0 :   AMI_If = Asc_If/b_dotdotIf;</span>
<span class="lineNum">    6733 </span><span class="lineNoCov">          0 :   effC_f = pow(2,theta_If/(2.0*b_dotdotIf));</span>
<span class="lineNum">    6734 </span><span class="lineNoCov">          0 :   effN_f = effF_f/effC_f;</span>
<span class="lineNum">    6735 </span><span class="lineNoCov">          0 :   effR_f = pow(2,AMI_If);</span>
<span class="lineNum">    6736 </span><span class="lineNoCov">          0 :   C_qf_prime = LD_qf_prime/S;</span>
<span class="lineNum">    6737 </span><span class="lineNoCov">          0 :   C_qf = LD_qf/S;</span>
<span class="lineNum">    6738 </span>            : 
<span class="lineNum">    6739 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Asc_I = &quot; &lt;&lt; Asc_I &lt;&lt; endl;</span>
<span class="lineNum">    6740 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Cd_I = &quot; &lt;&lt; Cd_I &lt;&lt; endl;</span>
<span class="lineNum">    6741 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_btotI = &quot; &lt;&lt; H_btotI &lt;&lt; endl;</span>
<span class="lineNum">    6742 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;theta_I = &quot; &lt;&lt; theta_I &lt;&lt; endl;</span>
<span class="lineNum">    6743 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;AMI_I = &quot; &lt;&lt; AMI_I &lt;&lt; endl;</span>
<span class="lineNum">    6744 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effC = &quot; &lt;&lt; effC &lt;&lt; endl;</span>
<span class="lineNum">    6745 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effF = &quot; &lt;&lt; effF &lt;&lt; endl;</span>
<span class="lineNum">    6746 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effN = &quot; &lt;&lt; effN &lt;&lt; endl;</span>
<span class="lineNum">    6747 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effR = &quot; &lt;&lt; effR &lt;&lt; endl;</span>
<span class="lineNum">    6748 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_bout = &quot; &lt;&lt; H_bout &lt;&lt; endl;</span>
<span class="lineNum">    6749 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_bin = &quot; &lt;&lt; H_bin &lt;&lt; endl;</span>
<span class="lineNum">    6750 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LD_q_prime = &quot; &lt;&lt; LD_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6751 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LD_q = &quot; &lt;&lt; LD_q &lt;&lt; endl;</span>
<span class="lineNum">    6752 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;C_q_prime = &quot; &lt;&lt; C_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6753 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;C_q = &quot; &lt;&lt; C_q &lt;&lt; endl;</span>
<span class="lineNum">    6754 </span>            : 
<span class="lineNum">    6755 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Asc_If = &quot; &lt;&lt; Asc_If &lt;&lt; endl;</span>
<span class="lineNum">    6756 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;Cd_If = &quot; &lt;&lt; Cd_If &lt;&lt; endl;</span>
<span class="lineNum">    6757 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_btotIf = &quot; &lt;&lt; H_btotIf &lt;&lt; endl;</span>
<span class="lineNum">    6758 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;theta_If = &quot; &lt;&lt; theta_If &lt;&lt; endl;</span>
<span class="lineNum">    6759 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;AMI_If = &quot; &lt;&lt; AMI_If &lt;&lt; endl;</span>
<span class="lineNum">    6760 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effC_f = &quot; &lt;&lt; effC_f &lt;&lt; endl;</span>
<span class="lineNum">    6761 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effF_f = &quot; &lt;&lt; effF_f &lt;&lt; endl;</span>
<span class="lineNum">    6762 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effN_f = &quot; &lt;&lt; effN_f &lt;&lt; endl;</span>
<span class="lineNum">    6763 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;effR_f = &quot; &lt;&lt; effR_f &lt;&lt; endl;</span>
<span class="lineNum">    6764 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_boutf = &quot; &lt;&lt; H_boutf &lt;&lt; endl;</span>
<span class="lineNum">    6765 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;H_binf = &quot; &lt;&lt; H_binf &lt;&lt; endl;</span>
<span class="lineNum">    6766 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LD_qf_prime = &quot; &lt;&lt; LD_qf_prime &lt;&lt; endl;</span>
<span class="lineNum">    6767 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;LD_qf = &quot; &lt;&lt; LD_qf &lt;&lt; endl;</span>
<span class="lineNum">    6768 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;C_qf_prime = &quot; &lt;&lt; C_qf_prime &lt;&lt; endl;</span>
<span class="lineNum">    6769 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;C_qf = &quot; &lt;&lt; C_qf &lt;&lt; endl;</span>
<span class="lineNum">    6770 </span>            :   
<span class="lineNum">    6771 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;G_q_prime = &quot; &lt;&lt; G_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6772 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;G_q = &quot; &lt;&lt; G_q &lt;&lt; endl;</span>
<span class="lineNum">    6773 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;V_q_prime = &quot; &lt;&lt; V_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6774 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;V_q = &quot; &lt;&lt; V_q &lt;&lt; endl;</span>
<span class="lineNum">    6775 </span>            : 
<span class="lineNum">    6776 </span>            :   // Final set of flow indicators
<span class="lineNum">    6777 </span>            :   // There are some vectors too for g_k_prime, g_k, v_k_prime, v_k, o_j and o_jf
<span class="lineNum">    6778 </span>            : 
<span class="lineNum">    6779 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; g_k_prime;</span>
<span class="lineNum">    6780 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; g_k;</span>
<span class="lineNum">    6781 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; v_k_prime;</span>
<span class="lineNum">    6782 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; v_k;</span>
<span class="lineNum">    6783 </span><span class="lineNoCov">          0 :   double sdG_q_prime = 0.0;</span>
<span class="lineNum">    6784 </span><span class="lineNoCov">          0 :   double sdG_q = 0.0;</span>
<span class="lineNum">    6785 </span><span class="lineNoCov">          0 :   double sdV_q_prime = 0.0;</span>
<span class="lineNum">    6786 </span><span class="lineNoCov">          0 :   double sdV_q = 0.0;</span>
<span class="lineNum">    6787 </span>            : 
<span class="lineNum">    6788 </span><span class="lineNoCov">          0 :   double dummy200 = 0.0;</span>
<span class="lineNum">    6789 </span><span class="lineNoCov">          0 :   double dummy201 = 0.0;</span>
<span class="lineNum">    6790 </span><span class="lineNoCov">          0 :   double dummy202 = 0.0;</span>
<span class="lineNum">    6791 </span><span class="lineNoCov">          0 :   double dummy203 = 0.0;</span>
<span class="lineNum">    6792 </span>            : 
<span class="lineNum">    6793 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    6794 </span><span class="lineNoCov">          0 :     g_k_prime[i] = (S*n_ink[i])/dummy106;</span>
<span class="lineNum">    6795 </span><span class="lineNoCov">          0 :     g_k[i] = (S*b_dotjI[i]*n_ink[i])/dummy107;</span>
<span class="lineNum">    6796 </span><span class="lineNoCov">          0 :     v_k_prime[i] = (S*n_outk[i])/dummy108;</span>
<span class="lineNum">    6797 </span><span class="lineNoCov">          0 :     v_k[i] = (S*b_idotI[i]*n_outk[i])/dummy109;</span>
<span class="lineNum">    6798 </span>            :   }
<span class="lineNum">    6799 </span>            :   // Note that from formulae, the means of above are always 1
<span class="lineNum">    6800 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    6801 </span><span class="lineNoCov">          0 :     dummy200 += pow(g_k_prime[i]-1,2.0);</span>
<span class="lineNum">    6802 </span><span class="lineNoCov">          0 :     dummy201 += pow(g_k[i]-1,2.0);</span>
<span class="lineNum">    6803 </span><span class="lineNoCov">          0 :     dummy202 += pow(v_k_prime[i]-1,2.0);</span>
<span class="lineNum">    6804 </span><span class="lineNoCov">          0 :     dummy203 += pow(v_k[i]-1,2.0);  </span>
<span class="lineNum">    6805 </span>            :   }
<span class="lineNum">    6806 </span>            :   // It has been checked that dividing dummy by S gives decimal
<span class="lineNum">    6807 </span><span class="lineNoCov">          0 :   sdG_q_prime = sqrt(dummy200/S);</span>
<span class="lineNum">    6808 </span><span class="lineNoCov">          0 :   sdG_q = sqrt(dummy201/S);</span>
<span class="lineNum">    6809 </span><span class="lineNoCov">          0 :   sdV_q_prime = sqrt(dummy202/S);</span>
<span class="lineNum">    6810 </span><span class="lineNoCov">          0 :   sdV_q = sqrt(dummy203/S);</span>
<span class="lineNum">    6811 </span>            : 
<span class="lineNum">    6812 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sdG_q_prime = &quot; &lt;&lt; sdG_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6813 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sdG_q = &quot; &lt;&lt; sdG_q &lt;&lt; endl;</span>
<span class="lineNum">    6814 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sdV_q_prime = &quot; &lt;&lt; sdV_q_prime &lt;&lt; endl;</span>
<span class="lineNum">    6815 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;sdV_q = &quot; &lt;&lt; sdV_q &lt;&lt; endl; </span>
<span class="lineNum">    6816 </span>            : 
<span class="lineNum">    6817 </span>            : 
<span class="lineNum">    6818 </span>            :   // Old link table file no longer produced
<span class="lineNum">    6819 </span>            :   /* for(int n=0;n&lt;S;n++){
<span class="lineNum">    6820 </span>            :     for(int m=0;m&lt;S;m++){
<span class="lineNum">    6821 </span>            :       if(ifrac(m,n)&gt;th){
<span class="lineNum">    6822 </span>            :         NewSpecies &amp; cons=s[n];
<span class="lineNum">    6823 </span>            :         NewSpecies &amp; reso=s[m];
<span class="lineNum">    6824 </span>            :         os.width(9);
<span class="lineNum">    6825 </span>            :         os &lt;&lt; level[n] &lt;&lt; &quot; &quot;;
<span class="lineNum">    6826 </span>            :         os.width(9);
<span class="lineNum">    6827 </span>            :         os &lt;&lt; level[m] &lt;&lt; &quot; &quot;;
<span class="lineNum">    6828 </span>            :         os.width(9);
<span class="lineNum">    6829 </span>            :         os &lt;&lt; log10(cons.bodymass()/unit_mass) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6830 </span>            :         os.width(9);
<span class="lineNum">    6831 </span>            :         os &lt;&lt; log10(reso.bodymass()/unit_mass) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6832 </span>            :         os.width(9);
<span class="lineNum">    6833 </span>            :         os &lt;&lt; log10(biomass_B(n)/unit_mass/area) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6834 </span>            :         os.width(9);
<span class="lineNum">    6835 </span>            :         os &lt;&lt; log10(biomass_B(m)/unit_mass/area) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6836 </span>            :         os.width(9);
<span class="lineNum">    6837 </span>            :         os &lt;&lt; assigned_column[n] &lt;&lt; &quot; &quot;;
<span class="lineNum">    6838 </span>            :         os.width(9);
<span class="lineNum">    6839 </span>            :         os &lt;&lt; assigned_column[m] &lt;&lt; &quot; &quot;;
<span class="lineNum">    6840 </span>            :         os.width(9);
<span class="lineNum">    6841 </span>            :         os &lt;&lt; intake(m,n)/unit_mass/area/(1/year) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6842 </span>            :         os.width(9);
<span class="lineNum">    6843 </span>            :         os &lt;&lt; ifrac(m,n) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6844 </span>            :         os.width(9);
<span class="lineNum">    6845 </span>            :         os &lt;&lt; log10(precomputed[n].c[m]) &lt;&lt; &quot; &quot;;
<span class="lineNum">    6846 </span>            :         os &lt;&lt; std::endl;
<span class="lineNum">    6847 </span>            :       }
<span class="lineNum">    6848 </span>            :     }
<span class="lineNum">    6849 </span>            :     } */
<span class="lineNum">    6850 </span>            : 
<a name="6851"><span class="lineNum">    6851 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6852 </span>            : 
<span class="lineNum">    6853 </span><span class="lineNoCov">          0 : int NewWeb::get_invasion_counter(){</span>
<a name="6854"><span class="lineNum">    6854 </span><span class="lineNoCov">          0 :   return invasion_counter;</span></a>
<span class="lineNum">    6855 </span>            : }
<span class="lineNum">    6856 </span><span class="lineNoCov">          0 : int NewWeb::get_speciation_counter(){</span>
<a name="6857"><span class="lineNum">    6857 </span><span class="lineNoCov">          0 :   return speciation_counter;</span></a>
<span class="lineNum">    6858 </span>            : }
<span class="lineNum">    6859 </span><span class="lineNoCov">          0 : int NewWeb::get_max_ever_plant_richness(){</span>
<span class="lineNum">    6860 </span><span class="lineNoCov">          0 :   return max_ever_plant_richness;</span>
<a name="6861"><span class="lineNum">    6861 </span>            : }</a>
<span class="lineNum">    6862 </span>            : 
<span class="lineNum">    6863 </span><span class="lineNoCov">          0 : link_strength_matrix NewWeb::numerical_Jacobian(double dx){</span>
<span class="lineNum">    6864 </span><span class="lineNoCov">          0 :   link_strength_matrix J;</span>
<span class="lineNum">    6865 </span><span class="lineNoCov">          0 :   J.resize(s.size());</span>
<span class="lineNum">    6866 </span><span class="lineNoCov">          0 :   ODE_dynamical_object::numerical_Jacobian(J,dx);</span>
<span class="lineNum">    6867 </span><span class="lineNoCov">          0 :   return J;</span>
<a name="6868"><span class="lineNum">    6868 </span>            : }</a>
<span class="lineNum">    6869 </span>            : 
<span class="lineNum">    6870 </span><span class="lineNoCov">          0 : void NewWeb::eigenvalue_list(const char* filename,double dx){</span>
<span class="lineNum">    6871 </span>            : #if 1
<span class="lineNum">    6872 </span><span class="lineNoCov">          0 :   link_strength_matrix J;</span>
<span class="lineNum">    6873 </span><span class="lineNoCov">          0 :   if(dx){</span>
<span class="lineNum">    6874 </span><span class="lineNoCov">          0 :     J=numerical_Jacobian(dx);</span>
<span class="lineNum">    6875 </span>            :   }else{
<span class="lineNum">    6876 </span><span class="lineNoCov">          0 :     J=numerical_Jacobian();</span>
<span class="lineNum">    6877 </span>            :   }
<span class="lineNum">    6878 </span>            : #else // do eigenvalues of the plant competition matrix instead.
<span class="lineNum">    6879 </span>            :   link_strength_matrix J;
<span class="lineNum">    6880 </span>            :   J.resize(number_of_plants());
<span class="lineNum">    6881 </span>            :   for(int i=number_of_plants();i--&gt;0;){
<span class="lineNum">    6882 </span>            :     for(int j=number_of_plants();j--&gt;0;){
<span class="lineNum">    6883 </span>            :       J[i][j]=-s(i+s.n_animals).plant_hampering_by(s(j+s.n_animals))/
<span class="lineNum">    6884 </span>            :         sqrt(s(i+s.n_animals).plant_hampering_by(s(i+s.n_animals)))/
<span class="lineNum">    6885 </span>            :         sqrt(s(j+s.n_animals).plant_hampering_by(s(j+s.n_animals)));
<span class="lineNum">    6886 </span>            :     }
<span class="lineNum">    6887 </span>            :   }
<span class="lineNum">    6888 </span>            : #endif
<span class="lineNum">    6889 </span>            :   
<span class="lineNum">    6890 </span>            :   
<span class="lineNum">    6891 </span><span class="lineNoCov">          0 :   NewMatrix mat(J);</span>
<span class="lineNum">    6892 </span>            : #if 0 // compute time-scaled community matrix instead
<span class="lineNum">    6893 </span>            :   ublas::diagonal_matrix&lt;double&gt; iB(s.size()),ir(s.size());
<span class="lineNum">    6894 </span>            :   for(int i=s.size();i--&gt;0;)
<span class="lineNum">    6895 </span>            :     iB[i][i]=1/s(i).biomass_abundance_B();
<span class="lineNum">    6896 </span>            :   ublas::diagonal_matrix&lt;double&gt; iB(s.size()),ir(s.size());
<span class="lineNum">    6897 </span>            :   for(int i=s.size();i--&gt;0;){
<span class="lineNum">    6898 </span>            :     iB[i][i]=1/s(i).biomass_abundance_B();
<span class="lineNum">    6899 </span>            :     ir[i][i]=1/(is_plant(i)?
<span class="lineNum">    6900 </span>            :                 s(i).plant_growth_rate_sigma() : 
<span class="lineNum">    6901 </span>            :                 s(i).turnover_rate_r() );
<span class="lineNum">    6902 </span>            :   }
<span class="lineNum">    6903 </span>            :   mat=ir*mat*iB/year*(animal_biomass()+plant_biomass())/s.size();
<span class="lineNum">    6904 </span>            : #endif
<span class="lineNum">    6905 </span>            : 
<span class="lineNum">    6906 </span><span class="lineNoCov">          0 :   mat*=1/year; // make sure we use units of 1/year.</span>
<span class="lineNum">    6907 </span>            :   
<span class="lineNum">    6908 </span><span class="lineNoCov">          0 :   eigen_report(mat, filename);</span>
<span class="lineNum">    6909 </span>            : 
<span class="lineNum">    6910 </span>            :   {
<span class="lineNum">    6911 </span><span class="lineNoCov">          0 :     ostringstream F,FS;</span>
<span class="lineNum">    6912 </span><span class="lineNoCov">          0 :     F &lt;&lt; &quot;F&quot; &lt;&lt; filename;</span>
<span class="lineNum">    6913 </span><span class="lineNoCov">          0 :     FS &lt;&lt; &quot;FS&quot; &lt;&lt; filename;</span>
<span class="lineNum">    6914 </span>            : 
<span class="lineNum">    6915 </span><span class="lineNoCov">          0 :     int S=number_of_species();</span>
<span class="lineNum">    6916 </span>            :     
<span class="lineNum">    6917 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; fish(0);</span>
<span class="lineNum">    6918 </span><span class="lineNoCov">          0 :     for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    6919 </span><span class="lineNoCov">          0 :       if(!is_plant(i) &amp;&amp; s(i).bodymass() &gt; fishMlowerthreshold &amp;&amp;</span>
<span class="lineNum">    6920 </span><span class="lineNoCov">          0 :          s(i).bodymass() &lt; fishMupperthreshold ){</span>
<span class="lineNum">    6921 </span><span class="lineNoCov">          0 :         fish.push_back(i);</span>
<span class="lineNum">    6922 </span>            :       }
<span class="lineNum">    6923 </span>            :     }
<span class="lineNum">    6924 </span><span class="lineNoCov">          0 :     arma::uvec sel(fish.size());</span>
<span class="lineNum">    6925 </span><span class="lineNoCov">          0 :     if(fish.size()){</span>
<span class="lineNum">    6926 </span><span class="lineNoCov">          0 :       copy(fish.begin(),fish.end(),sel.begin());</span>
<span class="lineNum">    6927 </span><span class="lineNoCov">          0 :       NewMatrix J_fish=Schur_complement(mat,sel);</span>
<span class="lineNum">    6928 </span><span class="lineNoCov">          0 :       eigen_report(J_fish,FS.str().c_str());</span>
<span class="lineNum">    6929 </span><span class="lineNoCov">          0 :       eigen_report(mat(sel,sel),F.str().c_str());</span>
<span class="lineNum">    6930 </span>            :     }
<span class="lineNum">    6931 </span>            :   }
<span class="lineNum">    6932 </span>            : 
<span class="lineNum">    6933 </span><span class="lineNoCov">          0 :   return;</span>
<a name="6934"><span class="lineNum">    6934 </span>            : }</a>
<span class="lineNum">    6935 </span>            : 
<span class="lineNum">    6936 </span><span class="lineCov">         45 : sequence&lt;double&gt; NewWeb::get_biomass_B() const{</span>
<span class="lineNum">    6937 </span><span class="lineCov">         45 :   sequence&lt;double&gt; b;</span>
<span class="lineNum">    6938 </span><span class="lineCov">       8890 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    6939 </span><span class="lineCov">      17600 :     b[i]=s[i].biomass_abundance_B();</span>
<span class="lineNum">    6940 </span>            :   }
<span class="lineNum">    6941 </span><span class="lineCov">         45 :   return b;</span>
<a name="6942"><span class="lineNum">    6942 </span>            : }</a>
<span class="lineNum">    6943 </span>            : 
<span class="lineNum">    6944 </span><span class="lineCov">         45 : sequence&lt;double&gt; NewWeb::get_bodymass_M() const{</span>
<span class="lineNum">    6945 </span><span class="lineCov">         45 :   sequence&lt;double&gt; m;</span>
<span class="lineNum">    6946 </span><span class="lineCov">       8890 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    6947 </span><span class="lineCov">      17600 :     m[i]=s[i].bodymass();</span>
<span class="lineNum">    6948 </span>            :   }
<span class="lineNum">    6949 </span><span class="lineCov">         45 :   return m;</span>
<a name="6950"><span class="lineNum">    6950 </span>            : }</a>
<span class="lineNum">    6951 </span>            : 
<span class="lineNum">    6952 </span><span class="lineNoCov">          0 : sequence&lt;double&gt; NewWeb::get_log_bodymass_M() const{</span>
<span class="lineNum">    6953 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; m;</span>
<span class="lineNum">    6954 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    6955 </span><span class="lineNoCov">          0 :     m[i]=s[i].log_mean_bodymass_M();</span>
<span class="lineNum">    6956 </span>            :   }
<span class="lineNum">    6957 </span><span class="lineNoCov">          0 :   return m;</span>
<a name="6958"><span class="lineNum">    6958 </span>            : }</a>
<span class="lineNum">    6959 </span>            : 
<span class="lineNum">    6960 </span><span class="lineCov">         45 : sequence&lt;int&gt; NewWeb::get_is_plant(){</span>
<span class="lineNum">    6961 </span><span class="lineCov">         45 :   sequence&lt;int&gt; m;</span>
<span class="lineNum">    6962 </span><span class="lineCov">       8890 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    6963 </span><span class="lineCov">      17600 :     m[i]=is_plant(i);</span>
<span class="lineNum">    6964 </span>            :   }
<span class="lineNum">    6965 </span><span class="lineCov">         45 :   return m;</span>
<span class="lineNum">    6966 </span>            : }
<a name="6967"><span class="lineNum">    6967 </span>            : </a>
<span class="lineNum">    6968 </span>            : static void 
<span class="lineNum">    6969 </span><span class="lineNoCov">          0 : sample_squares_not_0_dimension(average_meter &amp; am,</span>
<span class="lineNum">    6970 </span>            :                                const NewSpecies::trait_t &amp; t){
<span class="lineNum">    6971 </span><span class="lineNoCov">          0 :   for(int i=t.size();i--&gt;1;){</span>
<span class="lineNum">    6972 </span><span class="lineNoCov">          0 :     double val=t(i);</span>
<span class="lineNum">    6973 </span><span class="lineNoCov">          0 :     am.sample(val*val);</span>
<span class="lineNum">    6974 </span>            :   }
<a name="6975"><span class="lineNum">    6975 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    6976 </span>            : 
<span class="lineNum">    6977 </span><span class="lineNoCov">          0 : void NewWeb::fast_stats(){</span>
<span class="lineNum">    6978 </span>            :   // print some stats that are easily computed
<span class="lineNum">    6979 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;n_animals &quot; &lt;&lt; number_of_animals() &lt;&lt; endl;</span>
<span class="lineNum">    6980 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;n_plants &quot; &lt;&lt; number_of_plants() &lt;&lt; endl;</span>
<span class="lineNum">    6981 </span>            : 
<span class="lineNum">    6982 </span><span class="lineNoCov">          0 :   double max_log_bodymass=(s.size()?s(0).log_mean_bodymass_M():-9999);</span>
<span class="lineNum">    6983 </span><span class="lineNoCov">          0 :   average_meter log10_plant_bodymass;</span>
<span class="lineNum">    6984 </span><span class="lineNoCov">          0 :   average_meter log10_animal_bodymass;</span>
<span class="lineNum">    6985 </span><span class="lineNoCov">          0 :   average_meter log10_aggressivity;</span>
<span class="lineNum">    6986 </span><span class="lineNoCov">          0 :   double log10=log(10);</span>
<span class="lineNum">    6987 </span><span class="lineNoCov">          0 :   double log10unitmass=log(unit_mass)/log10;</span>
<span class="lineNum">    6988 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    6989 </span><span class="lineNoCov">          0 :     if(is_plant(i)){</span>
<span class="lineNum">    6990 </span><span class="lineNoCov">          0 :       log10_plant_bodymass.sample(s(i).log_mean_bodymass_M()/log10);</span>
<span class="lineNum">    6991 </span>            :     }else{
<span class="lineNum">    6992 </span><span class="lineNoCov">          0 :       log10_animal_bodymass.sample(s(i).log_mean_bodymass_M()/log10);</span>
<span class="lineNum">    6993 </span><span class="lineNoCov">          0 :       log10_aggressivity.sample(log(s(i).aggressivity_g()*unit_mass/unit_area )/log10);</span>
<span class="lineNum">    6994 </span>            :     }
<span class="lineNum">    6995 </span><span class="lineNoCov">          0 :     if(s(i).log_mean_bodymass_M() &gt; max_log_bodymass){</span>
<span class="lineNum">    6996 </span><span class="lineNoCov">          0 :       max_log_bodymass=s(i).log_mean_bodymass_M();</span>
<span class="lineNum">    6997 </span>            :     }
<span class="lineNum">    6998 </span>            :   }
<span class="lineNum">    6999 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;max_log10_bodymass &quot; &lt;&lt; max_log_bodymass/log10-log10unitmass&lt;&lt; endl;</span>
<span class="lineNum">    7000 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;log10_animal_bodymass &quot; &lt;&lt; log10_animal_bodymass.readout() -log10unitmass</span>
<span class="lineNum">    7001 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; +/- &quot; &lt;&lt; log10_animal_bodymass.std() &lt;&lt; endl;</span>
<span class="lineNum">    7002 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;log10_plant_bodymass &quot; &lt;&lt; log10_plant_bodymass.readout() -log10unitmass</span>
<span class="lineNum">    7003 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; +/- &quot; &lt;&lt; log10_plant_bodymass.std() &lt;&lt; endl;</span>
<span class="lineNum">    7004 </span><span class="lineNoCov">          0 :   weighted_average_meter log10_bodymass;</span>
<span class="lineNum">    7005 </span><span class="lineNoCov">          0 :   log10_bodymass+=log10_plant_bodymass;</span>
<span class="lineNum">    7006 </span><span class="lineNoCov">          0 :   log10_bodymass+=log10_animal_bodymass;</span>
<span class="lineNum">    7007 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;log10_bodymass &quot; &lt;&lt; log10_bodymass.readout() -log10unitmass</span>
<span class="lineNum">    7008 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; +/- &quot; &lt;&lt; log10_bodymass.sample_std() &lt;&lt; endl;</span>
<span class="lineNum">    7009 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;log10_aggressivity &quot; </span>
<span class="lineNum">    7010 </span><span class="lineNoCov">          0 :        &lt;&lt; log10_aggressivity.readout()</span>
<span class="lineNum">    7011 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; +/- &quot; &lt;&lt; log10_aggressivity.error() </span>
<span class="lineNum">    7012 </span><span class="lineNoCov">          0 :        &lt;&lt; &quot; std &quot; &lt;&lt; log10_aggressivity.sample_std() &lt;&lt; endl;</span>
<span class="lineNum">    7013 </span>            : 
<span class="lineNum">    7014 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;yield &quot; &lt;&lt; biomass_yield()*year &lt;&lt; endl;</span>
<span class="lineNum">    7015 </span>            : 
<span class="lineNum">    7016 </span><span class="lineNoCov">          0 :   if(get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;))</span>
<span class="lineNum">    7017 </span>            :     return;
<span class="lineNum">    7018 </span>            : 
<span class="lineNum">    7019 </span><span class="lineNoCov">          0 :   average_meter plant_absVrel,animal_absVrel,absV;</span>
<span class="lineNum">    7020 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;s.size();n++){</span>
<span class="lineNum">    7021 </span><span class="lineNoCov">          0 :     if(is_plant(n)){</span>
<span class="lineNum">    7022 </span>            :       plant_absVrel.
<span class="lineNum">    7023 </span><span class="lineNoCov">          0 :         sample(abs(s[n].relative_vulnerability()));</span>
<span class="lineNum">    7024 </span>            :     }else{
<span class="lineNum">    7025 </span>            :       animal_absVrel.
<span class="lineNum">    7026 </span><span class="lineNoCov">          0 :         sample(abs(s[n].relative_vulnerability()));</span>
<span class="lineNum">    7027 </span>            :     }
<span class="lineNum">    7028 </span><span class="lineNoCov">          0 :     absV.sample(abs(s[n].vulnerability_V()));</span>
<span class="lineNum">    7029 </span>            :   }
<span class="lineNum">    7030 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;absV &quot; &lt;&lt; absV.readout() &lt;&lt; endl;;</span>
<span class="lineNum">    7031 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;plant_absVrel &quot; &lt;&lt; plant_absVrel.readout() &lt;&lt; endl;</span>
<span class="lineNum">    7032 </span><span class="lineNoCov">          0 :   cout &lt;&lt; &quot;animal_absVrel &quot; &lt;&lt; animal_absVrel.readout() &lt;&lt; endl;</span>
<span class="lineNum">    7033 </span>            : 
<span class="lineNum">    7034 </span><span class="lineNoCov">          0 :   simple_vector&lt;bool&gt; selection(niche_space_dimensions_D,true);</span>
<span class="lineNum">    7035 </span><span class="lineNoCov">          0 :   chi_square_meter VV(selection);</span>
<span class="lineNum">    7036 </span><span class="lineNoCov">          0 :   chi_square_meter VVp(selection);</span>
<span class="lineNum">    7037 </span><span class="lineNoCov">          0 :   chi_square_meter VVa(selection);</span>
<span class="lineNum">    7038 </span><span class="lineNoCov">          0 :   chi_square_meter FFp(selection);</span>
<span class="lineNum">    7039 </span><span class="lineNoCov">          0 :   chi_square_meter FFa(selection);</span>
<span class="lineNum">    7040 </span><span class="lineNoCov">          0 :   average_meter V2,Vp2,Va2,F2,G2;</span>
<span class="lineNum">    7041 </span>            : 
<span class="lineNum">    7042 </span><span class="lineNoCov">          0 :   for(int n=0;n&lt;s.size();n++){</span>
<span class="lineNum">    7043 </span><span class="lineNoCov">          0 :     VV.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    7044 </span><span class="lineNoCov">          0 :     sample_squares_not_0_dimension(V2,s[n].vulnerability_V());</span>
<span class="lineNum">    7045 </span><span class="lineNoCov">          0 :     if(is_plant(n)){</span>
<span class="lineNum">    7046 </span><span class="lineNoCov">          0 :       VVp.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    7047 </span><span class="lineNoCov">          0 :       sample_squares_not_0_dimension(Vp2,s[n].vulnerability_V());</span>
<span class="lineNum">    7048 </span><span class="lineNoCov">          0 :       FFp.sample(s[n].niche_G());</span>
<span class="lineNum">    7049 </span><span class="lineNoCov">          0 :       sample_squares_not_0_dimension(G2,s[n].niche_G());</span>
<span class="lineNum">    7050 </span>            :     }else{
<span class="lineNum">    7051 </span><span class="lineNoCov">          0 :       VVa.sample(s[n].vulnerability_V());</span>
<span class="lineNum">    7052 </span><span class="lineNoCov">          0 :       sample_squares_not_0_dimension(Va2,s[n].vulnerability_V());</span>
<span class="lineNum">    7053 </span><span class="lineNoCov">          0 :       FFa.sample(s[n].foraging_F());</span>
<span class="lineNum">    7054 </span><span class="lineNoCov">          0 :       sample_squares_not_0_dimension(F2,s[n].foraging_F());</span>
<span class="lineNum">    7055 </span>            :     }
<span class="lineNum">    7056 </span>            :   }
<span class="lineNum">    7057 </span><span class="lineNoCov">          0 :   REPORT(V2);</span>
<span class="lineNum">    7058 </span><span class="lineNoCov">          0 :   REPORT(Vp2);</span>
<span class="lineNum">    7059 </span><span class="lineNoCov">          0 :   REPORT(Va2);</span>
<span class="lineNum">    7060 </span><span class="lineNoCov">          0 :   REPORT(F2);</span>
<span class="lineNum">    7061 </span><span class="lineNoCov">          0 :   REPORT(G2);</span>
<span class="lineNum">    7062 </span>            : 
<span class="lineNum">    7063 </span><span class="lineNoCov">          0 :   if(get_cfg_parameter(&quot;niche_space_dimensions_D&quot;) &gt;= number_of_plants())</span>
<span class="lineNum">    7064 </span>            :     return;
<span class="lineNum">    7065 </span><span class="lineNoCov">          0 :   if(get_cfg_parameter(&quot;niche_space_dimensions_D&quot;) &gt;= number_of_animals())</span>
<span class="lineNum">    7066 </span>            :     return;
<span class="lineNum">    7067 </span>            :   return;
<span class="lineNum">    7068 </span>            :   
<span class="lineNum">    7069 </span>            :   double log_det,log_det_a,log_det_p;
<span class="lineNum">    7070 </span>            :   FFa.chi_square(&amp;log_det,FFa.mean());
<span class="lineNum">    7071 </span>            :   cout &lt;&lt; &quot;foraging_trait_volume &quot; &lt;&lt; exp(log_det/2) &lt;&lt; endl;
<span class="lineNum">    7072 </span>            :   VV.chi_square(&amp;log_det,VV.mean());
<span class="lineNum">    7073 </span>            :   cout &lt;&lt; &quot;vulnerability_trait_volume &quot; &lt;&lt; exp(log_det/2) &lt;&lt; endl;
<span class="lineNum">    7074 </span>            :   VVa.chi_square(&amp;log_det_a,VVa.mean());
<span class="lineNum">    7075 </span>            :   cout &lt;&lt; &quot;animal vulnerability_trait_volume &quot; &lt;&lt; exp(log_det_a/2) &lt;&lt; endl;
<span class="lineNum">    7076 </span>            :   VVp.chi_square(&amp;log_det_p,VVp.mean());
<span class="lineNum">    7077 </span>            :   cout &lt;&lt; &quot;plant vulnerability_trait_volume &quot; &lt;&lt; exp(log_det_p/2) &lt;&lt; endl;
<span class="lineNum">    7078 </span>            :   cout &lt;&lt; endl;
<span class="lineNum">    7079 </span>            :   cout &lt;&lt; &quot;animal/plant volume ratio &quot; &lt;&lt; exp((log_det_a-log_det_p)/2) &lt;&lt; endl;
<span class="lineNum">    7080 </span>            :   FFp.chi_square(&amp;log_det,FFp.mean());
<span class="lineNum">    7081 </span>            :   cout &lt;&lt; &quot;plant_trait_volume &quot; &lt;&lt; exp(log_det/2) &lt;&lt; endl;
<span class="lineNum">    7082 </span>            : 
<span class="lineNum">    7083 </span>            :   return;
<a name="7084"><span class="lineNum">    7084 </span>            : }</a>
<span class="lineNum">    7085 </span>            : 
<span class="lineNum">    7086 </span><span class="lineNoCov">          0 : void NewWeb::distance_histogram(const char * filename){</span>
<span class="lineNum">    7087 </span><span class="lineNoCov">          0 :   ostringstream p,a;</span>
<span class="lineNum">    7088 </span><span class="lineNoCov">          0 :   p &lt;&lt; &quot;p&quot; &lt;&lt; filename;</span>
<span class="lineNum">    7089 </span><span class="lineNoCov">          0 :   a &lt;&lt; &quot;a&quot; &lt;&lt; filename;</span>
<span class="lineNum">    7090 </span><span class="lineNoCov">          0 :   Histogram_Estimator hp(0.0,0.02);</span>
<span class="lineNum">    7091 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    7092 </span><span class="lineNoCov">          0 :     for(int j=i;j--&gt;s.n_animals;){</span>
<span class="lineNum">    7093 </span><span class="lineNoCov">          0 :       sequence&lt;double&gt; diff=s[i].niche_G()-s[j].niche_G();</span>
<span class="lineNum">    7094 </span><span class="lineNoCov">          0 :       hp.sample(abs(diff));</span>
<span class="lineNum">    7095 </span>            :     }
<span class="lineNum">    7096 </span>            :   }
<span class="lineNum">    7097 </span><span class="lineNoCov">          0 :   Histogram_Estimator ha(0.0,0.2);</span>
<span class="lineNum">    7098 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    7099 </span><span class="lineNoCov">          0 :     for(int j=i;j--&gt;0;){</span>
<span class="lineNum">    7100 </span><span class="lineNoCov">          0 :       sequence&lt;double&gt; diff=s[i].foraging_F()-s[j].foraging_F();</span>
<span class="lineNum">    7101 </span><span class="lineNoCov">          0 :       ha.sample(abs(diff));</span>
<span class="lineNum">    7102 </span>            :     }
<span class="lineNum">    7103 </span>            :   }
<span class="lineNum">    7104 </span><span class="lineNoCov">          0 :   hp.save(p.str().c_str());</span>
<span class="lineNum">    7105 </span><span class="lineNoCov">          0 :   ha.save(a.str().c_str());</span>
<span class="lineNum">    7106 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7107 </span>            : 
<span class="lineNum">    7108 </span>            : class distanced_list_helper{
<span class="lineNum">    7109 </span>            :   ofstream file;
<span class="lineNum">    7110 </span>            :   vector&lt;double&gt; values;
<span class="lineNum">    7111 </span>            :   double normalizer;
<span class="lineNum">    7112 </span>            : public:
<span class="lineNum">    7113 </span>            :   distanced_list_helper(const char * filename,double n):
<a name="7114"><span class="lineNum">    7114 </span><span class="lineNoCov">          0 :     file(filename),normalizer(n){</span></a>
<span class="lineNum">    7115 </span>            :   }
<span class="lineNum">    7116 </span><span class="lineNoCov">          0 :   ~distanced_list_helper(){</span>
<span class="lineNum">    7117 </span><span class="lineNoCov">          0 :     sort(values.begin(),values.end());</span>
<span class="lineNum">    7118 </span><span class="lineNoCov">          0 :     for(int i=0;i&lt;values.size();i++){</span>
<span class="lineNum">    7119 </span><span class="lineNoCov">          0 :       if(!(values[i]+1 == values[i])){//&lt; poor man's test for nan/inf</span>
<span class="lineNum">    7120 </span><span class="lineNoCov">          0 :         file  &lt;&lt; values[i] &lt;&lt; &quot; &quot; &lt;&lt; (i+1)*normalizer &lt;&lt; endl;</span>
<span class="lineNum">    7121 </span>            :       }
<span class="lineNum">    7122 </span>            :     }
<span class="lineNum">    7123 </span><span class="lineNoCov">          0 :   }</span>
<span class="lineNum">    7124 </span>            :   void operator&lt;&lt;(double x){
<span class="lineNum">    7125 </span><span class="lineNoCov">          0 :     values.push_back(x);</span>
<span class="lineNum">    7126 </span>            :   }
<span class="lineNum">    7127 </span>            : };
<span class="lineNum">    7128 </span>            :     
<span class="lineNum">    7129 </span>            :     
<a name="7130"><span class="lineNum">    7130 </span>            :   </a>
<span class="lineNum">    7131 </span>            : 
<span class="lineNum">    7132 </span><span class="lineNoCov">          0 : void NewWeb::distance_lists(const char * filename){</span>
<span class="lineNum">    7133 </span><span class="lineNoCov">          0 :   ostringstream aV,pV,mV,F,G,FV,aVfish,Ffish;</span>
<span class="lineNum">    7134 </span><span class="lineNoCov">          0 :   aV &lt;&lt; &quot;aV&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7135 </span><span class="lineNoCov">          0 :   pV &lt;&lt; &quot;pV&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7136 </span><span class="lineNoCov">          0 :   mV &lt;&lt; &quot;mV&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7137 </span><span class="lineNoCov">          0 :   F &lt;&lt; &quot;F&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7138 </span><span class="lineNoCov">          0 :   G &lt;&lt; &quot;G&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7139 </span><span class="lineNoCov">          0 :   FV &lt;&lt; &quot;FV&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7140 </span><span class="lineNoCov">          0 :   aVfish &lt;&lt; &quot;aVfish&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7141 </span><span class="lineNoCov">          0 :   Ffish &lt;&lt; &quot;Ffish&quot; &lt;&lt; filename; </span>
<span class="lineNum">    7142 </span>            : 
<span class="lineNum">    7143 </span><span class="lineNoCov">          0 :   distanced_list_helper aVs(aV.str().c_str(),2.0/(number_of_animals()));</span>
<span class="lineNum">    7144 </span><span class="lineNoCov">          0 :   distanced_list_helper pVs(pV.str().c_str(),2.0/(number_of_plants()));</span>
<span class="lineNum">    7145 </span><span class="lineNoCov">          0 :   distanced_list_helper mVs(mV.str().c_str(),1);</span>
<span class="lineNum">    7146 </span><span class="lineNoCov">          0 :   distanced_list_helper Fs(F.str().c_str(),2.0/(number_of_animals()));</span>
<span class="lineNum">    7147 </span><span class="lineNoCov">          0 :   distanced_list_helper Gs(G.str().c_str(),2.0/(number_of_plants()));</span>
<span class="lineNum">    7148 </span><span class="lineNoCov">          0 :   distanced_list_helper FVs(FV.str().c_str(),1.0/number_of_animals());</span>
<span class="lineNum">    7149 </span><span class="lineNoCov">          0 :   distanced_list_helper aVfishs(aVfish.str().c_str(),2.0/(number_of_fish()));</span>
<span class="lineNum">    7150 </span><span class="lineNoCov">          0 :   distanced_list_helper Ffishs(Ffish.str().c_str(),2.0/(number_of_fish()));</span>
<span class="lineNum">    7151 </span>            : 
<span class="lineNum">    7152 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; diff(niche_space_dimensions_D);</span>
<span class="lineNum">    7153 </span>            :   
<span class="lineNum">    7154 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    7155 </span><span class="lineNoCov">          0 :     for(int j=i;j--&gt;s.n_animals;){</span>
<span class="lineNum">    7156 </span><span class="lineNoCov">          0 :       diff=s[i].niche_G()-s[j].niche_G();</span>
<span class="lineNum">    7157 </span><span class="lineNoCov">          0 :       Gs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7158 </span><span class="lineNoCov">          0 :       diff=s[i].vulnerability_V()-s[j].vulnerability_V();</span>
<span class="lineNum">    7159 </span><span class="lineNoCov">          0 :       pVs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7160 </span>            :     }
<span class="lineNum">    7161 </span><span class="lineNoCov">          0 :     for(int j=s.n_animals;j--&gt;0;){</span>
<span class="lineNum">    7162 </span><span class="lineNoCov">          0 :       diff=s[i].vulnerability_V()-s[j].vulnerability_V();</span>
<span class="lineNum">    7163 </span><span class="lineNoCov">          0 :       mVs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7164 </span>            :     }
<span class="lineNum">    7165 </span>            :   }
<span class="lineNum">    7166 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    7167 </span><span class="lineNoCov">          0 :     for(int j=i;j--&gt;0;){</span>
<span class="lineNum">    7168 </span><span class="lineNoCov">          0 :       diff=s[i].foraging_F()-s[j].foraging_F();</span>
<span class="lineNum">    7169 </span><span class="lineNoCov">          0 :       Fs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7170 </span><span class="lineNoCov">          0 :       diff=s[i].vulnerability_V()-s[j].vulnerability_V();</span>
<span class="lineNum">    7171 </span><span class="lineNoCov">          0 :       aVs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7172 </span>            :     }
<span class="lineNum">    7173 </span>            :     int FV_lower_bound=
<span class="lineNum">    7174 </span><span class="lineNoCov">          0 :       (get_cfg_parameter(&quot;no_carnivores&quot;) ?</span>
<span class="lineNum">    7175 </span><span class="lineNoCov">          0 :        s.n_animals : 0);</span>
<span class="lineNum">    7176 </span><span class="lineNoCov">          0 :     for(int j=s.size();j--&gt;FV_lower_bound;){</span>
<span class="lineNum">    7177 </span><span class="lineNoCov">          0 :       diff=s[i].foraging_F()-s[j].vulnerability_V();</span>
<span class="lineNum">    7178 </span><span class="lineNoCov">          0 :       FVs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7179 </span>            :     }
<span class="lineNum">    7180 </span>            :   }
<span class="lineNum">    7181 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    7182 </span><span class="lineNoCov">          0 :     if((s[i].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[i].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    7183 </span><span class="lineNoCov">          0 :       for(int j=i;j--&gt;0;){</span>
<span class="lineNum">    7184 </span><span class="lineNoCov">          0 :         if((s[j].bodymass()&gt;fishMlowerthreshold)&amp;&amp;(s[j].bodymass()&lt;fishMupperthreshold)){</span>
<span class="lineNum">    7185 </span><span class="lineNoCov">          0 :           diff=s[i].foraging_F()-s[j].foraging_F();</span>
<span class="lineNum">    7186 </span><span class="lineNoCov">          0 :           Ffishs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7187 </span><span class="lineNoCov">          0 :           diff=s[i].vulnerability_V()-s[j].vulnerability_V();</span>
<span class="lineNum">    7188 </span><span class="lineNoCov">          0 :           aVfishs &lt;&lt; abs(diff);</span>
<span class="lineNum">    7189 </span>            :         }
<span class="lineNum">    7190 </span>            :       }
<span class="lineNum">    7191 </span>            :     }
<span class="lineNum">    7192 </span>            :   }
<span class="lineNum">    7193 </span><span class="lineNoCov">          0 : }</span>
<a name="7194"><span class="lineNum">    7194 </span>            : </a>
<span class="lineNum">    7195 </span>            :      
<span class="lineNum">    7196 </span><span class="lineNoCov">          0 : void NewWeb::compute_biomass_action_products(){</span>
<span class="lineNum">    7197 </span><span class="lineNoCov">          0 :   if(!biomass_action_products.size()){</span>
<span class="lineNum">    7198 </span><span class="lineNoCov">          0 :     biomass_action_products.resize(s.size());</span>
<span class="lineNum">    7199 </span>            :   }
<span class="lineNum">    7200 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    7201 </span>            :     for(int j=s.size();j--&gt;0;){
<span class="lineNum">    7202 </span>            :       // NOT CURRENTLY WORKING:
<span class="lineNum">    7203 </span>            : //       biomass_action_products[i][j]=
<span class="lineNum">    7204 </span>            : //      biomass_B(i)*pow(biomass_B(j),s[i].switching_exponent_b());
<span class="lineNum">    7205 </span>            :     }
<span class="lineNum">    7206 </span>            :   }
<a name="7207"><span class="lineNum">    7207 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7208 </span>            : 
<span class="lineNum">    7209 </span><span class="lineNoCov">          0 : multinormal_distribution NewWeb::log_availability_structure(){</span>
<span class="lineNum">    7210 </span>            :   // Compute correlation structure of terms contributing to the
<span class="lineNum">    7211 </span>            :   // logarithm of the availability c_ik B_i.  Include a &quot;temporal
<span class="lineNum">    7212 </span>            :   // niche overlap&quot; factor correcting for temporal correlations
<span class="lineNum">    7213 </span>            :   // between B_i^b_k and B_k as well as the interchange of temporal
<span class="lineNum">    7214 </span>            :   // averaging and potentiation for B_i.
<span class="lineNum">    7215 </span>            : 
<span class="lineNum">    7216 </span><span class="lineNoCov">          0 :   FATAL_ERROR(&quot;log_availability_structure is not adjusted to new switching, yet&quot;);</span>
<span class="lineNum">    7217 </span>            :   
<span class="lineNum">    7218 </span><span class="lineNoCov">          0 :   if(!biomass_action_products.size()){</span>
<span class="lineNum">    7219 </span>            :     compute_biomass_action_products();
<span class="lineNum">    7220 </span>            :   }
<span class="lineNum">    7221 </span>            :   
<span class="lineNum">    7222 </span><span class="lineNoCov">          0 :   simple_vector&lt;bool&gt; selection(log_av_n_components,true);</span>
<span class="lineNum">    7223 </span><span class="lineNoCov">          0 :   sequence&lt;double&gt; component(log_av_n_components);</span>
<span class="lineNum">    7224 </span>            : 
<span class="lineNum">    7225 </span><span class="lineNoCov">          0 :   chi_square_meter term_structure(selection);</span>
<span class="lineNum">    7226 </span>            :   
<span class="lineNum">    7227 </span><span class="lineNoCov">          0 :   for(int i=s.n_animals;i--&gt;0;){</span>
<span class="lineNum">    7228 </span><span class="lineNoCov">          0 :     for(int j=s.size();j--&gt;0;){</span>
<span class="lineNum">    7229 </span><span class="lineNoCov">          0 :       if(s(i).bodymass()&gt;s(j).bodymass()){</span>
<span class="lineNum">    7230 </span><span class="lineNoCov">          0 :         component(log_av_niche)=</span>
<span class="lineNum">    7231 </span><span class="lineNoCov">          0 :           s(i).log_niche_matching(s(j));</span>
<span class="lineNum">    7232 </span><span class="lineNoCov">          0 :         cerr &lt;&lt; component(log_av_niche) &lt;&lt; endl;</span>
<span class="lineNum">    7233 </span><span class="lineNoCov">          0 :         component(log_av_small_prey)=</span>
<span class="lineNum">    7234 </span><span class="lineNoCov">          0 :           s(i).log_small_prey_matching(s(j));</span>
<span class="lineNum">    7235 </span><span class="lineNoCov">          0 :         component(log_av_large_prey)=</span>
<span class="lineNum">    7236 </span><span class="lineNoCov">          0 :           s(i).log_large_prey_matching(s(j));</span>
<span class="lineNum">    7237 </span><span class="lineNoCov">          0 :         component(log_av_other)=</span>
<span class="lineNum">    7238 </span><span class="lineNoCov">          0 :           s(i).log_other_matching(s(j));</span>
<span class="lineNum">    7239 </span><span class="lineNoCov">          0 :         component(log_av_biomass)=log(biomass_B(j));</span>
<span class="lineNum">    7240 </span>            :         // note that this has any effect only after computing time_average:
<span class="lineNum">    7241 </span>            :         // NOT CURRENTLY WORKING:
<span class="lineNum">    7242 </span><span class="lineNoCov">          0 :         component(log_av_temporal)=0;</span>
<span class="lineNum">    7243 </span>            : //        log(biomass_action_products(j,i)/
<span class="lineNum">    7244 </span>            : //            (biomass_B(i)*pow(biomass_B(j),s(i).switching_exponent_b())) )/
<span class="lineNum">    7245 </span>            : //        s(i).switching_exponent_b();
<span class="lineNum">    7246 </span><span class="lineNoCov">          0 :         term_structure.sample(component);</span>
<span class="lineNum">    7247 </span>            :       }
<span class="lineNum">    7248 </span>            :     }
<span class="lineNum">    7249 </span>            :   }
<span class="lineNum">    7250 </span><span class="lineNoCov">          0 :   return term_structure.estimate();</span>
<a name="7251"><span class="lineNum">    7251 </span>            : }</a>
<span class="lineNum">    7252 </span>            :   
<span class="lineNum">    7253 </span><span class="lineNoCov">          0 : void NewWeb::model_environmenatal_change(double strength){</span>
<span class="lineNum">    7254 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    7255 </span><span class="lineNoCov">          0 :     s[i].perturb_physiological_parameters(exp(gaussian(0,strength)));</span>
<span class="lineNum">    7256 </span>            :   }
<a name="7257"><span class="lineNum">    7257 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7258 </span>            :   
<span class="lineNum">    7259 </span><span class="lineNoCov">          0 : double NewWeb::Living_Planet_Index(NewWeb &amp; baseline,</span>
<span class="lineNum">    7260 </span>            :                                    bool with_plants, bool with_animals){
<span class="lineNum">    7261 </span><span class="lineNoCov">          0 :   const double regularizer=0.01;// assume 1% of population unseen</span>
<span class="lineNum">    7262 </span><span class="lineNoCov">          0 :   double delta_log_B_sum=0;</span>
<span class="lineNum">    7263 </span><span class="lineNoCov">          0 :   int count=0;</span>
<span class="lineNum">    7264 </span><span class="lineNoCov">          0 :   for(int i=baseline.species_at.size();i--&gt;0;){</span>
<span class="lineNum">    7265 </span><span class="lineNoCov">          0 :     if((baseline.species_at[i]!=column_unused)&amp;&amp;</span>
<span class="lineNum">    7266 </span><span class="lineNoCov">          0 :        (baseline.is_plant(baseline.species_at[i])?with_plants:with_animals)){</span>
<span class="lineNum">    7267 </span><span class="lineNoCov">          0 :       double B2=(species_at[i]==column_unused?</span>
<span class="lineNum">    7268 </span>            :                  0:
<span class="lineNum">    7269 </span><span class="lineNoCov">          0 :                  biomass_B(species_at[i]));</span>
<span class="lineNum">    7270 </span><span class="lineNoCov">          0 :       double B1=baseline.biomass_B(baseline.species_at[i]);</span>
<span class="lineNum">    7271 </span><span class="lineNoCov">          0 :       double mean=(B1+B2)/2;</span>
<span class="lineNum">    7272 </span><span class="lineNoCov">          0 :       delta_log_B_sum+=log(B2+regularizer*mean)-log(B1+regularizer*mean);</span>
<span class="lineNum">    7273 </span><span class="lineNoCov">          0 :       count++;</span>
<span class="lineNum">    7274 </span>            :     }
<span class="lineNum">    7275 </span>            :   }
<span class="lineNum">    7276 </span><span class="lineNoCov">          0 :   return exp(delta_log_B_sum/count);</span>
<a name="7277"><span class="lineNum">    7277 </span>            : }</a>
<span class="lineNum">    7278 </span>            : 
<span class="lineNum">    7279 </span><span class="lineNoCov">          0 : double NewWeb::Biodiversity_Intactness_Index(NewWeb &amp; baseline,</span>
<span class="lineNum">    7280 </span>            :                                              bool with_plants, 
<span class="lineNum">    7281 </span>            :                                              bool with_animals){
<span class="lineNum">    7282 </span><span class="lineNoCov">          0 :   double I_sum=0;</span>
<span class="lineNum">    7283 </span><span class="lineNoCov">          0 :   int count=0;</span>
<span class="lineNum">    7284 </span><span class="lineNoCov">          0 :   for(int i=baseline.species_at.size();i--&gt;0;){</span>
<span class="lineNum">    7285 </span><span class="lineNoCov">          0 :     if((baseline.species_at[i]!=column_unused)&amp;&amp;</span>
<span class="lineNum">    7286 </span><span class="lineNoCov">          0 :        (baseline.is_plant(baseline.species_at[i])?with_plants:with_animals)){</span>
<span class="lineNum">    7287 </span><span class="lineNoCov">          0 :       if(species_at[i]==column_unused){</span>
<span class="lineNum">    7288 </span><span class="lineNoCov">          0 :         count++;</span>
<span class="lineNum">    7289 </span>            :       }else{
<span class="lineNum">    7290 </span><span class="lineNoCov">          0 :         double B2=biomass_B(species_at[i]);</span>
<span class="lineNum">    7291 </span><span class="lineNoCov">          0 :         double B1=baseline.biomass_B(baseline.species_at[i]);</span>
<span class="lineNum">    7292 </span><span class="lineNoCov">          0 :         I_sum+=B2/B1;</span>
<span class="lineNum">    7293 </span>            :         //cout &lt;&lt; B2/B1 &lt;&lt; endl;
<span class="lineNum">    7294 </span><span class="lineNoCov">          0 :         count++;</span>
<span class="lineNum">    7295 </span>            :       }
<span class="lineNum">    7296 </span>            :     }
<span class="lineNum">    7297 </span>            :   }
<span class="lineNum">    7298 </span><span class="lineNoCov">          0 :   return I_sum/count;</span>
<a name="7299"><span class="lineNum">    7299 </span>            : }</a>
<span class="lineNum">    7300 </span>            : 
<span class="lineNum">    7301 </span><span class="lineNoCov">          0 : double NewWeb::GPP(){</span>
<span class="lineNum">    7302 </span><span class="lineNoCov">          0 :   double GPP=0;</span>
<span class="lineNum">    7303 </span><span class="lineNoCov">          0 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    7304 </span><span class="lineNoCov">          0 :     GPP+=s[i].the_GP;</span>
<span class="lineNum">    7305 </span>            :   }
<span class="lineNum">    7306 </span><span class="lineNoCov">          0 :   return GPP;</span>
<a name="7307"><span class="lineNum">    7307 </span>            : }</a>
<span class="lineNum">    7308 </span>            : 
<span class="lineNum">    7309 </span><span class="lineNoCov">          0 : void NewWeb::report_evolutionary_pressures(const int iterations){</span>
<span class="lineNum">    7310 </span>            : 
<span class="lineNum">    7311 </span><span class="lineNoCov">          0 :   if(steady_state.begin()==steady_state.end()){</span>
<span class="lineNum">    7312 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;Must compute steady_state first: do relax()&quot;);</span>
<span class="lineNum">    7313 </span>            :   }
<span class="lineNum">    7314 </span>            :   
<span class="lineNum">    7315 </span>            :   typedef NewSpecies::taxon_t taxon_t;
<span class="lineNum">    7316 </span>            :   typedef NewSpecies::trait_selection_t trait_selection_t;
<span class="lineNum">    7317 </span><span class="lineNoCov">          0 :   const int n_taxa=NewSpecies::n_taxa;</span>
<span class="lineNum">    7318 </span><span class="lineNoCov">          0 :   const int S=number_of_species();</span>
<span class="lineNum">    7319 </span><span class="lineNoCov">          0 :   vector&lt; int &gt; total_mutations(n_taxa,0),total_invasions(n_taxa,0);</span>
<span class="lineNum">    7320 </span>            :   bool use_fast_fitness=
<span class="lineNum">    7321 </span><span class="lineNoCov">          0 :     (++steady_state.begin()==steady_state.end());</span>
<span class="lineNum">    7322 </span><span class="lineNoCov">          0 :   if(use_fast_fitness){</span>
<span class="lineNum">    7323 </span><span class="lineNoCov">          0 :     WARNING(&quot;Using fast_linear_fitness()&quot;);</span>
<span class="lineNum">    7324 </span>            :   }
<span class="lineNum">    7325 </span>            : 
<span class="lineNum">    7326 </span>            :   // Get an array of size n_taxa X n_traits:
<span class="lineNum">    7327 </span><span class="lineNoCov">          0 :   vector&lt; vector&lt; weighted_average_meter &gt; &gt; pressure(n_taxa);</span>
<span class="lineNum">    7328 </span><span class="lineNoCov">          0 :   vector&lt; average_meter &gt; baseline(n_taxa);</span>
<span class="lineNum">    7329 </span><span class="lineNoCov">          0 :   for(int x=0;x&lt;n_taxa;x++){</span>
<span class="lineNum">    7330 </span><span class="lineNoCov">          0 :     pressure[x].resize(NewSpecies::number_of_kinds_of_traits(taxon_t(x)));</span>
<span class="lineNum">    7331 </span>            :   }
<span class="lineNum">    7332 </span>            : 
<span class="lineNum">    7333 </span>            :   // Measure pressures
<span class="lineNum">    7334 </span>            :   int nan_found=0;//how many #nan we found
<span class="lineNum">    7335 </span><span class="lineNoCov">          0 :   for(int ii=iterations;ii--&gt;0;){</span>
<span class="lineNum">    7336 </span><span class="lineNoCov">          0 :     cout &lt;&lt; ii &lt;&lt; &quot; \r&quot;; cout.flush();</span>
<span class="lineNum">    7337 </span>            : 
<span class="lineNum">    7338 </span><span class="lineNoCov">          0 :     int i=random_integer(S);</span>
<span class="lineNum">    7339 </span>            :     double f_baseline;
<span class="lineNum">    7340 </span><span class="lineNoCov">          0 :     if(use_fast_fitness){</span>
<span class="lineNum">    7341 </span><span class="lineNoCov">          0 :       f_baseline=fast_linear_fitness(&amp;s[i]);</span>
<span class="lineNum">    7342 </span>            :     }else{
<span class="lineNum">    7343 </span><span class="lineNoCov">          0 :       f_baseline=invasion_fitness(&amp;s[i]);</span>
<span class="lineNum">    7344 </span>            :     }
<span class="lineNum">    7345 </span><span class="lineNoCov">          0 :     if(f_baseline+1==f_baseline){</span>
<span class="lineNum">    7346 </span><span class="lineNoCov">          0 :       nan_found++;</span>
<span class="lineNum">    7347 </span>            :     }else{
<span class="lineNum">    7348 </span><span class="lineNoCov">          0 :       double fixed=f_baseline/s[i].turnover_rate_r();</span>
<span class="lineNum">    7349 </span><span class="lineNoCov">          0 :       baseline[s[i].taxon()].sample(fixed*fixed);</span>
<span class="lineNum">    7350 </span>            :     }
<span class="lineNum">    7351 </span>            : 
<span class="lineNum">    7352 </span>            :     int n_kinds=
<span class="lineNum">    7353 </span><span class="lineNoCov">          0 :       NewSpecies::number_of_kinds_of_traits(s(i).taxon());</span>
<span class="lineNum">    7354 </span>            : 
<span class="lineNum">    7355 </span><span class="lineNoCov">          0 :     vector&lt; NewSpecies::trait_t &gt; mutating(n_kinds);</span>
<span class="lineNum">    7356 </span><span class="lineNoCov">          0 :     vector&lt; average_meter &gt; mutating_av0(n_kinds);</span>
<span class="lineNum">    7357 </span><span class="lineNoCov">          0 :     vector&lt; NewSpecies::trait_t &gt; invading(n_kinds);</span>
<span class="lineNum">    7358 </span><span class="lineNoCov">          0 :     int mutations=0,invasions=0;</span>
<span class="lineNum">    7359 </span>            : 
<span class="lineNum">    7360 </span>            :     // Sample traits after mutation/invasion for this species:
<span class="lineNum">    7361 </span><span class="lineNoCov">          0 :     int n=iterations;// invasions to be found.</span>
<span class="lineNum">    7362 </span><span class="lineNoCov">          0 :     while(n&gt;0){</span>
<span class="lineNum">    7363 </span><span class="lineNoCov">          0 :       NewSpecies test_species=s[i];</span>
<span class="lineNum">    7364 </span>            :       double f;
<span class="lineNum">    7365 </span><span class="lineNoCov">          0 :       test_species.mutate_selected_traits(trait_selection_t(-1));</span>
<span class="lineNum">    7366 </span><span class="lineNoCov">          0 :       if(use_fast_fitness){</span>
<span class="lineNum">    7367 </span><span class="lineNoCov">          0 :         f=fast_linear_fitness(&amp;test_species);</span>
<span class="lineNum">    7368 </span>            :       }else{
<span class="lineNum">    7369 </span><span class="lineNoCov">          0 :         f=invasion_fitness(&amp;test_species);</span>
<span class="lineNum">    7370 </span>            :       }
<span class="lineNum">    7371 </span><span class="lineNoCov">          0 :       f-=f_baseline;</span>
<span class="lineNum">    7372 </span><span class="lineNoCov">          0 :       if(f+1==f){</span>
<span class="lineNum">    7373 </span><span class="lineNoCov">          0 :         nan_found++;</span>
<span class="lineNum">    7374 </span>            :       }else{
<span class="lineNum">    7375 </span><span class="lineNoCov">          0 :         mutations++;</span>
<span class="lineNum">    7376 </span><span class="lineNoCov">          0 :         if(f&gt;0){</span>
<span class="lineNum">    7377 </span><span class="lineNoCov">          0 :           invasions++;</span>
<span class="lineNum">    7378 </span><span class="lineNoCov">          0 :           n--;</span>
<span class="lineNum">    7379 </span>            :         }
<span class="lineNum">    7380 </span><span class="lineNoCov">          0 :         for(int trait=n_kinds;trait--&gt;0;){</span>
<span class="lineNum">    7381 </span><span class="lineNoCov">          0 :           NewSpecies::trait_t t=test_species.get_trait_values(trait);</span>
<span class="lineNum">    7382 </span><span class="lineNoCov">          0 :           mutating[trait]+=t;</span>
<span class="lineNum">    7383 </span><span class="lineNoCov">          0 :           mutating_av0[trait].sample(t[0]);</span>
<span class="lineNum">    7384 </span><span class="lineNoCov">          0 :           if(f&gt;0){</span>
<span class="lineNum">    7385 </span><span class="lineNoCov">          0 :             invading[trait]+=t;</span>
<span class="lineNum">    7386 </span>            :           }
<span class="lineNum">    7387 </span>            :         }
<span class="lineNum">    7388 </span>            :       }
<span class="lineNum">    7389 </span>            :     }
<span class="lineNum">    7390 </span>            : 
<span class="lineNum">    7391 </span><span class="lineNoCov">          0 :     total_mutations[s(i).taxon()]+=mutations;</span>
<span class="lineNum">    7392 </span><span class="lineNoCov">          0 :     total_invasions[s(i).taxon()]+=invasions;</span>
<span class="lineNum">    7393 </span>            : 
<span class="lineNum">    7394 </span>            :     // Compute squared differences between sucessful and mutated trait:
<span class="lineNum">    7395 </span><span class="lineNoCov">          0 :     if(invasions&gt;3){</span>
<span class="lineNum">    7396 </span><span class="lineNoCov">          0 :       for(int trait=n_kinds;trait--&gt;0;){</span>
<span class="lineNum">    7397 </span><span class="lineNoCov">          0 :         mutating[trait]/=mutations;</span>
<span class="lineNum">    7398 </span><span class="lineNoCov">          0 :         invading[trait]/=invasions;</span>
<span class="lineNum">    7399 </span>            :         double estimated_errors_squared=
<span class="lineNum">    7400 </span><span class="lineNoCov">          0 :           mutating_av0[trait].var()/s[i].trait_dimensions(trait)</span>
<span class="lineNum">    7401 </span>            :           // The following line takes correlations between the means
<span class="lineNum">    7402 </span>            :           // &quot;mutating&quot; and &quot;invading&quot; into account.  It assumes
<span class="lineNum">    7403 </span>            :           // invasion independent of the trait value(!) and takes a
<span class="lineNum">    7404 </span>            :           // few lines to verify. 
<span class="lineNum">    7405 </span><span class="lineNoCov">          0 :           *(mutations-invasions)/(double(mutations)*invasions);</span>
<span class="lineNum">    7406 </span>            :         double estimated_relative_distance_square_of_means_per_dimension=
<span class="lineNum">    7407 </span><span class="lineNoCov">          0 :           (mutating[trait].dist_square(invading[trait])</span>
<span class="lineNum">    7408 </span><span class="lineNoCov">          0 :            /s[i].trait_dimensions(trait)</span>
<span class="lineNum">    7409 </span><span class="lineNoCov">          0 :            - estimated_errors_squared</span>
<span class="lineNum">    7410 </span><span class="lineNoCov">          0 :            ) / mutating_av0[trait].var();</span>
<span class="lineNum">    7411 </span><span class="lineNoCov">          0 :         pressure[s[i].taxon()][trait].</span>
<span class="lineNum">    7412 </span><span class="lineNoCov">          0 :           sample(estimated_relative_distance_square_of_means_per_dimension,</span>
<span class="lineNum">    7413 </span><span class="lineNoCov">          0 :                  invasions/double(mutations));</span>
<span class="lineNum">    7414 </span>            :       }
<span class="lineNum">    7415 </span>            :     }
<span class="lineNum">    7416 </span>            :   }    
<span class="lineNum">    7417 </span>            :   
<span class="lineNum">    7418 </span>            :   // Report pressures:
<span class="lineNum">    7419 </span><span class="lineNoCov">          0 :   for(int x=0;x&lt;n_taxa;x++){</span>
<span class="lineNum">    7420 </span><span class="lineNoCov">          0 :     NewSpecies dummy(x);</span>
<span class="lineNum">    7421 </span>            :     
<span class="lineNum">    7422 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;Taxon: &quot; </span>
<span class="lineNum">    7423 </span><span class="lineNoCov">          0 :          &lt;&lt; dummy.taxon_name()</span>
<span class="lineNum">    7424 </span><span class="lineNoCov">          0 :          &lt;&lt; endl;</span>
<span class="lineNum">    7425 </span>            :     
<span class="lineNum">    7426 </span><span class="lineNoCov">          0 :     double invasion_success_rate=double(total_invasions[x])/total_mutations[x];</span>
<span class="lineNum">    7427 </span><span class="lineNoCov">          0 :     REPORT(invasion_success_rate);</span>
<span class="lineNum">    7428 </span>            : 
<span class="lineNum">    7429 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;baseline fitness^2: &quot; &lt;&lt; baseline[x] &lt;&lt; endl;</span>
<span class="lineNum">    7430 </span>            :     
<span class="lineNum">    7431 </span>            :     double sum=0;
<span class="lineNum">    7432 </span><span class="lineNoCov">          0 :     for(int trait=0;trait&lt;NewSpecies::number_of_kinds_of_traits(taxon_t(x));</span>
<span class="lineNum">    7433 </span>            :         ++trait){
<span class="lineNum">    7434 </span><span class="lineNoCov">          0 :       cout &lt;&lt; dummy.trait_name(trait) &lt;&lt; &quot;: &quot;</span>
<span class="lineNum">    7435 </span><span class="lineNoCov">          0 :            &lt;&lt; pressure[x][trait].readout() &lt;&lt; &quot; (SD &quot; </span>
<span class="lineNum">    7436 </span><span class="lineNoCov">          0 :            &lt;&lt; pressure[x][trait].sample_std() &lt;&lt; &quot;)&quot; </span>
<span class="lineNum">    7437 </span><span class="lineNoCov">          0 :            &lt;&lt; &quot; x &quot; &lt;&lt; dummy.trait_dimensions(trait) </span>
<span class="lineNum">    7438 </span><span class="lineNoCov">          0 :            &lt;&lt; endl;</span>
<span class="lineNum">    7439 </span><span class="lineNoCov">          0 :       sum+=pressure[x][trait].readout()*dummy.trait_dimensions(trait);</span>
<span class="lineNum">    7440 </span>            :     }
<span class="lineNum">    7441 </span><span class="lineNoCov">          0 :     REPORT(sum);</span>
<span class="lineNum">    7442 </span>            :   }
<span class="lineNum">    7443 </span><span class="lineNoCov">          0 :   if(nan_found){</span>
<span class="lineNum">    7444 </span><span class="lineNoCov">          0 :     WARNING(nan_found &lt;&lt; &quot; NAN found&quot;);</span>
<span class="lineNum">    7445 </span>            :   }
<a name="7446"><span class="lineNum">    7446 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7447 </span>            :   
<span class="lineNum">    7448 </span><span class="lineNoCov">          0 : void NewWeb::invasion_fitness_curve(const char * details){</span>
<span class="lineNum">    7449 </span><span class="lineNoCov">          0 :   if(steady_state.begin()==steady_state.end()){</span>
<span class="lineNum">    7450 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;Must compute steady_state first: do relax()&quot;);</span>
<span class="lineNum">    7451 </span>            :   }
<span class="lineNum">    7452 </span>            :   
<span class="lineNum">    7453 </span>            :   //int focal_species=s.n_animals+random_integer(number_of_plants());
<span class="lineNum">    7454 </span><span class="lineNoCov">          0 :   int focal_species=random_integer(s.n_animals);</span>
<span class="lineNum">    7455 </span>            :   NewSpecies::trait_sweep_t sweep=
<span class="lineNum">    7456 </span><span class="lineNoCov">          0 :     s[focal_species].trait_sweep(details);</span>
<span class="lineNum">    7457 </span>            : 
<span class="lineNum">    7458 </span><span class="lineNoCov">          0 :   ofstream os(&quot;landscape.dat&quot;);</span>
<span class="lineNum">    7459 </span><span class="lineNoCov">          0 :   for(NewSpecies::trait_sweep_t::iterator i=sweep.begin();</span>
<span class="lineNum">    7460 </span><span class="lineNoCov">          0 :       i!=sweep.end();</span>
<span class="lineNum">    7461 </span>            :       ++i){
<span class="lineNum">    7462 </span><span class="lineNoCov">          0 :     os &lt;&lt; i-&gt;trait_values() &lt;&lt; &quot; &quot; </span>
<span class="lineNum">    7463 </span><span class="lineNoCov">          0 :        &lt;&lt; invasion_fitness(i-&gt;species())/i-&gt;species()-&gt;turnover_rate_r()</span>
<span class="lineNum">    7464 </span><span class="lineNoCov">          0 :        &lt;&lt; endl;</span>
<a name="7465"><span class="lineNum">    7465 </span>            :   }</a>
<span class="lineNum">    7466 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7467 </span><span class="lineNoCov">          0 : void NewWeb::invasion_fitness_relief(const char * details){</span>
<span class="lineNum">    7468 </span><span class="lineNoCov">          0 :   if(steady_state.begin()==steady_state.end()){</span>
<span class="lineNum">    7469 </span><span class="lineNoCov">          0 :     FATAL_ERROR(&quot;Must compute steady_state first: do relax()&quot;);</span>
<span class="lineNum">    7470 </span>            :   }
<span class="lineNum">    7471 </span>            :   
<span class="lineNum">    7472 </span>            :   //int focal_species=s.n_animals+random_integer(number_of_plants());
<span class="lineNum">    7473 </span><span class="lineNoCov">          0 :   int focal_species=random_integer(s.n_animals);</span>
<span class="lineNum">    7474 </span>            :   NewSpecies::trait_sweep_t sweep=
<span class="lineNum">    7475 </span><span class="lineNoCov">          0 :     s[focal_species].trait_sweep(&quot;0&quot;);</span>
<span class="lineNum">    7476 </span>            : 
<span class="lineNum">    7477 </span><span class="lineNoCov">          0 :   ofstream os(&quot;relief.dat&quot;);</span>
<span class="lineNum">    7478 </span><span class="lineNoCov">          0 :   for(NewSpecies::trait_sweep_t::iterator i=sweep.begin();</span>
<span class="lineNum">    7479 </span><span class="lineNoCov">          0 :       i!=sweep.end();</span>
<span class="lineNum">    7480 </span>            :       ++i){
<span class="lineNum">    7481 </span><span class="lineNoCov">          0 :     cout &lt;&lt; i-&gt;trait_values() &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    7482 </span><span class="lineNoCov">          0 :     NewSpecies focal2=*(i-&gt;species());</span>
<span class="lineNum">    7483 </span>            :     NewSpecies::trait_sweep_t sweep2=
<span class="lineNum">    7484 </span><span class="lineNoCov">          0 :       focal2.trait_sweep(&quot;1&quot;);</span>
<span class="lineNum">    7485 </span><span class="lineNoCov">          0 :     for(NewSpecies::trait_sweep_t::iterator j=sweep2.begin();</span>
<span class="lineNum">    7486 </span><span class="lineNoCov">          0 :         j!=sweep2.end();</span>
<span class="lineNum">    7487 </span>            :         ++j){
<span class="lineNum">    7488 </span><span class="lineNoCov">          0 :       os &lt;&lt; invasion_fitness(j-&gt;species())/j-&gt;species()-&gt;turnover_rate_r()</span>
<span class="lineNum">    7489 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    7490 </span>            :     }
<span class="lineNum">    7491 </span><span class="lineNoCov">          0 :     os &lt;&lt; endl;</span>
<span class="lineNum">    7492 </span>            :   }
<span class="lineNum">    7493 </span><span class="lineNoCov">          0 :   cout &lt;&lt; endl;</span>
<a name="7494"><span class="lineNum">    7494 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7495 </span>            : 
<span class="lineNum">    7496 </span><span class="lineNoCov">          0 : void NewWeb::invasion_fitness_samples(int n){</span>
<span class="lineNum">    7497 </span><span class="lineNoCov">          0 :   ofstream of(&quot;fitness_samples.dat&quot;);</span>
<span class="lineNum">    7498 </span><span class="lineNoCov">          0 :   average_meter p_invasion;</span>
<span class="lineNum">    7499 </span><span class="lineNoCov">          0 :   if(n&gt;0){</span>
<span class="lineNum">    7500 </span><span class="lineNoCov">          0 :     for(int i=n;i--&gt;0;){</span>
<span class="lineNum">    7501 </span><span class="lineNoCov">          0 :       NewSpecies sample = NewSpecies(s,0,s.n_animals);</span>
<span class="lineNum">    7502 </span><span class="lineNoCov">          0 :       double f = invasion_fitness(&amp;sample)/sample.turnover_rate_r();</span>
<span class="lineNum">    7503 </span><span class="lineNoCov">          0 :       p_invasion.sample(f&gt;0);</span>
<span class="lineNum">    7504 </span><span class="lineNoCov">          0 :       of &lt;&lt; f &lt;&lt; endl;</span>
<span class="lineNum">    7505 </span>            :     }
<span class="lineNum">    7506 </span><span class="lineNoCov">          0 :   }else if(n &lt; 0){</span>
<span class="lineNum">    7507 </span><span class="lineNoCov">          0 :     for(int i=-n;i--&gt;0;){</span>
<span class="lineNum">    7508 </span><span class="lineNoCov">          0 :       NewSpecies sample = NewSpecies(s,s.n_animals,number_of_plants());</span>
<span class="lineNum">    7509 </span><span class="lineNoCov">          0 :       double f = invasion_fitness(&amp;sample)/sample.turnover_rate_r();</span>
<span class="lineNum">    7510 </span><span class="lineNoCov">          0 :       p_invasion.sample(f&gt;0);</span>
<span class="lineNum">    7511 </span><span class="lineNoCov">          0 :       of &lt;&lt; f &lt;&lt; endl;</span>
<span class="lineNum">    7512 </span>            :     }
<span class="lineNum">    7513 </span>            :   }
<span class="lineNum">    7514 </span><span class="lineNoCov">          0 :   REPORT(p_invasion);</span>
<a name="7515"><span class="lineNum">    7515 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7516 </span>            : 
<span class="lineNum">    7517 </span><span class="lineCov">         90 : void NewWeb::line_print(ODE_vector const &amp; state, ostream &amp;co){</span>
<span class="lineNum">    7518 </span><span class="lineCov">         90 :   double log10=log(10);</span>
<span class="lineNum">    7519 </span>            :   double log10_extinct_biomass=
<span class="lineNum">    7520 </span>            :     (minimum_biomass_considered?
<span class="lineNum">    7521 </span><span class="lineCov">         90 :      log(minimum_biomass_considered)/log10:</span>
<span class="lineNum">    7522 </span><span class="lineCov">        180 :      -15 );</span>
<span class="lineNum">    7523 </span><span class="lineCov">      39240 :   for(int i=0;i&lt;species_at.size();i++){</span>
<span class="lineNum">    7524 </span><span class="lineCov">      19530 :     if(species_at[i] == column_unused){</span>
<span class="lineNum">    7525 </span>            :       co &lt;&lt; log10_extinct_biomass;
<span class="lineNum">    7526 </span>            :     }else{
<span class="lineNum">    7527 </span><span class="lineCov">      35208 :       co &lt;&lt; state[species_at[i]]/log10;</span>
<span class="lineNum">    7528 </span>            :     }
<span class="lineNum">    7529 </span><span class="lineCov">      19530 :     co &lt;&lt; &quot; &quot;;</span>
<span class="lineNum">    7530 </span>            :   }
<a name="7531"><span class="lineNum">    7531 </span><span class="lineCov">         90 : }</span></a>
<span class="lineNum">    7532 </span>            : 
<span class="lineNum">    7533 </span><span class="lineNoCov">          0 : void NewWeb::write_link_coefficient_matrix(const char * filename){</span>
<span class="lineNum">    7534 </span><span class="lineNoCov">          0 :   ofstream C(filename);</span>
<span class="lineNum">    7535 </span><span class="lineNoCov">          0 :   C.precision(16);</span>
<span class="lineNum">    7536 </span><span class="lineNoCov">          0 :   C.setf(std::ios::scientific);</span>
<span class="lineNum">    7537 </span><span class="lineNoCov">          0 :   C.setf(std::ios::floatfield);</span>
<span class="lineNum">    7538 </span><span class="lineNoCov">          0 :   bool no_carnivores=get_cfg_parameter(&quot;no_carnivores&quot;);</span>
<span class="lineNum">    7539 </span>            : 
<span class="lineNum">    7540 </span><span class="lineNoCov">          0 :   for(int i=(no_carnivores ? s.n_animals : 0); i&lt;s.size(); i++){</span>
<span class="lineNum">    7541 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;s.n_animals;j++){</span>
<span class="lineNum">    7542 </span><span class="lineNoCov">          0 :       C &lt;&lt; s[j].foraging_strength_c_on(s[i]) ;</span>
<span class="lineNum">    7543 </span><span class="lineNoCov">          0 :       if(j+1 &lt; s.n_animals)</span>
<span class="lineNum">    7544 </span><span class="lineNoCov">          0 :         C &lt;&lt; &quot;,&quot;;</span>
<span class="lineNum">    7545 </span>            :     }
<span class="lineNum">    7546 </span><span class="lineNoCov">          0 :     C &lt;&lt; endl;</span>
<span class="lineNum">    7547 </span>            :   }
<span class="lineNum">    7548 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7549 </span>            : 
<span class="lineNum">    7550 </span>            : 
<span class="lineNum">    7551 </span>            : // Helper for write_link_coefficient_matrix:
<span class="lineNum">    7552 </span><span class="lineCov">        135 : const string PGM_magic=&quot;P5&quot;; </span>
<span class="lineNum">    7553 </span>            : class smaller_in {
<span class="lineNum">    7554 </span>            :   const NewVector &amp; z;
<span class="lineNum">    7555 </span>            : public:
<span class="lineNum">    7556 </span>            :   smaller_in(NewVector &amp; v):z(v){};
<span class="lineNum">    7557 </span>            :   bool operator()(int a,int b) const{
<span class="lineNum">    7558 </span><span class="lineNoCov">          0 :     return z[a]&lt;z[b];</span>
<span class="lineNum">    7559 </span>            :   }
<a name="7560"><span class="lineNum">    7560 </span>            : };</a>
<span class="lineNum">    7561 </span>            : 
<span class="lineNum">    7562 </span><span class="lineNoCov">          0 : void csv_write(NewMatrix M,const char * filename){</span>
<span class="lineNum">    7563 </span><span class="lineNoCov">          0 :   ofstream os(filename);</span>
<span class="lineNum">    7564 </span><span class="lineNoCov">          0 :   os.precision(16);</span>
<span class="lineNum">    7565 </span><span class="lineNoCov">          0 :   os.setf(std::ios::scientific);</span>
<span class="lineNum">    7566 </span>            :   //os.setf(std::ios::floatfield);
<span class="lineNum">    7567 </span>            : 
<span class="lineNum">    7568 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;M.SIZE1();++i){</span>
<span class="lineNum">    7569 </span><span class="lineNoCov">          0 :     for(int j=0;j&lt;M.SIZE2();++j){</span>
<span class="lineNum">    7570 </span><span class="lineNoCov">          0 :       os &lt;&lt; M(i,j);</span>
<span class="lineNum">    7571 </span><span class="lineNoCov">          0 :       os &lt;&lt; &quot;,&quot;;</span>
<span class="lineNum">    7572 </span>            :     }
<span class="lineNum">    7573 </span><span class="lineNoCov">          0 :     os &lt;&lt; endl;</span>
<span class="lineNum">    7574 </span>            :   }
<a name="7575"><span class="lineNum">    7575 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    7576 </span>            : 
<span class="lineNum">    7577 </span><span class="lineNoCov">          0 : void critical_vector(const NewVector info, const NewMatrix &amp; M,</span>
<span class="lineNum">    7578 </span>            :                      const char * filename){
<span class="lineNum">    7579 </span>            :   ASSERT(M.SIZE1() == M.SIZE2());
<span class="lineNum">    7580 </span><span class="lineNoCov">          0 :   const int S = M.SIZE1();</span>
<span class="lineNum">    7581 </span>            :   
<span class="lineNum">    7582 </span><span class="lineNoCov">          0 :   arma::cx_mat eigvec;</span>
<span class="lineNum">    7583 </span><span class="lineNoCov">          0 :   arma::cx_vec eigval;</span>
<span class="lineNum">    7584 </span><span class="lineNoCov">          0 :   arma::eig_gen(eigval, eigvec, M);</span>
<span class="lineNum">    7585 </span>            : 
<span class="lineNum">    7586 </span>            :   int imin=0;
<span class="lineNum">    7587 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7588 </span><span class="lineNoCov">          0 :     if(abs(eigvec(imin)) &gt; abs(eigvec(i))){</span>
<span class="lineNum">    7589 </span><span class="lineNoCov">          0 :       imin = i;</span>
<span class="lineNum">    7590 </span>            :     }
<span class="lineNum">    7591 </span>            :   }
<span class="lineNum">    7592 </span>            : 
<span class="lineNum">    7593 </span><span class="lineNoCov">          0 :   arma::vec critical = arma::real(eigvec.col(imin));</span>
<span class="lineNum">    7594 </span>            :   
<span class="lineNum">    7595 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    7596 </span><span class="lineNoCov">          0 :   for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    7597 </span><span class="lineNoCov">          0 :     os &lt;&lt; info[i] &lt;&lt; &quot; &quot; &lt;&lt; critical[i] &lt;&lt; std::endl;</span>
<span class="lineNum">    7598 </span>            :   }
<span class="lineNum">    7599 </span><span class="lineNoCov">          0 :   return;</span>
<a name="7600"><span class="lineNum">    7600 </span>            : }</a>
<span class="lineNum">    7601 </span>            : 
<span class="lineNum">    7602 </span><span class="lineNoCov">          0 : void alpha_image(const NewMatrix alpha, const char *filename)</span>
<span class="lineNum">    7603 </span>            : {
<span class="lineNum">    7604 </span><span class="lineNoCov">          0 :   std::ofstream os(filename);</span>
<span class="lineNum">    7605 </span>            :   
<span class="lineNum">    7606 </span><span class="lineNoCov">          0 :   const int S = alpha.SIZE1();</span>
<span class="lineNum">    7607 </span>            :   
<span class="lineNum">    7608 </span><span class="lineNoCov">          0 :   os &lt;&lt; PGM_magic &lt;&lt; endl;</span>
<span class="lineNum">    7609 </span><span class="lineNoCov">          0 :   os &lt;&lt; alpha.SIZE2() &lt;&lt; endl; //width</span>
<span class="lineNum">    7610 </span><span class="lineNoCov">          0 :   os &lt;&lt; alpha.SIZE1() &lt;&lt; endl; //height</span>
<span class="lineNum">    7611 </span><span class="lineNoCov">          0 :   os &lt;&lt; 255 &lt;&lt; endl; //maximum graylevel, i.e. black/white image</span>
<span class="lineNum">    7612 </span>            :   
<span class="lineNum">    7613 </span><span class="lineNoCov">          0 :   for(int i=0; i&lt;alpha.SIZE1(); ++i){</span>
<span class="lineNum">    7614 </span><span class="lineNoCov">          0 :     for(int j=0; j&lt;alpha.SIZE2(); ++j){</span>
<span class="lineNum">    7615 </span><span class="lineNoCov">          0 :       int value=(-alpha(i,j)+1)*128;</span>
<span class="lineNum">    7616 </span><span class="lineNoCov">          0 :       value = min(255,max(0,value));</span>
<span class="lineNum">    7617 </span><span class="lineNoCov">          0 :       os.put(value);</span>
<span class="lineNum">    7618 </span>            :     }
<span class="lineNum">    7619 </span>            :   }
<span class="lineNum">    7620 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7621 </span>            : 
<span class="lineNum">    7622 </span>            : template &lt;typename T&gt; int sgn(T &amp; val) {
<span class="lineNum">    7623 </span><span class="lineNoCov">          0 :     return (0 &lt; val) - (val &lt; 0);</span>
<a name="7624"><span class="lineNum">    7624 </span>            : }</a>
<span class="lineNum">    7625 </span>            : 
<span class="lineNum">    7626 </span><span class="lineNoCov">          0 : NewMatrix diagonal_one(const NewMatrix &amp; m){</span>
<span class="lineNum">    7627 </span><span class="lineNoCov">          0 :   return arma::diagmat(((0 &lt; m.diag()) - (m.diag() &lt; 0))/sqrt(abs(m.diag()))) *</span>
<span class="lineNum">    7628 </span><span class="lineNoCov">          0 :     m *</span>
<span class="lineNum">    7629 </span><span class="lineNoCov">          0 :     arma::diagmat(1/sqrt(abs(m.diag())));</span>
<span class="lineNum">    7630 </span>            : }
<span class="lineNum">    7631 </span>            : 
<a name="7632"><span class="lineNum">    7632 </span>            : // Compute competitive overlaps. Simple version, also allow for</a>
<span class="lineNum">    7633 </span>            : // competition between plants and animals
<span class="lineNum">    7634 </span><span class="lineNoCov">          0 : void NewWeb::write_competition_matrix(const char * filename){</span>
<span class="lineNum">    7635 </span>            : 
<span class="lineNum">    7636 </span><span class="lineNoCov">          0 :   int Sp=number_of_plants();</span>
<span class="lineNum">    7637 </span><span class="lineNoCov">          0 :   int Sc=number_of_animals();</span>
<span class="lineNum">    7638 </span><span class="lineNoCov">          0 :   int S=Sp+Sc;</span>
<span class="lineNum">    7639 </span><span class="lineNoCov">          0 :   const double dx = 1e-5;</span>
<span class="lineNum">    7640 </span>            : 
<span class="lineNum">    7641 </span>            :   // Prepares sorting
<span class="lineNum">    7642 </span><span class="lineNoCov">          0 :   permutation perm(S);</span>
<span class="lineNum">    7643 </span><span class="lineNoCov">          0 :   for(int i=perm.size();i--&gt;0;){</span>
<span class="lineNum">    7644 </span><span class="lineNoCov">          0 :     perm[i]=i;</span>
<span class="lineNum">    7645 </span>            :   }
<span class="lineNum">    7646 </span>            : #if 0
<span class="lineNum">    7647 </span>            :   // ... by trophic level
<span class="lineNum">    7648 </span>            :   // Compute trophic levels for later sorting
<span class="lineNum">    7649 </span>            :   NewVector level;
<span class="lineNum">    7650 </span>            :   NewMatrix F;
<span class="lineNum">    7651 </span>            :   {
<span class="lineNum">    7652 </span>            :     link_strength_matrix intake=intake_matrix();
<span class="lineNum">    7653 </span>            :     link_strength_matrix ifrac=in_fraction(intake);
<span class="lineNum">    7654 </span>            :     F=ifrac;
<span class="lineNum">    7655 </span>            :     NewVector ones(S);
<span class="lineNum">    7656 </span>            :     for(int i=S;i--&gt;0;)
<span class="lineNum">    7657 </span>            :       ones[i]=1;
<span class="lineNum">    7658 </span>            :     level=solve(NewIdentityMatrix(S,S)-F,ones);
<span class="lineNum">    7659 </span>            :   }
<span class="lineNum">    7660 </span>            :   REPORT(level.size());
<span class="lineNum">    7661 </span>            :   sort(perm.begin(),perm.end(),smaller_in(level));
<span class="lineNum">    7662 </span>            : #else
<span class="lineNum">    7663 </span>            :   // ... by size
<span class="lineNum">    7664 </span><span class="lineNoCov">          0 :   NewVector body_size(S);</span>
<span class="lineNum">    7665 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7666 </span><span class="lineNoCov">          0 :     body_size[i]=s[i].bodymass();</span>
<span class="lineNum">    7667 </span>            :   }
<span class="lineNum">    7668 </span><span class="lineNoCov">          0 :   REPORT(body_size.size());</span>
<span class="lineNum">    7669 </span><span class="lineNoCov">          0 :   sort(perm.begin(),perm.end(),smaller_in(body_size));</span>
<span class="lineNum">    7670 </span>            : #endif
<span class="lineNum">    7671 </span>            :   
<span class="lineNum">    7672 </span>            : 
<span class="lineNum">    7673 </span>            :   //// Linearize: generate A (=Aprime) epsAT and Cp matrix and sigma
<span class="lineNum">    7674 </span>            :   //vector
<span class="lineNum">    7675 </span><span class="lineNoCov">          0 :   NewMatrix iB(S,S);</span>
<span class="lineNum">    7676 </span><span class="lineNoCov">          0 :   iB = arma::diagmat(iB);</span>
<span class="lineNum">    7677 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7678 </span><span class="lineNoCov">          0 :     iB(i,i)=1/s(i).biomass_abundance_B();</span>
<span class="lineNum">    7679 </span>            :   }
<span class="lineNum">    7680 </span>            : 
<span class="lineNum">    7681 </span><span class="lineNoCov">          0 :   NewMatrix J=numerical_Jacobian(dx);</span>
<span class="lineNum">    7682 </span>            : 
<span class="lineNum">    7683 </span>            :   // The following is the correct formula, because J is for
<span class="lineNum">    7684 </span>            :   // _logarithmic_ biomasses.
<span class="lineNum">    7685 </span><span class="lineNoCov">          0 :   NewMatrix G=prod(J,iB);</span>
<span class="lineNum">    7686 </span>            : 
<span class="lineNum">    7687 </span>            :   
<span class="lineNum">    7688 </span>            :   // Split G according to signs only:
<span class="lineNum">    7689 </span><span class="lineNoCov">          0 :   NewMatrix C=-G;</span>
<span class="lineNum">    7690 </span><span class="lineNoCov">          0 :   NewMatrix A=NewZeroMatrix(S,S);</span>
<span class="lineNum">    7691 </span><span class="lineNoCov">          0 :   NewMatrix epsAT=NewZeroMatrix(S,S);</span>
<span class="lineNum">    7692 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7693 </span><span class="lineNoCov">          0 :     for(int j=S;j--&gt;0;){</span>
<span class="lineNum">    7694 </span><span class="lineNoCov">          0 :       if(i != j and C(i,j) &gt;= 0 and C(j,i) &lt;= 0){</span>
<span class="lineNum">    7695 </span><span class="lineNoCov">          0 :         if(!(is_plant(i) and is_plant(j))){</span>
<span class="lineNum">    7696 </span><span class="lineNoCov">          0 :           A(i,j)=C(i,j);C(i,j)=0;</span>
<span class="lineNum">    7697 </span><span class="lineNoCov">          0 :           epsAT(j,i)=-C(j,i);C(j,i)=0;</span>
<span class="lineNum">    7698 </span>            :         }
<span class="lineNum">    7699 </span>            :       }
<span class="lineNum">    7700 </span>            :     }
<span class="lineNum">    7701 </span>            :   }
<span class="lineNum">    7702 </span>            : 
<span class="lineNum">    7703 </span>            : #if 0
<span class="lineNum">    7704 </span>            :   csv_write(A,&quot;Aprime.csv&quot;);
<span class="lineNum">    7705 </span>            :   csv_write(arma::trans(epsAT),&quot;epsilonA.csv&quot;);
<span class="lineNum">    7706 </span>            :   csv_write(C,&quot;C.csv&quot;);
<span class="lineNum">    7707 </span>            : #endif
<span class="lineNum">    7708 </span>            :   
<span class="lineNum">    7709 </span><span class="lineNoCov">          0 :   NewMatrix hatC, ihatC;</span>
<span class="lineNum">    7710 </span>            : 
<span class="lineNum">    7711 </span>            :   // Compute a first guess for the effective competition matrix hatC:
<span class="lineNum">    7712 </span><span class="lineNoCov">          0 :   hatC=C;</span>
<span class="lineNum">    7713 </span><span class="lineNoCov">          0 :   average_meter average_plant_competition;</span>
<span class="lineNum">    7714 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;Sc;) average_plant_competition.sample(hatC(i,i));</span>
<span class="lineNum">    7715 </span><span class="lineNoCov">          0 :   hatC.submat(0,0,Sc-1,Sc-1)=</span>
<span class="lineNum">    7716 </span><span class="lineNoCov">          0 :     average_plant_competition.readout() * NewIdentityMatrix(Sc,Sc);</span>
<span class="lineNum">    7717 </span>            :   // Compute the effective competition matrix hatC:
<span class="lineNum">    7718 </span>            : 
<span class="lineNum">    7719 </span>            : #if 1
<span class="lineNum">    7720 </span><span class="lineNoCov">          0 :   CompMatrixSchur(hatC, ihatC, epsAT, A, C);</span>
<span class="lineNum">    7721 </span>            : #else 
<span class="lineNum">    7722 </span>            :   CompMatrix(hatC, ihatC, epsAT, A, C);
<span class="lineNum">    7723 </span>            : #endif
<span class="lineNum">    7724 </span>            :   
<span class="lineNum">    7725 </span><span class="lineNoCov">          0 :   NewMatrix alpha=NewZeroMatrix(0,0);</span>
<span class="lineNum">    7726 </span><span class="lineNoCov">          0 :   NewMatrix norm(S,S);</span>
<span class="lineNum">    7727 </span>            :   int negative_count=0;
<span class="lineNum">    7728 </span><span class="lineNoCov">          0 :   for(int j=S;j--&gt;0;){</span>
<span class="lineNum">    7729 </span><span class="lineNoCov">          0 :     if(hatC(j,j) &lt; 0) negative_count++;</span>
<span class="lineNum">    7730 </span><span class="lineNoCov">          0 :     double diag_entry=hatC(j,j);</span>
<span class="lineNum">    7731 </span><span class="lineNoCov">          0 :     if(diag_entry==0){</span>
<span class="lineNum">    7732 </span><span class="lineNoCov">          0 :       REPORT(Sc);</span>
<span class="lineNum">    7733 </span><span class="lineNoCov">          0 :       REPORT(j);</span>
<span class="lineNum">    7734 </span><span class="lineNoCov">          0 :       WARNING(&quot;zero self-competition, isolating species!!&quot;);</span>
<span class="lineNum">    7735 </span><span class="lineNoCov">          0 :       hatC.row(j)*=0;</span>
<span class="lineNum">    7736 </span><span class="lineNoCov">          0 :       hatC.col(j)*=0;</span>
<span class="lineNum">    7737 </span><span class="lineNoCov">          0 :       A.row(j)*=0;</span>
<span class="lineNum">    7738 </span><span class="lineNoCov">          0 :       A.col(j)*=0;</span>
<span class="lineNum">    7739 </span><span class="lineNoCov">          0 :       epsAT.row(j)*=0;</span>
<span class="lineNum">    7740 </span><span class="lineNoCov">          0 :       epsAT.col(j)*=0;</span>
<span class="lineNum">    7741 </span><span class="lineNoCov">          0 :       C.row(j)*=0;</span>
<span class="lineNum">    7742 </span><span class="lineNoCov">          0 :       C.col(j)*=0;</span>
<span class="lineNum">    7743 </span><span class="lineNoCov">          0 :       C(j,j)=1;</span>
<span class="lineNum">    7744 </span><span class="lineNoCov">          0 :       hatC(j,j)=1;</span>
<span class="lineNum">    7745 </span><span class="lineNoCov">          0 :       norm(j,j)=1;</span>
<span class="lineNum">    7746 </span>            :     }else{
<span class="lineNum">    7747 </span><span class="lineNoCov">          0 :       norm(j,j)=sgn(diag_entry)/sqrt(abs(diag_entry));</span>
<span class="lineNum">    7748 </span>            :     }
<span class="lineNum">    7749 </span>            :   }
<span class="lineNum">    7750 </span><span class="lineNoCov">          0 :   norm = arma::diagmat(norm);</span>
<span class="lineNum">    7751 </span>            :     
<span class="lineNum">    7752 </span><span class="lineNoCov">          0 :   REPORT(negative_count);</span>
<span class="lineNum">    7753 </span><span class="lineNoCov">          0 :   WARNING(&quot;Getting alpha again&quot;);</span>
<span class="lineNum">    7754 </span>            : 
<span class="lineNum">    7755 </span><span class="lineNoCov">          0 :   NewMatrix alpha_old = alpha;</span>
<span class="lineNum">    7756 </span><span class="lineNoCov">          0 :   alpha = norm * hatC * abs(norm);</span>
<span class="lineNum">    7757 </span>            : 
<span class="lineNum">    7758 </span>            : #if 0 // also use Schur method and compare
<span class="lineNum">    7759 </span>            :   alpha_image(alpha,&quot;i.pgm&quot;);
<span class="lineNum">    7760 </span>            : 
<span class="lineNum">    7761 </span>            :   CompMatrixSchur(hatC, ihatC, epsAT, A, C);
<span class="lineNum">    7762 </span>            :   
<span class="lineNum">    7763 </span>            :   negative_count=0;
<span class="lineNum">    7764 </span>            :   for(int j=S;j--&gt;0;){
<span class="lineNum">    7765 </span>            :     if(hatC(j,j) &lt; 0) negative_count++;
<span class="lineNum">    7766 </span>            :     double diag_entry=hatC(j,j);
<span class="lineNum">    7767 </span>            :     if(diag_entry==0){
<span class="lineNum">    7768 </span>            :       REPORT(Sc);
<span class="lineNum">    7769 </span>            :       REPORT(j);
<span class="lineNum">    7770 </span>            :       WARNING(&quot;zero self-competition, isolating species!!&quot;);
<span class="lineNum">    7771 </span>            :       hatC.row(j)*=0;
<span class="lineNum">    7772 </span>            :       hatC.col(j)*=0;
<span class="lineNum">    7773 </span>            :       A.row(j)*=0;
<span class="lineNum">    7774 </span>            :       A.col(j)*=0;
<span class="lineNum">    7775 </span>            :       epsAT.row(j)*=0;
<span class="lineNum">    7776 </span>            :       epsAT.col(j)*=0;
<span class="lineNum">    7777 </span>            :       C.row(j)*=0;
<span class="lineNum">    7778 </span>            :       C.col(j)*=0;
<span class="lineNum">    7779 </span>            :       C(j,j)=1;
<span class="lineNum">    7780 </span>            :       hatC(j,j)=1;
<span class="lineNum">    7781 </span>            :       norm(j,j)=1;
<span class="lineNum">    7782 </span>            :     }else{
<span class="lineNum">    7783 </span>            :       norm(j,j)=sig(diag_entry)/sqrt(abs(diag_entry));
<span class="lineNum">    7784 </span>            :     }
<span class="lineNum">    7785 </span>            :   }
<span class="lineNum">    7786 </span>            :   norm = arma::diagmat(norm);
<span class="lineNum">    7787 </span>            :     
<span class="lineNum">    7788 </span>            :   REPORT(negative_count);
<span class="lineNum">    7789 </span>            :   WARNING(&quot;Getting alphaSchur&quot;);
<span class="lineNum">    7790 </span>            : 
<span class="lineNum">    7791 </span>            :   NewMatrix alphaIter = alpha;
<span class="lineNum">    7792 </span>            :   NewMatrix alphaSchur = norm * hatC * abs(norm);
<span class="lineNum">    7793 </span>            :   alpha = alphaSchur;
<span class="lineNum">    7794 </span>            :   
<span class="lineNum">    7795 </span>            :   alpha_image(alphaSchur,&quot;s.pgm&quot;);
<span class="lineNum">    7796 </span>            :   alpha_image(arma::join_horiz(alphaIter,alphaSchur),filename);
<span class="lineNum">    7797 </span>            : #endif
<span class="lineNum">    7798 </span>            :   
<span class="lineNum">    7799 </span><span class="lineNoCov">          0 :   NewVector beta(S);</span>
<span class="lineNum">    7800 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7801 </span><span class="lineNoCov">          0 :     beta[i]=s[i].biomass_abundance_B()/abs(norm(i,i));</span>
<span class="lineNum">    7802 </span>            :   }
<span class="lineNum">    7803 </span>            :   
<span class="lineNum">    7804 </span><span class="lineNoCov">          0 :   NewVector sigma_eff= prod(alpha, beta);</span>
<span class="lineNum">    7805 </span>            : 
<span class="lineNum">    7806 </span>            :   {
<span class="lineNum">    7807 </span><span class="lineNoCov">          0 :     std::ofstream os(&quot;beta.dat&quot;);</span>
<span class="lineNum">    7808 </span><span class="lineNoCov">          0 :     os &lt;&lt; beta;</span>
<span class="lineNum">    7809 </span>            :   }
<span class="lineNum">    7810 </span>            :   {
<span class="lineNum">    7811 </span><span class="lineNoCov">          0 :     std::ofstream os(&quot;B.dat&quot;);</span>
<span class="lineNum">    7812 </span><span class="lineNoCov">          0 :     for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    7813 </span><span class="lineNoCov">          0 :       os &lt;&lt; s[i].biomass_abundance_B() &lt;&lt; endl;</span>
<span class="lineNum">    7814 </span>            :     }
<span class="lineNum">    7815 </span>            :   }
<span class="lineNum">    7816 </span>            :   {
<span class="lineNum">    7817 </span><span class="lineNoCov">          0 :     std::ofstream os(&quot;sigma_eff.dat&quot;);</span>
<span class="lineNum">    7818 </span><span class="lineNoCov">          0 :     os &lt;&lt; sigma_eff;</span>
<span class="lineNum">    7819 </span>            :   }
<span class="lineNum">    7820 </span>            :   {
<span class="lineNum">    7821 </span><span class="lineNoCov">          0 :     std::ofstream os(&quot;norm.dat&quot;);</span>
<span class="lineNum">    7822 </span><span class="lineNoCov">          0 :     for(int i=0; i&lt;S; i++){</span>
<span class="lineNum">    7823 </span><span class="lineNoCov">          0 :       os &lt;&lt; norm(i,i) &lt;&lt; endl;</span>
<span class="lineNum">    7824 </span>            :     }
<span class="lineNum">    7825 </span>            :   }
<span class="lineNum">    7826 </span>            :     
<span class="lineNum">    7827 </span>            : 
<span class="lineNum">    7828 </span>            :   // Deal with -1 on diagonal of alpha (needs improving)
<span class="lineNum">    7829 </span><span class="lineNoCov">          0 :   negative_count=0;</span>
<span class="lineNum">    7830 </span><span class="lineNoCov">          0 :   for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7831 </span><span class="lineNoCov">          0 :     if(alpha(i,i)&lt;0){</span>
<span class="lineNum">    7832 </span><span class="lineNoCov">          0 :       if(isnan(alpha(i,i))){</span>
<span class="lineNum">    7833 </span><span class="lineNoCov">          0 :         FATAL_ERROR(&quot;nan on diagonal of alpha: &quot; &lt;&lt; i);</span>
<span class="lineNum">    7834 </span>            :       }
<span class="lineNum">    7835 </span><span class="lineNoCov">          0 :       negative_count++;</span>
<span class="lineNum">    7836 </span>            :     }
<span class="lineNum">    7837 </span>            :   }
<span class="lineNum">    7838 </span><span class="lineNoCov">          0 :   if(negative_count){</span>
<span class="lineNum">    7839 </span><span class="lineNoCov">          0 :     WARNING(negative_count &lt;&lt; &quot; times -1 on diagonal: dropping&quot;);</span>
<span class="lineNum">    7840 </span>            :     //WARNING(negative_count &lt;&lt; &quot; times -1 on diagonal&quot;);
<span class="lineNum">    7841 </span>            :   }
<span class="lineNum">    7842 </span>            :   
<span class="lineNum">    7843 </span>            :   //negative_count=0;
<span class="lineNum">    7844 </span><span class="lineNoCov">          0 :   REPORT(negative_count);</span>
<span class="lineNum">    7845 </span>            : 
<span class="lineNum">    7846 </span><span class="lineNoCov">          0 :   NewMatrix unordered_alpha(alpha);</span>
<span class="lineNum">    7847 </span>            :   
<span class="lineNum">    7848 </span>            :   // Clean up an re-order alpha
<span class="lineNum">    7849 </span>            :   if(1){
<span class="lineNum">    7850 </span><span class="lineNoCov">          0 :     NewMatrix alpha_new(S-negative_count,S-negative_count);</span>
<span class="lineNum">    7851 </span>            :     int ii=0;
<span class="lineNum">    7852 </span><span class="lineNoCov">          0 :     for(int i=0;i&lt;S;i++){</span>
<span class="lineNum">    7853 </span><span class="lineNoCov">          0 :       if(alpha(perm[i],perm[i])&gt;0){</span>
<span class="lineNum">    7854 </span>            :         int jj=0;
<span class="lineNum">    7855 </span><span class="lineNoCov">          0 :         for(int j=0;j&lt;S;j++){</span>
<span class="lineNum">    7856 </span><span class="lineNoCov">          0 :           if(alpha(perm[j],perm[j])&gt;0){</span>
<span class="lineNum">    7857 </span><span class="lineNoCov">          0 :             alpha_new(ii,jj)=alpha(perm[i],perm[j]);</span>
<span class="lineNum">    7858 </span><span class="lineNoCov">          0 :             jj++;</span>
<span class="lineNum">    7859 </span>            :           }
<span class="lineNum">    7860 </span>            :         }
<span class="lineNum">    7861 </span><span class="lineNoCov">          0 :         ii++;</span>
<span class="lineNum">    7862 </span>            :       }
<span class="lineNum">    7863 </span>            :     }
<span class="lineNum">    7864 </span><span class="lineNoCov">          0 :     alpha=alpha_new;</span>
<span class="lineNum">    7865 </span><span class="lineNoCov">          0 :     S-=negative_count;</span>
<span class="lineNum">    7866 </span>            :   }else{
<span class="lineNum">    7867 </span>            :     negative_count=0;
<span class="lineNum">    7868 </span>            :   }
<span class="lineNum">    7869 </span>            :   
<span class="lineNum">    7870 </span>            : #if 0
<span class="lineNum">    7871 </span>            :   // Generate image of alpha
<span class="lineNum">    7872 </span>            : #if 0 // do not include plants
<span class="lineNum">    7873 </span>            :   alpha_image(alpha.submat(Sp,Sp,S-1,S-1),filename);
<span class="lineNum">    7874 </span>            : #else // do include plants
<span class="lineNum">    7875 </span>            :   alpha_image(alpha,filename);
<span class="lineNum">    7876 </span>            : #endif
<span class="lineNum">    7877 </span>            : #endif
<span class="lineNum">    7878 </span>            : 
<span class="lineNum">    7879 </span>            :     
<span class="lineNum">    7880 </span>            : //   {
<span class="lineNum">    7881 </span>            : //     std::ofstream os(&quot;foodweb.pgm&quot;);
<span class="lineNum">    7882 </span>            :     
<span class="lineNum">    7883 </span>            : // #if 0 // do not include plants
<span class="lineNum">    7884 </span>            : //     os &lt;&lt; PGM_magic &lt;&lt; endl;
<span class="lineNum">    7885 </span>            : //     os &lt;&lt; Sc &lt;&lt; endl; //width
<span class="lineNum">    7886 </span>            : //     os &lt;&lt; Sc &lt;&lt; endl; //height
<span class="lineNum">    7887 </span>            : //     os &lt;&lt; 255 &lt;&lt; endl; //maximum graylevel, i.e. black/white image
<span class="lineNum">    7888 </span>            :     
<span class="lineNum">    7889 </span>            : //     for(int i=Sc;i--&gt;0;){
<span class="lineNum">    7890 </span>            : //       for(int j=Sc;j--&gt;0;){
<span class="lineNum">    7891 </span>            : //      int value=(-F(perm[j],perm[i])+1)*255;
<span class="lineNum">    7892 </span>            : //      value = min(255,max(0,value));
<span class="lineNum">    7893 </span>            : //      os.put(value);
<span class="lineNum">    7894 </span>            : //       }
<span class="lineNum">    7895 </span>            : //     }// for i
<span class="lineNum">    7896 </span>            : // #else // do include plants
<span class="lineNum">    7897 </span>            : //     os &lt;&lt; PGM_magic &lt;&lt; endl;
<span class="lineNum">    7898 </span>            : //     os &lt;&lt; S &lt;&lt; endl; //width
<span class="lineNum">    7899 </span>            : //     os &lt;&lt; S &lt;&lt; endl; //height
<span class="lineNum">    7900 </span>            : //     os &lt;&lt; 255 &lt;&lt; endl; //maximum graylevel, i.e. black/white image
<span class="lineNum">    7901 </span>            :     
<span class="lineNum">    7902 </span>            : //     for(int i=S;i--&gt;0;){
<span class="lineNum">    7903 </span>            : //       for(int j=S;j--&gt;0;){
<span class="lineNum">    7904 </span>            : //      int value=(-F(perm[j],perm[i])+1)*255;
<span class="lineNum">    7905 </span>            : //      value = min(255,max(0,value));
<span class="lineNum">    7906 </span>            : //      os.put(value);
<span class="lineNum">    7907 </span>            : //       }
<span class="lineNum">    7908 </span>            : //     }// for i
<span class="lineNum">    7909 </span>            : // #endif
<span class="lineNum">    7910 </span>            : //   }
<span class="lineNum">    7911 </span>            : 
<span class="lineNum">    7912 </span>            :   // Compute and save spectrum
<span class="lineNum">    7913 </span><span class="lineNoCov">          0 :   eigen_report(alpha,&quot;alpha_spectrum.dat&quot;);</span>
<span class="lineNum">    7914 </span><span class="lineNoCov">          0 :   critical_vector(body_size,unordered_alpha,&quot;alpha_critical.dat&quot;);</span>
<span class="lineNum">    7915 </span>            :   // Compute and save animal spectrum
<span class="lineNum">    7916 </span>            :   {
<span class="lineNum">    7917 </span><span class="lineNoCov">          0 :     NewMatrix alphaC(unordered_alpha.submat(0,0,Sc-1,Sc-1));</span>
<span class="lineNum">    7918 </span><span class="lineNoCov">          0 :     eigen_report(alphaC,&quot;alphaC_spectrum.dat&quot;);</span>
<span class="lineNum">    7919 </span>            :   }
<span class="lineNum">    7920 </span>            :   {
<span class="lineNum">    7921 </span><span class="lineNoCov">          0 :     NewMatrix alphaCS(diagonal_one(Schur_complement(unordered_alpha,0,Sc-1)));</span>
<span class="lineNum">    7922 </span><span class="lineNoCov">          0 :     eigen_report(alphaCS,&quot;alphaCS_spectrum.dat&quot;);</span>
<span class="lineNum">    7923 </span><span class="lineNoCov">          0 :     critical_vector(body_size,alphaCS,&quot;alphaCS_critical.dat&quot;);</span>
<span class="lineNum">    7924 </span>            :   }
<span class="lineNum">    7925 </span>            :   {
<span class="lineNum">    7926 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; fish(0);</span>
<span class="lineNum">    7927 </span><span class="lineNoCov">          0 :     for(int i=S;i--&gt;0;){</span>
<span class="lineNum">    7928 </span><span class="lineNoCov">          0 :       if(!is_plant(i) &amp;&amp; s(i).bodymass() &gt; fishMlowerthreshold &amp;&amp;</span>
<span class="lineNum">    7929 </span><span class="lineNoCov">          0 :          s(i).bodymass() &lt; fishMupperthreshold ){</span>
<span class="lineNum">    7930 </span><span class="lineNoCov">          0 :         fish.push_back(i);</span>
<span class="lineNum">    7931 </span>            :       }
<span class="lineNum">    7932 </span>            :     }
<span class="lineNum">    7933 </span><span class="lineNoCov">          0 :     arma::uvec sel(fish.size());</span>
<span class="lineNum">    7934 </span><span class="lineNoCov">          0 :     if(fish.size()){</span>
<span class="lineNum">    7935 </span><span class="lineNoCov">          0 :       copy(fish.begin(),fish.end(),sel.begin());</span>
<span class="lineNum">    7936 </span><span class="lineNoCov">          0 :       NewMatrix alpha_fish=diagonal_one(Schur_complement(unordered_alpha,sel));</span>
<span class="lineNum">    7937 </span><span class="lineNoCov">          0 :       eigen_report(alpha_fish,&quot;alphaFS_spectrum.dat&quot;);</span>
<span class="lineNum">    7938 </span><span class="lineNoCov">          0 :       critical_vector(body_size(sel),alpha_fish,&quot;alphaFS_critical.dat&quot;);</span>
<span class="lineNum">    7939 </span><span class="lineNoCov">          0 :       eigen_report(unordered_alpha(sel,sel),&quot;alphaF_spectrum.dat&quot;);</span>
<span class="lineNum">    7940 </span>            :     }
<span class="lineNum">    7941 </span>            :   }
<span class="lineNum">    7942 </span>            :   // Compute and save spectrum of Raising Operator
<span class="lineNum">    7943 </span><span class="lineNoCov">          0 :   eigen_report(epsAT*ihatC,&quot;R_spectrum.dat&quot;);</span>
<span class="lineNum">    7944 </span>            :   // Compute and save spectrum of Lowering Operator
<span class="lineNum">    7945 </span><span class="lineNoCov">          0 :   eigen_report(A*ihatC,&quot;L_spectrum.dat&quot;);</span>
<span class="lineNum">    7946 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">    7947 </span>            : 
<span class="lineNum">    7948 </span>            : 
<a name="7949"><span class="lineNum">    7949 </span>            : // Explicitly define constructors in order to be able to specify</a>
<span class="lineNum">    7950 </span>            : // csc_eating as symmetric:
<span class="lineNum">    7951 </span><span class="lineCov">     119334 : NewWeb::precomputed_entry_t::</span>
<span class="lineNum">    7952 </span>            : precomputed_entry_t():
<span class="lineNum">    7953 </span>            :   csc_eating(SortedMatrix::symmetric),
<span class="lineNum">    7954 </span>            :   csc_being_eaten(SortedMatrix::asymmetric),
<span class="lineNum">    7955 </span>            :   c(),
<span class="lineNum">    7956 </span><span class="lineCov">     119334 :   cT(){</span>
<span class="lineNum">    7957 </span><span class="lineCov">     119334 : }</span>
<a name="7958"><span class="lineNum">    7958 </span>            : </a>
<span class="lineNum">    7959 </span>            : 
<span class="lineNum">    7960 </span><span class="lineCov">        559 : void NewWeb::initialize_precomputed(){</span>
<span class="lineNum">    7961 </span><span class="lineCov">        559 :   precomputed.resize(0,s);</span>
<span class="lineNum">    7962 </span><span class="lineCov">       1118 :   precomputed.resize(s.size(),s);</span>
<span class="lineNum">    7963 </span>            : 
<span class="lineNum">    7964 </span><span class="lineCov">        559 :   link_strength_matrix similarity;</span>
<span class="lineNum">    7965 </span><span class="lineCov">        559 :   if(not adjust_prey_similarity_width){</span>
<span class="lineNum">    7966 </span>            :     // Pre-pre compute similarities in order to precompute faster:
<span class="lineNum">    7967 </span><span class="lineCov">       1118 :     similarity.resize(s.size());</span>
<span class="lineNum">    7968 </span><span class="lineCov">        559 :     if(do_switching){</span>
<span class="lineNum">    7969 </span><span class="lineNoCov">          0 :       for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    7970 </span><span class="lineNoCov">          0 :         similarity[i][i]=</span>
<span class="lineNum">    7971 </span><span class="lineNoCov">          0 :           s(i).</span>
<span class="lineNum">    7972 </span><span class="lineNoCov">          0 :           switching_similarity_to(s(i),switching_similarity_width_w_s);</span>
<span class="lineNum">    7973 </span><span class="lineNoCov">          0 :         for(int j=i;j--&gt;0;){</span>
<span class="lineNum">    7974 </span><span class="lineNoCov">          0 :           similarity[i][j]=similarity[j][i]=</span>
<span class="lineNum">    7975 </span><span class="lineNoCov">          0 :             s(i).</span>
<span class="lineNum">    7976 </span><span class="lineNoCov">          0 :             switching_similarity_to(s(j),switching_similarity_width_w_s);</span>
<span class="lineNum">    7977 </span>            :         }
<span class="lineNum">    7978 </span>            :       }
<span class="lineNum">    7979 </span>            :     }
<span class="lineNum">    7980 </span>            :   }
<span class="lineNum">    7981 </span>            :   // Now, do the sorted vectors first.  We cannot speed up much here:
<span class="lineNum">    7982 </span><span class="lineCov">        559 :   SortedVector dummy_vector;</span>
<span class="lineNum">    7983 </span><span class="lineCov">        559 :   double vector_truncation_epsilon=dummy_vector.truncation_epsilon();</span>
<span class="lineNum">    7984 </span><span class="lineCov">        559 :   WARN_IF(SortedVector().truncation_epsilon()==0,&quot;Better set this to non-zero&quot;);</span>
<span class="lineNum">    7985 </span><span class="lineCov">        559 :   for(int k=s.n_animals;k--&gt;0;){</span>
<span class="lineNum">    7986 </span><span class="lineCov">      78540 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    7987 </span><span class="lineCov">   23408340 :       double c=s[k].foraging_strength_c_on(s[i]);</span>
<span class="lineNum">    7988 </span><span class="lineCov">   31211120 :       precomputed[k].c[i]=c;</span>
<span class="lineNum">    7989 </span><span class="lineCov">    7802780 :       if(!do_switching){</span>
<span class="lineNum">    7990 </span><span class="lineCov">   31211120 :         precomputed[i].cT[k]=c;</span>
<span class="lineNum">    7991 </span>            :       }
<span class="lineNum">    7992 </span>            :     }
<span class="lineNum">    7993 </span>            :   }
<span class="lineNum">    7994 </span><span class="lineCov">       1118 :   for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    7995 </span><span class="lineCov">    9112442 :     for(int j=s.size();j--&gt;s.n_animals;){</span>
<span class="lineNum">    7996 </span><span class="lineCov">   53828940 :       precomputed[i].c[j]=s[i].plant_hampering_by(s[j]);</span>
<span class="lineNum">    7997 </span>            :     }
<span class="lineNum">    7998 </span>            :   }
<span class="lineNum">    7999 </span>            : 
<span class="lineNum">    8000 </span>            :   /////// Test how many prey per predator are covered
<span class="lineNum">    8001 </span>            :   // for(int i=number_of_animals();i--&gt;0;){
<span class="lineNum">    8002 </span>            :   //   REPORT(precomputed[i].c.size());
<span class="lineNum">    8003 </span>            :   // }
<span class="lineNum">    8004 </span>            :   // exit(1);
<span class="lineNum">    8005 </span>            : 
<span class="lineNum">    8006 </span><span class="lineCov">        559 :   if(!do_switching)</span>
<span class="lineNum">    8007 </span><span class="lineCov">        559 :     return;</span>
<span class="lineNum">    8008 </span>            : 
<span class="lineNum">    8009 </span>            :   // Now, do the sorted matrices, and do them smart:
<span class="lineNum">    8010 </span><span class="lineNoCov">          0 :   SortedMatrix dummy_matrix;</span>
<span class="lineNum">    8011 </span><span class="lineNoCov">          0 :   double matrix_truncation_epsilon=dummy_matrix.truncation_epsilon();</span>
<span class="lineNum">    8012 </span><span class="lineNoCov">          0 :   WARN_IF(SortedMatrix().truncation_epsilon()==0,&quot;Better set this to non-zero&quot;);</span>
<span class="lineNum">    8013 </span><span class="lineNoCov">          0 :   vector&lt; int &gt; prey(s.size()); // list of prey of a predator</span>
<span class="lineNum">    8014 </span><span class="lineNoCov">          0 :   for(int k=s.n_animals;k--&gt;0;){</span>
<span class="lineNum">    8015 </span><span class="lineNoCov">          0 :     int Z=0;</span>
<span class="lineNum">    8016 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    8017 </span><span class="lineNoCov">          0 :       if(precomputed[k].c[i] &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8018 </span><span class="lineNoCov">          0 :         prey[Z++]=i;</span>
<span class="lineNum">    8019 </span>            :       }
<span class="lineNum">    8020 </span>            :     }
<span class="lineNum">    8021 </span><span class="lineNoCov">          0 :     for(int ii=Z;ii--&gt;0;){</span>
<span class="lineNum">    8022 </span><span class="lineNoCov">          0 :       int i=prey[ii];</span>
<span class="lineNum">    8023 </span><span class="lineNoCov">          0 :       double pre_k_i=precomputed[k].c[i];</span>
<span class="lineNum">    8024 </span><span class="lineNoCov">          0 :       if(adjust_prey_similarity_width){</span>
<span class="lineNum">    8025 </span><span class="lineNoCov">          0 :         for(int jj=ii+1;jj--&gt;0;){</span>
<span class="lineNum">    8026 </span><span class="lineNoCov">          0 :           int j=prey[jj];</span>
<span class="lineNum">    8027 </span><span class="lineNoCov">          0 :           double entry=pre_k_i*</span>
<span class="lineNum">    8028 </span><span class="lineNoCov">          0 :             precomputed[k].c[j]*</span>
<span class="lineNum">    8029 </span><span class="lineNoCov">          0 :             s(i).switching_similarity_to(s(j),s(k).prey_similarity_width());</span>
<span class="lineNum">    8030 </span><span class="lineNoCov">          0 :           if(entry &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8031 </span><span class="lineNoCov">          0 :             precomputed[k].csc_eating[i][j]=entry;</span>
<span class="lineNum">    8032 </span><span class="lineNoCov">          0 :             precomputed[i].csc_being_eaten[j][k]=entry;</span>
<span class="lineNum">    8033 </span><span class="lineNoCov">          0 :             precomputed[j].csc_being_eaten[i][k]=entry;</span>
<span class="lineNum">    8034 </span>            :           }
<span class="lineNum">    8035 </span>            :         }
<span class="lineNum">    8036 </span>            :       }else{
<span class="lineNum">    8037 </span><span class="lineNoCov">          0 :         for(int jj=ii+1;jj--&gt;0;){</span>
<span class="lineNum">    8038 </span><span class="lineNoCov">          0 :           int j=prey[jj];</span>
<span class="lineNum">    8039 </span><span class="lineNoCov">          0 :           double entry=pre_k_i*</span>
<span class="lineNum">    8040 </span><span class="lineNoCov">          0 :             precomputed[k].c[j]*</span>
<span class="lineNum">    8041 </span><span class="lineNoCov">          0 :             similarity[i][j];</span>
<span class="lineNum">    8042 </span><span class="lineNoCov">          0 :           if(entry &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8043 </span><span class="lineNoCov">          0 :             precomputed[k].csc_eating[i][j]=entry;</span>
<span class="lineNum">    8044 </span><span class="lineNoCov">          0 :             precomputed[i].csc_being_eaten[j][k]=entry;</span>
<span class="lineNum">    8045 </span><span class="lineNoCov">          0 :             precomputed[j].csc_being_eaten[i][k]=entry;</span>
<span class="lineNum">    8046 </span>            :           }
<span class="lineNum">    8047 </span>            :         }
<span class="lineNum">    8048 </span>            :       }
<span class="lineNum">    8049 </span>            :     }
<span class="lineNum">    8050 </span>            :   }
<span class="lineNum">    8051 </span>            : }
<span class="lineNum">    8052 </span>            : 
<a name="8053"><span class="lineNum">    8053 </span>            : </a>
<span class="lineNum">    8054 </span>            : NewWeb::precomputed_t &amp; 
<span class="lineNum">    8055 </span><span class="lineNoCov">          0 : NewWeb::precomputed_t::operator=(const NewWeb::precomputed_t &amp; other){</span>
<span class="lineNum">    8056 </span><span class="lineNoCov">          0 :   if (this != &amp;other){</span>
<span class="lineNum">    8057 </span>            :     // first, sloppy resize
<span class="lineNum">    8058 </span>            :     // instead of resize(size), do the following:
<span class="lineNum">    8059 </span><span class="lineNoCov">          0 :     while(size() &lt; other.size()){</span>
<span class="lineNum">    8060 </span><span class="lineNoCov">          0 :       push_back(new precomputed_entry_t());</span>
<span class="lineNum">    8061 </span>            :     }
<span class="lineNum">    8062 </span><span class="lineNoCov">          0 :     while(size() &gt; other.size()){</span>
<span class="lineNum">    8063 </span><span class="lineNoCov">          0 :       delete pop_back();</span>
<span class="lineNum">    8064 </span>            :     }
<span class="lineNum">    8065 </span>            : 
<span class="lineNum">    8066 </span>            :     // now, copy elementwise;
<span class="lineNum">    8067 </span><span class="lineNoCov">          0 :     copy(other.begin(),other.end(),begin());</span>
<span class="lineNum">    8068 </span>            :   }
<span class="lineNum">    8069 </span><span class="lineNoCov">          0 :   return *this;</span>
<a name="8070"><span class="lineNum">    8070 </span>            : }</a>
<span class="lineNum">    8071 </span>            : 
<span class="lineNum">    8072 </span><span class="lineNoCov">          0 : NewWeb::precomputed_t::precomputed_t(const precomputed_t &amp; other){</span>
<span class="lineNum">    8073 </span><span class="lineNoCov">          0 :   for(precomputed_container_t::const_iterator i=other.begin();</span>
<span class="lineNum">    8074 </span><span class="lineNoCov">          0 :       i!=other.end();</span>
<span class="lineNum">    8075 </span>            :       ++i){
<span class="lineNum">    8076 </span><span class="lineNoCov">          0 :     push_back(new precomputed_entry_t(*i));</span>
<span class="lineNum">    8077 </span>            :   }
<a name="8078"><span class="lineNum">    8078 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">    8079 </span>            : 
<span class="lineNum">    8080 </span><span class="lineCov">        270 : NewWeb::precomputed_t::~precomputed_t(){</span>
<span class="lineNum">    8081 </span><span class="lineCov">        180 :   while(size() &gt; 0){</span>
<span class="lineNum">    8082 </span><span class="lineNoCov">          0 :     delete pop_back();</span>
<span class="lineNum">    8083 </span>            :   }
<a name="8084"><span class="lineNum">    8084 </span><span class="lineCov">         90 : }</span></a>
<span class="lineNum">    8085 </span>            : 
<span class="lineNum">    8086 </span><span class="lineCov">      10098 : void NewWeb::precomputed_t::resize(int size,species_list_t &amp;s){</span>
<span class="lineNum">    8087 </span>            :   // for convenience:
<span class="lineNum">    8088 </span><span class="lineCov">      10098 :   precomputed_container_t &amp; pre=*this;</span>
<span class="lineNum">    8089 </span>            : 
<span class="lineNum">    8090 </span>            :   // instead of pre.resize(size), do the following:
<span class="lineNum">    8091 </span>            :   ASSERT(size &gt;= 0);
<span class="lineNum">    8092 </span><span class="lineCov">     128734 :   while(pre.size() &lt; size){</span>
<span class="lineNum">    8093 </span><span class="lineCov">     118636 :     pre.push_back(new precomputed_entry_t());</span>
<span class="lineNum">    8094 </span>            :   }
<span class="lineNum">    8095 </span><span class="lineCov">     119934 :   while(pre.size() &gt; size){</span>
<span class="lineNum">    8096 </span><span class="lineCov">     109836 :     delete pre.pop_back();</span>
<span class="lineNum">    8097 </span>            :   }
<span class="lineNum">    8098 </span>            : 
<span class="lineNum">    8099 </span><span class="lineCov">    1029300 :   for(int i=size;i--&gt;0;){</span>
<span class="lineNum">    8100 </span><span class="lineCov">    2038404 :     precomputed_entry_t &amp; pre_i=pre[i];</span>
<span class="lineNum">    8101 </span><span class="lineCov">    1019202 :     pre_i.c.resize(size);</span>
<span class="lineNum">    8102 </span><span class="lineCov">    1019202 :     if(do_switching){</span>
<span class="lineNum">    8103 </span><span class="lineNoCov">          0 :       pre_i.csc_eating.resize(size);</span>
<span class="lineNum">    8104 </span><span class="lineNoCov">          0 :       pre_i.csc_being_eaten.resize(size);</span>
<span class="lineNum">    8105 </span>            :     }else{
<span class="lineNum">    8106 </span><span class="lineCov">    1019202 :       pre_i.cT.resize(size);</span>
<span class="lineNum">    8107 </span>            :     }
<span class="lineNum">    8108 </span>            :   }
<a name="8109"><span class="lineNum">    8109 </span><span class="lineCov">      10098 : }</span></a>
<span class="lineNum">    8110 </span>            :  
<span class="lineNum">    8111 </span><span class="lineCov">         90 : void NewWeb::precomputed_t::update(int at,species_list_t &amp;s){</span>
<span class="lineNum">    8112 </span>            :   ASSERT(at&lt;s.size());
<span class="lineNum">    8113 </span>            : 
<span class="lineNum">    8114 </span>            :   // for convenience:
<span class="lineNum">    8115 </span><span class="lineCov">         90 :   precomputed_container_t &amp; pre=*this;</span>
<span class="lineNum">    8116 </span><span class="lineCov">        180 :   precomputed_entry_t &amp; pre_at=pre[at];</span>
<span class="lineNum">    8117 </span><span class="lineCov">        180 :   NewSpecies &amp; s_at=s[at];</span>
<span class="lineNum">    8118 </span>            : 
<span class="lineNum">    8119 </span><span class="lineCov">        180 :   pre_at.c.clear();</span>
<span class="lineNum">    8120 </span><span class="lineCov">        180 :   pre_at.cT.clear();</span>
<span class="lineNum">    8121 </span><span class="lineCov">        180 :   pre_at.csc_eating.clear();</span>
<span class="lineNum">    8122 </span><span class="lineCov">        180 :   pre_at.csc_being_eaten.clear();</span>
<span class="lineNum">    8123 </span>            : 
<span class="lineNum">    8124 </span><span class="lineCov">         90 :   double matrix_truncation_epsilon=SortedMatrix().truncation_epsilon();</span>
<span class="lineNum">    8125 </span><span class="lineCov">        270 :   vector&lt; int &gt; prey(s.size()); // list of prey of at</span>
<span class="lineNum">    8126 </span><span class="lineCov">        270 :   vector&lt; int &gt; predator(s.size()); // list of prey of at</span>
<span class="lineNum">    8127 </span><span class="lineCov">         90 :   int GEN=0;</span>
<span class="lineNum">    8128 </span><span class="lineCov">         90 :   int VUL=0;</span>
<span class="lineNum">    8129 </span>            : 
<span class="lineNum">    8130 </span>            :   // Now, do the sorted vectors first.  We remember prey and predators:
<span class="lineNum">    8131 </span><span class="lineCov">         90 :   double vector_truncation_epsilon=SortedVector().truncation_epsilon();</span>
<span class="lineNum">    8132 </span><span class="lineCov">         90 :   if(at&lt;s.n_animals){</span>
<span class="lineNum">    8133 </span><span class="lineCov">        180 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    8134 </span>            :       double c=
<span class="lineNum">    8135 </span><span class="lineCov">      70776 :         pre_at.c[i]=s_at.foraging_strength_c_on(s[i]);</span>
<span class="lineNum">    8136 </span>            : 
<span class="lineNum">    8137 </span>            :       // if(i&gt;=s.n_animals){
<span class="lineNum">    8138 </span>            :       //        for(int k=100000;k--&gt;0;){
<span class="lineNum">    8139 </span>            :       //          NewSpecies p=NewSpecies(NewSpecies::plant);
<span class="lineNum">    8140 </span>            :       //          NewSpecies a=NewSpecies(NewSpecies::animal);
<span class="lineNum">    8141 </span>            :       //          p.set_unique_id();
<span class="lineNum">    8142 </span>            :       //          a.set_unique_id();
<span class="lineNum">    8143 </span>            :       //          //double c=a.foraging_strength_c_on(p);
<span class="lineNum">    8144 </span>            :       //          double lnc=a.log_niche_matching(p);
<span class="lineNum">    8145 </span>            :       //          REPORT(c);
<span class="lineNum">    8146 </span>            :       //          static average_meter lna;
<span class="lineNum">    8147 </span>            :       //          lna.sample(lnc);
<span class="lineNum">    8148 </span>            :       //          REPORT(lna);
<span class="lineNum">    8149 </span>            :       //          REPORT(lna.std());
<span class="lineNum">    8150 </span>            :       //        }
<span class="lineNum">    8151 </span>            :       // }
<span class="lineNum">    8152 </span>            : 
<span class="lineNum">    8153 </span>            : 
<span class="lineNum">    8154 </span><span class="lineCov">      17694 :       if(do_switching){</span>
<span class="lineNum">    8155 </span><span class="lineNoCov">          0 :         if(c &gt; matrix_truncation_epsilon ){</span>
<span class="lineNum">    8156 </span><span class="lineNoCov">          0 :           prey[GEN++]=i;</span>
<span class="lineNum">    8157 </span>            :         }
<span class="lineNum">    8158 </span>            :       }else{
<span class="lineNum">    8159 </span><span class="lineCov">      70776 :         pre[i].cT[at]=c;</span>
<span class="lineNum">    8160 </span>            :       }
<span class="lineNum">    8161 </span>            :     }
<span class="lineNum">    8162 </span>            :   }else{
<span class="lineNum">    8163 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;s.n_animals;){</span>
<span class="lineNum">    8164 </span><span class="lineNoCov">          0 :       pre[i].c[at]=s[i].plant_hampering_by(s_at);</span>
<span class="lineNum">    8165 </span><span class="lineNoCov">          0 :       pre_at.c[i]=s_at.plant_hampering_by(s[i]);</span>
<span class="lineNum">    8166 </span>            :     }
<span class="lineNum">    8167 </span>            :   }
<span class="lineNum">    8168 </span><span class="lineCov">         90 :   for(int k=s.n_animals;k--&gt;0;){</span>
<span class="lineNum">    8169 </span>            :     double c=
<span class="lineNum">    8170 </span><span class="lineCov">      31925 :       pre[k].c[at]=s[k].foraging_strength_c_on(s_at);</span>
<span class="lineNum">    8171 </span><span class="lineCov">       6385 :     if(do_switching){</span>
<span class="lineNum">    8172 </span><span class="lineNoCov">          0 :       if(c &gt; matrix_truncation_epsilon ){</span>
<span class="lineNum">    8173 </span><span class="lineNoCov">          0 :         predator[VUL++]=k;</span>
<span class="lineNum">    8174 </span>            :       }
<span class="lineNum">    8175 </span>            :     }else{
<span class="lineNum">    8176 </span><span class="lineCov">      19155 :       pre_at.cT[k]=c;</span>
<span class="lineNum">    8177 </span>            :     }
<span class="lineNum">    8178 </span>            :   }
<span class="lineNum">    8179 </span>            : 
<span class="lineNum">    8180 </span><span class="lineCov">         90 :   if(!do_switching)</span>
<span class="lineNum">    8181 </span><span class="lineCov">         90 :     return;</span>
<span class="lineNum">    8182 </span>            : 
<span class="lineNum">    8183 </span>            :   // Now, do the sorted matrices, and do them smart:
<span class="lineNum">    8184 </span><span class="lineNoCov">          0 :   for(int ii=GEN;ii--&gt;0;){</span>
<span class="lineNum">    8185 </span><span class="lineNoCov">          0 :     int i=prey[ii];</span>
<span class="lineNum">    8186 </span><span class="lineNoCov">          0 :     double pre_i=pre_at.c[i];</span>
<span class="lineNum">    8187 </span><span class="lineNoCov">          0 :     for(int jj=ii+1;jj--&gt;0;){</span>
<span class="lineNum">    8188 </span><span class="lineNoCov">          0 :       int j=prey[jj];</span>
<span class="lineNum">    8189 </span><span class="lineNoCov">          0 :       double entry=pre_i*</span>
<span class="lineNum">    8190 </span><span class="lineNoCov">          0 :         pre_at.c[j]*</span>
<span class="lineNum">    8191 </span><span class="lineNoCov">          0 :         s[i].switching_similarity_to(s[j],s_at.prey_similarity_width());</span>
<span class="lineNum">    8192 </span><span class="lineNoCov">          0 :       if(entry &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8193 </span><span class="lineNoCov">          0 :         pre_at.csc_eating[i][j]=entry;</span>
<span class="lineNum">    8194 </span><span class="lineNoCov">          0 :         pre[i].csc_being_eaten[j][at]=entry;</span>
<span class="lineNum">    8195 </span><span class="lineNoCov">          0 :         pre[j].csc_being_eaten[i][at]=entry;</span>
<span class="lineNum">    8196 </span>            :       }
<span class="lineNum">    8197 </span>            :     }
<span class="lineNum">    8198 </span>            :   }
<span class="lineNum">    8199 </span><span class="lineNoCov">          0 :   for(int kk=VUL;kk--&gt;0;){</span>
<span class="lineNum">    8200 </span><span class="lineNoCov">          0 :     int k=predator[kk];</span>
<span class="lineNum">    8201 </span><span class="lineNoCov">          0 :     double pre_k_at=pre[k].c[at];</span>
<span class="lineNum">    8202 </span><span class="lineNoCov">          0 :     for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    8203 </span><span class="lineNoCov">          0 :       double pre_k_i=pre[k].c[i];</span>
<span class="lineNum">    8204 </span><span class="lineNoCov">          0 :       if(pre_k_i &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8205 </span>            :         double entry=
<span class="lineNum">    8206 </span><span class="lineNoCov">          0 :           pre_k_i*pre_k_at*</span>
<span class="lineNum">    8207 </span><span class="lineNoCov">          0 :           s[i].switching_similarity_to(s_at,s(k).prey_similarity_width());</span>
<span class="lineNum">    8208 </span><span class="lineNoCov">          0 :         if(entry &gt; matrix_truncation_epsilon){</span>
<span class="lineNum">    8209 </span><span class="lineNoCov">          0 :           pre[k].csc_eating[i][at]=entry;</span>
<span class="lineNum">    8210 </span><span class="lineNoCov">          0 :           pre[i].csc_being_eaten[at][k]=entry;</span>
<span class="lineNum">    8211 </span><span class="lineNoCov">          0 :           pre_at.csc_being_eaten[i][k]=entry;</span>
<span class="lineNum">    8212 </span>            :         }
<span class="lineNum">    8213 </span>            :       }
<span class="lineNum">    8214 </span>            :     }
<span class="lineNum">    8215 </span>            :   }
<a name="8216"><span class="lineNum">    8216 </span>            : }</a>
<span class="lineNum">    8217 </span>            :  
<span class="lineNum">    8218 </span><span class="lineCov">        194 : void NewWeb::precomputed_t::move(int from,int to,species_list_t &amp;s){</span>
<span class="lineNum">    8219 </span>            :   // We can now be sure that move deletes all value assigned to the
<span class="lineNum">    8220 </span>            :   // &quot;from&quot; index, so we do not need to set value to zero in
<span class="lineNum">    8221 </span>            :   // update(...) anymore.
<span class="lineNum">    8222 </span>            : 
<span class="lineNum">    8223 </span>            :   // for convenience:
<span class="lineNum">    8224 </span><span class="lineCov">        194 :   precomputed_container_t &amp; pre=*this;</span>
<span class="lineNum">    8225 </span><span class="lineCov">        388 :   precomputed_entry_t &amp; pre_from=pre[from];</span>
<span class="lineNum">    8226 </span>            : 
<span class="lineNum">    8227 </span><span class="lineCov">        388 :   pre[to]=pre_from;</span>
<span class="lineNum">    8228 </span><span class="lineCov">        388 :   pre_from.c.clear();</span>
<span class="lineNum">    8229 </span><span class="lineCov">        388 :   pre_from.cT.clear();</span>
<span class="lineNum">    8230 </span><span class="lineCov">        388 :   pre_from.csc_eating.clear();</span>
<span class="lineNum">    8231 </span><span class="lineCov">        388 :   pre_from.csc_being_eaten.clear();</span>
<span class="lineNum">    8232 </span>            : 
<span class="lineNum">    8233 </span><span class="lineCov">      38368 :   for(int i=s.size();i--&gt;0;){</span>
<span class="lineNum">    8234 </span><span class="lineCov">      75960 :     precomputed_entry_t &amp; pre_i=pre[i];</span>
<span class="lineNum">    8235 </span><span class="lineCov">      37980 :     pre_i.c.move(from,to);</span>
<span class="lineNum">    8236 </span><span class="lineCov">      37980 :     pre_i.cT.move(from,to);</span>
<span class="lineNum">    8237 </span><span class="lineCov">      37980 :     pre_i.csc_eating.move(from,to);</span>
<span class="lineNum">    8238 </span><span class="lineCov">      37980 :     pre_i.csc_being_eaten.move(from,to);</span>
<span class="lineNum">    8239 </span>            :   }
<a name="8240"><span class="lineNum">    8240 </span><span class="lineCov">        194 : }</span></a>
<a name="8241"><span class="lineNum">    8241 </span>            : </a>
<span class="lineNum">    8242 </span><span class="lineNoCov">          0 : NewWeb::saved_state::saved_state():t(0){};</span>
<span class="lineNum">    8243 </span><span class="lineCov">      21238 : NewWeb::saved_state::</span>
<a name="8244"><span class="lineNum">    8244 </span>            : saved_state(double tt,const vector_with_max &amp; B,const vector_with_max &amp;cf):</a>
<span class="lineNum">    8245 </span><span class="lineCov">      63714 :   t(tt),biomass_B(B),common_factor(cf){};</span>
<span class="lineNum">    8246 </span><span class="lineNoCov">          0 : NewWeb::saved_state::</span>
<span class="lineNum">    8247 </span>            : saved_state(const saved_state &amp; s):
<a name="8248"><span class="lineNum">    8248 </span><span class="lineNoCov">          0 :   t(s.t),biomass_B(s.biomass_B),common_factor(s.common_factor){};</span></a>
<span class="lineNum">    8249 </span>            : 
<span class="lineNum">    8250 </span><span class="lineCov">         90 : int number_of_CPUs(){</span>
<span class="lineNum">    8251 </span>            :   int number_of_cpus;
<span class="lineNum">    8252 </span>            : #ifdef _SC_NPROCESSORS_ONLN
<span class="lineNum">    8253 </span><span class="lineCov">         90 :   number_of_cpus = sysconf(_SC_NPROCESSORS_ONLN); </span>
<span class="lineNum">    8254 </span>            : #elif defined(HW_NCPU)
<span class="lineNum">    8255 </span>            :   {
<span class="lineNum">    8256 </span>            :     int mib[2];
<span class="lineNum">    8257 </span>            :     size_t len;
<span class="lineNum">    8258 </span>            : 
<span class="lineNum">    8259 </span>            :     mib[0] = CTL_HW;
<span class="lineNum">    8260 </span>            :     mib[1] = HW_NCPU;
<span class="lineNum">    8261 </span>            :     len = sizeof(number_of_cpus);
<span class="lineNum">    8262 </span>            :     sysctl(mib, 2, &amp;number_of_cpus, &amp;len, NULL, 0);
<span class="lineNum">    8263 </span>            :   } 
<span class="lineNum">    8264 </span>            : #else
<span class="lineNum">    8265 </span>            :   WARNING(&quot;Could not detect number of CPUs.&quot;);
<span class="lineNum">    8266 </span>            :   number_of_cpus = 1;
<span class="lineNum">    8267 </span>            : #endif
<span class="lineNum">    8268 </span><span class="lineCov">        270 :   REPORT(number_of_cpus);</span>
<span class="lineNum">    8269 </span><span class="lineCov">         90 :   return number_of_cpus;</span>
<span class="lineNum">    8270 </span>            : }
<span class="lineNum">    8271 </span>            : 
<span class="lineNum">    8272 </span>            : #ifdef SET_CPU_AFFINITY
<span class="lineNum">    8273 </span>            : /* DEAD CODE (only needed with dead code below)
<span class="lineNum">    8274 </span>            : // kernel &lt; 2.6.19 does not have getcpu, so we need to work around:
<span class="lineNum">    8275 </span>            : #ifndef KERNEL_VERSION
<span class="lineNum">    8276 </span>            : #define KERNEL_VERSION(a,b,c) (((a) &lt;&lt; 16) + ((b) &lt;&lt; 8) + (c))
<span class="lineNum">    8277 </span>            : #endif
<span class="lineNum">    8278 </span>            : #ifndef LINUX_VERSION_CODE
<span class="lineNum">    8279 </span>            : #define LINUX_VERSION_CODE KERNEL_VERSION(0,0,0)
<span class="lineNum">    8280 </span>            : #endif
<span class="lineNum">    8281 </span>            : #if LINUX_VERSION_CODE &lt; KERNEL_VERSION(2,6,19)
<span class="lineNum">    8282 </span>            : #include &lt;sys/syscall.h&gt;
<span class="lineNum">    8283 </span>            : int getcpu(int * cpu_id, void*, void*){
<span class="lineNum">    8284 </span>            :   pid_t pid = syscall(SYS_getpid);
<span class="lineNum">    8285 </span>            :   std::stringstream stringbuffer;
<span class="lineNum">    8286 </span>            :   stringbuffer &lt;&lt; &quot;cat /proc/&quot; &lt;&lt; pid &lt;&lt; &quot;/stat | awk '{print $39}'&quot;;
<span class="lineNum">    8287 </span>            :   FILE* file = popen(stringbuffer.str().c_str(), &quot;r&quot;);
<span class="lineNum">    8288 </span>            :   if (fscanf(file, &quot;%d&quot;, cpu_id) == EOF){
<span class="lineNum">    8289 </span>            :     FATAL_ERROR(&quot;Could not find current cpu&quot;);
<span class="lineNum">    8290 </span>            :   }
<span class="lineNum">    8291 </span>            :   pclose(file);
<span class="lineNum">    8292 </span>            :   return 0;
<span class="lineNum">    8293 </span>            : }
<span class="lineNum">    8294 </span>            : #endif
<a name="8295"><span class="lineNum">    8295 </span>            :  END OF DEAD CODE */</a>
<span class="lineNum">    8296 </span>            :  
<span class="lineNum">    8297 </span><span class="lineCov">         45 : CPU_set_list_t find_my_CPUs(){</span>
<span class="lineNum">    8298 </span><span class="lineCov">         45 :   int n_cpus=number_of_CPUs();</span>
<span class="lineNum">    8299 </span><span class="lineCov">        135 :   vector&lt;int&gt; cpu_list(n_cpus);</span>
<span class="lineNum">    8300 </span>            : 
<span class="lineNum">    8301 </span><span class="lineCov">         45 :   bool CPUs_assigned=false;</span>
<span class="lineNum">    8302 </span>            : 
<span class="lineNum">    8303 </span>            :   /// First, use heuristics to find a good list of CPUs:
<span class="lineNum">    8304 </span><span class="lineCov">         90 :   if(getenv(&quot;PBS_VERSION&quot;) and</span>
<span class="lineNum">    8305 </span><span class="lineNoCov">          0 :      strlen(getenv(&quot;PBS_VERSION&quot;))&gt;=6 and</span>
<span class="lineNum">    8306 </span><span class="lineCov">         45 :      strncmp(getenv(&quot;PBS_VERSION&quot;),&quot;TORQUE&quot;,6) == 0 and</span>
<span class="lineNum">    8307 </span><span class="lineNoCov">          0 :      getenv(&quot;PBS_JOBID&quot;)){</span>
<span class="lineNum">    8308 </span>            :     // Looks like we can find the assigned CPU using a torque command:
<span class="lineNum">    8309 </span><span class="lineNoCov">          0 :     FILE * pipe=popen(&quot;qstat -f -1 ${PBS_JOBID}|grep exec_host&quot;,&quot;r&quot;);</span>
<span class="lineNum">    8310 </span><span class="lineNoCov">          0 :     ALWAYS_ASSERT(pipe!=0);</span>
<span class="lineNum">    8311 </span>            :     int i=0;
<span class="lineNum">    8312 </span><span class="lineNoCov">          0 :     while((!feof(pipe)) and !ferror(pipe) and i&lt;n_cpus){</span>
<span class="lineNum">    8313 </span><span class="lineNoCov">          0 :       char c=getc(pipe);</span>
<span class="lineNum">    8314 </span><span class="lineNoCov">          0 :       if(c == '/'){</span>
<span class="lineNum">    8315 </span><span class="lineNoCov">          0 :         fscanf(pipe,&quot;%i&quot;,&amp;cpu_list[i]);</span>
<span class="lineNum">    8316 </span><span class="lineNoCov">          0 :         ++i;</span>
<span class="lineNum">    8317 </span>            :       }
<span class="lineNum">    8318 </span><span class="lineNoCov">          0 :       ALWAYS_ASSERT(ferror(pipe)==0);</span>
<span class="lineNum">    8319 </span>            :     }
<span class="lineNum">    8320 </span><span class="lineNoCov">          0 :     cpu_list.resize(i);</span>
<span class="lineNum">    8321 </span>            : 
<span class="lineNum">    8322 </span>            :     CPUs_assigned=true;
<span class="lineNum">    8323 </span>            :   }
<span class="lineNum">    8324 </span>            :   /* DEAD CODE: COULD NOT MAKE THIS WORK 
<span class="lineNum">    8325 </span>            :    else{
<span class="lineNum">    8326 </span>            :     // Find free CPUs manually:
<span class="lineNum">    8327 </span>            :     cpu_set_t all_cpus;
<span class="lineNum">    8328 </span>            :     for(int i = 0;i&lt;n_cpus;++i){//try all cpus
<span class="lineNum">    8329 </span>            :       CPU_SET(i, &amp;all_cpus);
<span class="lineNum">    8330 </span>            :     }
<span class="lineNum">    8331 </span>            : 
<span class="lineNum">    8332 </span>            :     cpu_set_t try_these_cpus;
<span class="lineNum">    8333 </span>            :     cpu_set_t all_cpus;
<span class="lineNum">    8334 </span>            : 
<span class="lineNum">    8335 </span>            :     for(int i = 0;i&lt;n_cpus;++i){//try all cpus
<span class="lineNum">    8336 </span>            :       CPU_SET(i, &amp;all_cpus);
<span class="lineNum">    8337 </span>            :       CPU_SET(i, &amp;try_these_cpus);
<span class="lineNum">    8338 </span>            :     }
<span class="lineNum">    8339 </span>            :     // Now successively disallow those that we are using to prioritize those
<span class="lineNum">    8340 </span>            :     // that are available:
<span class="lineNum">    8341 </span>            :     int current_cpu;
<span class="lineNum">    8342 </span>            :     int i=0;
<span class="lineNum">    8343 </span>            :     while(true){
<span class="lineNum">    8344 </span>            :       getcpu(&amp;current_cpu,0,0);
<span class="lineNum">    8345 </span>            :       cpu_list[i++]=current_cpu;
<span class="lineNum">    8346 </span>            :       if(!CPU_ISSET(current_cpu, &amp;try_these_cpus)){
<span class="lineNum">    8347 </span>            :         FATAL_ERROR(&quot;Running on forbidden CPU&quot;);
<span class="lineNum">    8348 </span>            :       };
<span class="lineNum">    8349 </span>            :       if(i&gt;=n_cpus) break;
<span class="lineNum">    8350 </span>            :       CPU_CLR(current_cpu, &amp;try_these_cpus);
<span class="lineNum">    8351 </span>            :       if(sched_setaffinity(0, CPU_SETSIZE, &amp;try_these_cpus)){
<span class="lineNum">    8352 </span>            :         REPORT(EFAULT);
<span class="lineNum">    8353 </span>            :         REPORT(EINVAL);
<span class="lineNum">    8354 </span>            :         REPORT(EPERM);
<span class="lineNum">    8355 </span>            :         REPORT(ESRCH);
<span class="lineNum">    8356 </span>            :         FATAL_ERROR(&quot;Problem setting CPU affinity (errno=&quot; &lt;&lt; errno &lt;&lt;&quot;)&quot;);
<span class="lineNum">    8357 </span>            :       };
<span class="lineNum">    8358 </span>            :     }
<span class="lineNum">    8359 </span>            :     for(int i=0;i&lt;n_cpus-1;i++){
<span class="lineNum">    8360 </span>            :       getcpu(&amp;current_cpu,0,0);
<span class="lineNum">    8361 </span>            :       cpu_list[i]=current_cpu;
<span class="lineNum">    8362 </span>            :       if(!CPU_ISSET(current_cpu, &amp;try_these_cpus)){
<span class="lineNum">    8363 </span>            :         FATAL_ERROR(&quot;Running on forbidden CPU&quot;);
<span class="lineNum">    8364 </span>            :       }
<span class="lineNum">    8365 </span>            :       CPU_CLR(current_cpu,&amp;try_these_cpus);
<span class="lineNum">    8366 </span>            :       if(sched_setaffinity(0, CPU_SETSIZE, &amp;try_these_cpus)){
<span class="lineNum">    8367 </span>            :         FATAL_ERROR(&quot;Problem setting CPU affinity (errno=&quot; &lt;&lt; errno &lt;&lt;&quot;)&quot;);
<span class="lineNum">    8368 </span>            :       }
<span class="lineNum">    8369 </span>            :     }
<span class="lineNum">    8370 </span>            :     if(sched_setaffinity(0, CPU_SETSIZE, &amp;all_cpus)){
<span class="lineNum">    8371 </span>            :       FATAL_ERROR(&quot;Problem setting CPU affinity (errno=&quot; &lt;&lt; errno &lt;&lt;&quot;)&quot;);
<span class="lineNum">    8372 </span>            :     }
<span class="lineNum">    8373 </span>            :   }
<span class="lineNum">    8374 </span>            : END DEAD CODE */
<span class="lineNum">    8375 </span>            : 
<span class="lineNum">    8376 </span><span class="lineCov">        135 :   max_num_threads=min((int)cpu_list.size(),max_num_threads);</span>
<span class="lineNum">    8377 </span>            : 
<span class="lineNum">    8378 </span><span class="lineCov">         45 :   if(CPUs_assigned){</span>
<span class="lineNum">    8379 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;Assigned CPUs: &quot;;</span>
<span class="lineNum">    8380 </span><span class="lineNoCov">          0 :     for(int i=0;i&lt;cpu_list.size()-1;i++){</span>
<span class="lineNum">    8381 </span><span class="lineNoCov">          0 :       cout &lt;&lt; cpu_list[i] &lt;&lt; &quot;, &quot;;</span>
<span class="lineNum">    8382 </span>            :     }
<span class="lineNum">    8383 </span><span class="lineNoCov">          0 :     cout &lt;&lt; *cpu_list.rbegin() &lt;&lt; endl;</span>
<span class="lineNum">    8384 </span>            :   }
<span class="lineNum">    8385 </span>            : 
<span class="lineNum">    8386 </span>            :   // We need this if we could not assign cpus.
<span class="lineNum">    8387 </span>            :   cpu_set_t all_cpus;
<span class="lineNum">    8388 </span><span class="lineCov">        405 :   for(int i = 0;i&lt;n_cpus;++i){//try all cpus</span>
<span class="lineNum">    8389 </span><span class="lineCov">        180 :     CPU_SET(i, &amp;all_cpus);</span>
<span class="lineNum">    8390 </span>            :   }
<span class="lineNum">    8391 </span>            : 
<span class="lineNum">    8392 </span>            :   /// cpu_list is now an array filled with different cpu ids.  Now we
<span class="lineNum">    8393 </span>            :   /// have to convert these into (trivial) cpu sets.
<span class="lineNum">    8394 </span><span class="lineCov">        135 :   CPU_set_list_t cpus(cpu_list.size());</span>
<span class="lineNum">    8395 </span>            :     
<span class="lineNum">    8396 </span><span class="lineCov">        450 :   for(int i = 0;i&lt;cpus.size();++i){</span>
<span class="lineNum">    8397 </span><span class="lineCov">        360 :     CPU_ZERO(&amp;cpus[i]); // clear cpu set</span>
<span class="lineNum">    8398 </span><span class="lineCov">        180 :     if(CPUs_assigned){</span>
<span class="lineNum">    8399 </span><span class="lineNoCov">          0 :       CPU_SET(cpu_list[i], &amp;cpus[i]);</span>
<span class="lineNum">    8400 </span>            :     }else{
<span class="lineNum">    8401 </span><span class="lineCov">        360 :       memcpy(&amp;cpus[i],&amp;all_cpus,sizeof(cpu_set_t));</span>
<span class="lineNum">    8402 </span>            :     }
<span class="lineNum">    8403 </span>            :   }
<span class="lineNum">    8404 </span>            : 
<a name="8405"><span class="lineNum">    8405 </span><span class="lineCov">        225 :   REPORT(CPUs_assigned);</span></a>
<span class="lineNum">    8406 </span><span class="lineCov">         45 :   return cpus;</span>
<span class="lineNum">    8407 </span><span class="lineCov">        135 : }</span>
<span class="lineNum">    8408 </span>            : #endif
<span class="lineNum">    8409 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
