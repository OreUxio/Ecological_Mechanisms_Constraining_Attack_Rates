<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - NewWeb.info - build/Inspect.cc</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">build</a> - Inspect.cc<span style="font-size: 80%;"> (source / <a href="Inspect.cc.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">NewWeb.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">263</td>
            <td class="headerCovTableEntry">679</td>
            <td class="headerCovTableEntryLo">38.7 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2018-05-14 13:23:03</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">5</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntryLo">62.5 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : // $Id: Inspect.cc 2489 2016-12-21 13:31:36Z axel $</a>
<span class="lineNum">       2 </span>            : #include &lt;string&gt;
<span class="lineNum">       3 </span><span class="lineCov">        135 : std::string version(&quot;$Revision: 2489 $&quot;);</span>
<span class="lineNum">       4 </span>            : 
<span class="lineNum">       5 </span>            : extern std::string compilation_time;
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            : #include &lt;signal.h&gt;
<span class="lineNum">       8 </span>            : #include &lt;iostream&gt;
<span class="lineNum">       9 </span>            : #include &lt;sstream&gt;
<span class="lineNum">      10 </span>            : #include &lt;iomanip&gt;
<span class="lineNum">      11 </span>            : #include &lt;cstdlib&gt;
<span class="lineNum">      12 </span>            : #include &lt;ctime&gt;
<span class="lineNum">      13 </span>            : // to_string example
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : 
<span class="lineNum">      16 </span>            : //#define DO_FPE  // do floating point exceptions
<span class="lineNum">      17 </span>            : #ifdef DO_FPE
<span class="lineNum">      18 </span>            : #ifdef __GNUC__
<span class="lineNum">      19 </span>            : #include &lt;fenv.h&gt;  // floating point exceptions
<span class="lineNum">      20 </span>            : #endif
<span class="lineNum">      21 </span>            : #ifdef SX
<span class="lineNum">      22 </span>            : #include &lt;ieeefp.h&gt;  // floating point exceptions
<span class="lineNum">      23 </span>            : #endif
<span class="lineNum">      24 </span>            : #endif
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &quot;NewSpecies.h&quot;
<span class="lineNum">      27 </span>            : #include &quot;parsecfg.h&quot; // include this header file when use parsecfg lib
<span class="lineNum">      28 </span>            : #include &quot;error.h&quot;    // my error handlers
<span class="lineNum">      29 </span>            : #include &quot;XMLStore.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;cfgPermanent.h&quot;
<span class="lineNum">      31 </span>            : #include &quot;matrix_transformers.h&quot;
<span class="lineNum">      32 </span>            : #include &quot;standardize.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;nls_web.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;random.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;time_average.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;tlf.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;snapshot.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;perturb.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;relax.h&quot;
<span class="lineNum">      40 </span>            : #include &quot;three_column_files.h&quot;
<span class="lineNum">      41 </span>            : #include &quot;mass_integrator.h&quot;
<span class="lineNum">      42 </span>            : #include &quot;Integrator.h&quot;
<span class="lineNum">      43 </span>            : #include &quot;MSY.h&quot;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : #ifdef GET_INDIRECT_DEPENDENCIES
<span class="lineNum">      47 </span>            : #include &quot;Statistics.h&quot;
<span class="lineNum">      48 </span>            : #include &quot;NewWeb.h&quot;
<span class="lineNum">      49 </span>            : #include &quot;evaluate.h&quot;
<span class="lineNum">      50 </span>            : //#include &quot;linpack_eigen.h&quot;
<span class="lineNum">      51 </span>            : #include &quot;period_cutter.h&quot;
<span class="lineNum">      52 </span>            : #include &quot;xy_graph.h&quot;
<span class="lineNum">      53 </span>            : #include &quot;hotspots.h&quot;
<span class="lineNum">      54 </span>            : #include &quot;polyfit.h&quot;
<span class="lineNum">      55 </span>            : #include &quot;packed_simulation.h&quot;
<span class="lineNum">      56 </span>            : #ifdef TRY_ASSEMBLER_CODE
<span class="lineNum">      57 </span>            : #include &quot;packed_simulation_asm.h&quot;
<span class="lineNum">      58 </span>            : #endif
<span class="lineNum">      59 </span>            : #endif
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            : using namespace std;
<span class="lineNum">      62 </span><span class="lineCov">         45 : ofstream fitness_only;</span>
<span class="lineNum">      63 </span><span class="lineCov">         45 : ofstream interaction_matrix;</span>
<span class="lineNum">      64 </span><span class="lineCov">         45 : ofstream agg_for_matrix;</span>
<span class="lineNum">      65 </span><span class="lineCov">         45 : ofstream during_agg_for_matrix;</span>
<span class="lineNum">      66 </span><span class="lineCov">         45 : ofstream during_interaction_matrix;</span>
<span class="lineNum">      67 </span><span class="lineCov">         45 : ofstream during_agg_for_matrix1;</span>
<span class="lineNum">      68 </span><span class="lineCov">         45 : ofstream during_interaction_matrix1;</span>
<span class="lineNum">      69 </span><span class="lineCov">         45 : ofstream before_agg_for_matrix;</span>
<span class="lineNum">      70 </span><span class="lineCov">         45 : ofstream before_interaction_matrix;</span>
<span class="lineNum">      71 </span><span class="lineCov">         45 : ofstream after_agg_for_matrix;</span>
<span class="lineNum">      72 </span><span class="lineCov">         45 : ofstream after_interaction_matrix;</span>
<span class="lineNum">      73 </span><span class="lineCov">         45 : ofstream after_agg_for_matrix1;</span>
<span class="lineNum">      74 </span><span class="lineCov">         45 : ofstream after_interaction_matrix1;</span>
<span class="lineNum">      75 </span><span class="lineCov">         45 : ofstream biomass_interaction_matrix;</span>
<span class="lineNum">      76 </span><span class="lineCov">         45 : ofstream list_of_inserted_deleted_biomass_species_w;</span>
<span class="lineNum">      77 </span><span class="lineCov">         45 : ofstream list_of_inserted_deleted_biomass_species_ww;</span>
<span class="lineNum">      78 </span><span class="lineCov">         45 : ofstream list_of_inserted_deleted_biomass_species_www;</span>
<span class="lineNum">      79 </span>            : 
<span class="lineNum">      80 </span>            : static int random_seed=1;
<span class="lineNum">      81 </span>            : static int number_of_next_save=0;
<span class="lineNum">      82 </span>            : static double abundance_multiplier=1;
<span class="lineNum">      83 </span>            : static bool needs_flows=false;
<span class="lineNum">      84 </span>            : static int coldelS=0;
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span>            :  
<span class="lineNum">      87 </span>            : // Manage adjustable parameters:
<span class="lineNum">      88 </span>            : #include &quot;cfgList.h&quot;
<span class="lineNum">      89 </span>            : static cfgStruct cfg[] = 
<span class="lineNum">      90 </span>            : {
<span class="lineNum">      91 </span>            :   CFGINT(random_seed),
<span class="lineNum">      92 </span>            :   CFGINT(number_of_next_save),
<span class="lineNum">      93 </span>            :   CFGDOUBLE(abundance_multiplier),
<span class="lineNum">      94 </span>            :   CFGINT(coldelS),
<span class="lineNum">      95 </span>            :   {0, CFG_END, 0}
<span class="lineNum">      96 </span>            : };
<span class="lineNum">      97 </span><span class="lineCov">         45 : static cfg_add dummy(cfg);</span>
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : enum file_type_t {xml,nls,tlf,dot_web};
<a name="100"><span class="lineNum">     100 </span>            : static file_type_t file_type=xml;</a>
<span class="lineNum">     101 </span>            : 
<span class="lineNum">     102 </span><span class="lineCov">        540 : bool has_suffix(const char * suff,const char * filename){</span>
<span class="lineNum">     103 </span><span class="lineCov">        540 :   return 0==strcmp(suff,filename+strlen(filename)-strlen(suff));</span>
<span class="lineNum">     104 </span>            : }
<span class="lineNum">     105 </span>            : 
<span class="lineNum">     106 </span><span class="lineCov">         45 : static my_evaluator_t eval_now;</span>
<span class="lineNum">     107 </span>            : 
<span class="lineNum">     108 </span><span class="lineCov">        135 : static string in_file_name=&quot;&quot;;</span>
<span class="lineNum">     109 </span><span class="lineCov">        135 : static string web_file_name=&quot;&quot;;</span>
<span class="lineNum">     110 </span><span class="lineCov">        135 : static string dot_graph_file=&quot;&quot;;</span>
<span class="lineNum">     111 </span><span class="lineCov">        135 : static string pajek_graph_file=&quot;&quot;;</span>
<span class="lineNum">     112 </span>            : static bool use_c=false;
<span class="lineNum">     113 </span>            : static const double default_threshold_value=0.01;
<span class="lineNum">     114 </span>            : static double threshold_value=default_threshold_value;
<span class="lineNum">     115 </span>            : static bool print_properties=false;
<span class="lineNum">     116 </span><span class="lineCov">        135 : static string graph_file_name=&quot;graph.eps&quot;;</span>
<span class="lineNum">     117 </span>            : static bool standardized=false;
<span class="lineNum">     118 </span>            : static bool lump=false;
<span class="lineNum">     119 </span>            : static bool print=false;
<span class="lineNum">     120 </span>            : static bool print_flows=false;
<span class="lineNum">     121 </span>            : static bool lump_lowest_level=false;
<span class="lineNum">     122 </span>            : static bool get_msy=false;
<span class="lineNum">     123 </span>            : static char* rank_abundance_plot=0;
<span class="lineNum">     124 </span>            : static char* size_spectrum_file=0;
<span class="lineNum">     125 </span>            : static char* strength_spectrum_file=0;
<span class="lineNum">     126 </span>            : static char* species_table=0;
<span class="lineNum">     127 </span>            : static char* species_table2=0;
<span class="lineNum">     128 </span>            : static char* species_table3=0;
<span class="lineNum">     129 </span>            : static char* link_table=0;
<span class="lineNum">     130 </span>            : static char* link_table2=0;
<span class="lineNum">     131 </span>            : static char* pgm_file=0;
<span class="lineNum">     132 </span>            : static char* eigenvalue_file=0;
<span class="lineNum">     133 </span>            : static char* generality_file=0;
<span class="lineNum">     134 </span>            : static char* biomass_spectrum_file=0;
<span class="lineNum">     135 </span>            : static char* vulnerability_file=0;
<span class="lineNum">     136 </span>            : static char* distance_file=0;
<span class="lineNum">     137 </span><span class="lineCov">         45 : static vector&lt; string &gt; assignments;</span>
<span class="lineNum">     138 </span>            : static bool print_insertion_count;
<span class="lineNum">     139 </span>            : static bool choose_other=false; // for debugging
<span class="lineNum">     140 </span>            : static double time_averaging_time=0;
<span class="lineNum">     141 </span>            : static bool fast_stats=false;
<span class="lineNum">     142 </span>            : static bool report_pressures=false;
<span class="lineNum">     143 </span>            : static int iterations_for_pressures=100;
<span class="lineNum">     144 </span>            : static double nls_area=0;
<span class="lineNum">     145 </span>            : static char* log_availability_structure_file=0;
<span class="lineNum">     146 </span>            : static char* rectification_base_name=0;
<span class="lineNum">     147 </span>            : static char* perturbation_type=0;
<span class="lineNum">     148 </span>            : static char* waiting_time=0;
<span class="lineNum">     149 </span>            : static char* writeback_file=0;
<span class="lineNum">     150 </span>            : static char* invasion_fitness_curve=0;
<span class="lineNum">     151 </span>            : static int fitness_samples=0;
<span class="lineNum">     152 </span>            : static char* link_coefficient_matrix_file=0;
<span class="lineNum">     153 </span>            : static char* competition_file=0;
<span class="lineNum">     154 </span>            : static bool print_indices=false;
<span class="lineNum">     155 </span>            : static double min_size_of_things_we_care_about=0;
<span class="lineNum">     156 </span>            : static bool jolly=false;
<span class="lineNum">     157 </span>            : static double mass_integral_start=0;
<span class="lineNum">     158 </span>            : static double mass_integral_start_LSI=0;
<span class="lineNum">     159 </span>            : static bool biodiv_indices_start=false;
<span class="lineNum">     160 </span>            : static double all_indices_start=0;
<span class="lineNum">     161 </span>            : static bool scale_flows=false;
<span class="lineNum">     162 </span>            : static bool rate_of_change_indices=false;
<span class="lineNum">     163 </span>            : static bool snap_to_fixed_point=false;
<span class="lineNum">     164 </span>            : static bool forbid_fishing=false;
<span class="lineNum">     165 </span>            : static char* fished_web_name=0;
<span class="lineNum">     166 </span>            : static bool enforce_equilibrium=false;
<span class="lineNum">     167 </span>            : static char* aggressivenes_file=0;
<span class="lineNum">     168 </span>            : //~ static bool aggressivenes_file=false;
<a name="169"><span class="lineNum">     169 </span>            : </a>
<span class="lineNum">     170 </span>            : 
<span class="lineNum">     171 </span><span class="lineNoCov">          0 : void do_inline_assignments(){</span>
<span class="lineNum">     172 </span><span class="lineCov">        135 :   do_assignments(assignments);</span>
<span class="lineNum">     173 </span><span class="lineNoCov">          0 : }</span>
<a name="174"><span class="lineNum">     174 </span>            : </a>
<span class="lineNum">     175 </span>            : 
<span class="lineNum">     176 </span><span class="lineNoCov">          0 : void print_usage(char ** argv,const char * formatstring){</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :   fprintf(stdout,&quot;usage: %s [options] foodweb_file\n\n\</span>
<span class="lineNum">     178 </span>            : options (some work only with special input file types):\n\
<span class="lineNum">     179 </span>            : -a [&lt;time&gt;]  : time average over non-constant states for at most &lt;time&gt;\n\
<span class="lineNum">     180 </span>            : -A &lt;area&gt;    : set area for SCOR files, e.g. \&quot;10*ha\&quot;\n\
<span class="lineNum">     181 </span>            : -b           : print connection matrix\n\
<span class="lineNum">     182 </span>            : -B &lt;filename&gt;: generate a biomass spectrum\n\
<span class="lineNum">     183 </span>            : -c           : use potential link strength rather than realized link strength\n\
<span class="lineNum">     184 </span>            : -C &lt;filename&gt;: output log availability structure to file\n\
<span class="lineNum">     185 </span>            : -d &lt;filename&gt;: generate a dot file for graphs\n\
<span class="lineNum">     186 </span>            : -D &lt;basename&gt;: write neighbors-within-distance curves to files ending in basename\n\
<span class="lineNum">     187 </span>            : -e           : output invasion fitness curve\n\
<span class="lineNum">     188 </span>            : -E &lt;filename&gt;: write eigenvalues of Jacobian ( * -1) to file\n\
<span class="lineNum">     189 </span>            : -f           : print strengths of connections\n\
<span class="lineNum">     190 </span>            : -F &lt;n&gt;       : strengths of evolutionary pressures using &lt;n&gt; iterations\n\
<span class="lineNum">     191 </span>            : -g [&lt;name&gt;]  : generate web graph (dysfunctional)\n\
<span class="lineNum">     192 </span>            : -G &lt;filename&gt;: write cumulative generality distribution to file\n\
<span class="lineNum">     193 </span>            : -H &lt;filename&gt;: generate a dat file to draw a food-web graph using Pajek\n\
<span class="lineNum">     194 </span>            : -i           : print the number of insertions into the web\n\
<span class="lineNum">     195 </span>            : -I           : print macroecological ecological indices\n\
<span class="lineNum">     196 </span>            : -I &lt;size&gt;    : restrict some indices to size larger than this\n\
<span class="lineNum">     197 </span>            : -j           : jolly: don't do things that are computationally heavy\n\
<span class="lineNum">     198 </span>            : -J           : write dynamics of variables related to rate of change of LFI, LSI and biodiv indices\n\
<span class="lineNum">     199 </span>            : -k &lt;assign&gt;  : assign value to parameter\n\
<span class="lineNum">     200 </span>            : -K &lt;filename&gt;: generate PGM image of competition matrix\n\
<span class="lineNum">     201 </span>            : -l           : lump lowest level\n\
<span class="lineNum">     202 </span>            : -L &lt;filename&gt;: generate a table of link properties\n\
<span class="lineNum">     203 </span>            : -m           : print some fast statistics (e.g. on bodymasses)\n\
<span class="lineNum">     204 </span>            : -M &lt;size&gt;    : write LFI dynamics with size as the threshold\n\
<span class="lineNum">     205 </span>            : -n &lt;filename&gt;: write link-strength matrix to file\n\
<span class="lineNum">     206 </span>            : -N &lt;size&gt;    : write LSI dynamics with size as the threshold\n\
<span class="lineNum">     207 </span>            : -o           : analyze state at fix point\n\
<span class="lineNum">     208 </span>            : -O           : write dynamics for biodiversity indices\n\
<span class="lineNum">     209 </span>            : -p           : compute and print topological properties\n\
<span class="lineNum">     210 </span>            : -P &lt;filename&gt;: generate a PGM file of the connection matrix\n\
<span class="lineNum">     211 </span>            : -q &lt;filename&gt;: generate link properties \n\
<span class="lineNum">     212 </span>            : -Q &lt;size&gt;    : write dynamics for LFI, LSI and biodiversity indices\n\
<span class="lineNum">     213 </span>            : -r &lt;filename&gt;: generate a rank-abundance plot (affected by -l)\n\
<span class="lineNum">     214 </span>            : -R &lt;filename&gt;: rectify the interaction matrix, write into various files\n\
<span class="lineNum">     215 </span>            : -s           : standardize topology\n\
<span class="lineNum">     216 </span>            : -S &lt;filename&gt;: write diet partitioning function (DPF) to file\n\
<span class="lineNum">     217 </span>            : -t &lt;value&gt;   : set threshold value for link assignment (default %g)\n\
<span class="lineNum">     218 </span>            : -T &lt;filename&gt;: generate a table of species properties (affected by -l)\n\
<span class="lineNum">     219 </span>            : -u &lt;filename&gt;: generate a table of properties for fish species, together with supporting tables (affected by -l)\n\
<span class="lineNum">     220 </span>            : -U &lt;filename&gt;: generate a table of properties for fish species, together with supporting tables (affected by -l)\n\
<span class="lineNum">     221 </span>            : -v           : print version information\n\
<span class="lineNum">     222 </span>            : -V &lt;filename&gt;: write cumulative vulnerability distribution to file\n\
<span class="lineNum">     223 </span>            : -w &lt;time&gt;    : wait &lt;time&gt; to relax before averaging\n\
<span class="lineNum">     224 </span>            : -W &lt;filename&gt;  write relaxed state to &lt;filename&gt;\n\
<span class="lineNum">     225 </span>            : -x           : lump trophic species for topology\n\
<span class="lineNum">     226 </span>            : -X &lt;type&gt;    : apply perturbation &lt;type&gt; before waiting and averaging\n\
<span class="lineNum">     227 </span>            :                (use type \&quot;help\&quot; for help on types)\n\
<span class="lineNum">     228 </span>            : -y           : Do MSY computation (experimental)\n\
<span class="lineNum">     229 </span>            : -Y           : divide flows by resource turnover rate before using\n\
<span class="lineNum">     230 </span>            : -z [&lt;ncpus&gt;] : user experimental core code (as -z in NewWorld)\n\
<span class="lineNum">     231 </span>            : -Z &lt;filename&gt;: generate a size spectrum\n\
<span class="lineNum">     232 </span>            : -0           : set fishing mortalities to zero\n\
<span class="lineNum">     233 </span>            : -3 &lt;n&gt;       : generate |n| samples of animal inv. fitness (n&lt;0 for plants)\n\
<span class="lineNum">     234 </span>            : -4           : enforce equilibrium state by adjusting turnover rates\n\
<span class="lineNum">     235 </span>            : -5 &lt;webfile&gt; : copy fishing mortalities from web file\n\
<span class="lineNum">     236 </span><span class="lineNoCov">          0 : &quot;,argv[0],double(default_threshold_value));</span>
<a name="237"><span class="lineNum">     237 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     238 </span>            : 
<span class="lineNum">     239 </span><span class="lineCov">         45 : void read_arguments(int argc,char *argv[]){</span>
<span class="lineNum">     240 </span>            :   int c;
<span class="lineNum">     241 </span>            :   const char * formatstring= 
<span class="lineNum">     242 </span><span class="lineCov">         45 :     &quot;k:K:Q:N:M:n:ma::B:E:L:q:G:V:P:T:u:U:D:ihvg::sxbfdH:ct:plr:Z:S:12yYA:C:R:X:w:W:I::jF:e:OoJz::3:05:4&quot;;</span>
<span class="lineNum">     243 </span>            : 
<span class="lineNum">     244 </span>            :   while(1){
<span class="lineNum">     245 </span><span class="lineCov">        135 :     c=getopt(argc, argv, formatstring);</span>
<span class="lineNum">     246 </span><span class="lineCov">        135 :     if (c == -1)</span>
<span class="lineNum">     247 </span>            :       break;
<span class="lineNum">     248 </span>            :     
<span class="lineNum">     249 </span><span class="lineCov">         90 :     switch(c){</span>
<span class="lineNum">     250 </span>            :     case 'v':
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :       printf(&quot;Main code version: %s\n&quot;,version.c_str());</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :       printf(&quot;Compilation time:  %s\n&quot;,compilation_time.c_str());</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :       printf(&quot;Copyright (C) 2007,2008 Axel G. Rossberg\n&quot;);</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :       printf(&quot;License GPL 3\n&quot;);</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :       exit(0);</span>
<span class="lineNum">     256 </span>            :       break;
<span class="lineNum">     257 </span>            :     case 'R':
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :       rectification_base_name=optarg;</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     261 </span>            :     case 's':
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :       standardized=true;</span>
<span class="lineNum">     263 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     264 </span>            :     case 'x':
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :       lump=true;</span>
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     267 </span>            :     case 'm':
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :       fast_stats=true;</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     270 </span>            :     case 'M':
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :       mass_integral_start=eval(optarg);</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     273 </span>            :     case 'N':
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :       mass_integral_start_LSI=eval(optarg);</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     276 </span>            :     case 'o':
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :       snap_to_fixed_point=true;</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     279 </span>            :     case 'O':
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :       biodiv_indices_start=true;</span>
<span class="lineNum">     281 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     282 </span>            :     case 'Q':
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :       all_indices_start=eval(optarg);</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     285 </span>            :     case 'J':
<span class="lineNum">     286 </span><span class="lineNoCov">          0 :       rate_of_change_indices=true;</span>
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     288 </span>            :     case 'l':
<span class="lineNum">     289 </span><span class="lineNoCov">          0 :       lump_lowest_level=true;</span>
<span class="lineNum">     290 </span><span class="lineNoCov">          0 :       break; </span>
<span class="lineNum">     291 </span>            :     case 'b':
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :       print=true;</span>
<span class="lineNum">     293 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     295 </span>            :     case 'y':
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :       get_msy=true;</span>
<span class="lineNum">     297 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     298 </span>            :     case 'Y':
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :       scale_flows=true;</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     302 </span>            :     case 'i':
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :       print_insertion_count=true;</span>
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     305 </span>            :     case 'I':
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :       print_indices=true;</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :       if(optarg)</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :         min_size_of_things_we_care_about=eval(optarg);</span>
<span class="lineNum">     310 </span>            :       break;
<span class="lineNum">     311 </span>            :     case 'j':
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :       jolly=true;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     314 </span>            :     case 'f':
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :       print_flows=true;</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     317 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     318 </span>            :     case 'F':
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :       report_pressures=true;</span>
<span class="lineNum">     320 </span><span class="lineNoCov">          0 :       iterations_for_pressures=eval(optarg);</span>
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     322 </span>            :     case 'P':
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :       pgm_file=optarg;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     326 </span>            :     case 'C':
<span class="lineNum">     327 </span><span class="lineNoCov">          0 :       log_availability_structure_file=optarg;</span>
<span class="lineNum">     328 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     329 </span>            :     case 'E':
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :       eigenvalue_file=optarg;</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     332 </span>            :     case 'e':
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :       invasion_fitness_curve=optarg;//(char *)&quot;*&quot;;</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     335 </span>            :     case 'G':
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :       generality_file=optarg;</span>
<span class="lineNum">     337 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     339 </span>            :     case 'V':
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :       vulnerability_file=optarg;</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     343 </span>            :     case 'd':
<span class="lineNum">     344 </span><span class="lineNoCov">          0 :       dot_graph_file=optarg;</span>
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     347 </span>            :     case 'r':
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :       rank_abundance_plot=optarg;</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     350 </span>            :     case 'Z':
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :       size_spectrum_file=optarg;</span>
<span class="lineNum">     352 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     353 </span>            :     case 'z':
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :       use_packed_simulation=true;</span>
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :       if(optarg){</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :         max_num_threads=atoi(optarg);</span>
<span class="lineNum">     357 </span>            :       }
<span class="lineNum">     358 </span>            :       break;
<span class="lineNum">     359 </span>            :     case 'B':
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :       biomass_spectrum_file=optarg;</span>
<span class="lineNum">     361 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     362 </span>            :     case 'D':
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :       distance_file=optarg;</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     365 </span>            :     case 'S':
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :       strength_spectrum_file=optarg;</span>
<span class="lineNum">     367 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     369 </span>            :     case 'K':
<span class="lineNum">     370 </span><span class="lineNoCov">          0 :       competition_file=optarg;</span>
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     372 </span>            :     case 'k':
<span class="lineNum">     373 </span><span class="lineCov">        180 :       assignments.push_back(optarg);</span>
<span class="lineNum">     374 </span><span class="lineCov">         45 :       break;</span>
<span class="lineNum">     375 </span>            :     case 'T':
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :       species_table=optarg;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     378 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     379 </span>            :     case 'u':
<span class="lineNum">     380 </span><span class="lineNoCov">          0 :       species_table2=optarg;</span>
<span class="lineNum">     381 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     383 </span>            :     case 'U':
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :       species_table3=optarg;</span>
<span class="lineNum">     385 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     386 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     387 </span>            :     case 'X':
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :       perturbation_type=optarg;</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     390 </span>            :     case 'w':
<span class="lineNum">     391 </span><span class="lineNoCov">          0 :       waiting_time=optarg;</span>
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     393 </span>            :     case 'W':
<span class="lineNum">     394 </span>            :       //~ writeback_file=optarg;
<span class="lineNum">     395 </span><span class="lineCov">         45 :       aggressivenes_file=optarg;</span>
<span class="lineNum">     396 </span><span class="lineCov">         45 :       needs_flows=true;</span>
<span class="lineNum">     397 </span><span class="lineCov">         45 :       break;</span>
<span class="lineNum">     398 </span>            :     case 'L':
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :       link_table=optarg;</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     402 </span>            :     case 'q':
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :       link_table2=optarg;</span>
<span class="lineNum">     404 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     405 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     406 </span>            :     case 'n': 
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :       link_coefficient_matrix_file=optarg;</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     409 </span>            :     case 'a':
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :       if(optarg)</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :         time_averaging_time=eval(optarg);</span>
<span class="lineNum">     412 </span>            :       else
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :         time_averaging_time=eval(&quot;1*year&quot;);</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :       REPORT(time_averaging_time);</span>
<span class="lineNum">     415 </span>            :       break;
<span class="lineNum">     416 </span>            :     case 'c':
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :       use_c=true;</span>
<span class="lineNum">     418 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     419 </span>            :     case 'p':
<span class="lineNum">     420 </span><span class="lineNoCov">          0 :       print_properties=true;</span>
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     423 </span>            :     case '5':
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :       fished_web_name=optarg;</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     426 </span>            :     case '4':
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :       enforce_equilibrium=true;</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     429 </span>            :     case '3':
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :       fitness_samples=atof(optarg);</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     432 </span>            :     case '2':
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :       choose_other=true;</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     435 </span>            :     case '1':
<span class="lineNum">     436 </span><span class="lineNoCov">          0 :       choose_other=false;</span>
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     438 </span>            :     case '0':
<span class="lineNum">     439 </span><span class="lineNoCov">          0 :       forbid_fishing=true;</span>
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     441 </span>            :     case 't':
<span class="lineNum">     442 </span><span class="lineNoCov">          0 :       threshold_value=atof(optarg);</span>
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     444 </span>            :     case 'A':
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :       nls_area=eval(optarg);</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     447 </span>            :     case 'H':
<span class="lineNum">     448 </span><span class="lineNoCov">          0 :       pajek_graph_file=optarg;</span>
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :       needs_flows=true;</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :       break;</span>
<span class="lineNum">     451 </span>            :     case 'h':
<span class="lineNum">     452 </span>            :     default:
<span class="lineNum">     453 </span><span class="lineNoCov">          0 :       print_usage(argv,formatstring);</span>
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :       exit(c=='h'?0:1);</span>
<span class="lineNum">     455 </span>            :     }
<span class="lineNum">     456 </span>            :   }
<span class="lineNum">     457 </span><span class="lineCov">         45 :   argc-=optind-1;</span>
<span class="lineNum">     458 </span><span class="lineCov">         45 :   argv+=optind-1;</span>
<span class="lineNum">     459 </span>            :   
<span class="lineNum">     460 </span><span class="lineCov">        135 :   while(argc&gt;1){</span>
<span class="lineNum">     461 </span><span class="lineCov">         45 :     if(has_suffix(&quot;.cfg&quot;,argv[1])){</span>
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :       in_file_name=argv[1];</span>
<span class="lineNum">     463 </span><span class="lineCov">        135 :     }else if(has_suffix(&quot;.dat&quot;,argv[1]) ||</span>
<span class="lineNum">     464 </span><span class="lineCov">         90 :              has_suffix(&quot;.DAT&quot;,argv[1]) ||</span>
<span class="lineNum">     465 </span><span class="lineCov">         90 :              has_suffix(&quot;.tlf&quot;,argv[1]) ||</span>
<span class="lineNum">     466 </span><span class="lineCov">         90 :              has_suffix(&quot;.web&quot;,argv[1]) ||</span>
<span class="lineNum">     467 </span><span class="lineCov">         90 :              has_suffix(&quot;.xml&quot;,argv[1]) ||</span>
<span class="lineNum">     468 </span><span class="lineCov">        135 :              has_suffix(&quot;.xml.gz&quot;,argv[1]) ||</span>
<span class="lineNum">     469 </span><span class="lineCov">         45 :              has_suffix(&quot;.xml.bz2&quot;,argv[1]) ){</span>
<span class="lineNum">     470 </span><span class="lineCov">         90 :       web_file_name=argv[1];</span>
<span class="lineNum">     471 </span><span class="lineCov">         45 :       if(has_suffix(&quot;.dat&quot;,argv[1])||has_suffix(&quot;.DAT&quot;,argv[1])){</span>
<span class="lineNum">     472 </span>            :         // SCOR files
<span class="lineNum">     473 </span><span class="lineNoCov">          0 :         file_type=nls;</span>
<span class="lineNum">     474 </span><span class="lineCov">         45 :       }else if(has_suffix(&quot;.tlf&quot;,argv[1])){</span>
<span class="lineNum">     475 </span>            :         // custom &quot;Tuesday Lake&quot; format 
<span class="lineNum">     476 </span><span class="lineNoCov">          0 :         file_type=tlf;</span>
<span class="lineNum">     477 </span><span class="lineCov">         45 :       }else if(has_suffix(&quot;.web&quot;,argv[1])){</span>
<span class="lineNum">     478 </span><span class="lineNoCov">          0 :         file_type=dot_web;</span>
<span class="lineNum">     479 </span>            :       }
<span class="lineNum">     480 </span>            :     }else
<span class="lineNum">     481 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;unknown file type: &quot; &lt;&lt; argv[1]);</span>
<span class="lineNum">     482 </span><span class="lineCov">         45 :     argv++;</span>
<span class="lineNum">     483 </span><span class="lineCov">         45 :     argc--;</span>
<span class="lineNum">     484 </span>            :   }
<span class="lineNum">     485 </span><span class="lineCov">         45 :   if(web_file_name.size()==0){</span>
<span class="lineNum">     486 </span><span class="lineNoCov">          0 :     print_usage(argv,formatstring);</span>
<span class="lineNum">     487 </span><span class="lineNoCov">          0 :     exit(1);</span>
<span class="lineNum">     488 </span>            :   }
<span class="lineNum">     489 </span><span class="lineCov">         45 : }</span>
<a name="490"><span class="lineNum">     490 </span>            : </a>
<span class="lineNum">     491 </span>            : 
<span class="lineNum">     492 </span><span class="lineNoCov">          0 : string order_of_magnitude(double x){</span>
<span class="lineNum">     493 </span><span class="lineNoCov">          0 :   int y=int(-log(x)/log(10.0));</span>
<span class="lineNum">     494 </span><span class="lineNoCov">          0 :   ostringstream s;</span>
<span class="lineNum">     495 </span><span class="lineNoCov">          0 :   if(y&gt;=6 || x==0){</span>
<span class="lineNum">     496 </span><span class="lineNoCov">          0 :     s &lt;&lt; &quot;.&quot;;</span>
<span class="lineNum">     497 </span><span class="lineNoCov">          0 :   }else if(y&lt;=-10){</span>
<span class="lineNum">     498 </span><span class="lineNoCov">          0 :     s &lt;&lt; &quot;X&quot;;</span>
<span class="lineNum">     499 </span>            :   }else{
<span class="lineNum">     500 </span><span class="lineNoCov">          0 :     s &lt;&lt; y;</span>
<span class="lineNum">     501 </span>            :   }
<span class="lineNum">     502 </span><span class="lineNoCov">          0 :   return s.str();</span>
<span class="lineNum">     503 </span>            : }    
<span class="lineNum">     504 </span>            : 
<span class="lineNum">     505 </span>            : extern &quot;C&quot; {
<span class="lineNum">     506 </span>            :   void openblas_set_num_threads(int num_threads);
<a name="507"><span class="lineNum">     507 </span>            : }</a>
<span class="lineNum">     508 </span>            : 
<span class="lineNum">     509 </span><span class="lineCov">         45 : int main(int argc,char *argv[]){</span>
<span class="lineNum">     510 </span><span class="lineCov">         45 :   std::set_new_handler(outOfMemory); </span>
<span class="lineNum">     511 </span><span class="lineCov">         45 :   signal_handling();</span>
<span class="lineNum">     512 </span>            : 
<span class="lineNum">     513 </span>            : #ifdef DO_FPE
<span class="lineNum">     514 </span>            :   // floating-point exceptions
<span class="lineNum">     515 </span>            : #ifdef __GNUC__
<span class="lineNum">     516 </span>            :   feenableexcept( 0 | FE_DIVBYZERO | FE_INVALID | FE_OVERFLOW ); 
<span class="lineNum">     517 </span>            : #endif
<span class="lineNum">     518 </span>            : #ifdef SX
<span class="lineNum">     519 </span>            :   fpsetmask(fpgetmask() | FP_X_DZ | FP_X_INV | FP_X_OFL );
<span class="lineNum">     520 </span>            : #endif
<span class="lineNum">     521 </span>            : #endif
<span class="lineNum">     522 </span>            : 
<span class="lineNum">     523 </span>            : #ifdef SET_CPU_AFFINITY 
<span class="lineNum">     524 </span><span class="lineCov">         45 :   max_num_threads=number_of_CPUs();</span>
<span class="lineNum">     525 </span>            : #endif
<span class="lineNum">     526 </span>            :   
<span class="lineNum">     527 </span><span class="lineCov">         45 :   read_arguments(argc,argv);</span>
<span class="lineNum">     528 </span>            : 
<span class="lineNum">     529 </span>            :   do_inline_assignments();
<span class="lineNum">     530 </span>            : 
<span class="lineNum">     531 </span>            : #ifdef SET_CPU_AFFINITY 
<span class="lineNum">     532 </span><span class="lineCov">         90 :   CPU_set_list = find_my_CPUs();//.. and restrict max_num_threads if required</span>
<span class="lineNum">     533 </span>            : #endif
<span class="lineNum">     534 </span>            : 
<span class="lineNum">     535 </span><span class="lineCov">         45 :   openblas_set_num_threads(max_num_threads);</span>
<span class="lineNum">     536 </span>            :   
<span class="lineNum">     537 </span>            :   // read parameter file for the first time:
<span class="lineNum">     538 </span><span class="lineCov">         45 :   set_cfg_parameter(&quot;DEFAULT_RELATIVE_TOLERANCE&quot;,&quot;0.001&quot;);</span>
<span class="lineNum">     539 </span><span class="lineCov">         45 :   if(in_file_name[0])</span>
<span class="lineNum">     540 </span><span class="lineNoCov">          0 :     if (cfgParse(in_file_name.c_str(), full_cfg_list(), CFG_SIMPLE) == -1)</span>
<span class="lineNum">     541 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;error reading parameter file&quot;);</span>
<span class="lineNum">     542 </span><span class="lineCov">        180 :   REPORT(random_seed);</span>
<span class="lineNum">     543 </span><span class="lineCov">         45 :   set_random_seed(random_seed);</span>
<span class="lineNum">     544 </span><span class="lineCov">         45 :   NewSpecies::initialize();</span>
<span class="lineNum">     545 </span>            :   
<span class="lineNum">     546 </span><span class="lineCov">         90 :   cfgPermanent parameters;</span>
<span class="lineNum">     547 </span><span class="lineCov">         90 :   NewWeb web,baseline_web;</span>
<span class="lineNum">     548 </span><span class="lineCov">         90 :   link_strength_matrix ls;</span>
<span class="lineNum">     549 </span><span class="lineCov">         90 :   sequence&lt;double&gt; biomass_B;</span>
<span class="lineNum">     550 </span>            : 
<span class="lineNum">     551 </span><span class="lineCov">         90 :   nls_web nlsweb;</span>
<span class="lineNum">     552 </span><span class="lineCov">         90 :   Snapshot web_data;</span>
<span class="lineNum">     553 </span>            :   
<span class="lineNum">     554 </span><span class="lineCov">         45 :   switch(file_type){</span>
<span class="lineNum">     555 </span>            :   case xml:
<span class="lineNum">     556 </span>            :     {// NewWeb simulation result
<span class="lineNum">     557 </span><span class="lineCov">         90 :       XMLStore store(web_file_name);</span>
<span class="lineNum">     558 </span><span class="lineCov">         45 :       store.get(&amp;parameters,&quot;adjustable_parameters&quot;);</span>
<span class="lineNum">     559 </span>            :       do_inline_assignments();
<span class="lineNum">     560 </span>            :       // read parameter file again to overwrite if desired!
<span class="lineNum">     561 </span><span class="lineCov">         45 :       if(in_file_name[0])</span>
<span class="lineNum">     562 </span><span class="lineNoCov">          0 :         if (cfgParse(in_file_name.c_str(), full_cfg_list(), CFG_SIMPLE) == -1)</span>
<span class="lineNum">     563 </span><span class="lineNoCov">          0 :           FATAL_ERROR(&quot;error reading parameter file&quot;);</span>
<span class="lineNum">     564 </span><span class="lineCov">        180 :       REPORT(random_seed);</span>
<span class="lineNum">     565 </span><span class="lineCov">         45 :       set_random_seed(random_seed);</span>
<span class="lineNum">     566 </span>            : 
<span class="lineNum">     567 </span><span class="lineCov">         45 :       if(store.older_than(&quot;Aug 1 2006, 14:45:21&quot;)){</span>
<span class="lineNum">     568 </span><span class="lineNoCov">          0 :         WARNING(&quot;input web is from old code,&quot;);</span>
<span class="lineNum">     569 </span><span class="lineNoCov">          0 :         WARNING(&quot;emulating carrying-capacity bug!&quot;);</span>
<span class="lineNum">     570 </span><span class="lineNoCov">          0 :         emulate_carrying_capacity_bug=1;</span>
<span class="lineNum">     571 </span>            :       }
<span class="lineNum">     572 </span><span class="lineCov">         45 :       if(store.older_than(&quot;Nov 7 2010, 13:30:00&quot;)){</span>
<span class="lineNum">     573 </span><span class="lineNoCov">          0 :         if(get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;)){</span>
<span class="lineNum">     574 </span><span class="lineNoCov">          0 :           WARNING(&quot;input web is from old code,&quot;);</span>
<span class="lineNum">     575 </span><span class="lineNoCov">          0 :           WARNING(&quot;emulating log-random-matching bug&quot;);</span>
<span class="lineNum">     576 </span>            :         }
<span class="lineNum">     577 </span><span class="lineNoCov">          0 :         emulate_log_random_matching_bug=1;</span>
<span class="lineNum">     578 </span>            :       }
<span class="lineNum">     579 </span>            : 
<span class="lineNum">     580 </span><span class="lineCov">         45 :       if(get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;)){</span>
<span class="lineNum">     581 </span>            :         double as_ratio=
<span class="lineNum">     582 </span><span class="lineCov">        135 :           -log(get_cfg_parameter(&quot;conversion_efficiency_epsilon&quot;)*</span>
<span class="lineNum">     583 </span><span class="lineCov">         45 :                get_cfg_parameter(&quot;attack_rate_allometric_prefactor&quot;)/</span>
<span class="lineNum">     584 </span><span class="lineCov">         90 :                get_cfg_parameter(&quot;respiration_rate_allometric_prefactor&quot;))/</span>
<span class="lineNum">     585 </span><span class="lineCov">         45 :           get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;);</span>
<span class="lineNum">     586 </span>            :         double Sr_guess=
<span class="lineNum">     587 </span><span class="lineCov">         45 :           exp(pow(as_ratio,2)/2)*as_ratio*sqrt(2*M_PI)+1;</span>
<span class="lineNum">     588 </span><span class="lineCov">        180 :         REPORT(Sr_guess);</span>
<span class="lineNum">     589 </span><span class="lineCov">         45 :         double ic_guess=sqrt(2*log(Sr_guess))/</span>
<span class="lineNum">     590 </span><span class="lineCov">         45 :           get_cfg_parameter(&quot;totally_random_link_strength_sigma&quot;);</span>
<span class="lineNum">     591 </span><span class="lineCov">        135 :         REPORT(ic_guess);</span>
<span class="lineNum">     592 </span>            :       }
<span class="lineNum">     593 </span>            : 
<span class="lineNum">     594 </span><span class="lineCov">         45 :       store.get(&amp;web,&quot;FoodWeb&quot;);</span>
<span class="lineNum">     595 </span>            :       
<span class="lineNum">     596 </span><span class="lineCov">         90 :       for(int i=web.s.size();i--&gt;0;){</span>
<span class="lineNum">     597 </span><span class="lineCov">      17600 :         web.s(i).</span>
<span class="lineNum">     598 </span><span class="lineCov">      17600 :           set_biomass_abundance_B(web.s(i).biomass_abundance_B()*</span>
<span class="lineNum">     599 </span><span class="lineCov">       8800 :                                   abundance_multiplier );</span>
<span class="lineNum">     600 </span>            :       }
<span class="lineNum">     601 </span>            : 
<span class="lineNum">     602 </span><span class="lineCov">         45 :       web.initialize_for_integration();</span>
<span class="lineNum">     603 </span><span class="lineCov">         45 :       web.compute_diagnostics=true;</span>
<span class="lineNum">     604 </span>            : 
<span class="lineNum">     605 </span><span class="lineCov">         45 :       if(enforce_equilibrium){</span>
<span class="lineNum">     606 </span><span class="lineNoCov">          0 :         web.enforce_equilibrium();</span>
<span class="lineNum">     607 </span>            :       }
<span class="lineNum">     608 </span><span class="lineCov">         45 :       if(fished_web_name){</span>
<span class="lineNum">     609 </span><span class="lineNoCov">          0 :         NewWeb fished_web;</span>
<span class="lineNum">     610 </span><span class="lineNoCov">          0 :         XMLStore(fished_web_name).get(&amp;fished_web,&quot;FoodWeb&quot;);</span>
<span class="lineNum">     611 </span><span class="lineNoCov">          0 :         web.copy_fishing_mortalities_from(fished_web);</span>
<span class="lineNum">     612 </span>            :       }
<span class="lineNum">     613 </span>            :       
<span class="lineNum">     614 </span><span class="lineCov">         45 :       if(print_indices){</span>
<span class="lineNum">     615 </span><span class="lineNoCov">          0 :         baseline_web=web;</span>
<span class="lineNum">     616 </span><span class="lineNoCov">          0 :         if(time_averaging_time){</span>
<span class="lineNum">     617 </span><span class="lineNoCov">          0 :           time_average avr(baseline_web,time_averaging_time); </span>
<span class="lineNum">     618 </span>            :         }else{
<span class="lineNum">     619 </span><span class="lineNoCov">          0 :           baseline_web.get_top_down_strength();</span>
<span class="lineNum">     620 </span>            :         }
<span class="lineNum">     621 </span><span class="lineNoCov">          0 :         if(snap_to_fixed_point){</span>
<span class="lineNum">     622 </span><span class="lineNoCov">          0 :           FATAL_ERROR(&quot;fixed point snapping and index calculation cannot be combined, yet&quot;);</span>
<span class="lineNum">     623 </span>            :         }
<span class="lineNum">     624 </span>            :       }
<span class="lineNum">     625 </span>            : 
<span class="lineNum">     626 </span><span class="lineCov">         45 :       if(forbid_fishing){</span>
<span class="lineNum">     627 </span><span class="lineNoCov">          0 :         web.forbid_fishing();</span>
<span class="lineNum">     628 </span>            :       }
<span class="lineNum">     629 </span>            : 
<span class="lineNum">     630 </span><span class="lineCov">         45 :       if(perturbation_type){</span>
<span class="lineNum">     631 </span><span class="lineNoCov">          0 :         perturb(web,perturbation_type);</span>
<span class="lineNum">     632 </span>            :       }
<span class="lineNum">     633 </span>            : 
<span class="lineNum">     634 </span><span class="lineCov">         45 :       if(waiting_time){</span>
<span class="lineNum">     635 </span>            :         //~ web.compute_diagnostics=false;
<span class="lineNum">     636 </span>            :         //~ cout &lt;&lt; &quot;relaxing ... &quot;;
<span class="lineNum">     637 </span>            :         //~ cout.flush();
<span class="lineNum">     638 </span>            :         //~ double T=eval(waiting_time);
<span class="lineNum">     639 </span>            :         //~ if(T&gt;0){
<span class="lineNum">     640 </span>            :           //~ double simulated_time_relaxing=
<span class="lineNum">     641 </span>            :             //~ web.relax(T);
<span class="lineNum">     642 </span>            :           //~ REPORT(simulated_time_relaxing);
<span class="lineNum">     643 </span>            :         //~ }else{
<span class="lineNum">     644 </span>            :           //~ T=-T;
<span class="lineNum">     645 </span>            : //~ #if 1
<span class="lineNum">     646 </span>            :           //~ double simulated_time_relaxing=
<span class="lineNum">     647 </span>            :             //~ web.relax(T,NewWeb::species_set_t(),false);       
<span class="lineNum">     648 </span>            :           //~ REPORT(simulated_time_relaxing);
<span class="lineNum">     649 </span>            : //~ #else // experimental code to make movies
<span class="lineNum">     650 </span>            :           //~ int frame_number=0;
<span class="lineNum">     651 </span>            :           //~ double t=0;
<span class="lineNum">     652 </span>            :           //~ for(double next_t=0.001;next_t&lt;T;next_t*=1.1 ){
<span class="lineNum">     653 </span>            :             //~ biomass_B=web.get_biomass_B();
<span class="lineNum">     654 </span>            :             //~ ostringstream filename;
<span class="lineNum">     655 </span>            :             //~ filename  &lt;&lt; &quot;frame&quot; &lt;&lt; setfill('0') &lt;&lt; setw(5) 
<span class="lineNum">     656 </span>            :                       //~ &lt;&lt; frame_number &lt;&lt; &quot;.dat&quot;;
<span class="lineNum">     657 </span>            :             //~ Mass_Integrator().spectrum(1e-12*web.get_biomass_B(),
<span class="lineNum">     658 </span>            :                                        //~ web.get_bodymass_M(),
<span class="lineNum">     659 </span>            :                                        //~ filename.str().c_str());
<span class="lineNum">     660 </span>            :             //~ REPORT(frame_number);
<span class="lineNum">     661 </span>            :             //~ double simulated_time_relaxing=
<span class="lineNum">     662 </span>            :               //~ web.relax(next_t-t,
<span class="lineNum">     663 </span>            :                         //~ NewWeb::species_set_t(),false);                 
<span class="lineNum">     664 </span>            :             //~ REPORT(simulated_time_relaxing);
<span class="lineNum">     665 </span>            :             //~ t=next_t;
<span class="lineNum">     666 </span>            :             //~ REPORT(t);
<span class="lineNum">     667 </span>            :             //~ frame_number++;
<span class="lineNum">     668 </span>            :           //~ }
<span class="lineNum">     669 </span>            : //~ #endif // experimental code to make movies
<span class="lineNum">     670 </span>            :         //~ }
<span class="lineNum">     671 </span>            :         //~ cout &lt;&lt; &quot;finished&quot; &lt;&lt; endl;
<span class="lineNum">     672 </span><span class="lineNoCov">          0 :                 stringstream ss;</span>
<span class="lineNum">     673 </span><span class="lineNoCov">          0 :                 ss &lt;&lt; waiting_time;</span>
<span class="lineNum">     674 </span><span class="lineNoCov">          0 :                 string str = ss.str();</span>
<span class="lineNum">     675 </span>            :                 
<span class="lineNum">     676 </span><span class="lineNoCov">          0 :                 NewSpecies * new_species = web.speciate_only_fit(NewSpecies::plant);</span>
<span class="lineNum">     677 </span><span class="lineNoCov">          0 :                 double fitness = web.invasion_fitness(new_species);</span>
<span class="lineNum">     678 </span>            :                 int invaded = 0;
<span class="lineNum">     679 </span>            :                 int attempt = 0;
<span class="lineNum">     680 </span><span class="lineNoCov">          0 :                 while(invaded==0){</span>
<span class="lineNum">     681 </span><span class="lineNoCov">          0 :                         attempt = attempt+1;</span>
<span class="lineNum">     682 </span><span class="lineNoCov">          0 :                         NewSpecies * new_species = web.speciate_only_fit(NewSpecies::plant);</span>
<span class="lineNum">     683 </span><span class="lineNoCov">          0 :                         fitness = web.invasion_fitness(new_species);</span>
<span class="lineNum">     684 </span><span class="lineNoCov">          0 :                         if(fitness&gt;0){</span>
<span class="lineNum">     685 </span><span class="lineNoCov">          0 :                                 invaded = 1;</span>
<span class="lineNum">     686 </span>            :                         }
<span class="lineNum">     687 </span><span class="lineNoCov">          0 :                         if(attempt&gt;1000){</span>
<span class="lineNum">     688 </span><span class="lineNoCov">          0 :                                 invaded = 2;</span>
<span class="lineNum">     689 </span>            :                         }
<span class="lineNum">     690 </span>            :                 }
<span class="lineNum">     691 </span><span class="lineNoCov">          0 :                 string out1 = &quot;list_of_inserted_deleted_biomass_species_w.dat&quot;;</span>
<span class="lineNum">     692 </span>            :                 //~ out1 = out1 + str +&quot;.dat&quot;;
<span class="lineNum">     693 </span><span class="lineNoCov">          0 :                 string out2 = &quot;list_of_inserted_deleted_biomass_species_ww.dat&quot;;</span>
<span class="lineNum">     694 </span>            :                 //~ out2 = out2 + str + &quot;.dat&quot;;
<span class="lineNum">     695 </span><span class="lineNoCov">          0 :                 string out3 = &quot;list_of_inserted_deleted_biomass_species_www.dat&quot;;</span>
<span class="lineNum">     696 </span>            :                 //~ out3 = out3 + str + &quot;.dat&quot;;
<span class="lineNum">     697 </span><span class="lineNoCov">          0 :                 if(invaded==1){</span>
<span class="lineNum">     698 </span><span class="lineNoCov">          0 :                         list_of_inserted_deleted_biomass_species_w.open(out1.c_str(),ios_base::app);</span>
<span class="lineNum">     699 </span><span class="lineNoCov">          0 :                         list_of_inserted_deleted_biomass_species_ww.open(out2.c_str(),ios_base::app);</span>
<span class="lineNum">     700 </span><span class="lineNoCov">          0 :                         list_of_inserted_deleted_biomass_species_www.open(out3.c_str(),ios_base::app);</span>
<span class="lineNum">     701 </span><span class="lineNoCov">          0 :                         int jj=web.s.size();</span>
<span class="lineNum">     702 </span><span class="lineNoCov">          0 :                         for(int i=jj;i--&gt;0;){</span>
<span class="lineNum">     703 </span><span class="lineNoCov">          0 :                                 list_of_inserted_deleted_biomass_species_w &lt;&lt; fitness &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).aggressivity_g()  &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B()  &lt;&lt; &quot; &quot; &lt;&lt; jj &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot; &lt;&lt; number_of_next_save &lt;&lt; &quot; &quot; &lt;&lt; random_seed &lt;&lt; endl;</span>
<span class="lineNum">     704 </span>            :                         }
<span class="lineNum">     705 </span><span class="lineNoCov">          0 :                         web.insert(new_species);</span>
<span class="lineNum">     706 </span><span class="lineNoCov">          0 :                         jj=web.s.size();</span>
<span class="lineNum">     707 </span><span class="lineNoCov">          0 :                         for(int i=jj;i--&gt;0;){</span>
<span class="lineNum">     708 </span><span class="lineNoCov">          0 :                                 list_of_inserted_deleted_biomass_species_ww &lt;&lt; fitness &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).aggressivity_g()  &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B()  &lt;&lt; &quot; &quot; &lt;&lt; jj &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot; &lt;&lt; number_of_next_save &lt;&lt; &quot; &quot; &lt;&lt; random_seed &lt;&lt; endl;</span>
<span class="lineNum">     709 </span>            :                         }
<span class="lineNum">     710 </span><span class="lineNoCov">          0 :                         int time_between_insertions=1000;</span>
<span class="lineNum">     711 </span><span class="lineNoCov">          0 :                         web.relax(time_between_insertions,NewWeb::species_set_t(),true);</span>
<span class="lineNum">     712 </span><span class="lineNoCov">          0 :                         jj=web.s.size();</span>
<span class="lineNum">     713 </span><span class="lineNoCov">          0 :                         for(int i=jj;i--&gt;0;){</span>
<span class="lineNum">     714 </span><span class="lineNoCov">          0 :                                 list_of_inserted_deleted_biomass_species_www &lt;&lt;  fitness &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).aggressivity_g()  &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B()  &lt;&lt; &quot; &quot; &lt;&lt; jj &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot; &lt;&lt; number_of_next_save &lt;&lt; &quot; &quot; &lt;&lt; random_seed &lt;&lt; endl;</span>
<span class="lineNum">     715 </span>            :                         }
<span class="lineNum">     716 </span>            :                 }
<span class="lineNum">     717 </span>            :       }
<span class="lineNum">     718 </span>            : 
<span class="lineNum">     719 </span>            :       //~ if(writeback_file){
<span class="lineNum">     720 </span>            :         //~ cfgPermanent parameters;
<span class="lineNum">     721 </span>            :         //~ XMLStore()
<span class="lineNum">     722 </span>            :           //~ .put(version,&quot;version&quot;)
<span class="lineNum">     723 </span>            :           //~ .put(compilation_time,&quot;compilation_time&quot;)
<span class="lineNum">     724 </span>            :           //~ .put(&amp;parameters,&quot;adjustable_parameters&quot;)
<span class="lineNum">     725 </span>            :           //~ .put(&amp;web,&quot;FoodWeb&quot;)
<span class="lineNum">     726 </span>            :           //~ .save(writeback_file);
<span class="lineNum">     727 </span>            :       //~ }
<span class="lineNum">     728 </span>            :       
<span class="lineNum">     729 </span>            :       
<span class="lineNum">     730 </span>            :       do_inline_assignments();
<span class="lineNum">     731 </span>            :       
<span class="lineNum">     732 </span>            : 
<span class="lineNum">     733 </span>            :   //~ FATAL_ERROR(&quot;EXPERIMENTAL CODE HERE&quot;);
<span class="lineNum">     734 </span>            : 
<span class="lineNum">     735 </span><span class="lineCov">         45 :       if(fast_stats){</span>
<span class="lineNum">     736 </span><span class="lineNoCov">          0 :         web.fast_stats();</span>
<span class="lineNum">     737 </span>            :       }
<span class="lineNum">     738 </span>            : 
<span class="lineNum">     739 </span>            :       //web.initialize_for_integration();
<span class="lineNum">     740 </span><span class="lineCov">         45 :       web.compute_diagnostics=true;</span>
<span class="lineNum">     741 </span><span class="lineCov">         45 :       if(time_averaging_time and not snap_to_fixed_point){</span>
<span class="lineNum">     742 </span><span class="lineNoCov">          0 :         time_average avr(web,time_averaging_time); // here the</span>
<span class="lineNum">     743 </span>            :         // averages are
<span class="lineNum">     744 </span>            :         // computed!!
<span class="lineNum">     745 </span><span class="lineNoCov">          0 :         if(needs_flows) ls=web.fx;</span>
<span class="lineNum">     746 </span><span class="lineNoCov">          0 :         biomass_B.resize(web.biomass_B.size());</span>
<span class="lineNum">     747 </span><span class="lineNoCov">          0 :         std::copy(web.biomass_B.begin(),web.biomass_B.end(),biomass_B.begin());</span>
<span class="lineNum">     748 </span>            :       }else{
<span class="lineNum">     749 </span><span class="lineCov">         45 :         if(snap_to_fixed_point){</span>
<span class="lineNum">     750 </span><span class="lineNoCov">          0 :           if(time_averaging_time){</span>
<span class="lineNum">     751 </span><span class="lineNoCov">          0 :             time_average avr(web,time_averaging_time);</span>
<span class="lineNum">     752 </span>            :           }
<span class="lineNum">     753 </span>            :           // Snap web to fixed point:
<span class="lineNum">     754 </span>            :           {     
<span class="lineNum">     755 </span><span class="lineNoCov">          0 :             WARNING(&quot;snapping&quot;);</span>
<span class="lineNum">     756 </span><span class="lineNoCov">          0 :             fixed_point_analyzer snapper(&amp;web,-10);</span>
<span class="lineNum">     757 </span><span class="lineNoCov">          0 :             snapper.set_time_scale_to(1e-5);</span>
<span class="lineNum">     758 </span><span class="lineNoCov">          0 :             snapper.snap_to_fixed_point();</span>
<span class="lineNum">     759 </span>            :           }
<span class="lineNum">     760 </span><span class="lineNoCov">          0 :           cfgPermanent parameters;</span>
<span class="lineNum">     761 </span>            :           XMLStore()
<span class="lineNum">     762 </span><span class="lineNoCov">          0 :             .put(version,&quot;version&quot;)</span>
<span class="lineNum">     763 </span><span class="lineNoCov">          0 :             .put(compilation_time,&quot;compilation_time&quot;)</span>
<span class="lineNum">     764 </span><span class="lineNoCov">          0 :             .put(&amp;parameters,&quot;adjustable_parameters&quot;)</span>
<span class="lineNum">     765 </span><span class="lineNoCov">          0 :             .put(&amp;web,&quot;FoodWeb&quot;)</span>
<span class="lineNum">     766 </span><span class="lineNoCov">          0 :             .save(&quot;snapped.xml.bz2&quot;);</span>
<span class="lineNum">     767 </span>            :         }
<span class="lineNum">     768 </span><span class="lineCov">         45 :         if(needs_flows){</span>
<span class="lineNum">     769 </span><span class="lineCov">         45 :           web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">     770 </span><span class="lineCov">         45 :           if(scale_flows)</span>
<span class="lineNum">     771 </span><span class="lineNoCov">          0 :             ls=web.scaled_intake_matrix(not jolly);//don't precompute if jolly</span>
<span class="lineNum">     772 </span>            :           else
<span class="lineNum">     773 </span><span class="lineCov">        135 :             ls=web.intake_matrix(not jolly);//don't precompute if jolly</span>
<span class="lineNum">     774 </span>            :         }
<span class="lineNum">     775 </span><span class="lineCov">         90 :         biomass_B=web.get_biomass_B();</span>
<span class="lineNum">     776 </span><span class="lineCov">         45 :         web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">     777 </span>            :       }
<span class="lineNum">     778 </span><span class="lineCov">         45 :       if(use_c &amp;&amp; needs_flows){</span>
<span class="lineNum">     779 </span><span class="lineNoCov">          0 :         ls=web.matching_matrix();</span>
<span class="lineNum">     780 </span>            :       }
<span class="lineNum">     781 </span><span class="lineCov">         45 :       web_data.set_number_of_compartments(web.number_of_species());</span>
<span class="lineNum">     782 </span><span class="lineCov">         45 :       web_data.set_biomasses(biomass_B);</span>
<span class="lineNum">     783 </span><span class="lineCov">         90 :       web_data.set_bodymasses(web.get_bodymass_M());</span>
<span class="lineNum">     784 </span><span class="lineCov">         90 :       web_data.set_bottom(web.get_is_plant());</span>
<span class="lineNum">     785 </span><span class="lineCov">         45 :       if(needs_flows){</span>
<span class="lineNum">     786 </span><span class="lineCov">         45 :         web_data.set_flows(ls);</span>
<span class="lineNum">     787 </span><span class="lineCov">         45 :         web_data.adjust_links_given_flows(threshold_value);</span>
<span class="lineNum">     788 </span>            :       }
<span class="lineNum">     789 </span><span class="lineCov">         45 :       web_data.set_area(area_per_compartment);</span>
<span class="lineNum">     790 </span>            : 
<span class="lineNum">     791 </span><span class="lineCov">        135 :       cout &lt;&lt; &quot;web_number &quot; &lt;&lt; number_of_next_save-1 &lt;&lt; endl;</span>
<span class="lineNum">     792 </span><span class="lineCov">         45 :       int old_prec=std::cout.precision();</span>
<span class="lineNum">     793 </span><span class="lineCov">         90 :       std::cout.precision(10);</span>
<span class="lineNum">     794 </span><span class="lineCov">        180 :       cout &lt;&lt; &quot;current_time &quot; &lt;&lt; web.current_time &lt;&lt; endl;</span>
<span class="lineNum">     795 </span><span class="lineCov">         90 :       std::cout.precision(old_prec);</span>
<span class="lineNum">     796 </span>            :     }
<span class="lineNum">     797 </span><span class="lineCov">         45 :     break;</span>
<span class="lineNum">     798 </span>            :   case nls:
<span class="lineNum">     799 </span>            :     {// nls web in SCORE format:
<span class="lineNum">     800 </span><span class="lineNoCov">          0 :       nlsweb=nls_web(web_file_name.c_str());</span>
<span class="lineNum">     801 </span><span class="lineNoCov">          0 :       biomass_B=nlsweb.biomass;</span>
<span class="lineNum">     802 </span><span class="lineNoCov">          0 :       biomass_B.resize(nlsweb.number_of_living_compartments);</span>
<span class="lineNum">     803 </span><span class="lineNoCov">          0 :       ls=nlsweb.trophic_intake_matrix();</span>
<span class="lineNum">     804 </span>            :  
<span class="lineNum">     805 </span><span class="lineNoCov">          0 :       if(nls_area)</span>
<span class="lineNum">     806 </span><span class="lineNoCov">          0 :         web_data.set_area(nls_area);</span>
<span class="lineNum">     807 </span>            :       else{
<span class="lineNum">     808 </span><span class="lineNoCov">          0 :         WARNING(&quot;area not set, assuming area of 1 meter^2&quot;);</span>
<span class="lineNum">     809 </span><span class="lineNoCov">          0 :         web_data.set_area(eval_now(&quot;1*meter^2&quot;));</span>
<span class="lineNum">     810 </span>            :       }
<span class="lineNum">     811 </span>            : 
<span class="lineNum">     812 </span>            :       web_data.
<span class="lineNum">     813 </span><span class="lineNoCov">          0 :         set_number_of_compartments(nlsweb.number_of_living_compartments);</span>
<span class="lineNum">     814 </span><span class="lineNoCov">          0 :       web_data.set_biomasses(biomass_B);</span>
<span class="lineNum">     815 </span><span class="lineNoCov">          0 :       web_data.set_flows(ls);</span>
<span class="lineNum">     816 </span><span class="lineNoCov">          0 :       web_data.adjust_links_given_flows(threshold_value);</span>
<span class="lineNum">     817 </span><span class="lineNoCov">          0 :       web_data.adjust_bottom_given_links();</span>
<span class="lineNum">     818 </span>            :     }
<span class="lineNum">     819 </span>            :     break;
<span class="lineNum">     820 </span>            :   case tlf:
<span class="lineNum">     821 </span>            :     {// custom &quot;Tuesday Lake&quot; format
<span class="lineNum">     822 </span><span class="lineNoCov">          0 :       read_tlf_file(web_file_name.c_str(),web_data);</span>
<span class="lineNum">     823 </span>            :     }
<span class="lineNum">     824 </span>            :     break;
<span class="lineNum">     825 </span>            :   case dot_web:
<span class="lineNum">     826 </span><span class="lineNoCov">          0 :     web_data.set_links(load_three_column_file(web_file_name));</span>
<span class="lineNum">     827 </span>            :   }
<span class="lineNum">     828 </span>            : 
<span class="lineNum">     829 </span><span class="lineCov">         45 :   if(fast_stats and file_type!=xml){</span>
<span class="lineNum">     830 </span><span class="lineNoCov">          0 :     web_data.fast_stats();</span>
<span class="lineNum">     831 </span>            :   }
<span class="lineNum">     832 </span>            :   
<span class="lineNum">     833 </span>            :                 //~ for(int i=10;i--&gt;0;){
<span class="lineNum">     834 </span>            :                 //~ fitness_only2.open(&quot;fitness_only2.dat&quot;,ios_base::app);
<span class="lineNum">     835 </span>            :                 //~ NewSpecies * s = web.speciate(NewSpecies::animal);
<span class="lineNum">     836 </span>            :                 //~ s-&gt;set_aggressivity_g(0.06); // you need to adjust this!
<span class="lineNum">     837 </span>            :                 //~ fitness_only2 &lt;&lt; web.invasion_fitness(s) &lt;&lt; endl;
<span class="lineNum">     838 </span>            :                 //~ REPORT(web.invasion_fitness(s));
<span class="lineNum">     839 </span>            :         //~ }
<span class="lineNum">     840 </span>            :         
<span class="lineNum">     841 </span>            : 
<span class="lineNum">     842 </span>            :   
<span class="lineNum">     843 </span><span class="lineCov">         45 :   if(mass_integral_start){</span>
<span class="lineNum">     844 </span><span class="lineNoCov">          0 :     Mass_Integrator integrator;</span>
<span class="lineNum">     845 </span>            :     double mass_integral=
<span class="lineNum">     846 </span><span class="lineNoCov">          0 :       integrator.integrate(biomass_B,web_data.get_bodymasses(),</span>
<span class="lineNum">     847 </span><span class="lineNoCov">          0 :                            mass_integral_start);</span>
<span class="lineNum">     848 </span><span class="lineNoCov">          0 :     REPORT(mass_integral);</span>
<span class="lineNum">     849 </span>            :   }
<span class="lineNum">     850 </span>            :   
<span class="lineNum">     851 </span><span class="lineCov">         45 :   if(print_insertion_count){</span>
<span class="lineNum">     852 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;attempted insertions &quot; </span>
<span class="lineNum">     853 </span><span class="lineNoCov">          0 :          &lt;&lt; web.get_invasion_counter() + web.get_speciation_counter() </span>
<span class="lineNum">     854 </span>            :          &lt;&lt; endl;
<span class="lineNum">     855 </span>            :   }
<span class="lineNum">     856 </span>            :   
<span class="lineNum">     857 </span><span class="lineCov">         45 :   if(strength_spectrum_file){</span>
<span class="lineNum">     858 </span><span class="lineNoCov">          0 :     if(choose_other || !file_type==nls)</span>
<span class="lineNum">     859 </span><span class="lineNoCov">          0 :       strength_distribution_new(web_data.get_ifrac(),</span>
<span class="lineNum">     860 </span>            :                             threshold_value/100.0,
<span class="lineNum">     861 </span>            :                             strength_spectrum_file,
<span class="lineNum">     862 </span><span class="lineNoCov">          0 :                             web_data.get_bodymasses());</span>
<span class="lineNum">     863 </span>            :     else
<span class="lineNum">     864 </span>            :       nlsweb.
<span class="lineNum">     865 </span><span class="lineNoCov">          0 :         strength_distribution(threshold_value/100.0,strength_spectrum_file);</span>
<span class="lineNum">     866 </span>            :   }
<span class="lineNum">     867 </span><span class="lineCov">         45 :   if(distance_file &amp;&amp; file_type==xml){</span>
<span class="lineNum">     868 </span><span class="lineNoCov">          0 :     web.distance_lists(distance_file);</span>
<span class="lineNum">     869 </span>            :   }
<span class="lineNum">     870 </span>            :   
<span class="lineNum">     871 </span>            :   Interaction_Matrix im=
<span class="lineNum">     872 </span><span class="lineCov">         90 :     (needs_flows ? web_data.get_im() : Interaction_Matrix());</span>
<span class="lineNum">     873 </span><span class="lineCov">         45 :   if(lump_lowest_level){</span>
<span class="lineNum">     874 </span><span class="lineNoCov">          0 :     im=im.lump_lowest_level();</span>
<span class="lineNum">     875 </span>            :   }
<span class="lineNum">     876 </span><span class="lineCov">         45 :   if(standardized){</span>
<span class="lineNum">     877 </span><span class="lineNoCov">          0 :     im=standardize(im);</span>
<span class="lineNum">     878 </span>            :   }
<span class="lineNum">     879 </span><span class="lineCov">         45 :   if(lump){</span>
<span class="lineNum">     880 </span><span class="lineNoCov">          0 :     im=im.trophic();</span>
<span class="lineNum">     881 </span>            :   }
<span class="lineNum">     882 </span><span class="lineCov">         45 :   if(print || pgm_file){</span>
<span class="lineNum">     883 </span>            :     if(true || standardized || lump)
<span class="lineNum">     884 </span><span class="lineNoCov">          0 :       im=forgiving_tsort(im);</span>
<span class="lineNum">     885 </span><span class="lineNoCov">          0 :     if(pgm_file){</span>
<span class="lineNum">     886 </span><span class="lineNoCov">          0 :       im.pgm_write(pgm_file);</span>
<span class="lineNum">     887 </span>            :     }
<span class="lineNum">     888 </span><span class="lineNoCov">          0 :     if(print){</span>
<span class="lineNum">     889 </span><span class="lineNoCov">          0 :       im.Print();</span>
<span class="lineNum">     890 </span>            :     }
<span class="lineNum">     891 </span>            :   }
<span class="lineNum">     892 </span><span class="lineCov">         45 :     if(aggressivenes_file){</span>
<span class="lineNum">     893 </span>            :         //~ before_interaction_matrix.open(&quot;before_interaction_matrix.dat&quot;,ios_base::app);
<span class="lineNum">     894 </span>            :         //~ before_agg_for_matrix.open(&quot;before_agg_for_matrix.dat&quot;,ios_base::app);
<span class="lineNum">     895 </span>            :         //~ after_interaction_matrix.open(&quot;after_interaction_matrix.dat&quot;,ios_base::app);
<span class="lineNum">     896 </span>            :         //~ after_agg_for_matrix.open(&quot;after_agg_for_matrix.dat&quot;,ios_base::app);
<span class="lineNum">     897 </span>            :         //~ bool needs_flows=true;
<span class="lineNum">     898 </span>            :         //~ ls=web.fx;
<span class="lineNum">     899 </span>            :         //~ web.get_top_down_strength();
<span class="lineNum">     900 </span>            :         //~ ls=web.matching_matrix();
<span class="lineNum">     901 </span>            :     //~ web_data.set_flows(ls);
<span class="lineNum">     902 </span>            :         //~ web_data.adjust_links_given_flows(threshold_value);
<span class="lineNum">     903 </span>            :         //~ Interaction_Matrix im=
<span class="lineNum">     904 </span>            :     //~ (needs_flows ? web_data.get_im() : Interaction_Matrix());
<span class="lineNum">     905 </span>            :     //~ const link_strength_matrix &amp; m=ls;
<span class="lineNum">     906 </span>            :     //~ std::cout &lt;&lt; &quot;   &quot;;
<span class="lineNum">     907 </span>            :     //~ for(unsigned int j=0;j&lt;m.size();j++)
<span class="lineNum">     908 </span>            :       //~ std::cout &lt;&lt; std::setw(2) &lt;&lt; (j/10)%10;
<span class="lineNum">     909 </span>            :     //~ std::cout &lt;&lt; endl;
<span class="lineNum">     910 </span>            :     //~ std::cout &lt;&lt; &quot;   &quot;;
<span class="lineNum">     911 </span>            :     //~ for(unsigned int j=0;j&lt;m.size();j++)
<span class="lineNum">     912 </span>            :       //~ std::cout &lt;&lt; std::setw(2) &lt;&lt; j%10;
<span class="lineNum">     913 </span>            :     //~ std::cout &lt;&lt; endl;
<span class="lineNum">     914 </span>            :     //~ std::cout &lt;&lt; &quot;   &quot;;
<span class="lineNum">     915 </span>            :     //~ for(unsigned int j=0;j&lt;m.size();j++)
<span class="lineNum">     916 </span>            :       //~ std::cout &lt;&lt; &quot;--&quot;;
<span class="lineNum">     917 </span>            :     //~ std::cout &lt;&lt; std::endl;
<span class="lineNum">     918 </span>            :     //~ for(unsigned int i=0;i&lt;m.size();i++){
<span class="lineNum">     919 </span>            :       //~ before_agg_for_matrix &lt;&lt; web.s(i).aggressivity_g() &lt;&lt; endl;
<span class="lineNum">     920 </span>            :       //~ std::cout &lt;&lt; std::setw(2 ) &lt;&lt; i%100 &lt;&lt; &quot;|&quot;;
<span class="lineNum">     921 </span>            :       //~ for(unsigned int j=0;j&lt;m.size();j++){
<span class="lineNum">     922 </span>            :         //~ std::cout &lt;&lt; std::setw(2) &lt;&lt; order_of_magnitude(m[j][i]);
<span class="lineNum">     923 </span>            :         //~ before_interaction_matrix &lt;&lt; m[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;
<span class="lineNum">     924 </span>            :               //~ }
<span class="lineNum">     925 </span>            :       //~ std::cout &lt;&lt; endl;
<span class="lineNum">     926 </span>            :     //~ }
<span class="lineNum">     927 </span>            :     //~ NewSpecies * new_species = web.speciate_only_fit(NewSpecies::plant);
<span class="lineNum">     928 </span>            :         //~ web.insert(new_species);
<span class="lineNum">     929 </span>            :         //~ web.initialize_for_integration();
<span class="lineNum">     930 </span>            :         //~ int time_between_insertions=1000;
<span class="lineNum">     931 </span>            :         //~ web.relax(time_between_insertions,NewWeb::species_set_t(),true);
<span class="lineNum">     932 </span>            :         //~ for(unsigned int i=0;i&lt;m.size();i++){
<span class="lineNum">     933 </span>            :       //~ after_agg_for_matrix &lt;&lt; web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt;endl;
<span class="lineNum">     934 </span>            :       //~ for(unsigned int j=0;j&lt;m.size();j++){
<span class="lineNum">     935 </span>            :           //~ after_interaction_matrix &lt;&lt; m[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;
<span class="lineNum">     936 </span>            :       //~ }
<span class="lineNum">     937 </span>            :     //~ }
<span class="lineNum">     938 </span>            :     
<span class="lineNum">     939 </span><span class="lineCov">        225 :         stringstream ss(aggressivenes_file);</span>
<span class="lineNum">     940 </span>            :         //~ ss &lt;&lt; aggressivenes_file;
<span class="lineNum">     941 </span><span class="lineCov">         90 :         double agg = 0; ss &gt;&gt; agg;</span>
<span class="lineNum">     942 </span><span class="lineCov">         90 :         string str = ss.str();</span>
<span class="lineNum">     943 </span><span class="lineCov">         90 :         string random;</span>
<span class="lineNum">     944 </span>            :         
<span class="lineNum">     945 </span><span class="lineCov">         45 :         srand((unsigned)time(0));</span>
<span class="lineNum">     946 </span><span class="lineCov">         45 :         int random_integer = rand();</span>
<span class="lineNum">     947 </span><span class="lineCov">         45 :         int Number = rand();     // number to be converted to a string</span>
<span class="lineNum">     948 </span><span class="lineCov">         90 :         ostringstream convert;   // stream used for the conversion</span>
<span class="lineNum">     949 </span><span class="lineCov">         45 :         convert &lt;&lt; Number;       </span>
<span class="lineNum">     950 </span><span class="lineCov">        135 :         random = convert.str();</span>
<span class="lineNum">     951 </span>            : 
<span class="lineNum">     952 </span><span class="lineCov">        135 :         str = str + random;</span>
<span class="lineNum">     953 </span><span class="lineCov">        180 :         string out1 = &quot;before_interaction_matrix&quot;;</span>
<span class="lineNum">     954 </span><span class="lineCov">        180 :         out1 = out1 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     955 </span><span class="lineCov">        180 :         string out2 = &quot;before_agg_for_matrix&quot;;</span>
<span class="lineNum">     956 </span><span class="lineCov">        180 :         out2 = out2 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     957 </span><span class="lineCov">        180 :         string out3 = &quot;after_interaction_matrix&quot;;</span>
<span class="lineNum">     958 </span><span class="lineCov">        180 :         out3 = out3 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     959 </span><span class="lineCov">        180 :         string out4 = &quot;after_agg_for_matrix&quot;;</span>
<span class="lineNum">     960 </span><span class="lineCov">        180 :         out4 = out4 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     961 </span><span class="lineCov">        180 :         string out5 = &quot;during_interaction_matrix&quot;;</span>
<span class="lineNum">     962 </span><span class="lineCov">        180 :         out5 = out5 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     963 </span><span class="lineCov">        180 :         string out6 = &quot;during_agg_for_matrix&quot;;</span>
<span class="lineNum">     964 </span><span class="lineCov">        180 :         out6 = out6 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     965 </span><span class="lineCov">        180 :         string out7 = &quot;after_interaction_matrix1&quot;;</span>
<span class="lineNum">     966 </span><span class="lineCov">        180 :         out7 = out7 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     967 </span><span class="lineCov">        180 :         string out8 = &quot;after_agg_for_matrix1&quot;;</span>
<span class="lineNum">     968 </span><span class="lineCov">        180 :         out8 = out8 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     969 </span><span class="lineCov">        180 :         string out9 = &quot;during_interaction_matrix1&quot;;</span>
<span class="lineNum">     970 </span><span class="lineCov">        180 :         out9 = out9 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     971 </span><span class="lineCov">        180 :         string out10 = &quot;during_agg_for_matrix1&quot;;</span>
<span class="lineNum">     972 </span><span class="lineCov">        180 :         out10 = out10 + str + &quot;.dat&quot;;</span>
<span class="lineNum">     973 </span><span class="lineCov">         45 :         before_interaction_matrix.open(out1.c_str(),ios_base::app);</span>
<span class="lineNum">     974 </span><span class="lineCov">         45 :         before_agg_for_matrix.open(out2.c_str(),ios_base::app);</span>
<span class="lineNum">     975 </span><span class="lineCov">         45 :         during_interaction_matrix.open(out5.c_str(),ios_base::app);</span>
<span class="lineNum">     976 </span><span class="lineCov">         45 :         during_agg_for_matrix.open(out6.c_str(),ios_base::app);</span>
<span class="lineNum">     977 </span><span class="lineCov">         45 :         after_interaction_matrix.open(out3.c_str(),ios_base::app);</span>
<span class="lineNum">     978 </span><span class="lineCov">         45 :         after_agg_for_matrix.open(out4.c_str(),ios_base::app);</span>
<span class="lineNum">     979 </span><span class="lineCov">         45 :         after_interaction_matrix1.open(out7.c_str(),ios_base::app);</span>
<span class="lineNum">     980 </span><span class="lineCov">         45 :         after_agg_for_matrix1.open(out8.c_str(),ios_base::app);</span>
<span class="lineNum">     981 </span><span class="lineCov">         45 :         during_interaction_matrix1.open(out9.c_str(),ios_base::app);</span>
<span class="lineNum">     982 </span><span class="lineCov">         45 :         during_agg_for_matrix1.open(out10.c_str(),ios_base::app);</span>
<span class="lineNum">     983 </span>            :         
<span class="lineNum">     984 </span>            :         const link_strength_matrix &amp; m=ls;
<span class="lineNum">     985 </span><span class="lineCov">      17645 :         for(unsigned int i=0;i&lt;m.size();i++){</span>
<span class="lineNum">     986 </span><span class="lineCov">      61600 :                 before_agg_for_matrix &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot;&lt;&lt;web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt; endl;</span>
<span class="lineNum">     987 </span><span class="lineCov">    3488360 :                 for(unsigned int j=0;j&lt;m.size();j++){</span>
<span class="lineNum">     988 </span><span class="lineCov">    8698900 :         before_interaction_matrix &lt;&lt; m[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">     989 </span>            :                 }
<span class="lineNum">     990 </span>            :         }
<span class="lineNum">     991 </span><span class="lineCov">         45 :                 NewSpecies * new_species = web.speciate(NewSpecies::animal);</span>
<span class="lineNum">     992 </span><span class="lineCov">         90 :         new_species-&gt;set_aggressivity_g(agg);</span>
<span class="lineNum">     993 </span><span class="lineCov">         45 :         web.initialize_for_integration();</span>
<span class="lineNum">     994 </span><span class="lineCov">         45 :         double fitness = web.invasion_fitness(new_species);</span>
<span class="lineNum">     995 </span>            :         int invaded = 0;
<span class="lineNum">     996 </span>            :         int attempt = 0;
<span class="lineNum">     997 </span><span class="lineCov">        469 :         while(invaded==0){</span>
<span class="lineNum">     998 </span><span class="lineCov">        424 :                 attempt = attempt+1;</span>
<span class="lineNum">     999 </span>            :                 //~ NewSpecies * new_species = web.speciate_only_fit(NewSpecies::animal);
<span class="lineNum">    1000 </span><span class="lineCov">        424 :                 NewSpecies * new_species = web.speciate(NewSpecies::animal);</span>
<span class="lineNum">    1001 </span><span class="lineCov">        848 :                 new_species-&gt;set_aggressivity_g(agg);</span>
<span class="lineNum">    1002 </span><span class="lineCov">        424 :                 web.initialize_for_integration();</span>
<span class="lineNum">    1003 </span><span class="lineCov">        424 :                 fitness = web.invasion_fitness(new_species);</span>
<span class="lineNum">    1004 </span><span class="lineCov">        424 :                 if(fitness&gt;0){</span>
<span class="lineNum">    1005 </span><span class="lineCov">         45 :                         invaded = 1;</span>
<span class="lineNum">    1006 </span>            :                 }
<span class="lineNum">    1007 </span><span class="lineCov">        424 :                 if(attempt&gt;1000){</span>
<span class="lineNum">    1008 </span><span class="lineNoCov">          0 :                         invaded = 2;</span>
<span class="lineNum">    1009 </span>            :                 }
<span class="lineNum">    1010 </span>            :         }
<span class="lineNum">    1011 </span><span class="lineCov">         45 :                 web.insert(new_species);</span>
<span class="lineNum">    1012 </span>            :                 
<span class="lineNum">    1013 </span><span class="lineCov">        135 :                 ls=web.scaled_intake_matrix(not jolly);//don't precompute if jolly</span>
<span class="lineNum">    1014 </span><span class="lineCov">        135 :                 ls=web.intake_matrix(not jolly);</span>
<span class="lineNum">    1015 </span><span class="lineCov">         45 :                 const link_strength_matrix &amp; mmm=ls;</span>
<span class="lineNum">    1016 </span><span class="lineCov">       8890 :                 for(unsigned int i=0;i&lt;mmm.size();i++){</span>
<span class="lineNum">    1017 </span><span class="lineCov">      61915 :                         during_agg_for_matrix &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot;&lt;&lt;web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt; endl;</span>
<span class="lineNum">    1018 </span><span class="lineCov">    3523695 :                         for(unsigned int j=0;j&lt;mmm.size();j++){</span>
<span class="lineNum">    1019 </span><span class="lineCov">    8787125 :                         during_interaction_matrix &lt;&lt; mmm[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1020 </span>            :                   }
<span class="lineNum">    1021 </span>            :                 }
<span class="lineNum">    1022 </span>            :         
<span class="lineNum">    1023 </span><span class="lineCov">         45 :         if(fitness&gt;0){</span>
<span class="lineNum">    1024 </span><span class="lineCov">         45 :                 int time_between_insertions=1000;</span>
<span class="lineNum">    1025 </span><span class="lineCov">         90 :                 web.relax(time_between_insertions,NewWeb::species_set_t(),true);</span>
<span class="lineNum">    1026 </span><span class="lineCov">         45 :                 web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">    1027 </span>            : 
<span class="lineNum">    1028 </span><span class="lineCov">        135 :                 ls=web.intake_matrix(not jolly);</span>
<span class="lineNum">    1029 </span><span class="lineCov">         45 :                 const link_strength_matrix &amp; m5=ls;</span>
<span class="lineNum">    1030 </span>            :                 
<span class="lineNum">    1031 </span><span class="lineCov">       8849 :                 for(unsigned int i=0;i&lt;m5.size();i++){</span>
<span class="lineNum">    1032 </span><span class="lineCov">      61628 :                         during_agg_for_matrix1 &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot;&lt;&lt;web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt; endl;</span>
<span class="lineNum">    1033 </span><span class="lineCov">    3491656 :                         for(unsigned int j=0;j&lt;m5.size();j++){</span>
<span class="lineNum">    1034 </span><span class="lineCov">    8707130 :                         during_interaction_matrix1 &lt;&lt; m5[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1035 </span>            :                   }
<span class="lineNum">    1036 </span>            :                 }
<span class="lineNum">    1037 </span>            : 
<span class="lineNum">    1038 </span><span class="lineCov">         45 :                 NewSpecies * new_species = web.speciate_only_fit(NewSpecies::animal);</span>
<span class="lineNum">    1039 </span><span class="lineCov">         45 :                 web.insert(new_species);</span>
<span class="lineNum">    1040 </span><span class="lineCov">         45 :                 web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">    1041 </span><span class="lineCov">         45 :                 web.initialize_for_integration();</span>
<span class="lineNum">    1042 </span>            :                 
<span class="lineNum">    1043 </span><span class="lineCov">         45 :                 web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">    1044 </span><span class="lineCov">        135 :                 ls=web.scaled_intake_matrix(not jolly);//don't precompute if jolly</span>
<span class="lineNum">    1045 </span><span class="lineCov">        135 :                 ls=web.intake_matrix(not jolly);</span>
<span class="lineNum">    1046 </span><span class="lineCov">         45 :                 link_strength_matrix &amp; mmmm=ls;</span>
<span class="lineNum">    1047 </span><span class="lineCov">       8894 :                 for(unsigned int i=0;i&lt;mmmm.size();i++){</span>
<span class="lineNum">    1048 </span><span class="lineCov">      61943 :                   after_agg_for_matrix1 &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot;&lt;&lt; web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt;endl;</span>
<span class="lineNum">    1049 </span><span class="lineCov">    3527007 :                   for(unsigned int j=0;j&lt;mmmm.size();j++){</span>
<span class="lineNum">    1050 </span><span class="lineCov">    8795395 :                   after_interaction_matrix1 &lt;&lt; mmmm[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1051 </span>            :                   }
<span class="lineNum">    1052 </span>            :                 }
<span class="lineNum">    1053 </span>            :                 
<span class="lineNum">    1054 </span><span class="lineCov">         90 :                 web.relax(time_between_insertions,NewWeb::species_set_t(),true);</span>
<span class="lineNum">    1055 </span><span class="lineCov">         45 :                 web.get_top_down_strength();// called for side effects.</span>
<span class="lineNum">    1056 </span><span class="lineCov">        135 :                 ls=web.scaled_intake_matrix(not jolly);//don't precompute if jolly</span>
<span class="lineNum">    1057 </span><span class="lineCov">        135 :                 ls=web.intake_matrix(not jolly);</span>
<span class="lineNum">    1058 </span><span class="lineCov">         45 :                 link_strength_matrix &amp; mm=ls;</span>
<span class="lineNum">    1059 </span><span class="lineCov">       8845 :                 for(unsigned int i=0;i&lt;mm.size();i++){</span>
<span class="lineNum">    1060 </span><span class="lineCov">      61600 :                   after_agg_for_matrix &lt;&lt; web.s(i).unique_id() &lt;&lt; &quot; &quot;&lt;&lt; web.s(i).aggressivity_g() &lt;&lt; &quot; &quot; &lt;&lt; web.s(i).biomass_abundance_B() &lt;&lt;endl;</span>
<span class="lineNum">    1061 </span><span class="lineCov">    3488888 :                   for(unsigned int j=0;j&lt;mm.size();j++){</span>
<span class="lineNum">    1062 </span><span class="lineCov">    8700220 :                   after_interaction_matrix &lt;&lt; mm[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1063 </span>            :                   }
<span class="lineNum">    1064 </span>            :                 }
<span class="lineNum">    1065 </span>            :         }
<span class="lineNum">    1066 </span>            :   }  
<span class="lineNum">    1067 </span><span class="lineCov">         45 :   if(print_flows){</span>
<span class="lineNum">    1068 </span><span class="lineNoCov">          0 :         interaction_matrix.open(&quot;interaction_matrix.dat&quot;,ios_base::app);</span>
<span class="lineNum">    1069 </span><span class="lineNoCov">          0 :         biomass_interaction_matrix.open(&quot;biomass_interaction_matrix.dat&quot;,ios_base::app);</span>
<span class="lineNum">    1070 </span><span class="lineNoCov">          0 :         agg_for_matrix.open(&quot;agg_for_matrix.dat&quot;,ios_base::app);</span>
<span class="lineNum">    1071 </span><span class="lineNoCov">          0 :     const link_strength_matrix &amp; m=ls;</span>
<span class="lineNum">    1072 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; &quot;   &quot;;</span>
<span class="lineNum">    1073 </span><span class="lineNoCov">          0 :     for(unsigned int j=0;j&lt;m.size();j++)</span>
<span class="lineNum">    1074 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; std::setw(2) &lt;&lt; (j/10)%10;</span>
<span class="lineNum">    1075 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; endl;</span>
<span class="lineNum">    1076 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; &quot;   &quot;;</span>
<span class="lineNum">    1077 </span><span class="lineNoCov">          0 :     for(unsigned int j=0;j&lt;m.size();j++)</span>
<span class="lineNum">    1078 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; std::setw(2) &lt;&lt; j%10;</span>
<span class="lineNum">    1079 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; endl;</span>
<span class="lineNum">    1080 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; &quot;   &quot;;</span>
<span class="lineNum">    1081 </span><span class="lineNoCov">          0 :     for(unsigned int j=0;j&lt;m.size();j++)</span>
<span class="lineNum">    1082 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; &quot;--&quot;;</span>
<span class="lineNum">    1083 </span>            :     std::cout &lt;&lt; std::endl;
<span class="lineNum">    1084 </span><span class="lineNoCov">          0 :     for(unsigned int i=0;i&lt;m.size();i++){</span>
<span class="lineNum">    1085 </span><span class="lineNoCov">          0 :       agg_for_matrix &lt;&lt; web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1086 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; std::setw(2 ) &lt;&lt; i%100 &lt;&lt; &quot;|&quot;;</span>
<span class="lineNum">    1087 </span><span class="lineNoCov">          0 :       for(unsigned int j=0;j&lt;m.size();j++){</span>
<span class="lineNum">    1088 </span><span class="lineNoCov">          0 :         std::cout &lt;&lt; std::setw(2) &lt;&lt; order_of_magnitude(m[j][i]);</span>
<span class="lineNum">    1089 </span><span class="lineNoCov">          0 :         interaction_matrix &lt;&lt; m[i][j]/web.s(i).aggressivity_g() &lt;&lt; endl;</span>
<span class="lineNum">    1090 </span><span class="lineNoCov">          0 :         biomass_interaction_matrix &lt;&lt; m[i][j]/web.s(i).aggressivity_g()*web.s(j).biomass_abundance_B() &lt;&lt; endl;</span>
<span class="lineNum">    1091 </span>            :       }
<span class="lineNum">    1092 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; endl;</span>
<span class="lineNum">    1093 </span>            :     }
<span class="lineNum">    1094 </span>            :   }
<span class="lineNum">    1095 </span><span class="lineCov">         45 :   if(dot_graph_file.size()){</span>
<span class="lineNum">    1096 </span><span class="lineNoCov">          0 :     im.dot_graph(dot_graph_file);</span>
<span class="lineNum">    1097 </span>            :   }
<span class="lineNum">    1098 </span><span class="lineCov">         45 :   if(pajek_graph_file.size()){</span>
<span class="lineNum">    1099 </span><span class="lineNoCov">          0 :     web_data.pajek_graph(pajek_graph_file,threshold_value);</span>
<span class="lineNum">    1100 </span>            :   }
<span class="lineNum">    1101 </span><span class="lineCov">         45 :   if(print_properties){</span>
<span class="lineNum">    1102 </span><span class="lineNoCov">          0 :     sequence&lt;const char *&gt; names=Interaction_Matrix::prop_names();</span>
<span class="lineNum">    1103 </span><span class="lineNoCov">          0 :     Interaction_Matrix::distribution pr=im.props();</span>
<span class="lineNum">    1104 </span>            : 
<span class="lineNum">    1105 </span><span class="lineNoCov">          0 :     for(unsigned int j=0;j&lt;pr.size();j++){</span>
<span class="lineNum">    1106 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; names[j] &lt;&lt; &quot; &quot; </span>
<span class="lineNum">    1107 </span><span class="lineNoCov">          0 :            &lt;&lt; pr[j]</span>
<span class="lineNum">    1108 </span><span class="lineNoCov">          0 :            &lt;&lt; endl;</span>
<span class="lineNum">    1109 </span>            :     }
<span class="lineNum">    1110 </span>            :   }
<span class="lineNum">    1111 </span><span class="lineCov">         45 :   if(eigenvalue_file){</span>
<span class="lineNum">    1112 </span><span class="lineNoCov">          0 :     web.eigenvalue_list(eigenvalue_file);</span>
<span class="lineNum">    1113 </span>            :   }
<span class="lineNum">    1114 </span><span class="lineCov">         45 :   if(generality_file){</span>
<span class="lineNum">    1115 </span><span class="lineNoCov">          0 :     ofstream os(generality_file);</span>
<span class="lineNum">    1116 </span><span class="lineNoCov">          0 :     im.cumulative_prey_hist(os);</span>
<span class="lineNum">    1117 </span>            :   }
<span class="lineNum">    1118 </span><span class="lineCov">         45 :   if(vulnerability_file){</span>
<span class="lineNum">    1119 </span><span class="lineNoCov">          0 :     ofstream os(vulnerability_file);</span>
<span class="lineNum">    1120 </span><span class="lineNoCov">          0 :     im.cumulative_predator_hist(os);</span>
<span class="lineNum">    1121 </span>            :   }
<span class="lineNum">    1122 </span><span class="lineCov">         45 :   if(rank_abundance_plot){</span>
<span class="lineNum">    1123 </span><span class="lineNoCov">          0 :     web.rank_abundance_plot(rank_abundance_plot,!lump_lowest_level);</span>
<span class="lineNum">    1124 </span>            :   }    
<span class="lineNum">    1125 </span><span class="lineCov">         45 :   if(size_spectrum_file){</span>
<span class="lineNum">    1126 </span><span class="lineNoCov">          0 :     if(file_type==nls)</span>
<span class="lineNum">    1127 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;cannot compute size spectrum for SCOR files&quot;);</span>
<span class="lineNum">    1128 </span><span class="lineNoCov">          0 :     ostringstream p,a,t;</span>
<span class="lineNum">    1129 </span><span class="lineNoCov">          0 :     p &lt;&lt; &quot;p&quot; &lt;&lt; size_spectrum_file;</span>
<span class="lineNum">    1130 </span><span class="lineNoCov">          0 :     a &lt;&lt; &quot;a&quot; &lt;&lt; size_spectrum_file;</span>
<span class="lineNum">    1131 </span><span class="lineNoCov">          0 :     t &lt;&lt; &quot;t&quot; &lt;&lt; size_spectrum_file;</span>
<span class="lineNum">    1132 </span><span class="lineNoCov">          0 :     web_data.size_spectrum(p.str().c_str(),1,0);</span>
<span class="lineNum">    1133 </span><span class="lineNoCov">          0 :     web_data.size_spectrum(a.str().c_str(),0,1);</span>
<span class="lineNum">    1134 </span><span class="lineNoCov">          0 :     web_data.size_spectrum(t.str().c_str(),1,1);</span>
<span class="lineNum">    1135 </span><span class="lineNoCov">          0 :     Mass_Integrator().spectrum(web_data.get_biomasses(),</span>
<span class="lineNum">    1136 </span><span class="lineNoCov">          0 :                                web_data.get_bodymasses(),</span>
<span class="lineNum">    1137 </span><span class="lineNoCov">          0 :                                size_spectrum_file,/* take log 10?*/true);</span>
<span class="lineNum">    1138 </span>            :   }    
<span class="lineNum">    1139 </span><span class="lineCov">         45 :   if(biomass_spectrum_file){</span>
<span class="lineNum">    1140 </span><span class="lineNoCov">          0 :     if(file_type==nls)</span>
<span class="lineNum">    1141 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;cannot compute biomass spectrum for SCOR files&quot;);</span>
<span class="lineNum">    1142 </span><span class="lineNoCov">          0 :     ostringstream p,a,t;</span>
<span class="lineNum">    1143 </span><span class="lineNoCov">          0 :     p &lt;&lt; &quot;p&quot; &lt;&lt; biomass_spectrum_file;</span>
<span class="lineNum">    1144 </span><span class="lineNoCov">          0 :     a &lt;&lt; &quot;a&quot; &lt;&lt; biomass_spectrum_file;</span>
<span class="lineNum">    1145 </span><span class="lineNoCov">          0 :     t &lt;&lt; &quot;t&quot; &lt;&lt; biomass_spectrum_file;</span>
<span class="lineNum">    1146 </span><span class="lineNoCov">          0 :     web_data.biomass_spectrum(p.str().c_str(),1,0);</span>
<span class="lineNum">    1147 </span><span class="lineNoCov">          0 :     web_data.biomass_spectrum(a.str().c_str(),0,1);</span>
<span class="lineNum">    1148 </span><span class="lineNoCov">          0 :     web_data.biomass_spectrum(t.str().c_str(),1,1);</span>
<span class="lineNum">    1149 </span>            :   }    
<span class="lineNum">    1150 </span><span class="lineCov">         45 :   if(rectification_base_name){</span>
<span class="lineNum">    1151 </span><span class="lineNoCov">          0 :     ostringstream i,t;</span>
<span class="lineNum">    1152 </span><span class="lineNoCov">          0 :     i &lt;&lt; rectification_base_name &lt;&lt; &quot;.pgm&quot;;</span>
<span class="lineNum">    1153 </span><span class="lineNoCov">          0 :     t &lt;&lt; rectification_base_name &lt;&lt; &quot;.dat&quot;;</span>
<span class="lineNum">    1154 </span><span class="lineNoCov">          0 :     permutation p=web_data.rectification();</span>
<span class="lineNum">    1155 </span><span class="lineNoCov">          0 :     threshold(web_data.ifrac(),threshold_value).</span>
<span class="lineNum">    1156 </span><span class="lineNoCov">          0 :       permute(p.inverse()).</span>
<span class="lineNum">    1157 </span><span class="lineNoCov">          0 :       pgm_write(i.str().c_str());</span>
<span class="lineNum">    1158 </span><span class="lineNoCov">          0 :     cout &lt;&lt; &quot;rectified_niche_width &quot; &lt;&lt; sqrt(web_data.Omega(p,2.2)) </span>
<span class="lineNum">    1159 </span><span class="lineNoCov">          0 :          &lt;&lt; &quot;                           &quot; &lt;&lt; endl;</span>
<span class="lineNum">    1160 </span>            :   }
<span class="lineNum">    1161 </span><span class="lineCov">         45 :   if(file_type==xml &amp;&amp; competition_file){</span>
<span class="lineNum">    1162 </span><span class="lineNoCov">          0 :     web.write_competition_matrix(competition_file);</span>
<span class="lineNum">    1163 </span>            :   }
<span class="lineNum">    1164 </span><span class="lineCov">         45 :   if(species_table){</span>
<span class="lineNum">    1165 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1166 </span><span class="lineNoCov">          0 :       web.species_table(species_table,true,</span>
<span class="lineNum">    1167 </span><span class="lineNoCov">          0 :                         threshold_value,web_data,jolly);</span>
<span class="lineNum">    1168 </span>            :     }else{
<span class="lineNum">    1169 </span><span class="lineNoCov">          0 :       web_data.species_table(species_table,true,</span>
<span class="lineNum">    1170 </span><span class="lineNoCov">          0 :                              threshold_value);</span>
<span class="lineNum">    1171 </span>            :     }
<span class="lineNum">    1172 </span>            :   }
<span class="lineNum">    1173 </span><span class="lineCov">         45 :   if(species_table2){</span>
<span class="lineNum">    1174 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1175 </span><span class="lineNoCov">          0 :       web.species_table2(species_table2,true,</span>
<span class="lineNum">    1176 </span><span class="lineNoCov">          0 :                         threshold_value,web_data,ls,coldelS,jolly);</span>
<span class="lineNum">    1177 </span>            :     }else{
<span class="lineNum">    1178 </span><span class="lineNoCov">          0 :       web_data.species_table2(species_table2,true,</span>
<span class="lineNum">    1179 </span><span class="lineNoCov">          0 :                              threshold_value);</span>
<span class="lineNum">    1180 </span>            :     }
<span class="lineNum">    1181 </span>            :   }
<span class="lineNum">    1182 </span><span class="lineCov">         45 :   if(species_table3){</span>
<span class="lineNum">    1183 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1184 </span><span class="lineNoCov">          0 :       web.species_table3(species_table3,true,</span>
<span class="lineNum">    1185 </span><span class="lineNoCov">          0 :                          threshold_value,web_data,ls,jolly);</span>
<span class="lineNum">    1186 </span>            :     }else{
<span class="lineNum">    1187 </span><span class="lineNoCov">          0 :       web_data.species_table3(species_table3,true,</span>
<span class="lineNum">    1188 </span><span class="lineNoCov">          0 :                              threshold_value);</span>
<span class="lineNum">    1189 </span>            :     }
<span class="lineNum">    1190 </span>            :   }
<span class="lineNum">    1191 </span><span class="lineCov">         45 :   if(link_coefficient_matrix_file){</span>
<span class="lineNum">    1192 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1193 </span><span class="lineNoCov">          0 :       web.write_link_coefficient_matrix(link_coefficient_matrix_file);</span>
<span class="lineNum">    1194 </span>            :     }else{
<span class="lineNum">    1195 </span><span class="lineNoCov">          0 :       FATAL_ERROR(&quot;Option -n not implemented for this filetype.&quot;);</span>
<span class="lineNum">    1196 </span>            :     }
<span class="lineNum">    1197 </span>            :   }
<span class="lineNum">    1198 </span><span class="lineCov">         45 :   if(link_table){</span>
<span class="lineNum">    1199 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1200 </span><span class="lineNoCov">          0 :       web.link_table(link_table,threshold_value,ls,biomass_B);</span>
<span class="lineNum">    1201 </span>            :     }else{
<span class="lineNum">    1202 </span><span class="lineNoCov">          0 :       web_data.link_table(link_table, threshold_value);</span>
<span class="lineNum">    1203 </span>            :     }
<span class="lineNum">    1204 </span>            :   }
<span class="lineNum">    1205 </span><span class="lineCov">         45 :   if(link_table2){</span>
<span class="lineNum">    1206 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1207 </span><span class="lineNoCov">          0 :       web.link_table2(link_table2,threshold_value,ls,biomass_B);</span>
<span class="lineNum">    1208 </span>            :     }else{
<span class="lineNum">    1209 </span><span class="lineNoCov">          0 :       web_data.link_table2(link_table2, threshold_value);</span>
<span class="lineNum">    1210 </span>            :     }
<span class="lineNum">    1211 </span>            :   }
<span class="lineNum">    1212 </span><span class="lineCov">         45 :   if(file_type==xml &amp;&amp; log_availability_structure_file){</span>
<span class="lineNum">    1213 </span>            :     multinormal_distribution log_avs=
<span class="lineNum">    1214 </span><span class="lineNoCov">          0 :       web.log_availability_structure();</span>
<span class="lineNum">    1215 </span><span class="lineNoCov">          0 :     log_avs.save(log_availability_structure_file);</span>
<span class="lineNum">    1216 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; &quot;var_log_availability &quot; </span>
<span class="lineNum">    1217 </span><span class="lineNoCov">          0 :               &lt;&lt; log_avs.var_of_sum() </span>
<span class="lineNum">    1218 </span><span class="lineNoCov">          0 :               &lt;&lt; std::endl;</span>
<span class="lineNum">    1219 </span>            :   }
<span class="lineNum">    1220 </span><span class="lineCov">         45 :   if(print_indices){</span>
<span class="lineNum">    1221 </span><span class="lineNoCov">          0 :     bool with_plants=!lump_lowest_level;</span>
<span class="lineNum">    1222 </span>            : 
<span class="lineNum">    1223 </span>            :     double S=(with_plants?
<span class="lineNum">    1224 </span><span class="lineNoCov">          0 :               web_data.number_of_species():</span>
<span class="lineNum">    1225 </span><span class="lineNoCov">          0 :               web_data.number_of_animals() );</span>
<span class="lineNum">    1226 </span>            :       
<span class="lineNum">    1227 </span><span class="lineNoCov">          0 :     double H=web_data.Shanon_diversity_H(with_plants,true);</span>
<span class="lineNum">    1228 </span>            : 
<span class="lineNum">    1229 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; S &lt;&lt; &quot;(S)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1230 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; 1/web_data.Simpson_s_diversity_D(with_plants,true) &lt;&lt; &quot;(1/D)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1231 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; 1-web_data.Simpson_s_diversity_D(with_plants,true) &lt;&lt; &quot;(1-D)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1232 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; H &lt;&lt; &quot;(H)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1233 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; exp(H) &lt;&lt; &quot;(expH)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1234 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; H/log(S) &lt;&lt; &quot;(E)&quot; &lt;&lt; std::endl; // Pielou's evenness index</span>
<span class="lineNum">    1235 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; web_data.max_level() &lt;&lt; &quot;(hmax)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1236 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; web_data.mean_level() &lt;&lt; &quot;(hmean)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1237 </span><span class="lineNoCov">          0 :     std::cout &lt;&lt; web_data.biomass_weighted_mean_level() &lt;&lt; &quot;(hBmean)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1238 </span><span class="lineNoCov">          0 :     if(file_type==xml){</span>
<span class="lineNum">    1239 </span>            :       std::cout &lt;&lt; 
<span class="lineNum">    1240 </span><span class="lineNoCov">          0 :         web.biomass_larger(min_size_of_things_we_care_about)/</span>
<span class="lineNum">    1241 </span><span class="lineNoCov">          0 :         baseline_web.biomass_larger(min_size_of_things_we_care_about) &lt;&lt; </span>
<span class="lineNum">    1242 </span><span class="lineNoCov">          0 :         &quot;(FishI)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1243 </span><span class="lineNoCov">          0 :       std::cout &lt;&lt; web.GPP()/baseline_web.GPP() &lt;&lt; &quot;(GPPI)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1244 </span>            :       std::cout &lt;&lt; 
<span class="lineNum">    1245 </span><span class="lineNoCov">          0 :         web.Living_Planet_Index(baseline_web,with_plants,true) &lt;&lt; &quot;(LPI)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1246 </span>            :       std::cout &lt;&lt; 
<span class="lineNum">    1247 </span><span class="lineNoCov">          0 :         web.Biodiversity_Intactness_Index(baseline_web,with_plants,true) </span>
<span class="lineNum">    1248 </span><span class="lineNoCov">          0 :                 &lt;&lt; &quot;(BII)&quot; &lt;&lt; std::endl;</span>
<span class="lineNum">    1249 </span>            :     }
<span class="lineNum">    1250 </span>            :   }
<span class="lineNum">    1251 </span><span class="lineCov">         45 :   if(report_pressures || invasion_fitness_curve || fitness_samples){</span>
<span class="lineNum">    1252 </span><span class="lineNoCov">          0 :     if(!waiting_time){</span>
<span class="lineNum">    1253 </span><span class="lineNoCov">          0 :       REPORT(waiting_time);</span>
<span class="lineNum">    1254 </span><span class="lineNoCov">          0 :       WARNING(&quot;Cannot report evolutionary pressures&quot;);</span>
<span class="lineNum">    1255 </span><span class="lineNoCov">          0 :       WARNING(&quot;Must set -w option&quot;);</span>
<span class="lineNum">    1256 </span><span class="lineNoCov">          0 :     }else if(file_type!=xml){</span>
<span class="lineNum">    1257 </span><span class="lineNoCov">          0 :       WARNING(&quot;Cannot report evolutionary pressures&quot;);</span>
<span class="lineNum">    1258 </span><span class="lineNoCov">          0 :       WARNING(&quot;Works only for xml files&quot;);</span>
<span class="lineNum">    1259 </span>            :     }else{
<span class="lineNum">    1260 </span><span class="lineNoCov">          0 :       if(report_pressures){</span>
<span class="lineNum">    1261 </span><span class="lineNoCov">          0 :         web.report_evolutionary_pressures(iterations_for_pressures);</span>
<span class="lineNum">    1262 </span>            :       }
<span class="lineNum">    1263 </span><span class="lineNoCov">          0 :       if(invasion_fitness_curve){</span>
<span class="lineNum">    1264 </span><span class="lineNoCov">          0 :         web.invasion_fitness_curve(invasion_fitness_curve);</span>
<span class="lineNum">    1265 </span>            :       }
<span class="lineNum">    1266 </span><span class="lineNoCov">          0 :       if(fitness_samples){</span>
<span class="lineNum">    1267 </span><span class="lineNoCov">          0 :         web.invasion_fitness_samples(fitness_samples);</span>
<span class="lineNum">    1268 </span>            :       }
<span class="lineNum">    1269 </span>            :     }
<span class="lineNum">    1270 </span>            :   }
<span class="lineNum">    1271 </span><span class="lineCov">         45 :   if(get_msy){</span>
<span class="lineNum">    1272 </span>            : #if 0
<span class="lineNum">    1273 </span>            :     vector&lt;string&gt; catchability_function(1);
<span class="lineNum">    1274 </span>            : #define MMIN &quot;(1*gram)&quot;
<span class="lineNum">    1275 </span>            :     catchability_function[0]=
<span class="lineNum">    1276 </span>            :       &quot;(1-1/(1+(Mmat/&quot; MMIN &quot;)^4))&quot; &quot;*(Mmat/&quot; MMIN &quot;)^(-1/4)&quot;;
<span class="lineNum">    1277 </span>            :     //    catchability_function[1]=&quot;exp(-log(Mmat/(100*gram))^2/(2*log(3)^2))&quot;;
<span class="lineNum">    1278 </span>            :    //    catchability_function[0]=&quot;(1-1/(1+(Mmat/(1000*gram))^4))*sin(1000*log(Mmat))^2&quot;;
<span class="lineNum">    1279 </span>            :    //    catchability_function[1]=&quot;(1-1/(1+(Mmat/(1000*gram))^4))*sin(7327*log(Mmat))^2&quot;;
<span class="lineNum">    1280 </span>            :     //catchability_function[1]=&quot;10*exp(-log(Mmat/(100*gram))^2/(2*log(3)^2))&quot;;
<span class="lineNum">    1281 </span>            :     //catchability_function[0]=&quot;exp(-log(Mmat/(10*gram))^2/(2*log(10)^2))&quot;;
<span class="lineNum">    1282 </span>            :     MSY_fleets msy(web,catchability_function);
<span class="lineNum">    1283 </span>            : #else 
<span class="lineNum">    1284 </span><span class="lineNoCov">          0 :     vector&lt;int&gt; fished;</span>
<span class="lineNum">    1285 </span><span class="lineNoCov">          0 :     double cutoff=get_cfg_parameter(&quot;catchability_cutoff&quot;);</span>
<span class="lineNum">    1286 </span><span class="lineNoCov">          0 :     for(int i=web.number_of_species();i--&gt;0;){</span>
<span class="lineNum">    1287 </span><span class="lineNoCov">          0 :       if(web.s[i].mean_bodymass_M() &gt;= cutoff){</span>
<span class="lineNum">    1288 </span><span class="lineNoCov">          0 :         fished.push_back(web.assigned_column(i));</span>
<span class="lineNum">    1289 </span>            :         // if(!cin.eof()){
<span class="lineNum">    1290 </span>            :         //   cout &lt;&lt; &quot;Pipe in list of mortalities, or hit [return]&quot; &lt;&lt; endl;
<span class="lineNum">    1291 </span>            :         //   // Read fishing mortalities from standard input if
<span class="lineNum">    1292 </span>            :         //   // available.
<span class="lineNum">    1293 </span>            :         //   double F;
<span class="lineNum">    1294 </span>            :         //   cin &gt;&gt; F;
<span class="lineNum">    1295 </span>            :         //   web.s[i].set_fishing_mortality(F);
<span class="lineNum">    1296 </span>            :         // }
<span class="lineNum">    1297 </span>            :       }
<span class="lineNum">    1298 </span>            :     }
<span class="lineNum">    1299 </span><span class="lineNoCov">          0 :     MSY_species msy(web,fished);</span>
<span class="lineNum">    1300 </span>            :     if(1){
<span class="lineNum">    1301 </span>            :       //individual_transposed_interaction_controller_t HCR(msy);
<span class="lineNum">    1302 </span>            :       //individual_target_pressure_controller_t HCR(msy);
<span class="lineNum">    1303 </span><span class="lineNoCov">          0 :       individual_productive_state_controller_t HCR(msy);</span>
<span class="lineNum">    1304 </span>            :       //soft_individual_productive_state_controller_t HCR(msy);
<span class="lineNum">    1305 </span>            :       //individual_B_transposed_interaction_controller_t HCR(msy);
<span class="lineNum">    1306 </span>            :       //individual_B_target_pressure_controller_t HCR(msy);
<span class="lineNum">    1307 </span>            :       //individual_B_target_pressure_controller_t HCR(msy);
<span class="lineNum">    1308 </span>            :       //individual_B_productive_state_controller_t HCR(msy);
<span class="lineNum">    1309 </span>            :       //productive_state_controller_t HCR(msy);
<span class="lineNum">    1310 </span>            :       //transposed_interaction_controller_t HCR(msy);
<span class="lineNum">    1311 </span>            :       //target_pressure_controller_t HCR(msy);
<span class="lineNum">    1312 </span>            :       //growth_rate_controller_t HCR(msy);
<span class="lineNum">    1313 </span>            :       //CFP_controller_t HCR(msy);
<span class="lineNum">    1314 </span>            :       //DPF_controller_t HCR(msy);
<span class="lineNum">    1315 </span>            :       HCR.recompute_strategy();
<span class="lineNum">    1316 </span><span class="lineNoCov">          0 :       for(int rep=31;rep--&gt;0;){</span>
<span class="lineNum">    1317 </span><span class="lineNoCov">          0 :         HCR.relax(eval(&quot;50*year&quot;),NewWeb::species_set_t(),false);</span>
<span class="lineNum">    1318 </span>            :         HCR.recompute_strategy();
<span class="lineNum">    1319 </span>            :       }
<span class="lineNum">    1320 </span><span class="lineNoCov">          0 :       HCR.relax(eval(&quot;50*year&quot;),NewWeb::species_set_t(),false);</span>
<span class="lineNum">    1321 </span><span class="lineNoCov">          0 :       NewWeb test=HCR;</span>
<span class="lineNum">    1322 </span><span class="lineNoCov">          0 :       cfgPermanent parameters;</span>
<span class="lineNum">    1323 </span>            :       XMLStore()
<span class="lineNum">    1324 </span><span class="lineNoCov">          0 :         .put(version,&quot;version&quot;)</span>
<span class="lineNum">    1325 </span><span class="lineNoCov">          0 :         .put(compilation_time,&quot;compilation_time&quot;)</span>
<span class="lineNum">    1326 </span><span class="lineNoCov">          0 :         .put(&amp;parameters,&quot;adjustable_parameters&quot;)</span>
<span class="lineNum">    1327 </span><span class="lineNoCov">          0 :         .put(&amp;HCR,&quot;FoodWeb&quot;)</span>
<span class="lineNum">    1328 </span><span class="lineNoCov">          0 :         .save(&quot;HCR-web.xml.bz2&quot;);</span>
<span class="lineNum">    1329 </span><span class="lineNoCov">          0 :       exit(0);</span>
<span class="lineNum">    1330 </span>            :     }
<span class="lineNum">    1331 </span>            : #endif
<span class="lineNum">    1332 </span>            :     msy.find_MSY();
<span class="lineNum">    1333 </span>            :     REPORT(msy.yield());
<span class="lineNum">    1334 </span>            :     //    exit_now=false; // we are exiting soon anyway!
<span class="lineNum">    1335 </span>            :     msy.optimally_exploited_web(web);
<span class="lineNum">    1336 </span>            : 
<span class="lineNum">    1337 </span>            :     {
<span class="lineNum">    1338 </span>            :       cfgPermanent parameters;
<span class="lineNum">    1339 </span>            :       XMLStore()
<span class="lineNum">    1340 </span>            :         .put(version,&quot;version&quot;)
<span class="lineNum">    1341 </span>            :         .put(compilation_time,&quot;compilation_time&quot;)
<span class="lineNum">    1342 </span>            :         .put(&amp;parameters,&quot;adjustable_parameters&quot;)
<span class="lineNum">    1343 </span>            :         .put(&amp;web,&quot;FoodWeb&quot;)
<span class="lineNum">    1344 </span>            :         .save(&quot;MSY-web.xml.bz2&quot;);
<a name="1345"><span class="lineNum">    1345 </span>            :     }</a>
<span class="lineNum">    1346 </span>            :   }
<span class="lineNum">    1347 </span><span class="lineCov">        180 : }</span>
<span class="lineNum">    1348 </span>            : 
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
